/*! jQuery v2.1.3 | (c) 2005, 2014 jQuery Foundation, Inc. | jquery.org/license */
!function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("jQuery requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){var c=[],d=c.slice,e=c.concat,f=c.push,g=c.indexOf,h={},i=h.toString,j=h.hasOwnProperty,k={},l=a.document,m="2.1.3",n=function(a,b){return new n.fn.init(a,b)},o=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,p=/^-ms-/,q=/-([\da-z])/gi,r=function(a,b){return b.toUpperCase()};n.fn=n.prototype={jquery:m,constructor:n,selector:"",length:0,toArray:function(){return d.call(this)},get:function(a){return null!=a?0>a?this[a+this.length]:this[a]:d.call(this)},pushStack:function(a){var b=n.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a,b){return n.each(this,a,b)},map:function(a){return this.pushStack(n.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(d.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:f,sort:c.sort,splice:c.splice},n.extend=n.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||n.isFunction(g)||(g={}),h===i&&(g=this,h--);i>h;h++)if(null!=(a=arguments[h]))for(b in a)c=g[b],d=a[b],g!==d&&(j&&d&&(n.isPlainObject(d)||(e=n.isArray(d)))?(e?(e=!1,f=c&&n.isArray(c)?c:[]):f=c&&n.isPlainObject(c)?c:{},g[b]=n.extend(j,f,d)):void 0!==d&&(g[b]=d));return g},n.extend({expando:"jQuery"+(m+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return"function"===n.type(a)},isArray:Array.isArray,isWindow:function(a){return null!=a&&a===a.window},isNumeric:function(a){return!n.isArray(a)&&a-parseFloat(a)+1>=0},isPlainObject:function(a){return"object"!==n.type(a)||a.nodeType||n.isWindow(a)?!1:a.constructor&&!j.call(a.constructor.prototype,"isPrototypeOf")?!1:!0},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?h[i.call(a)]||"object":typeof a},globalEval:function(a){var b,c=eval;a=n.trim(a),a&&(1===a.indexOf("use strict")?(b=l.createElement("script"),b.text=a,l.head.appendChild(b).parentNode.removeChild(b)):c(a))},camelCase:function(a){return a.replace(p,"ms-").replace(q,r)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b,c){var d,e=0,f=a.length,g=s(a);if(c){if(g){for(;f>e;e++)if(d=b.apply(a[e],c),d===!1)break}else for(e in a)if(d=b.apply(a[e],c),d===!1)break}else if(g){for(;f>e;e++)if(d=b.call(a[e],e,a[e]),d===!1)break}else for(e in a)if(d=b.call(a[e],e,a[e]),d===!1)break;return a},trim:function(a){return null==a?"":(a+"").replace(o,"")},makeArray:function(a,b){var c=b||[];return null!=a&&(s(Object(a))?n.merge(c,"string"==typeof a?[a]:a):f.call(c,a)),c},inArray:function(a,b,c){return null==b?-1:g.call(b,a,c)},merge:function(a,b){for(var c=+b.length,d=0,e=a.length;c>d;d++)a[e++]=b[d];return a.length=e,a},grep:function(a,b,c){for(var d,e=[],f=0,g=a.length,h=!c;g>f;f++)d=!b(a[f],f),d!==h&&e.push(a[f]);return e},map:function(a,b,c){var d,f=0,g=a.length,h=s(a),i=[];if(h)for(;g>f;f++)d=b(a[f],f,c),null!=d&&i.push(d);else for(f in a)d=b(a[f],f,c),null!=d&&i.push(d);return e.apply([],i)},guid:1,proxy:function(a,b){var c,e,f;return"string"==typeof b&&(c=a[b],b=a,a=c),n.isFunction(a)?(e=d.call(arguments,2),f=function(){return a.apply(b||this,e.concat(d.call(arguments)))},f.guid=a.guid=a.guid||n.guid++,f):void 0},now:Date.now,support:k}),n.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(a,b){h["[object "+b+"]"]=b.toLowerCase()});function s(a){var b=a.length,c=n.type(a);return"function"===c||n.isWindow(a)?!1:1===a.nodeType&&b?!0:"array"===c||0===b||"number"==typeof b&&b>0&&b-1 in a}var t=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u="sizzle"+1*new Date,v=a.document,w=0,x=0,y=hb(),z=hb(),A=hb(),B=function(a,b){return a===b&&(l=!0),0},C=1<<31,D={}.hasOwnProperty,E=[],F=E.pop,G=E.push,H=E.push,I=E.slice,J=function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1},K="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",L="[\\x20\\t\\r\\n\\f]",M="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",N=M.replace("w","w#"),O="\\["+L+"*("+M+")(?:"+L+"*([*^$|!~]?=)"+L+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+N+"))|)"+L+"*\\]",P=":("+M+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+O+")*)|.*)\\)|)",Q=new RegExp(L+"+","g"),R=new RegExp("^"+L+"+|((?:^|[^\\\\])(?:\\\\.)*)"+L+"+$","g"),S=new RegExp("^"+L+"*,"+L+"*"),T=new RegExp("^"+L+"*([>+~]|"+L+")"+L+"*"),U=new RegExp("="+L+"*([^\\]'\"]*?)"+L+"*\\]","g"),V=new RegExp(P),W=new RegExp("^"+N+"$"),X={ID:new RegExp("^#("+M+")"),CLASS:new RegExp("^\\.("+M+")"),TAG:new RegExp("^("+M.replace("w","w*")+")"),ATTR:new RegExp("^"+O),PSEUDO:new RegExp("^"+P),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+L+"*(even|odd|(([+-]|)(\\d*)n|)"+L+"*(?:([+-]|)"+L+"*(\\d+)|))"+L+"*\\)|)","i"),bool:new RegExp("^(?:"+K+")$","i"),needsContext:new RegExp("^"+L+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+L+"*((?:-\\d)?\\d*)"+L+"*\\)|)(?=[^-]|$)","i")},Y=/^(?:input|select|textarea|button)$/i,Z=/^h\d$/i,$=/^[^{]+\{\s*\[native \w/,_=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ab=/[+~]/,bb=/'|\\/g,cb=new RegExp("\\\\([\\da-f]{1,6}"+L+"?|("+L+")|.)","ig"),db=function(a,b,c){var d="0x"+b-65536;return d!==d||c?b:0>d?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)},eb=function(){m()};try{H.apply(E=I.call(v.childNodes),v.childNodes),E[v.childNodes.length].nodeType}catch(fb){H={apply:E.length?function(a,b){G.apply(a,I.call(b))}:function(a,b){var c=a.length,d=0;while(a[c++]=b[d++]);a.length=c-1}}}function gb(a,b,d,e){var f,h,j,k,l,o,r,s,w,x;if((b?b.ownerDocument||b:v)!==n&&m(b),b=b||n,d=d||[],k=b.nodeType,"string"!=typeof a||!a||1!==k&&9!==k&&11!==k)return d;if(!e&&p){if(11!==k&&(f=_.exec(a)))if(j=f[1]){if(9===k){if(h=b.getElementById(j),!h||!h.parentNode)return d;if(h.id===j)return d.push(h),d}else if(b.ownerDocument&&(h=b.ownerDocument.getElementById(j))&&t(b,h)&&h.id===j)return d.push(h),d}else{if(f[2])return H.apply(d,b.getElementsByTagName(a)),d;if((j=f[3])&&c.getElementsByClassName)return H.apply(d,b.getElementsByClassName(j)),d}if(c.qsa&&(!q||!q.test(a))){if(s=r=u,w=b,x=1!==k&&a,1===k&&"object"!==b.nodeName.toLowerCase()){o=g(a),(r=b.getAttribute("id"))?s=r.replace(bb,"\\$&"):b.setAttribute("id",s),s="[id='"+s+"'] ",l=o.length;while(l--)o[l]=s+rb(o[l]);w=ab.test(a)&&pb(b.parentNode)||b,x=o.join(",")}if(x)try{return H.apply(d,w.querySelectorAll(x)),d}catch(y){}finally{r||b.removeAttribute("id")}}}return i(a.replace(R,"$1"),b,d,e)}function hb(){var a=[];function b(c,e){return a.push(c+" ")>d.cacheLength&&delete b[a.shift()],b[c+" "]=e}return b}function ib(a){return a[u]=!0,a}function jb(a){var b=n.createElement("div");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function kb(a,b){var c=a.split("|"),e=a.length;while(e--)d.attrHandle[c[e]]=b}function lb(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||C)-(~a.sourceIndex||C);if(d)return d;if(c)while(c=c.nextSibling)if(c===b)return-1;return a?1:-1}function mb(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function nb(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function ob(a){return ib(function(b){return b=+b,ib(function(c,d){var e,f=a([],c.length,b),g=f.length;while(g--)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function pb(a){return a&&"undefined"!=typeof a.getElementsByTagName&&a}c=gb.support={},f=gb.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?"HTML"!==b.nodeName:!1},m=gb.setDocument=function(a){var b,e,g=a?a.ownerDocument||a:v;return g!==n&&9===g.nodeType&&g.documentElement?(n=g,o=g.documentElement,e=g.defaultView,e&&e!==e.top&&(e.addEventListener?e.addEventListener("unload",eb,!1):e.attachEvent&&e.attachEvent("onunload",eb)),p=!f(g),c.attributes=jb(function(a){return a.className="i",!a.getAttribute("className")}),c.getElementsByTagName=jb(function(a){return a.appendChild(g.createComment("")),!a.getElementsByTagName("*").length}),c.getElementsByClassName=$.test(g.getElementsByClassName),c.getById=jb(function(a){return o.appendChild(a).id=u,!g.getElementsByName||!g.getElementsByName(u).length}),c.getById?(d.find.ID=function(a,b){if("undefined"!=typeof b.getElementById&&p){var c=b.getElementById(a);return c&&c.parentNode?[c]:[]}},d.filter.ID=function(a){var b=a.replace(cb,db);return function(a){return a.getAttribute("id")===b}}):(delete d.find.ID,d.filter.ID=function(a){var b=a.replace(cb,db);return function(a){var c="undefined"!=typeof a.getAttributeNode&&a.getAttributeNode("id");return c&&c.value===b}}),d.find.TAG=c.getElementsByTagName?function(a,b){return"undefined"!=typeof b.getElementsByTagName?b.getElementsByTagName(a):c.qsa?b.querySelectorAll(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){while(c=f[e++])1===c.nodeType&&d.push(c);return d}return f},d.find.CLASS=c.getElementsByClassName&&function(a,b){return p?b.getElementsByClassName(a):void 0},r=[],q=[],(c.qsa=$.test(g.querySelectorAll))&&(jb(function(a){o.appendChild(a).innerHTML="<a id='"+u+"'></a><select id='"+u+"-\f]' msallowcapture=''><option selected=''></option></select>",a.querySelectorAll("[msallowcapture^='']").length&&q.push("[*^$]="+L+"*(?:''|\"\")"),a.querySelectorAll("[selected]").length||q.push("\\["+L+"*(?:value|"+K+")"),a.querySelectorAll("[id~="+u+"-]").length||q.push("~="),a.querySelectorAll(":checked").length||q.push(":checked"),a.querySelectorAll("a#"+u+"+*").length||q.push(".#.+[+~]")}),jb(function(a){var b=g.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("name","D"),a.querySelectorAll("[name=d]").length&&q.push("name"+L+"*[*^$|!~]?="),a.querySelectorAll(":enabled").length||q.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),q.push(",.*:")})),(c.matchesSelector=$.test(s=o.matches||o.webkitMatchesSelector||o.mozMatchesSelector||o.oMatchesSelector||o.msMatchesSelector))&&jb(function(a){c.disconnectedMatch=s.call(a,"div"),s.call(a,"[s!='']:x"),r.push("!=",P)}),q=q.length&&new RegExp(q.join("|")),r=r.length&&new RegExp(r.join("|")),b=$.test(o.compareDocumentPosition),t=b||$.test(o.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)while(b=b.parentNode)if(b===a)return!0;return!1},B=b?function(a,b){if(a===b)return l=!0,0;var d=!a.compareDocumentPosition-!b.compareDocumentPosition;return d?d:(d=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&d||!c.sortDetached&&b.compareDocumentPosition(a)===d?a===g||a.ownerDocument===v&&t(v,a)?-1:b===g||b.ownerDocument===v&&t(v,b)?1:k?J(k,a)-J(k,b):0:4&d?-1:1)}:function(a,b){if(a===b)return l=!0,0;var c,d=0,e=a.parentNode,f=b.parentNode,h=[a],i=[b];if(!e||!f)return a===g?-1:b===g?1:e?-1:f?1:k?J(k,a)-J(k,b):0;if(e===f)return lb(a,b);c=a;while(c=c.parentNode)h.unshift(c);c=b;while(c=c.parentNode)i.unshift(c);while(h[d]===i[d])d++;return d?lb(h[d],i[d]):h[d]===v?-1:i[d]===v?1:0},g):n},gb.matches=function(a,b){return gb(a,null,null,b)},gb.matchesSelector=function(a,b){if((a.ownerDocument||a)!==n&&m(a),b=b.replace(U,"='$1']"),!(!c.matchesSelector||!p||r&&r.test(b)||q&&q.test(b)))try{var d=s.call(a,b);if(d||c.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return gb(b,n,null,[a]).length>0},gb.contains=function(a,b){return(a.ownerDocument||a)!==n&&m(a),t(a,b)},gb.attr=function(a,b){(a.ownerDocument||a)!==n&&m(a);var e=d.attrHandle[b.toLowerCase()],f=e&&D.call(d.attrHandle,b.toLowerCase())?e(a,b,!p):void 0;return void 0!==f?f:c.attributes||!p?a.getAttribute(b):(f=a.getAttributeNode(b))&&f.specified?f.value:null},gb.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},gb.uniqueSort=function(a){var b,d=[],e=0,f=0;if(l=!c.detectDuplicates,k=!c.sortStable&&a.slice(0),a.sort(B),l){while(b=a[f++])b===a[f]&&(e=d.push(f));while(e--)a.splice(d[e],1)}return k=null,a},e=gb.getText=function(a){var b,c="",d=0,f=a.nodeType;if(f){if(1===f||9===f||11===f){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=e(a)}else if(3===f||4===f)return a.nodeValue}else while(b=a[d++])c+=e(b);return c},d=gb.selectors={cacheLength:50,createPseudo:ib,match:X,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(cb,db),a[3]=(a[3]||a[4]||a[5]||"").replace(cb,db),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||gb.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&gb.error(a[0]),a},PSEUDO:function(a){var b,c=!a[6]&&a[2];return X.CHILD.test(a[0])?null:(a[3]?a[2]=a[4]||a[5]||"":c&&V.test(c)&&(b=g(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(cb,db).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=y[a+" "];return b||(b=new RegExp("(^|"+L+")"+a+"("+L+"|$)"))&&y(a,function(a){return b.test("string"==typeof a.className&&a.className||"undefined"!=typeof a.getAttribute&&a.getAttribute("class")||"")})},ATTR:function(a,b,c){return function(d){var e=gb.attr(d,a);return null==e?"!="===b:b?(e+="","="===b?e===c:"!="===b?e!==c:"^="===b?c&&0===e.indexOf(c):"*="===b?c&&e.indexOf(c)>-1:"$="===b?c&&e.slice(-c.length)===c:"~="===b?(" "+e.replace(Q," ")+" ").indexOf(c)>-1:"|="===b?e===c||e.slice(0,c.length+1)===c+"-":!1):!0}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h;if(q){if(f){while(p){l=b;while(l=l[p])if(h?l.nodeName.toLowerCase()===r:1===l.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){k=q[u]||(q[u]={}),j=k[a]||[],n=j[0]===w&&j[1],m=j[0]===w&&j[2],l=n&&q.childNodes[n];while(l=++n&&l&&l[p]||(m=n=0)||o.pop())if(1===l.nodeType&&++m&&l===b){k[a]=[w,n,m];break}}else if(s&&(j=(b[u]||(b[u]={}))[a])&&j[0]===w)m=j[1];else while(l=++n&&l&&l[p]||(m=n=0)||o.pop())if((h?l.nodeName.toLowerCase()===r:1===l.nodeType)&&++m&&(s&&((l[u]||(l[u]={}))[a]=[w,m]),l===b))break;return m-=e,m===d||m%d===0&&m/d>=0}}},PSEUDO:function(a,b){var c,e=d.pseudos[a]||d.setFilters[a.toLowerCase()]||gb.error("unsupported pseudo: "+a);return e[u]?e(b):e.length>1?(c=[a,a,"",b],d.setFilters.hasOwnProperty(a.toLowerCase())?ib(function(a,c){var d,f=e(a,b),g=f.length;while(g--)d=J(a,f[g]),a[d]=!(c[d]=f[g])}):function(a){return e(a,0,c)}):e}},pseudos:{not:ib(function(a){var b=[],c=[],d=h(a.replace(R,"$1"));return d[u]?ib(function(a,b,c,e){var f,g=d(a,null,e,[]),h=a.length;while(h--)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,e,f){return b[0]=a,d(b,null,f,c),b[0]=null,!c.pop()}}),has:ib(function(a){return function(b){return gb(a,b).length>0}}),contains:ib(function(a){return a=a.replace(cb,db),function(b){return(b.textContent||b.innerText||e(b)).indexOf(a)>-1}}),lang:ib(function(a){return W.test(a||"")||gb.error("unsupported lang: "+a),a=a.replace(cb,db).toLowerCase(),function(b){var c;do if(c=p?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===o},focus:function(a){return a===n.activeElement&&(!n.hasFocus||n.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType<6)return!1;return!0},parent:function(a){return!d.pseudos.empty(a)},header:function(a){return Z.test(a.nodeName)},input:function(a){return Y.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||"text"===b.toLowerCase())},first:ob(function(){return[0]}),last:ob(function(a,b){return[b-1]}),eq:ob(function(a,b,c){return[0>c?c+b:c]}),even:ob(function(a,b){for(var c=0;b>c;c+=2)a.push(c);return a}),odd:ob(function(a,b){for(var c=1;b>c;c+=2)a.push(c);return a}),lt:ob(function(a,b,c){for(var d=0>c?c+b:c;--d>=0;)a.push(d);return a}),gt:ob(function(a,b,c){for(var d=0>c?c+b:c;++d<b;)a.push(d);return a})}},d.pseudos.nth=d.pseudos.eq;for(b in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})d.pseudos[b]=mb(b);for(b in{submit:!0,reset:!0})d.pseudos[b]=nb(b);function qb(){}qb.prototype=d.filters=d.pseudos,d.setFilters=new qb,g=gb.tokenize=function(a,b){var c,e,f,g,h,i,j,k=z[a+" "];if(k)return b?0:k.slice(0);h=a,i=[],j=d.preFilter;while(h){(!c||(e=S.exec(h)))&&(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),c=!1,(e=T.exec(h))&&(c=e.shift(),f.push({value:c,type:e[0].replace(R," ")}),h=h.slice(c.length));for(g in d.filter)!(e=X[g].exec(h))||j[g]&&!(e=j[g](e))||(c=e.shift(),f.push({value:c,type:g,matches:e}),h=h.slice(c.length));if(!c)break}return b?h.length:h?gb.error(a):z(a,i).slice(0)};function rb(a){for(var b=0,c=a.length,d="";c>b;b++)d+=a[b].value;return d}function sb(a,b,c){var d=b.dir,e=c&&"parentNode"===d,f=x++;return b.first?function(b,c,f){while(b=b[d])if(1===b.nodeType||e)return a(b,c,f)}:function(b,c,g){var h,i,j=[w,f];if(g){while(b=b[d])if((1===b.nodeType||e)&&a(b,c,g))return!0}else while(b=b[d])if(1===b.nodeType||e){if(i=b[u]||(b[u]={}),(h=i[d])&&h[0]===w&&h[1]===f)return j[2]=h[2];if(i[d]=j,j[2]=a(b,c,g))return!0}}}function tb(a){return a.length>1?function(b,c,d){var e=a.length;while(e--)if(!a[e](b,c,d))return!1;return!0}:a[0]}function ub(a,b,c){for(var d=0,e=b.length;e>d;d++)gb(a,b[d],c);return c}function vb(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;i>h;h++)(f=a[h])&&(!c||c(f,d,e))&&(g.push(f),j&&b.push(h));return g}function wb(a,b,c,d,e,f){return d&&!d[u]&&(d=wb(d)),e&&!e[u]&&(e=wb(e,f)),ib(function(f,g,h,i){var j,k,l,m=[],n=[],o=g.length,p=f||ub(b||"*",h.nodeType?[h]:h,[]),q=!a||!f&&b?p:vb(p,m,a,h,i),r=c?e||(f?a:o||d)?[]:g:q;if(c&&c(q,r,h,i),d){j=vb(r,n),d(j,[],h,i),k=j.length;while(k--)(l=j[k])&&(r[n[k]]=!(q[n[k]]=l))}if(f){if(e||a){if(e){j=[],k=r.length;while(k--)(l=r[k])&&j.push(q[k]=l);e(null,r=[],j,i)}k=r.length;while(k--)(l=r[k])&&(j=e?J(f,l):m[k])>-1&&(f[j]=!(g[j]=l))}}else r=vb(r===g?r.splice(o,r.length):r),e?e(null,g,r,i):H.apply(g,r)})}function xb(a){for(var b,c,e,f=a.length,g=d.relative[a[0].type],h=g||d.relative[" "],i=g?1:0,k=sb(function(a){return a===b},h,!0),l=sb(function(a){return J(b,a)>-1},h,!0),m=[function(a,c,d){var e=!g&&(d||c!==j)||((b=c).nodeType?k(a,c,d):l(a,c,d));return b=null,e}];f>i;i++)if(c=d.relative[a[i].type])m=[sb(tb(m),c)];else{if(c=d.filter[a[i].type].apply(null,a[i].matches),c[u]){for(e=++i;f>e;e++)if(d.relative[a[e].type])break;return wb(i>1&&tb(m),i>1&&rb(a.slice(0,i-1).concat({value:" "===a[i-2].type?"*":""})).replace(R,"$1"),c,e>i&&xb(a.slice(i,e)),f>e&&xb(a=a.slice(e)),f>e&&rb(a))}m.push(c)}return tb(m)}function yb(a,b){var c=b.length>0,e=a.length>0,f=function(f,g,h,i,k){var l,m,o,p=0,q="0",r=f&&[],s=[],t=j,u=f||e&&d.find.TAG("*",k),v=w+=null==t?1:Math.random()||.1,x=u.length;for(k&&(j=g!==n&&g);q!==x&&null!=(l=u[q]);q++){if(e&&l){m=0;while(o=a[m++])if(o(l,g,h)){i.push(l);break}k&&(w=v)}c&&((l=!o&&l)&&p--,f&&r.push(l))}if(p+=q,c&&q!==p){m=0;while(o=b[m++])o(r,s,g,h);if(f){if(p>0)while(q--)r[q]||s[q]||(s[q]=F.call(i));s=vb(s)}H.apply(i,s),k&&!f&&s.length>0&&p+b.length>1&&gb.uniqueSort(i)}return k&&(w=v,j=t),r};return c?ib(f):f}return h=gb.compile=function(a,b){var c,d=[],e=[],f=A[a+" "];if(!f){b||(b=g(a)),c=b.length;while(c--)f=xb(b[c]),f[u]?d.push(f):e.push(f);f=A(a,yb(e,d)),f.selector=a}return f},i=gb.select=function(a,b,e,f){var i,j,k,l,m,n="function"==typeof a&&a,o=!f&&g(a=n.selector||a);if(e=e||[],1===o.length){if(j=o[0]=o[0].slice(0),j.length>2&&"ID"===(k=j[0]).type&&c.getById&&9===b.nodeType&&p&&d.relative[j[1].type]){if(b=(d.find.ID(k.matches[0].replace(cb,db),b)||[])[0],!b)return e;n&&(b=b.parentNode),a=a.slice(j.shift().value.length)}i=X.needsContext.test(a)?0:j.length;while(i--){if(k=j[i],d.relative[l=k.type])break;if((m=d.find[l])&&(f=m(k.matches[0].replace(cb,db),ab.test(j[0].type)&&pb(b.parentNode)||b))){if(j.splice(i,1),a=f.length&&rb(j),!a)return H.apply(e,f),e;break}}}return(n||h(a,o))(f,b,!p,e,ab.test(a)&&pb(b.parentNode)||b),e},c.sortStable=u.split("").sort(B).join("")===u,c.detectDuplicates=!!l,m(),c.sortDetached=jb(function(a){return 1&a.compareDocumentPosition(n.createElement("div"))}),jb(function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")})||kb("type|href|height|width",function(a,b,c){return c?void 0:a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),c.attributes&&jb(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||kb("value",function(a,b,c){return c||"input"!==a.nodeName.toLowerCase()?void 0:a.defaultValue}),jb(function(a){return null==a.getAttribute("disabled")})||kb(K,function(a,b,c){var d;return c?void 0:a[b]===!0?b.toLowerCase():(d=a.getAttributeNode(b))&&d.specified?d.value:null}),gb}(a);n.find=t,n.expr=t.selectors,n.expr[":"]=n.expr.pseudos,n.unique=t.uniqueSort,n.text=t.getText,n.isXMLDoc=t.isXML,n.contains=t.contains;var u=n.expr.match.needsContext,v=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,w=/^.[^:#\[\.,]*$/;function x(a,b,c){if(n.isFunction(b))return n.grep(a,function(a,d){return!!b.call(a,d,a)!==c});if(b.nodeType)return n.grep(a,function(a){return a===b!==c});if("string"==typeof b){if(w.test(b))return n.filter(b,a,c);b=n.filter(b,a)}return n.grep(a,function(a){return g.call(b,a)>=0!==c})}n.filter=function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?n.find.matchesSelector(d,a)?[d]:[]:n.find.matches(a,n.grep(b,function(a){return 1===a.nodeType}))},n.fn.extend({find:function(a){var b,c=this.length,d=[],e=this;if("string"!=typeof a)return this.pushStack(n(a).filter(function(){for(b=0;c>b;b++)if(n.contains(e[b],this))return!0}));for(b=0;c>b;b++)n.find(a,e[b],d);return d=this.pushStack(c>1?n.unique(d):d),d.selector=this.selector?this.selector+" "+a:a,d},filter:function(a){return this.pushStack(x(this,a||[],!1))},not:function(a){return this.pushStack(x(this,a||[],!0))},is:function(a){return!!x(this,"string"==typeof a&&u.test(a)?n(a):a||[],!1).length}});var y,z=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,A=n.fn.init=function(a,b){var c,d;if(!a)return this;if("string"==typeof a){if(c="<"===a[0]&&">"===a[a.length-1]&&a.length>=3?[null,a,null]:z.exec(a),!c||!c[1]&&b)return!b||b.jquery?(b||y).find(a):this.constructor(b).find(a);if(c[1]){if(b=b instanceof n?b[0]:b,n.merge(this,n.parseHTML(c[1],b&&b.nodeType?b.ownerDocument||b:l,!0)),v.test(c[1])&&n.isPlainObject(b))for(c in b)n.isFunction(this[c])?this[c](b[c]):this.attr(c,b[c]);return this}return d=l.getElementById(c[2]),d&&d.parentNode&&(this.length=1,this[0]=d),this.context=l,this.selector=a,this}return a.nodeType?(this.context=this[0]=a,this.length=1,this):n.isFunction(a)?"undefined"!=typeof y.ready?y.ready(a):a(n):(void 0!==a.selector&&(this.selector=a.selector,this.context=a.context),n.makeArray(a,this))};A.prototype=n.fn,y=n(l);var B=/^(?:parents|prev(?:Until|All))/,C={children:!0,contents:!0,next:!0,prev:!0};n.extend({dir:function(a,b,c){var d=[],e=void 0!==c;while((a=a[b])&&9!==a.nodeType)if(1===a.nodeType){if(e&&n(a).is(c))break;d.push(a)}return d},sibling:function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c}}),n.fn.extend({has:function(a){var b=n(a,this),c=b.length;return this.filter(function(){for(var a=0;c>a;a++)if(n.contains(this,b[a]))return!0})},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=u.test(a)||"string"!=typeof a?n(a,b||this.context):0;e>d;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&n.find.matchesSelector(c,a))){f.push(c);break}return this.pushStack(f.length>1?n.unique(f):f)},index:function(a){return a?"string"==typeof a?g.call(n(a),this[0]):g.call(this,a.jquery?a[0]:a):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(n.unique(n.merge(this.get(),n(a,b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}});function D(a,b){while((a=a[b])&&1!==a.nodeType);return a}n.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return n.dir(a,"parentNode")},parentsUntil:function(a,b,c){return n.dir(a,"parentNode",c)},next:function(a){return D(a,"nextSibling")},prev:function(a){return D(a,"previousSibling")},nextAll:function(a){return n.dir(a,"nextSibling")},prevAll:function(a){return n.dir(a,"previousSibling")},nextUntil:function(a,b,c){return n.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return n.dir(a,"previousSibling",c)},siblings:function(a){return n.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return n.sibling(a.firstChild)},contents:function(a){return a.contentDocument||n.merge([],a.childNodes)}},function(a,b){n.fn[a]=function(c,d){var e=n.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=n.filter(d,e)),this.length>1&&(C[a]||n.unique(e),B.test(a)&&e.reverse()),this.pushStack(e)}});var E=/\S+/g,F={};function G(a){var b=F[a]={};return n.each(a.match(E)||[],function(a,c){b[c]=!0}),b}n.Callbacks=function(a){a="string"==typeof a?F[a]||G(a):n.extend({},a);var b,c,d,e,f,g,h=[],i=!a.once&&[],j=function(l){for(b=a.memory&&l,c=!0,g=e||0,e=0,f=h.length,d=!0;h&&f>g;g++)if(h[g].apply(l[0],l[1])===!1&&a.stopOnFalse){b=!1;break}d=!1,h&&(i?i.length&&j(i.shift()):b?h=[]:k.disable())},k={add:function(){if(h){var c=h.length;!function g(b){n.each(b,function(b,c){var d=n.type(c);"function"===d?a.unique&&k.has(c)||h.push(c):c&&c.length&&"string"!==d&&g(c)})}(arguments),d?f=h.length:b&&(e=c,j(b))}return this},remove:function(){return h&&n.each(arguments,function(a,b){var c;while((c=n.inArray(b,h,c))>-1)h.splice(c,1),d&&(f>=c&&f--,g>=c&&g--)}),this},has:function(a){return a?n.inArray(a,h)>-1:!(!h||!h.length)},empty:function(){return h=[],f=0,this},disable:function(){return h=i=b=void 0,this},disabled:function(){return!h},lock:function(){return i=void 0,b||k.disable(),this},locked:function(){return!i},fireWith:function(a,b){return!h||c&&!i||(b=b||[],b=[a,b.slice?b.slice():b],d?i.push(b):j(b)),this},fire:function(){return k.fireWith(this,arguments),this},fired:function(){return!!c}};return k},n.extend({Deferred:function(a){var b=[["resolve","done",n.Callbacks("once memory"),"resolved"],["reject","fail",n.Callbacks("once memory"),"rejected"],["notify","progress",n.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return n.Deferred(function(c){n.each(b,function(b,f){var g=n.isFunction(a[b])&&a[b];e[f[1]](function(){var a=g&&g.apply(this,arguments);a&&n.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[f[0]+"With"](this===d?c.promise():this,g?[a]:arguments)})}),a=null}).promise()},promise:function(a){return null!=a?n.extend(a,d):d}},e={};return d.pipe=d.then,n.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock),e[f[0]]=function(){return e[f[0]+"With"](this===e?d:this,arguments),this},e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b=0,c=d.call(arguments),e=c.length,f=1!==e||a&&n.isFunction(a.promise)?e:0,g=1===f?a:n.Deferred(),h=function(a,b,c){return function(e){b[a]=this,c[a]=arguments.length>1?d.call(arguments):e,c===i?g.notifyWith(b,c):--f||g.resolveWith(b,c)}},i,j,k;if(e>1)for(i=new Array(e),j=new Array(e),k=new Array(e);e>b;b++)c[b]&&n.isFunction(c[b].promise)?c[b].promise().done(h(b,k,c)).fail(g.reject).progress(h(b,j,i)):--f;return f||g.resolveWith(k,c),g.promise()}});var H;n.fn.ready=function(a){return n.ready.promise().done(a),this},n.extend({isReady:!1,readyWait:1,holdReady:function(a){a?n.readyWait++:n.ready(!0)},ready:function(a){(a===!0?--n.readyWait:n.isReady)||(n.isReady=!0,a!==!0&&--n.readyWait>0||(H.resolveWith(l,[n]),n.fn.triggerHandler&&(n(l).triggerHandler("ready"),n(l).off("ready"))))}});function I(){l.removeEventListener("DOMContentLoaded",I,!1),a.removeEventListener("load",I,!1),n.ready()}n.ready.promise=function(b){return H||(H=n.Deferred(),"complete"===l.readyState?setTimeout(n.ready):(l.addEventListener("DOMContentLoaded",I,!1),a.addEventListener("load",I,!1))),H.promise(b)},n.ready.promise();var J=n.access=function(a,b,c,d,e,f,g){var h=0,i=a.length,j=null==c;if("object"===n.type(c)){e=!0;for(h in c)n.access(a,b,h,c[h],!0,f,g)}else if(void 0!==d&&(e=!0,n.isFunction(d)||(g=!0),j&&(g?(b.call(a,d),b=null):(j=b,b=function(a,b,c){return j.call(n(a),c)})),b))for(;i>h;h++)b(a[h],c,g?d:d.call(a[h],h,b(a[h],c)));return e?a:j?b.call(a):i?b(a[0],c):f};n.acceptData=function(a){return 1===a.nodeType||9===a.nodeType||!+a.nodeType};function K(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=n.expando+K.uid++}K.uid=1,K.accepts=n.acceptData,K.prototype={key:function(a){if(!K.accepts(a))return 0;var b={},c=a[this.expando];if(!c){c=K.uid++;try{b[this.expando]={value:c},Object.defineProperties(a,b)}catch(d){b[this.expando]=c,n.extend(a,b)}}return this.cache[c]||(this.cache[c]={}),c},set:function(a,b,c){var d,e=this.key(a),f=this.cache[e];if("string"==typeof b)f[b]=c;else if(n.isEmptyObject(f))n.extend(this.cache[e],b);else for(d in b)f[d]=b[d];return f},get:function(a,b){var c=this.cache[this.key(a)];return void 0===b?c:c[b]},access:function(a,b,c){var d;return void 0===b||b&&"string"==typeof b&&void 0===c?(d=this.get(a,b),void 0!==d?d:this.get(a,n.camelCase(b))):(this.set(a,b,c),void 0!==c?c:b)},remove:function(a,b){var c,d,e,f=this.key(a),g=this.cache[f];if(void 0===b)this.cache[f]={};else{n.isArray(b)?d=b.concat(b.map(n.camelCase)):(e=n.camelCase(b),b in g?d=[b,e]:(d=e,d=d in g?[d]:d.match(E)||[])),c=d.length;while(c--)delete g[d[c]]}},hasData:function(a){return!n.isEmptyObject(this.cache[a[this.expando]]||{})},discard:function(a){a[this.expando]&&delete this.cache[a[this.expando]]}};var L=new K,M=new K,N=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,O=/([A-Z])/g;function P(a,b,c){var d;if(void 0===c&&1===a.nodeType)if(d="data-"+b.replace(O,"-$1").toLowerCase(),c=a.getAttribute(d),"string"==typeof c){try{c="true"===c?!0:"false"===c?!1:"null"===c?null:+c+""===c?+c:N.test(c)?n.parseJSON(c):c}catch(e){}M.set(a,b,c)}else c=void 0;return c}n.extend({hasData:function(a){return M.hasData(a)||L.hasData(a)},data:function(a,b,c){return M.access(a,b,c)
},removeData:function(a,b){M.remove(a,b)},_data:function(a,b,c){return L.access(a,b,c)},_removeData:function(a,b){L.remove(a,b)}}),n.fn.extend({data:function(a,b){var c,d,e,f=this[0],g=f&&f.attributes;if(void 0===a){if(this.length&&(e=M.get(f),1===f.nodeType&&!L.get(f,"hasDataAttrs"))){c=g.length;while(c--)g[c]&&(d=g[c].name,0===d.indexOf("data-")&&(d=n.camelCase(d.slice(5)),P(f,d,e[d])));L.set(f,"hasDataAttrs",!0)}return e}return"object"==typeof a?this.each(function(){M.set(this,a)}):J(this,function(b){var c,d=n.camelCase(a);if(f&&void 0===b){if(c=M.get(f,a),void 0!==c)return c;if(c=M.get(f,d),void 0!==c)return c;if(c=P(f,d,void 0),void 0!==c)return c}else this.each(function(){var c=M.get(this,d);M.set(this,d,b),-1!==a.indexOf("-")&&void 0!==c&&M.set(this,a,b)})},null,b,arguments.length>1,null,!0)},removeData:function(a){return this.each(function(){M.remove(this,a)})}}),n.extend({queue:function(a,b,c){var d;return a?(b=(b||"fx")+"queue",d=L.get(a,b),c&&(!d||n.isArray(c)?d=L.access(a,b,n.makeArray(c)):d.push(c)),d||[]):void 0},dequeue:function(a,b){b=b||"fx";var c=n.queue(a,b),d=c.length,e=c.shift(),f=n._queueHooks(a,b),g=function(){n.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return L.get(a,c)||L.access(a,c,{empty:n.Callbacks("once memory").add(function(){L.remove(a,[b+"queue",c])})})}}),n.fn.extend({queue:function(a,b){var c=2;return"string"!=typeof a&&(b=a,a="fx",c--),arguments.length<c?n.queue(this[0],a):void 0===b?this:this.each(function(){var c=n.queue(this,a,b);n._queueHooks(this,a),"fx"===a&&"inprogress"!==c[0]&&n.dequeue(this,a)})},dequeue:function(a){return this.each(function(){n.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,d=1,e=n.Deferred(),f=this,g=this.length,h=function(){--d||e.resolveWith(f,[f])};"string"!=typeof a&&(b=a,a=void 0),a=a||"fx";while(g--)c=L.get(f[g],a+"queueHooks"),c&&c.empty&&(d++,c.empty.add(h));return h(),e.promise(b)}});var Q=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,R=["Top","Right","Bottom","Left"],S=function(a,b){return a=b||a,"none"===n.css(a,"display")||!n.contains(a.ownerDocument,a)},T=/^(?:checkbox|radio)$/i;!function(){var a=l.createDocumentFragment(),b=a.appendChild(l.createElement("div")),c=l.createElement("input");c.setAttribute("type","radio"),c.setAttribute("checked","checked"),c.setAttribute("name","t"),b.appendChild(c),k.checkClone=b.cloneNode(!0).cloneNode(!0).lastChild.checked,b.innerHTML="<textarea>x</textarea>",k.noCloneChecked=!!b.cloneNode(!0).lastChild.defaultValue}();var U="undefined";k.focusinBubbles="onfocusin"in a;var V=/^key/,W=/^(?:mouse|pointer|contextmenu)|click/,X=/^(?:focusinfocus|focusoutblur)$/,Y=/^([^.]*)(?:\.(.+)|)$/;function Z(){return!0}function $(){return!1}function _(){try{return l.activeElement}catch(a){}}n.event={global:{},add:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,o,p,q,r=L.get(a);if(r){c.handler&&(f=c,c=f.handler,e=f.selector),c.guid||(c.guid=n.guid++),(i=r.events)||(i=r.events={}),(g=r.handle)||(g=r.handle=function(b){return typeof n!==U&&n.event.triggered!==b.type?n.event.dispatch.apply(a,arguments):void 0}),b=(b||"").match(E)||[""],j=b.length;while(j--)h=Y.exec(b[j])||[],o=q=h[1],p=(h[2]||"").split(".").sort(),o&&(l=n.event.special[o]||{},o=(e?l.delegateType:l.bindType)||o,l=n.event.special[o]||{},k=n.extend({type:o,origType:q,data:d,handler:c,guid:c.guid,selector:e,needsContext:e&&n.expr.match.needsContext.test(e),namespace:p.join(".")},f),(m=i[o])||(m=i[o]=[],m.delegateCount=0,l.setup&&l.setup.call(a,d,p,g)!==!1||a.addEventListener&&a.addEventListener(o,g,!1)),l.add&&(l.add.call(a,k),k.handler.guid||(k.handler.guid=c.guid)),e?m.splice(m.delegateCount++,0,k):m.push(k),n.event.global[o]=!0)}},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,o,p,q,r=L.hasData(a)&&L.get(a);if(r&&(i=r.events)){b=(b||"").match(E)||[""],j=b.length;while(j--)if(h=Y.exec(b[j])||[],o=q=h[1],p=(h[2]||"").split(".").sort(),o){l=n.event.special[o]||{},o=(d?l.delegateType:l.bindType)||o,m=i[o]||[],h=h[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),g=f=m.length;while(f--)k=m[f],!e&&q!==k.origType||c&&c.guid!==k.guid||h&&!h.test(k.namespace)||d&&d!==k.selector&&("**"!==d||!k.selector)||(m.splice(f,1),k.selector&&m.delegateCount--,l.remove&&l.remove.call(a,k));g&&!m.length&&(l.teardown&&l.teardown.call(a,p,r.handle)!==!1||n.removeEvent(a,o,r.handle),delete i[o])}else for(o in i)n.event.remove(a,o+b[j],c,d,!0);n.isEmptyObject(i)&&(delete r.handle,L.remove(a,"events"))}},trigger:function(b,c,d,e){var f,g,h,i,k,m,o,p=[d||l],q=j.call(b,"type")?b.type:b,r=j.call(b,"namespace")?b.namespace.split("."):[];if(g=h=d=d||l,3!==d.nodeType&&8!==d.nodeType&&!X.test(q+n.event.triggered)&&(q.indexOf(".")>=0&&(r=q.split("."),q=r.shift(),r.sort()),k=q.indexOf(":")<0&&"on"+q,b=b[n.expando]?b:new n.Event(q,"object"==typeof b&&b),b.isTrigger=e?2:3,b.namespace=r.join("."),b.namespace_re=b.namespace?new RegExp("(^|\\.)"+r.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,b.result=void 0,b.target||(b.target=d),c=null==c?[b]:n.makeArray(c,[b]),o=n.event.special[q]||{},e||!o.trigger||o.trigger.apply(d,c)!==!1)){if(!e&&!o.noBubble&&!n.isWindow(d)){for(i=o.delegateType||q,X.test(i+q)||(g=g.parentNode);g;g=g.parentNode)p.push(g),h=g;h===(d.ownerDocument||l)&&p.push(h.defaultView||h.parentWindow||a)}f=0;while((g=p[f++])&&!b.isPropagationStopped())b.type=f>1?i:o.bindType||q,m=(L.get(g,"events")||{})[b.type]&&L.get(g,"handle"),m&&m.apply(g,c),m=k&&g[k],m&&m.apply&&n.acceptData(g)&&(b.result=m.apply(g,c),b.result===!1&&b.preventDefault());return b.type=q,e||b.isDefaultPrevented()||o._default&&o._default.apply(p.pop(),c)!==!1||!n.acceptData(d)||k&&n.isFunction(d[q])&&!n.isWindow(d)&&(h=d[k],h&&(d[k]=null),n.event.triggered=q,d[q](),n.event.triggered=void 0,h&&(d[k]=h)),b.result}},dispatch:function(a){a=n.event.fix(a);var b,c,e,f,g,h=[],i=d.call(arguments),j=(L.get(this,"events")||{})[a.type]||[],k=n.event.special[a.type]||{};if(i[0]=a,a.delegateTarget=this,!k.preDispatch||k.preDispatch.call(this,a)!==!1){h=n.event.handlers.call(this,a,j),b=0;while((f=h[b++])&&!a.isPropagationStopped()){a.currentTarget=f.elem,c=0;while((g=f.handlers[c++])&&!a.isImmediatePropagationStopped())(!a.namespace_re||a.namespace_re.test(g.namespace))&&(a.handleObj=g,a.data=g.data,e=((n.event.special[g.origType]||{}).handle||g.handler).apply(f.elem,i),void 0!==e&&(a.result=e)===!1&&(a.preventDefault(),a.stopPropagation()))}return k.postDispatch&&k.postDispatch.call(this,a),a.result}},handlers:function(a,b){var c,d,e,f,g=[],h=b.delegateCount,i=a.target;if(h&&i.nodeType&&(!a.button||"click"!==a.type))for(;i!==this;i=i.parentNode||this)if(i.disabled!==!0||"click"!==a.type){for(d=[],c=0;h>c;c++)f=b[c],e=f.selector+" ",void 0===d[e]&&(d[e]=f.needsContext?n(e,this).index(i)>=0:n.find(e,this,null,[i]).length),d[e]&&d.push(f);d.length&&g.push({elem:i,handlers:d})}return h<b.length&&g.push({elem:this,handlers:b.slice(h)}),g},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,b){var c,d,e,f=b.button;return null==a.pageX&&null!=b.clientX&&(c=a.target.ownerDocument||l,d=c.documentElement,e=c.body,a.pageX=b.clientX+(d&&d.scrollLeft||e&&e.scrollLeft||0)-(d&&d.clientLeft||e&&e.clientLeft||0),a.pageY=b.clientY+(d&&d.scrollTop||e&&e.scrollTop||0)-(d&&d.clientTop||e&&e.clientTop||0)),a.which||void 0===f||(a.which=1&f?1:2&f?3:4&f?2:0),a}},fix:function(a){if(a[n.expando])return a;var b,c,d,e=a.type,f=a,g=this.fixHooks[e];g||(this.fixHooks[e]=g=W.test(e)?this.mouseHooks:V.test(e)?this.keyHooks:{}),d=g.props?this.props.concat(g.props):this.props,a=new n.Event(f),b=d.length;while(b--)c=d[b],a[c]=f[c];return a.target||(a.target=l),3===a.target.nodeType&&(a.target=a.target.parentNode),g.filter?g.filter(a,f):a},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==_()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===_()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&n.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(a){return n.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&a.originalEvent&&(a.originalEvent.returnValue=a.result)}}},simulate:function(a,b,c,d){var e=n.extend(new n.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?n.event.trigger(e,null,b):n.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},n.removeEvent=function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)},n.Event=function(a,b){return this instanceof n.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&a.returnValue===!1?Z:$):this.type=a,b&&n.extend(this,b),this.timeStamp=a&&a.timeStamp||n.now(),void(this[n.expando]=!0)):new n.Event(a,b)},n.Event.prototype={isDefaultPrevented:$,isPropagationStopped:$,isImmediatePropagationStopped:$,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=Z,a&&a.preventDefault&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=Z,a&&a.stopPropagation&&a.stopPropagation()},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=Z,a&&a.stopImmediatePropagation&&a.stopImmediatePropagation(),this.stopPropagation()}},n.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(a,b){n.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return(!e||e!==d&&!n.contains(d,e))&&(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),k.focusinBubbles||n.each({focus:"focusin",blur:"focusout"},function(a,b){var c=function(a){n.event.simulate(b,a.target,n.event.fix(a),!0)};n.event.special[b]={setup:function(){var d=this.ownerDocument||this,e=L.access(d,b);e||d.addEventListener(a,c,!0),L.access(d,b,(e||0)+1)},teardown:function(){var d=this.ownerDocument||this,e=L.access(d,b)-1;e?L.access(d,b,e):(d.removeEventListener(a,c,!0),L.remove(d,b))}}}),n.fn.extend({on:function(a,b,c,d,e){var f,g;if("object"==typeof a){"string"!=typeof b&&(c=c||b,b=void 0);for(g in a)this.on(g,b,c,a[g],e);return this}if(null==c&&null==d?(d=b,c=b=void 0):null==d&&("string"==typeof b?(d=c,c=void 0):(d=c,c=b,b=void 0)),d===!1)d=$;else if(!d)return this;return 1===e&&(f=d,d=function(a){return n().off(a),f.apply(this,arguments)},d.guid=f.guid||(f.guid=n.guid++)),this.each(function(){n.event.add(this,a,d,c,b)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,b,c){var d,e;if(a&&a.preventDefault&&a.handleObj)return d=a.handleObj,n(a.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if("object"==typeof a){for(e in a)this.off(e,b,a[e]);return this}return(b===!1||"function"==typeof b)&&(c=b,b=void 0),c===!1&&(c=$),this.each(function(){n.event.remove(this,a,c,b)})},trigger:function(a,b){return this.each(function(){n.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];return c?n.event.trigger(a,b,c,!0):void 0}});var ab=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,bb=/<([\w:]+)/,cb=/<|&#?\w+;/,db=/<(?:script|style|link)/i,eb=/checked\s*(?:[^=]|=\s*.checked.)/i,fb=/^$|\/(?:java|ecma)script/i,gb=/^true\/(.*)/,hb=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,ib={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};ib.optgroup=ib.option,ib.tbody=ib.tfoot=ib.colgroup=ib.caption=ib.thead,ib.th=ib.td;function jb(a,b){return n.nodeName(a,"table")&&n.nodeName(11!==b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function kb(a){return a.type=(null!==a.getAttribute("type"))+"/"+a.type,a}function lb(a){var b=gb.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function mb(a,b){for(var c=0,d=a.length;d>c;c++)L.set(a[c],"globalEval",!b||L.get(b[c],"globalEval"))}function nb(a,b){var c,d,e,f,g,h,i,j;if(1===b.nodeType){if(L.hasData(a)&&(f=L.access(a),g=L.set(b,f),j=f.events)){delete g.handle,g.events={};for(e in j)for(c=0,d=j[e].length;d>c;c++)n.event.add(b,e,j[e][c])}M.hasData(a)&&(h=M.access(a),i=n.extend({},h),M.set(b,i))}}function ob(a,b){var c=a.getElementsByTagName?a.getElementsByTagName(b||"*"):a.querySelectorAll?a.querySelectorAll(b||"*"):[];return void 0===b||b&&n.nodeName(a,b)?n.merge([a],c):c}function pb(a,b){var c=b.nodeName.toLowerCase();"input"===c&&T.test(a.type)?b.checked=a.checked:("input"===c||"textarea"===c)&&(b.defaultValue=a.defaultValue)}n.extend({clone:function(a,b,c){var d,e,f,g,h=a.cloneNode(!0),i=n.contains(a.ownerDocument,a);if(!(k.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||n.isXMLDoc(a)))for(g=ob(h),f=ob(a),d=0,e=f.length;e>d;d++)pb(f[d],g[d]);if(b)if(c)for(f=f||ob(a),g=g||ob(h),d=0,e=f.length;e>d;d++)nb(f[d],g[d]);else nb(a,h);return g=ob(h,"script"),g.length>0&&mb(g,!i&&ob(a,"script")),h},buildFragment:function(a,b,c,d){for(var e,f,g,h,i,j,k=b.createDocumentFragment(),l=[],m=0,o=a.length;o>m;m++)if(e=a[m],e||0===e)if("object"===n.type(e))n.merge(l,e.nodeType?[e]:e);else if(cb.test(e)){f=f||k.appendChild(b.createElement("div")),g=(bb.exec(e)||["",""])[1].toLowerCase(),h=ib[g]||ib._default,f.innerHTML=h[1]+e.replace(ab,"<$1></$2>")+h[2],j=h[0];while(j--)f=f.lastChild;n.merge(l,f.childNodes),f=k.firstChild,f.textContent=""}else l.push(b.createTextNode(e));k.textContent="",m=0;while(e=l[m++])if((!d||-1===n.inArray(e,d))&&(i=n.contains(e.ownerDocument,e),f=ob(k.appendChild(e),"script"),i&&mb(f),c)){j=0;while(e=f[j++])fb.test(e.type||"")&&c.push(e)}return k},cleanData:function(a){for(var b,c,d,e,f=n.event.special,g=0;void 0!==(c=a[g]);g++){if(n.acceptData(c)&&(e=c[L.expando],e&&(b=L.cache[e]))){if(b.events)for(d in b.events)f[d]?n.event.remove(c,d):n.removeEvent(c,d,b.handle);L.cache[e]&&delete L.cache[e]}delete M.cache[c[M.expando]]}}}),n.fn.extend({text:function(a){return J(this,function(a){return void 0===a?n.text(this):this.empty().each(function(){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&(this.textContent=a)})},null,a,arguments.length)},append:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=jb(this,a);b.appendChild(a)}})},prepend:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=jb(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},remove:function(a,b){for(var c,d=a?n.filter(a,this):this,e=0;null!=(c=d[e]);e++)b||1!==c.nodeType||n.cleanData(ob(c)),c.parentNode&&(b&&n.contains(c.ownerDocument,c)&&mb(ob(c,"script")),c.parentNode.removeChild(c));return this},empty:function(){for(var a,b=0;null!=(a=this[b]);b++)1===a.nodeType&&(n.cleanData(ob(a,!1)),a.textContent="");return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return n.clone(this,a,b)})},html:function(a){return J(this,function(a){var b=this[0]||{},c=0,d=this.length;if(void 0===a&&1===b.nodeType)return b.innerHTML;if("string"==typeof a&&!db.test(a)&&!ib[(bb.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(ab,"<$1></$2>");try{for(;d>c;c++)b=this[c]||{},1===b.nodeType&&(n.cleanData(ob(b,!1)),b.innerHTML=a);b=0}catch(e){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=arguments[0];return this.domManip(arguments,function(b){a=this.parentNode,n.cleanData(ob(this)),a&&a.replaceChild(b,this)}),a&&(a.length||a.nodeType)?this:this.remove()},detach:function(a){return this.remove(a,!0)},domManip:function(a,b){a=e.apply([],a);var c,d,f,g,h,i,j=0,l=this.length,m=this,o=l-1,p=a[0],q=n.isFunction(p);if(q||l>1&&"string"==typeof p&&!k.checkClone&&eb.test(p))return this.each(function(c){var d=m.eq(c);q&&(a[0]=p.call(this,c,d.html())),d.domManip(a,b)});if(l&&(c=n.buildFragment(a,this[0].ownerDocument,!1,this),d=c.firstChild,1===c.childNodes.length&&(c=d),d)){for(f=n.map(ob(c,"script"),kb),g=f.length;l>j;j++)h=c,j!==o&&(h=n.clone(h,!0,!0),g&&n.merge(f,ob(h,"script"))),b.call(this[j],h,j);if(g)for(i=f[f.length-1].ownerDocument,n.map(f,lb),j=0;g>j;j++)h=f[j],fb.test(h.type||"")&&!L.access(h,"globalEval")&&n.contains(i,h)&&(h.src?n._evalUrl&&n._evalUrl(h.src):n.globalEval(h.textContent.replace(hb,"")))}return this}}),n.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){n.fn[a]=function(a){for(var c,d=[],e=n(a),g=e.length-1,h=0;g>=h;h++)c=h===g?this:this.clone(!0),n(e[h])[b](c),f.apply(d,c.get());return this.pushStack(d)}});var qb,rb={};function sb(b,c){var d,e=n(c.createElement(b)).appendTo(c.body),f=a.getDefaultComputedStyle&&(d=a.getDefaultComputedStyle(e[0]))?d.display:n.css(e[0],"display");return e.detach(),f}function tb(a){var b=l,c=rb[a];return c||(c=sb(a,b),"none"!==c&&c||(qb=(qb||n("<iframe frameborder='0' width='0' height='0'/>")).appendTo(b.documentElement),b=qb[0].contentDocument,b.write(),b.close(),c=sb(a,b),qb.detach()),rb[a]=c),c}var ub=/^margin/,vb=new RegExp("^("+Q+")(?!px)[a-z%]+$","i"),wb=function(b){return b.ownerDocument.defaultView.opener?b.ownerDocument.defaultView.getComputedStyle(b,null):a.getComputedStyle(b,null)};function xb(a,b,c){var d,e,f,g,h=a.style;return c=c||wb(a),c&&(g=c.getPropertyValue(b)||c[b]),c&&(""!==g||n.contains(a.ownerDocument,a)||(g=n.style(a,b)),vb.test(g)&&ub.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=c.width,h.width=d,h.minWidth=e,h.maxWidth=f)),void 0!==g?g+"":g}function yb(a,b){return{get:function(){return a()?void delete this.get:(this.get=b).apply(this,arguments)}}}!function(){var b,c,d=l.documentElement,e=l.createElement("div"),f=l.createElement("div");if(f.style){f.style.backgroundClip="content-box",f.cloneNode(!0).style.backgroundClip="",k.clearCloneStyle="content-box"===f.style.backgroundClip,e.style.cssText="border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;position:absolute",e.appendChild(f);function g(){f.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",f.innerHTML="",d.appendChild(e);var g=a.getComputedStyle(f,null);b="1%"!==g.top,c="4px"===g.width,d.removeChild(e)}a.getComputedStyle&&n.extend(k,{pixelPosition:function(){return g(),b},boxSizingReliable:function(){return null==c&&g(),c},reliableMarginRight:function(){var b,c=f.appendChild(l.createElement("div"));return c.style.cssText=f.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",c.style.marginRight=c.style.width="0",f.style.width="1px",d.appendChild(e),b=!parseFloat(a.getComputedStyle(c,null).marginRight),d.removeChild(e),f.removeChild(c),b}})}}(),n.swap=function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e};var zb=/^(none|table(?!-c[ea]).+)/,Ab=new RegExp("^("+Q+")(.*)$","i"),Bb=new RegExp("^([+-])=("+Q+")","i"),Cb={position:"absolute",visibility:"hidden",display:"block"},Db={letterSpacing:"0",fontWeight:"400"},Eb=["Webkit","O","Moz","ms"];function Fb(a,b){if(b in a)return b;var c=b[0].toUpperCase()+b.slice(1),d=b,e=Eb.length;while(e--)if(b=Eb[e]+c,b in a)return b;return d}function Gb(a,b,c){var d=Ab.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function Hb(a,b,c,d,e){for(var f=c===(d?"border":"content")?4:"width"===b?1:0,g=0;4>f;f+=2)"margin"===c&&(g+=n.css(a,c+R[f],!0,e)),d?("content"===c&&(g-=n.css(a,"padding"+R[f],!0,e)),"margin"!==c&&(g-=n.css(a,"border"+R[f]+"Width",!0,e))):(g+=n.css(a,"padding"+R[f],!0,e),"padding"!==c&&(g+=n.css(a,"border"+R[f]+"Width",!0,e)));return g}function Ib(a,b,c){var d=!0,e="width"===b?a.offsetWidth:a.offsetHeight,f=wb(a),g="border-box"===n.css(a,"boxSizing",!1,f);if(0>=e||null==e){if(e=xb(a,b,f),(0>e||null==e)&&(e=a.style[b]),vb.test(e))return e;d=g&&(k.boxSizingReliable()||e===a.style[b]),e=parseFloat(e)||0}return e+Hb(a,b,c||(g?"border":"content"),d,f)+"px"}function Jb(a,b){for(var c,d,e,f=[],g=0,h=a.length;h>g;g++)d=a[g],d.style&&(f[g]=L.get(d,"olddisplay"),c=d.style.display,b?(f[g]||"none"!==c||(d.style.display=""),""===d.style.display&&S(d)&&(f[g]=L.access(d,"olddisplay",tb(d.nodeName)))):(e=S(d),"none"===c&&e||L.set(d,"olddisplay",e?c:n.css(d,"display"))));for(g=0;h>g;g++)d=a[g],d.style&&(b&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=b?f[g]||"":"none"));return a}n.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=xb(a,"opacity");return""===c?"1":c}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(a,b,c,d){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var e,f,g,h=n.camelCase(b),i=a.style;return b=n.cssProps[h]||(n.cssProps[h]=Fb(i,h)),g=n.cssHooks[b]||n.cssHooks[h],void 0===c?g&&"get"in g&&void 0!==(e=g.get(a,!1,d))?e:i[b]:(f=typeof c,"string"===f&&(e=Bb.exec(c))&&(c=(e[1]+1)*e[2]+parseFloat(n.css(a,b)),f="number"),null!=c&&c===c&&("number"!==f||n.cssNumber[h]||(c+="px"),k.clearCloneStyle||""!==c||0!==b.indexOf("background")||(i[b]="inherit"),g&&"set"in g&&void 0===(c=g.set(a,c,d))||(i[b]=c)),void 0)}},css:function(a,b,c,d){var e,f,g,h=n.camelCase(b);return b=n.cssProps[h]||(n.cssProps[h]=Fb(a.style,h)),g=n.cssHooks[b]||n.cssHooks[h],g&&"get"in g&&(e=g.get(a,!0,c)),void 0===e&&(e=xb(a,b,d)),"normal"===e&&b in Db&&(e=Db[b]),""===c||c?(f=parseFloat(e),c===!0||n.isNumeric(f)?f||0:e):e}}),n.each(["height","width"],function(a,b){n.cssHooks[b]={get:function(a,c,d){return c?zb.test(n.css(a,"display"))&&0===a.offsetWidth?n.swap(a,Cb,function(){return Ib(a,b,d)}):Ib(a,b,d):void 0},set:function(a,c,d){var e=d&&wb(a);return Gb(a,c,d?Hb(a,b,d,"border-box"===n.css(a,"boxSizing",!1,e),e):0)}}}),n.cssHooks.marginRight=yb(k.reliableMarginRight,function(a,b){return b?n.swap(a,{display:"inline-block"},xb,[a,"marginRight"]):void 0}),n.each({margin:"",padding:"",border:"Width"},function(a,b){n.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];4>d;d++)e[a+R[d]+b]=f[d]||f[d-2]||f[0];return e}},ub.test(a)||(n.cssHooks[a+b].set=Gb)}),n.fn.extend({css:function(a,b){return J(this,function(a,b,c){var d,e,f={},g=0;if(n.isArray(b)){for(d=wb(a),e=b.length;e>g;g++)f[b[g]]=n.css(a,b[g],!1,d);return f}return void 0!==c?n.style(a,b,c):n.css(a,b)},a,b,arguments.length>1)},show:function(){return Jb(this,!0)},hide:function(){return Jb(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){S(this)?n(this).show():n(this).hide()})}});function Kb(a,b,c,d,e){return new Kb.prototype.init(a,b,c,d,e)}n.Tween=Kb,Kb.prototype={constructor:Kb,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||"swing",this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(n.cssNumber[c]?"":"px")},cur:function(){var a=Kb.propHooks[this.prop];return a&&a.get?a.get(this):Kb.propHooks._default.get(this)},run:function(a){var b,c=Kb.propHooks[this.prop];return this.pos=b=this.options.duration?n.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):Kb.propHooks._default.set(this),this}},Kb.prototype.init.prototype=Kb.prototype,Kb.propHooks={_default:{get:function(a){var b;return null==a.elem[a.prop]||a.elem.style&&null!=a.elem.style[a.prop]?(b=n.css(a.elem,a.prop,""),b&&"auto"!==b?b:0):a.elem[a.prop]},set:function(a){n.fx.step[a.prop]?n.fx.step[a.prop](a):a.elem.style&&(null!=a.elem.style[n.cssProps[a.prop]]||n.cssHooks[a.prop])?n.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}},Kb.propHooks.scrollTop=Kb.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},n.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2}},n.fx=Kb.prototype.init,n.fx.step={};var Lb,Mb,Nb=/^(?:toggle|show|hide)$/,Ob=new RegExp("^(?:([+-])=|)("+Q+")([a-z%]*)$","i"),Pb=/queueHooks$/,Qb=[Vb],Rb={"*":[function(a,b){var c=this.createTween(a,b),d=c.cur(),e=Ob.exec(b),f=e&&e[3]||(n.cssNumber[a]?"":"px"),g=(n.cssNumber[a]||"px"!==f&&+d)&&Ob.exec(n.css(c.elem,a)),h=1,i=20;if(g&&g[3]!==f){f=f||g[3],e=e||[],g=+d||1;do h=h||".5",g/=h,n.style(c.elem,a,g+f);while(h!==(h=c.cur()/d)&&1!==h&&--i)}return e&&(g=c.start=+g||+d||0,c.unit=f,c.end=e[1]?g+(e[1]+1)*e[2]:+e[2]),c}]};function Sb(){return setTimeout(function(){Lb=void 0}),Lb=n.now()}function Tb(a,b){var c,d=0,e={height:a};for(b=b?1:0;4>d;d+=2-b)c=R[d],e["margin"+c]=e["padding"+c]=a;return b&&(e.opacity=e.width=a),e}function Ub(a,b,c){for(var d,e=(Rb[b]||[]).concat(Rb["*"]),f=0,g=e.length;g>f;f++)if(d=e[f].call(c,b,a))return d}function Vb(a,b,c){var d,e,f,g,h,i,j,k,l=this,m={},o=a.style,p=a.nodeType&&S(a),q=L.get(a,"fxshow");c.queue||(h=n._queueHooks(a,"fx"),null==h.unqueued&&(h.unqueued=0,i=h.empty.fire,h.empty.fire=function(){h.unqueued||i()}),h.unqueued++,l.always(function(){l.always(function(){h.unqueued--,n.queue(a,"fx").length||h.empty.fire()})})),1===a.nodeType&&("height"in b||"width"in b)&&(c.overflow=[o.overflow,o.overflowX,o.overflowY],j=n.css(a,"display"),k="none"===j?L.get(a,"olddisplay")||tb(a.nodeName):j,"inline"===k&&"none"===n.css(a,"float")&&(o.display="inline-block")),c.overflow&&(o.overflow="hidden",l.always(function(){o.overflow=c.overflow[0],o.overflowX=c.overflow[1],o.overflowY=c.overflow[2]}));for(d in b)if(e=b[d],Nb.exec(e)){if(delete b[d],f=f||"toggle"===e,e===(p?"hide":"show")){if("show"!==e||!q||void 0===q[d])continue;p=!0}m[d]=q&&q[d]||n.style(a,d)}else j=void 0;if(n.isEmptyObject(m))"inline"===("none"===j?tb(a.nodeName):j)&&(o.display=j);else{q?"hidden"in q&&(p=q.hidden):q=L.access(a,"fxshow",{}),f&&(q.hidden=!p),p?n(a).show():l.done(function(){n(a).hide()}),l.done(function(){var b;L.remove(a,"fxshow");for(b in m)n.style(a,b,m[b])});for(d in m)g=Ub(p?q[d]:0,d,l),d in q||(q[d]=g.start,p&&(g.end=g.start,g.start="width"===d||"height"===d?1:0))}}function Wb(a,b){var c,d,e,f,g;for(c in a)if(d=n.camelCase(c),e=b[d],f=a[c],n.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=n.cssHooks[d],g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function Xb(a,b,c){var d,e,f=0,g=Qb.length,h=n.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=Lb||Sb(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;i>g;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),1>f&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:n.extend({},b),opts:n.extend(!0,{specialEasing:{}},c),originalProperties:b,originalOptions:c,startTime:Lb||Sb(),duration:c.duration,tweens:[],createTween:function(b,c){var d=n.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;d>c;c++)j.tweens[c].run(1);return b?h.resolveWith(a,[j,b]):h.rejectWith(a,[j,b]),this}}),k=j.props;for(Wb(k,j.opts.specialEasing);g>f;f++)if(d=Qb[f].call(j,a,k,j.opts))return d;return n.map(k,Ub,j),n.isFunction(j.opts.start)&&j.opts.start.call(a,j),n.fx.timer(n.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}n.Animation=n.extend(Xb,{tweener:function(a,b){n.isFunction(a)?(b=a,a=["*"]):a=a.split(" ");for(var c,d=0,e=a.length;e>d;d++)c=a[d],Rb[c]=Rb[c]||[],Rb[c].unshift(b)},prefilter:function(a,b){b?Qb.unshift(a):Qb.push(a)}}),n.speed=function(a,b,c){var d=a&&"object"==typeof a?n.extend({},a):{complete:c||!c&&b||n.isFunction(a)&&a,duration:a,easing:c&&b||b&&!n.isFunction(b)&&b};return d.duration=n.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in n.fx.speeds?n.fx.speeds[d.duration]:n.fx.speeds._default,(null==d.queue||d.queue===!0)&&(d.queue="fx"),d.old=d.complete,d.complete=function(){n.isFunction(d.old)&&d.old.call(this),d.queue&&n.dequeue(this,d.queue)},d},n.fn.extend({fadeTo:function(a,b,c,d){return this.filter(S).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=n.isEmptyObject(a),f=n.speed(b,c,d),g=function(){var b=Xb(this,n.extend({},a),f);(e||L.get(this,"finish"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var d=function(a){var b=a.stop;delete a.stop,b(c)};return"string"!=typeof a&&(c=b,b=a,a=void 0),b&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,e=null!=a&&a+"queueHooks",f=n.timers,g=L.get(this);if(e)g[e]&&g[e].stop&&d(g[e]);else for(e in g)g[e]&&g[e].stop&&Pb.test(e)&&d(g[e]);for(e=f.length;e--;)f[e].elem!==this||null!=a&&f[e].queue!==a||(f[e].anim.stop(c),b=!1,f.splice(e,1));(b||!c)&&n.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||"fx"),this.each(function(){var b,c=L.get(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=n.timers,g=d?d.length:0;for(c.finish=!0,n.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;g>b;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),n.each(["toggle","show","hide"],function(a,b){var c=n.fn[b];n.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(Tb(b,!0),a,d,e)}}),n.each({slideDown:Tb("show"),slideUp:Tb("hide"),slideToggle:Tb("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){n.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),n.timers=[],n.fx.tick=function(){var a,b=0,c=n.timers;for(Lb=n.now();b<c.length;b++)a=c[b],a()||c[b]!==a||c.splice(b--,1);c.length||n.fx.stop(),Lb=void 0},n.fx.timer=function(a){n.timers.push(a),a()?n.fx.start():n.timers.pop()},n.fx.interval=13,n.fx.start=function(){Mb||(Mb=setInterval(n.fx.tick,n.fx.interval))},n.fx.stop=function(){clearInterval(Mb),Mb=null},n.fx.speeds={slow:600,fast:200,_default:400},n.fn.delay=function(a,b){return a=n.fx?n.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},function(){var a=l.createElement("input"),b=l.createElement("select"),c=b.appendChild(l.createElement("option"));a.type="checkbox",k.checkOn=""!==a.value,k.optSelected=c.selected,b.disabled=!0,k.optDisabled=!c.disabled,a=l.createElement("input"),a.value="t",a.type="radio",k.radioValue="t"===a.value}();var Yb,Zb,$b=n.expr.attrHandle;n.fn.extend({attr:function(a,b){return J(this,n.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){n.removeAttr(this,a)})}}),n.extend({attr:function(a,b,c){var d,e,f=a.nodeType;if(a&&3!==f&&8!==f&&2!==f)return typeof a.getAttribute===U?n.prop(a,b,c):(1===f&&n.isXMLDoc(a)||(b=b.toLowerCase(),d=n.attrHooks[b]||(n.expr.match.bool.test(b)?Zb:Yb)),void 0===c?d&&"get"in d&&null!==(e=d.get(a,b))?e:(e=n.find.attr(a,b),null==e?void 0:e):null!==c?d&&"set"in d&&void 0!==(e=d.set(a,c,b))?e:(a.setAttribute(b,c+""),c):void n.removeAttr(a,b))
},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(E);if(f&&1===a.nodeType)while(c=f[e++])d=n.propFix[c]||c,n.expr.match.bool.test(c)&&(a[d]=!1),a.removeAttribute(c)},attrHooks:{type:{set:function(a,b){if(!k.radioValue&&"radio"===b&&n.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}}}),Zb={set:function(a,b,c){return b===!1?n.removeAttr(a,c):a.setAttribute(c,c),c}},n.each(n.expr.match.bool.source.match(/\w+/g),function(a,b){var c=$b[b]||n.find.attr;$b[b]=function(a,b,d){var e,f;return d||(f=$b[b],$b[b]=e,e=null!=c(a,b,d)?b.toLowerCase():null,$b[b]=f),e}});var _b=/^(?:input|select|textarea|button)$/i;n.fn.extend({prop:function(a,b){return J(this,n.prop,a,b,arguments.length>1)},removeProp:function(a){return this.each(function(){delete this[n.propFix[a]||a]})}}),n.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(a,b,c){var d,e,f,g=a.nodeType;if(a&&3!==g&&8!==g&&2!==g)return f=1!==g||!n.isXMLDoc(a),f&&(b=n.propFix[b]||b,e=n.propHooks[b]),void 0!==c?e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:a[b]=c:e&&"get"in e&&null!==(d=e.get(a,b))?d:a[b]},propHooks:{tabIndex:{get:function(a){return a.hasAttribute("tabindex")||_b.test(a.nodeName)||a.href?a.tabIndex:-1}}}}),k.optSelected||(n.propHooks.selected={get:function(a){var b=a.parentNode;return b&&b.parentNode&&b.parentNode.selectedIndex,null}}),n.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){n.propFix[this.toLowerCase()]=this});var ac=/[\t\r\n\f]/g;n.fn.extend({addClass:function(a){var b,c,d,e,f,g,h="string"==typeof a&&a,i=0,j=this.length;if(n.isFunction(a))return this.each(function(b){n(this).addClass(a.call(this,b,this.className))});if(h)for(b=(a||"").match(E)||[];j>i;i++)if(c=this[i],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(ac," "):" ")){f=0;while(e=b[f++])d.indexOf(" "+e+" ")<0&&(d+=e+" ");g=n.trim(d),c.className!==g&&(c.className=g)}return this},removeClass:function(a){var b,c,d,e,f,g,h=0===arguments.length||"string"==typeof a&&a,i=0,j=this.length;if(n.isFunction(a))return this.each(function(b){n(this).removeClass(a.call(this,b,this.className))});if(h)for(b=(a||"").match(E)||[];j>i;i++)if(c=this[i],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(ac," "):"")){f=0;while(e=b[f++])while(d.indexOf(" "+e+" ")>=0)d=d.replace(" "+e+" "," ");g=a?n.trim(d):"",c.className!==g&&(c.className=g)}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):this.each(n.isFunction(a)?function(c){n(this).toggleClass(a.call(this,c,this.className,b),b)}:function(){if("string"===c){var b,d=0,e=n(this),f=a.match(E)||[];while(b=f[d++])e.hasClass(b)?e.removeClass(b):e.addClass(b)}else(c===U||"boolean"===c)&&(this.className&&L.set(this,"__className__",this.className),this.className=this.className||a===!1?"":L.get(this,"__className__")||"")})},hasClass:function(a){for(var b=" "+a+" ",c=0,d=this.length;d>c;c++)if(1===this[c].nodeType&&(" "+this[c].className+" ").replace(ac," ").indexOf(b)>=0)return!0;return!1}});var bc=/\r/g;n.fn.extend({val:function(a){var b,c,d,e=this[0];{if(arguments.length)return d=n.isFunction(a),this.each(function(c){var e;1===this.nodeType&&(e=d?a.call(this,c,n(this).val()):a,null==e?e="":"number"==typeof e?e+="":n.isArray(e)&&(e=n.map(e,function(a){return null==a?"":a+""})),b=n.valHooks[this.type]||n.valHooks[this.nodeName.toLowerCase()],b&&"set"in b&&void 0!==b.set(this,e,"value")||(this.value=e))});if(e)return b=n.valHooks[e.type]||n.valHooks[e.nodeName.toLowerCase()],b&&"get"in b&&void 0!==(c=b.get(e,"value"))?c:(c=e.value,"string"==typeof c?c.replace(bc,""):null==c?"":c)}}}),n.extend({valHooks:{option:{get:function(a){var b=n.find.attr(a,"value");return null!=b?b:n.trim(n.text(a))}},select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f="select-one"===a.type||0>e,g=f?null:[],h=f?e+1:d.length,i=0>e?h:f?e:0;h>i;i++)if(c=d[i],!(!c.selected&&i!==e||(k.optDisabled?c.disabled:null!==c.getAttribute("disabled"))||c.parentNode.disabled&&n.nodeName(c.parentNode,"optgroup"))){if(b=n(c).val(),f)return b;g.push(b)}return g},set:function(a,b){var c,d,e=a.options,f=n.makeArray(b),g=e.length;while(g--)d=e[g],(d.selected=n.inArray(d.value,f)>=0)&&(c=!0);return c||(a.selectedIndex=-1),f}}}}),n.each(["radio","checkbox"],function(){n.valHooks[this]={set:function(a,b){return n.isArray(b)?a.checked=n.inArray(n(a).val(),b)>=0:void 0}},k.checkOn||(n.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})}),n.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){n.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),n.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}});var cc=n.now(),dc=/\?/;n.parseJSON=function(a){return JSON.parse(a+"")},n.parseXML=function(a){var b,c;if(!a||"string"!=typeof a)return null;try{c=new DOMParser,b=c.parseFromString(a,"text/xml")}catch(d){b=void 0}return(!b||b.getElementsByTagName("parsererror").length)&&n.error("Invalid XML: "+a),b};var ec=/#.*$/,fc=/([?&])_=[^&]*/,gc=/^(.*?):[ \t]*([^\r\n]*)$/gm,hc=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,ic=/^(?:GET|HEAD)$/,jc=/^\/\//,kc=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,lc={},mc={},nc="*/".concat("*"),oc=a.location.href,pc=kc.exec(oc.toLowerCase())||[];function qc(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(E)||[];if(n.isFunction(c))while(d=f[e++])"+"===d[0]?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function rc(a,b,c,d){var e={},f=a===mc;function g(h){var i;return e[h]=!0,n.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||f||e[j]?f?!(i=j):void 0:(b.dataTypes.unshift(j),g(j),!1)}),i}return g(b.dataTypes[0])||!e["*"]&&g("*")}function sc(a,b){var c,d,e=n.ajaxSettings.flatOptions||{};for(c in b)void 0!==b[c]&&((e[c]?a:d||(d={}))[c]=b[c]);return d&&n.extend(!0,a,d),a}function tc(a,b,c){var d,e,f,g,h=a.contents,i=a.dataTypes;while("*"===i[0])i.shift(),void 0===d&&(d=a.mimeType||b.getResponseHeader("Content-Type"));if(d)for(e in h)if(h[e]&&h[e].test(d)){i.unshift(e);break}if(i[0]in c)f=i[0];else{for(e in c){if(!i[0]||a.converters[e+" "+i[0]]){f=e;break}g||(g=e)}f=f||g}return f?(f!==i[0]&&i.unshift(f),c[f]):void 0}function uc(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];f=k.shift();while(f)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(g=j[i+" "+f]||j["* "+f],!g)for(e in j)if(h=e.split(" "),h[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){g===!0?g=j[e]:j[e]!==!0&&(f=h[0],k.unshift(h[1]));break}if(g!==!0)if(g&&a["throws"])b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}n.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:oc,type:"GET",isLocal:hc.test(pc[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":nc,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":n.parseJSON,"text xml":n.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?sc(sc(a,n.ajaxSettings),b):sc(n.ajaxSettings,a)},ajaxPrefilter:qc(lc),ajaxTransport:qc(mc),ajax:function(a,b){"object"==typeof a&&(b=a,a=void 0),b=b||{};var c,d,e,f,g,h,i,j,k=n.ajaxSetup({},b),l=k.context||k,m=k.context&&(l.nodeType||l.jquery)?n(l):n.event,o=n.Deferred(),p=n.Callbacks("once memory"),q=k.statusCode||{},r={},s={},t=0,u="canceled",v={readyState:0,getResponseHeader:function(a){var b;if(2===t){if(!f){f={};while(b=gc.exec(e))f[b[1].toLowerCase()]=b[2]}b=f[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return 2===t?e:null},setRequestHeader:function(a,b){var c=a.toLowerCase();return t||(a=s[c]=s[c]||a,r[a]=b),this},overrideMimeType:function(a){return t||(k.mimeType=a),this},statusCode:function(a){var b;if(a)if(2>t)for(b in a)q[b]=[q[b],a[b]];else v.always(a[v.status]);return this},abort:function(a){var b=a||u;return c&&c.abort(b),x(0,b),this}};if(o.promise(v).complete=p.add,v.success=v.done,v.error=v.fail,k.url=((a||k.url||oc)+"").replace(ec,"").replace(jc,pc[1]+"//"),k.type=b.method||b.type||k.method||k.type,k.dataTypes=n.trim(k.dataType||"*").toLowerCase().match(E)||[""],null==k.crossDomain&&(h=kc.exec(k.url.toLowerCase()),k.crossDomain=!(!h||h[1]===pc[1]&&h[2]===pc[2]&&(h[3]||("http:"===h[1]?"80":"443"))===(pc[3]||("http:"===pc[1]?"80":"443")))),k.data&&k.processData&&"string"!=typeof k.data&&(k.data=n.param(k.data,k.traditional)),rc(lc,k,b,v),2===t)return v;i=n.event&&k.global,i&&0===n.active++&&n.event.trigger("ajaxStart"),k.type=k.type.toUpperCase(),k.hasContent=!ic.test(k.type),d=k.url,k.hasContent||(k.data&&(d=k.url+=(dc.test(d)?"&":"?")+k.data,delete k.data),k.cache===!1&&(k.url=fc.test(d)?d.replace(fc,"$1_="+cc++):d+(dc.test(d)?"&":"?")+"_="+cc++)),k.ifModified&&(n.lastModified[d]&&v.setRequestHeader("If-Modified-Since",n.lastModified[d]),n.etag[d]&&v.setRequestHeader("If-None-Match",n.etag[d])),(k.data&&k.hasContent&&k.contentType!==!1||b.contentType)&&v.setRequestHeader("Content-Type",k.contentType),v.setRequestHeader("Accept",k.dataTypes[0]&&k.accepts[k.dataTypes[0]]?k.accepts[k.dataTypes[0]]+("*"!==k.dataTypes[0]?", "+nc+"; q=0.01":""):k.accepts["*"]);for(j in k.headers)v.setRequestHeader(j,k.headers[j]);if(k.beforeSend&&(k.beforeSend.call(l,v,k)===!1||2===t))return v.abort();u="abort";for(j in{success:1,error:1,complete:1})v[j](k[j]);if(c=rc(mc,k,b,v)){v.readyState=1,i&&m.trigger("ajaxSend",[v,k]),k.async&&k.timeout>0&&(g=setTimeout(function(){v.abort("timeout")},k.timeout));try{t=1,c.send(r,x)}catch(w){if(!(2>t))throw w;x(-1,w)}}else x(-1,"No Transport");function x(a,b,f,h){var j,r,s,u,w,x=b;2!==t&&(t=2,g&&clearTimeout(g),c=void 0,e=h||"",v.readyState=a>0?4:0,j=a>=200&&300>a||304===a,f&&(u=tc(k,v,f)),u=uc(k,u,v,j),j?(k.ifModified&&(w=v.getResponseHeader("Last-Modified"),w&&(n.lastModified[d]=w),w=v.getResponseHeader("etag"),w&&(n.etag[d]=w)),204===a||"HEAD"===k.type?x="nocontent":304===a?x="notmodified":(x=u.state,r=u.data,s=u.error,j=!s)):(s=x,(a||!x)&&(x="error",0>a&&(a=0))),v.status=a,v.statusText=(b||x)+"",j?o.resolveWith(l,[r,x,v]):o.rejectWith(l,[v,x,s]),v.statusCode(q),q=void 0,i&&m.trigger(j?"ajaxSuccess":"ajaxError",[v,k,j?r:s]),p.fireWith(l,[v,x]),i&&(m.trigger("ajaxComplete",[v,k]),--n.active||n.event.trigger("ajaxStop")))}return v},getJSON:function(a,b,c){return n.get(a,b,c,"json")},getScript:function(a,b){return n.get(a,void 0,b,"script")}}),n.each(["get","post"],function(a,b){n[b]=function(a,c,d,e){return n.isFunction(c)&&(e=e||d,d=c,c=void 0),n.ajax({url:a,type:b,dataType:e,data:c,success:d})}}),n._evalUrl=function(a){return n.ajax({url:a,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},n.fn.extend({wrapAll:function(a){var b;return n.isFunction(a)?this.each(function(b){n(this).wrapAll(a.call(this,b))}):(this[0]&&(b=n(a,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstElementChild)a=a.firstElementChild;return a}).append(this)),this)},wrapInner:function(a){return this.each(n.isFunction(a)?function(b){n(this).wrapInner(a.call(this,b))}:function(){var b=n(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=n.isFunction(a);return this.each(function(c){n(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){n.nodeName(this,"body")||n(this).replaceWith(this.childNodes)}).end()}}),n.expr.filters.hidden=function(a){return a.offsetWidth<=0&&a.offsetHeight<=0},n.expr.filters.visible=function(a){return!n.expr.filters.hidden(a)};var vc=/%20/g,wc=/\[\]$/,xc=/\r?\n/g,yc=/^(?:submit|button|image|reset|file)$/i,zc=/^(?:input|select|textarea|keygen)/i;function Ac(a,b,c,d){var e;if(n.isArray(b))n.each(b,function(b,e){c||wc.test(a)?d(a,e):Ac(a+"["+("object"==typeof e?b:"")+"]",e,c,d)});else if(c||"object"!==n.type(b))d(a,b);else for(e in b)Ac(a+"["+e+"]",b[e],c,d)}n.param=function(a,b){var c,d=[],e=function(a,b){b=n.isFunction(b)?b():null==b?"":b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(void 0===b&&(b=n.ajaxSettings&&n.ajaxSettings.traditional),n.isArray(a)||a.jquery&&!n.isPlainObject(a))n.each(a,function(){e(this.name,this.value)});else for(c in a)Ac(c,a[c],b,e);return d.join("&").replace(vc,"+")},n.fn.extend({serialize:function(){return n.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=n.prop(this,"elements");return a?n.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!n(this).is(":disabled")&&zc.test(this.nodeName)&&!yc.test(a)&&(this.checked||!T.test(a))}).map(function(a,b){var c=n(this).val();return null==c?null:n.isArray(c)?n.map(c,function(a){return{name:b.name,value:a.replace(xc,"\r\n")}}):{name:b.name,value:c.replace(xc,"\r\n")}}).get()}}),n.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(a){}};var Bc=0,Cc={},Dc={0:200,1223:204},Ec=n.ajaxSettings.xhr();a.attachEvent&&a.attachEvent("onunload",function(){for(var a in Cc)Cc[a]()}),k.cors=!!Ec&&"withCredentials"in Ec,k.ajax=Ec=!!Ec,n.ajaxTransport(function(a){var b;return k.cors||Ec&&!a.crossDomain?{send:function(c,d){var e,f=a.xhr(),g=++Bc;if(f.open(a.type,a.url,a.async,a.username,a.password),a.xhrFields)for(e in a.xhrFields)f[e]=a.xhrFields[e];a.mimeType&&f.overrideMimeType&&f.overrideMimeType(a.mimeType),a.crossDomain||c["X-Requested-With"]||(c["X-Requested-With"]="XMLHttpRequest");for(e in c)f.setRequestHeader(e,c[e]);b=function(a){return function(){b&&(delete Cc[g],b=f.onload=f.onerror=null,"abort"===a?f.abort():"error"===a?d(f.status,f.statusText):d(Dc[f.status]||f.status,f.statusText,"string"==typeof f.responseText?{text:f.responseText}:void 0,f.getAllResponseHeaders()))}},f.onload=b(),f.onerror=b("error"),b=Cc[g]=b("abort");try{f.send(a.hasContent&&a.data||null)}catch(h){if(b)throw h}},abort:function(){b&&b()}}:void 0}),n.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(a){return n.globalEval(a),a}}}),n.ajaxPrefilter("script",function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type="GET")}),n.ajaxTransport("script",function(a){if(a.crossDomain){var b,c;return{send:function(d,e){b=n("<script>").prop({async:!0,charset:a.scriptCharset,src:a.url}).on("load error",c=function(a){b.remove(),c=null,a&&e("error"===a.type?404:200,a.type)}),l.head.appendChild(b[0])},abort:function(){c&&c()}}}});var Fc=[],Gc=/(=)\?(?=&|$)|\?\?/;n.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=Fc.pop()||n.expando+"_"+cc++;return this[a]=!0,a}}),n.ajaxPrefilter("json jsonp",function(b,c,d){var e,f,g,h=b.jsonp!==!1&&(Gc.test(b.url)?"url":"string"==typeof b.data&&!(b.contentType||"").indexOf("application/x-www-form-urlencoded")&&Gc.test(b.data)&&"data");return h||"jsonp"===b.dataTypes[0]?(e=b.jsonpCallback=n.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h?b[h]=b[h].replace(Gc,"$1"+e):b.jsonp!==!1&&(b.url+=(dc.test(b.url)?"&":"?")+b.jsonp+"="+e),b.converters["script json"]=function(){return g||n.error(e+" was not called"),g[0]},b.dataTypes[0]="json",f=a[e],a[e]=function(){g=arguments},d.always(function(){a[e]=f,b[e]&&(b.jsonpCallback=c.jsonpCallback,Fc.push(e)),g&&n.isFunction(f)&&f(g[0]),g=f=void 0}),"script"):void 0}),n.parseHTML=function(a,b,c){if(!a||"string"!=typeof a)return null;"boolean"==typeof b&&(c=b,b=!1),b=b||l;var d=v.exec(a),e=!c&&[];return d?[b.createElement(d[1])]:(d=n.buildFragment([a],b,e),e&&e.length&&n(e).remove(),n.merge([],d.childNodes))};var Hc=n.fn.load;n.fn.load=function(a,b,c){if("string"!=typeof a&&Hc)return Hc.apply(this,arguments);var d,e,f,g=this,h=a.indexOf(" ");return h>=0&&(d=n.trim(a.slice(h)),a=a.slice(0,h)),n.isFunction(b)?(c=b,b=void 0):b&&"object"==typeof b&&(e="POST"),g.length>0&&n.ajax({url:a,type:e,dataType:"html",data:b}).done(function(a){f=arguments,g.html(d?n("<div>").append(n.parseHTML(a)).find(d):a)}).complete(c&&function(a,b){g.each(c,f||[a.responseText,b,a])}),this},n.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){n.fn[b]=function(a){return this.on(b,a)}}),n.expr.filters.animated=function(a){return n.grep(n.timers,function(b){return a===b.elem}).length};var Ic=a.document.documentElement;function Jc(a){return n.isWindow(a)?a:9===a.nodeType&&a.defaultView}n.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,j,k=n.css(a,"position"),l=n(a),m={};"static"===k&&(a.style.position="relative"),h=l.offset(),f=n.css(a,"top"),i=n.css(a,"left"),j=("absolute"===k||"fixed"===k)&&(f+i).indexOf("auto")>-1,j?(d=l.position(),g=d.top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),n.isFunction(b)&&(b=b.call(a,c,h)),null!=b.top&&(m.top=b.top-h.top+g),null!=b.left&&(m.left=b.left-h.left+e),"using"in b?b.using.call(a,m):l.css(m)}},n.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each(function(b){n.offset.setOffset(this,a,b)});var b,c,d=this[0],e={top:0,left:0},f=d&&d.ownerDocument;if(f)return b=f.documentElement,n.contains(b,d)?(typeof d.getBoundingClientRect!==U&&(e=d.getBoundingClientRect()),c=Jc(f),{top:e.top+c.pageYOffset-b.clientTop,left:e.left+c.pageXOffset-b.clientLeft}):e},position:function(){if(this[0]){var a,b,c=this[0],d={top:0,left:0};return"fixed"===n.css(c,"position")?b=c.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),n.nodeName(a[0],"html")||(d=a.offset()),d.top+=n.css(a[0],"borderTopWidth",!0),d.left+=n.css(a[0],"borderLeftWidth",!0)),{top:b.top-d.top-n.css(c,"marginTop",!0),left:b.left-d.left-n.css(c,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var a=this.offsetParent||Ic;while(a&&!n.nodeName(a,"html")&&"static"===n.css(a,"position"))a=a.offsetParent;return a||Ic})}}),n.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(b,c){var d="pageYOffset"===c;n.fn[b]=function(e){return J(this,function(b,e,f){var g=Jc(b);return void 0===f?g?g[c]:b[e]:void(g?g.scrollTo(d?a.pageXOffset:f,d?f:a.pageYOffset):b[e]=f)},b,e,arguments.length,null)}}),n.each(["top","left"],function(a,b){n.cssHooks[b]=yb(k.pixelPosition,function(a,c){return c?(c=xb(a,b),vb.test(c)?n(a).position()[b]+"px":c):void 0})}),n.each({Height:"height",Width:"width"},function(a,b){n.each({padding:"inner"+a,content:b,"":"outer"+a},function(c,d){n.fn[d]=function(d,e){var f=arguments.length&&(c||"boolean"!=typeof d),g=c||(d===!0||e===!0?"margin":"border");return J(this,function(b,c,d){var e;return n.isWindow(b)?b.document.documentElement["client"+a]:9===b.nodeType?(e=b.documentElement,Math.max(b.body["scroll"+a],e["scroll"+a],b.body["offset"+a],e["offset"+a],e["client"+a])):void 0===d?n.css(b,c,g):n.style(b,c,d,g)},b,f?d:void 0,f,null)}})}),n.fn.size=function(){return this.length},n.fn.andSelf=n.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return n});var Kc=a.jQuery,Lc=a.$;return n.noConflict=function(b){return a.$===n&&(a.$=Lc),b&&a.jQuery===n&&(a.jQuery=Kc),n},typeof b===U&&(a.jQuery=a.$=n),n});
(function( jQuery, window, undefined ) {
"use strict";
 
var matched, browser;
 
jQuery.uaMatch = function( ua ) {
  ua = ua.toLowerCase();
 
	var match = /(chrome)[ \/]([\w.]+)/.exec( ua ) ||
		/(webkit)[ \/]([\w.]+)/.exec( ua ) ||
		/(opera)(?:.*version|)[ \/]([\w.]+)/.exec( ua ) ||
		/(msie) ([\w.]+)/.exec( ua ) ||
		ua.indexOf("compatible") < 0 && /(mozilla)(?:.*? rv:([\w.]+)|)/.exec( ua ) ||
		[];
 
	return {
		browser: match[ 1 ] || "",
		version: match[ 2 ] || "0"
	};
};
 
matched = jQuery.uaMatch( window.navigator.userAgent );
browser = {};
 
if ( matched.browser ) {
	browser[ matched.browser ] = true;
	browser.version = matched.version;
}
 
// Chrome is Webkit, but Webkit is also Safari.
if ( browser.chrome ) {
	browser.webkit = true;
} else if ( browser.webkit ) {
	browser.safari = true;
}
 
jQuery.browser = browser;
 
})( jQuery, window );/*!
 * jQuery Templates Plugin 1.0.0pre
 * http://github.com/jquery/jquery-tmpl
 * Requires jQuery 1.4.2
 *
 * Copyright 2011, Software Freedom Conservancy, Inc.
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 */
(function( jQuery, undefined ){
	var oldManip = jQuery.fn.domManip, tmplItmAtt = "_tmplitem", htmlExpr = /^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,
		newTmplItems = {}, wrappedItems = {}, appendToTmplItems, topTmplItem = { key: 0, data: {} }, itemKey = 0, cloneIndex = 0, stack = [];

	function newTmplItem( options, parentItem, fn, data ) {
		// Returns a template item data structure for a new rendered instance of a template (a 'template item').
		// The content field is a hierarchical array of strings and nested items (to be
		// removed and replaced by nodes field of dom elements, once inserted in DOM).
		var newItem = {
			data: data || (data === 0 || data === false) ? data : (parentItem ? parentItem.data : {}),
			_wrap: parentItem ? parentItem._wrap : null,
			tmpl: null,
			parent: parentItem || null,
			nodes: [],
			calls: tiCalls,
			nest: tiNest,
			wrap: tiWrap,
			html: tiHtml,
			update: tiUpdate
		};
		if ( options ) {
			jQuery.extend( newItem, options, { nodes: [], parent: parentItem });
		}
		if ( fn ) {
			// Build the hierarchical content to be used during insertion into DOM
			newItem.tmpl = fn;
			newItem._ctnt = newItem._ctnt || newItem.tmpl( jQuery, newItem );
			newItem.key = ++itemKey;
			// Keep track of new template item, until it is stored as jQuery Data on DOM element
			(stack.length ? wrappedItems : newTmplItems)[itemKey] = newItem;
		}
		return newItem;
	}

	// Override appendTo etc., in order to provide support for targeting multiple elements. (This code would disappear if integrated in jquery core).
	jQuery.each({
		appendTo: "append",
		prependTo: "prepend",
		insertBefore: "before",
		insertAfter: "after",
		replaceAll: "replaceWith"
	}, function( name, original ) {
		jQuery.fn[ name ] = function( selector ) {
			var ret = [], insert = jQuery( selector ), elems, i, l, tmplItems,
				parent = this.length === 1 && this[0].parentNode;

			appendToTmplItems = newTmplItems || {};
			if ( parent && parent.nodeType === 11 && parent.childNodes.length === 1 && insert.length === 1 ) {
				insert[ original ]( this[0] );
				ret = this;
			} else {
				for ( i = 0, l = insert.length; i < l; i++ ) {
					cloneIndex = i;
					elems = (i > 0 ? this.clone(true) : this).get();
					jQuery( insert[i] )[ original ]( elems );
					ret = ret.concat( elems );
				}
				cloneIndex = 0;
				ret = this.pushStack( ret, name, insert.selector );
			}
			tmplItems = appendToTmplItems;
			appendToTmplItems = null;
			jQuery.tmpl.complete( tmplItems );
			return ret;
		};
	});

	jQuery.fn.extend({
		// Use first wrapped element as template markup.
		// Return wrapped set of template items, obtained by rendering template against data.
		tmpl: function( data, options, parentItem ) {
			return jQuery.tmpl( this[0], data, options, parentItem );
		},

		// Find which rendered template item the first wrapped DOM element belongs to
		tmplItem: function() {
			return jQuery.tmplItem( this[0] );
		},

		// Consider the first wrapped element as a template declaration, and get the compiled template or store it as a named template.
		template: function( name ) {
			return jQuery.template( name, this[0] );
		},

		domManip: function( args, table, callback, options ) {
			if ( args[0] && jQuery.isArray( args[0] )) {
				var dmArgs = jQuery.makeArray( arguments ), elems = args[0], elemsLength = elems.length, i = 0, tmplItem;
				while ( i < elemsLength && !(tmplItem = jQuery.data( elems[i++], "tmplItem" ))) {}
				if ( tmplItem && cloneIndex ) {
					dmArgs[2] = function( fragClone ) {
						// Handler called by oldManip when rendered template has been inserted into DOM.
						jQuery.tmpl.afterManip( this, fragClone, callback );
					};
				}
				oldManip.apply( this, dmArgs );
			} else {
				oldManip.apply( this, arguments );
			}
			cloneIndex = 0;
			if ( !appendToTmplItems ) {
				jQuery.tmpl.complete( newTmplItems );
			}
			return this;
		}
	});

	jQuery.extend({
		// Return wrapped set of template items, obtained by rendering template against data.
		tmpl: function( tmpl, data, options, parentItem ) {
			var ret, topLevel = !parentItem;
			if ( topLevel ) {
				// This is a top-level tmpl call (not from a nested template using {{tmpl}})
				parentItem = topTmplItem;
				tmpl = jQuery.template[tmpl] || jQuery.template( null, tmpl );
				wrappedItems = {}; // Any wrapped items will be rebuilt, since this is top level
			} else if ( !tmpl ) {
				// The template item is already associated with DOM - this is a refresh.
				// Re-evaluate rendered template for the parentItem
				tmpl = parentItem.tmpl;
				newTmplItems[parentItem.key] = parentItem;
				parentItem.nodes = [];
				if ( parentItem.wrapped ) {
					updateWrapped( parentItem, parentItem.wrapped );
				}
				// Rebuild, without creating a new template item
				return jQuery( build( parentItem, null, parentItem.tmpl( jQuery, parentItem ) ));
			}
			if ( !tmpl ) {
				return []; // Could throw...
			}
			if ( typeof data === "function" ) {
				data = data.call( parentItem || {} );
			}
			if ( options && options.wrapped ) {
				updateWrapped( options, options.wrapped );
			}
			ret = jQuery.isArray( data ) ?
				jQuery.map( data, function( dataItem ) {
					return dataItem ? newTmplItem( options, parentItem, tmpl, dataItem ) : null;
				}) :
				[ newTmplItem( options, parentItem, tmpl, data ) ];
			return topLevel ? jQuery( build( parentItem, null, ret ) ) : ret;
		},

		// Return rendered template item for an element.
		tmplItem: function( elem ) {
			var tmplItem;
			if ( elem instanceof jQuery ) {
				elem = elem[0];
			}
			while ( elem && elem.nodeType === 1 && !(tmplItem = jQuery.data( elem, "tmplItem" )) && (elem = elem.parentNode) ) {}
			return tmplItem || topTmplItem;
		},

		// Set:
		// Use $.template( name, tmpl ) to cache a named template,
		// where tmpl is a template string, a script element or a jQuery instance wrapping a script element, etc.
		// Use $( "selector" ).template( name ) to provide access by name to a script block template declaration.

		// Get:
		// Use $.template( name ) to access a cached template.
		// Also $( selectorToScriptBlock ).template(), or $.template( null, templateString )
		// will return the compiled template, without adding a name reference.
		// If templateString includes at least one HTML tag, $.template( templateString ) is equivalent
		// to $.template( null, templateString )
		template: function( name, tmpl ) {
			if (tmpl) {
				// Compile template and associate with name
				if ( typeof tmpl === "string" ) {
					// This is an HTML string being passed directly in.
					tmpl = buildTmplFn( tmpl );
				} else if ( tmpl instanceof jQuery ) {
					tmpl = tmpl[0] || {};
				}
				if ( tmpl.nodeType ) {
					// If this is a template block, use cached copy, or generate tmpl function and cache.
					tmpl = jQuery.data( tmpl, "tmpl" ) || jQuery.data( tmpl, "tmpl", buildTmplFn( tmpl.innerHTML ));
					// Issue: In IE, if the container element is not a script block, the innerHTML will remove quotes from attribute values whenever the value does not include white space.
					// This means that foo="${x}" will not work if the value of x includes white space: foo="${x}" -> foo=value of x.
					// To correct this, include space in tag: foo="${ x }" -> foo="value of x"
				}
				return typeof name === "string" ? (jQuery.template[name] = tmpl) : tmpl;
			}
			// Return named compiled template
			return name ? (typeof name !== "string" ? jQuery.template( null, name ):
				(jQuery.template[name] ||
					// If not in map, and not containing at least on HTML tag, treat as a selector.
					// (If integrated with core, use quickExpr.exec)
					jQuery.template( null, htmlExpr.test( name ) ? name : jQuery( name )))) : null;
		},

		encode: function( text ) {
			// Do HTML encoding replacing < > & and ' and " by corresponding entities.
			return ("" + text).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;");
		}
	});

	jQuery.extend( jQuery.tmpl, {
		tag: {
			"tmpl": {
				_default: { $2: "null" },
				open: "if($notnull_1){__=__.concat($item.nest($1,$2));}"
				// tmpl target parameter can be of type function, so use $1, not $1a (so not auto detection of functions)
				// This means that {{tmpl foo}} treats foo as a template (which IS a function).
				// Explicit parens can be used if foo is a function that returns a template: {{tmpl foo()}}.
			},
			"wrap": {
				_default: { $2: "null" },
				open: "$item.calls(__,$1,$2);__=[];",
				close: "call=$item.calls();__=call._.concat($item.wrap(call,__));"
			},
			"each": {
				_default: { $2: "$index, $value" },
				open: "if($notnull_1){$.each($1a,function($2){with(this){",
				close: "}});}"
			},
			"if": {
				open: "if(($notnull_1) && $1a){",
				close: "}"
			},
			"else": {
				_default: { $1: "true" },
				open: "}else if(($notnull_1) && $1a){"
			},
			"html": {
				// Unecoded expression evaluation.
				open: "if($notnull_1){__.push($1a);}"
			},
			"=": {
				// Encoded expression evaluation. Abbreviated form is ${}.
				_default: { $1: "$data" },
				open: "if($notnull_1){__.push($.encode($1a));}"
			},
			"!": {
				// Comment tag. Skipped by parser
				open: ""
			}
		},

		// This stub can be overridden, e.g. in jquery.tmplPlus for providing rendered events
		complete: function( items ) {
			newTmplItems = {};
		},

		// Call this from code which overrides domManip, or equivalent
		// Manage cloning/storing template items etc.
		afterManip: function afterManip( elem, fragClone, callback ) {
			// Provides cloned fragment ready for fixup prior to and after insertion into DOM
			var content = fragClone.nodeType === 11 ?
				jQuery.makeArray(fragClone.childNodes) :
				fragClone.nodeType === 1 ? [fragClone] : [];

			// Return fragment to original caller (e.g. append) for DOM insertion
			callback.call( elem, fragClone );

			// Fragment has been inserted:- Add inserted nodes to tmplItem data structure. Replace inserted element annotations by jQuery.data.
			storeTmplItems( content );
			cloneIndex++;
		}
	});

	//========================== Private helper functions, used by code above ==========================

	function build( tmplItem, nested, content ) {
		// Convert hierarchical content into flat string array
		// and finally return array of fragments ready for DOM insertion
		var frag, ret = content ? jQuery.map( content, function( item ) {
			return (typeof item === "string") ?
				// Insert template item annotations, to be converted to jQuery.data( "tmplItem" ) when elems are inserted into DOM.
				(tmplItem.key ? item.replace( /(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g, "$1 " + tmplItmAtt + "=\"" + tmplItem.key + "\" $2" ) : item) :
				// This is a child template item. Build nested template.
				build( item, tmplItem, item._ctnt );
		}) :
		// If content is not defined, insert tmplItem directly. Not a template item. May be a string, or a string array, e.g. from {{html $item.html()}}.
		tmplItem;
		if ( nested ) {
			return ret;
		}

		// top-level template
		ret = ret.join("");

		// Support templates which have initial or final text nodes, or consist only of text
		// Also support HTML entities within the HTML markup.
		//ret.replace( /^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/, function( all, before, middle, after) {
		//	frag = jQuery( middle ).get();
        //
		//	storeTmplItems( frag );
		//	if ( before ) {
		//		frag = unencode( before ).concat(frag);
		//	}
		//	if ( after ) {
		//		frag = frag.concat(unencode( after ));
		//	}
		//});
		return frag ? frag : unencode( ret );
	}

	function unencode( text ) {
		// Use createElement, since createTextNode will not render HTML entities correctly
		var el = document.createElement( "div" );
		el.innerHTML = text;
		return jQuery.makeArray(el.childNodes);
	}

	// Generate a reusable function that will serve to render a template against data
	function buildTmplFn( markup ) {
		return new Function("jQuery","$item",
			// Use the variable __ to hold a string array while building the compiled template. (See https://github.com/jquery/jquery-tmpl/issues#issue/10).
			"var $=jQuery,call,__=[],$data=$item.data;" +

			// Introduce the data as local variables using with(){}
			"with($data){__.push('" +

			// Convert the template into pure JavaScript
			jQuery.trim(markup)
				.replace( /([\\'])/g, "\\$1" )
				.replace( /[\r\t\n]/g, " " )
				.replace( /\$\{([^\}]*)\}/g, "{{= $1}}" )
				.replace( /\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,
				function( all, slash, type, fnargs, target, parens, args ) {
					var tag = jQuery.tmpl.tag[ type ], def, expr, exprAutoFnDetect;
					if ( !tag ) {
						throw "Unknown template tag: " + type;
					}
					def = tag._default || [];
					if ( parens && !/\w$/.test(target)) {
						target += parens;
						parens = "";
					}
					if ( target ) {
						target = unescape( target );
						args = args ? ("," + unescape( args ) + ")") : (parens ? ")" : "");
						// Support for target being things like a.toLowerCase();
						// In that case don't call with template item as 'this' pointer. Just evaluate...
						expr = parens ? (target.indexOf(".") > -1 ? target + unescape( parens ) : ("(" + target + ").call($item" + args)) : target;
						exprAutoFnDetect = parens ? expr : "(typeof(" + target + ")==='function'?(" + target + ").call($item):(" + target + "))";
					} else {
						exprAutoFnDetect = expr = def.$1 || "null";
					}
					fnargs = unescape( fnargs );
					return "');" +
						tag[ slash ? "close" : "open" ]
							.split( "$notnull_1" ).join( target ? "typeof(" + target + ")!=='undefined' && (" + target + ")!=null" : "true" )
							.split( "$1a" ).join( exprAutoFnDetect )
							.split( "$1" ).join( expr )
							.split( "$2" ).join( fnargs || def.$2 || "" ) +
						"__.push('";
				}) +
			"');}return __;"
		);
	}
	function updateWrapped( options, wrapped ) {
		// Build the wrapped content.
		options._wrap = build( options, true,
			// Suport imperative scenario in which options.wrapped can be set to a selector or an HTML string.
			jQuery.isArray( wrapped ) ? wrapped : [htmlExpr.test( wrapped ) ? wrapped : jQuery( wrapped ).html()]
		).join("");
	}

	function unescape( args ) {
		return args ? args.replace( /\\'/g, "'").replace(/\\\\/g, "\\" ) : null;
	}
	function outerHtml( elem ) {
		var div = document.createElement("div");
		div.appendChild( elem.cloneNode(true) );
		return div.innerHTML;
	}

	// Store template items in jQuery.data(), ensuring a unique tmplItem data data structure for each rendered template instance.
	function storeTmplItems( content ) {
		//var keySuffix = "_" + cloneIndex, elem, elems, newClonedItems = {}, i, l, m;
		//for ( i = 0, l = content.length; i < l; i++ ) {
		//	if ( (elem = content[i]).nodeType !== 1 ) {
		//		continue;
		//	}
		//	elems = elem.getElementsByTagName("*");
		//	for ( m = elems.length - 1; m >= 0; m-- ) {
		//		processItemKey( elems[m] );
		//	}
		//	processItemKey( elem );
		//}
		//function processItemKey( el ) {
		//	//var pntKey, pntNode = el, pntItem, tmplItem, key;
		//	//// Ensure that each rendered template inserted into the DOM has its own template item,
		//	//if ( (key = el.getAttribute( tmplItmAtt ))) {
		//	//	while ( pntNode.parentNode && (pntNode = pntNode.parentNode).nodeType === 1 && !(pntKey = pntNode.getAttribute( tmplItmAtt ))) { }
		//	//	if ( pntKey !== key ) {
		//	//		// The next ancestor with a _tmplitem expando is on a different key than this one.
		//	//		// So this is a top-level element within this template item
		//	//		// Set pntNode to the key of the parentNode, or to 0 if pntNode.parentNode is null, or pntNode is a fragment.
		//	//		pntNode = pntNode.parentNode ? (pntNode.nodeType === 11 ? 0 : (pntNode.getAttribute( tmplItmAtt ) || 0)) : 0;
		//	//		if ( !(tmplItem = newTmplItems[key]) ) {
		//	//			// The item is for wrapped content, and was copied from the temporary parent wrappedItem.
		//	//			tmplItem = wrappedItems[key];
		//	//			tmplItem = newTmplItem( tmplItem, newTmplItems[pntNode]||wrappedItems[pntNode] );
		//	//			tmplItem.key = ++itemKey;
		//	//			newTmplItems[itemKey] = tmplItem;
		//	//		}
		//	//		if ( cloneIndex ) {
		//	//			cloneTmplItem( key );
		//	//		}
		//	//	}
		//	//	el.removeAttribute( tmplItmAtt );
		//	//} //else if ( cloneIndex && (tmplItem = jQuery.data( el, "tmplItem" )) ) {
		//	//	// This was a rendered element, cloned during append or appendTo etc.
		//	//	// TmplItem stored in jQuery data has already been cloned in cloneCopyEvent. We must replace it with a fresh cloned tmplItem.
		//	//	cloneTmplItem( tmplItem.key );
		//	//	newTmplItems[tmplItem.key] = tmplItem;
		//	//	pntNode = jQuery.data( el.parentNode, "tmplItem" );
		//	//	pntNode = pntNode ? pntNode.key : 0;
		//	//}
		//	//if ( tmplItem ) {
		//	//	pntItem = tmplItem;
		//	//	// Find the template item of the parent element.
		//	//	// (Using !=, not !==, since pntItem.key is number, and pntNode may be a string)
		//	//	while ( pntItem && pntItem.key != pntNode ) {
		//	//		// Add this element as a top-level node for this rendered template item, as well as for any
		//	//		// ancestor items between this item and the item of its parent element
		//	//		pntItem.nodes.push( el );
		//	//		pntItem = pntItem.parent;
		//	//	}
		//	//	// Delete content built during rendering - reduce API surface area and memory use, and avoid exposing of stale data after rendering...
		//	//	delete tmplItem._ctnt;
		//	//	delete tmplItem._wrap;
		//	//	// Store template item as jQuery data on the element
		//	//	//jQuery.data( el, "tmplItem", tmplItem );
		//	//}
		//	function cloneTmplItem( key ) {
		//		//key = key + keySuffix;
		//		//tmplItem = newClonedItems[key] =
		//		//	(newClonedItems[key] || newTmplItem( tmplItem, newTmplItems[tmplItem.parent.key + keySuffix] || tmplItem.parent ));
		//	}
		//}
	}

	//---- Helper functions for template item ----

	function tiCalls( content, tmpl, data, options ) {
		if ( !content ) {
			return stack.pop();
		}
		stack.push({ _: content, tmpl: tmpl, item:this, data: data, options: options });
	}

	function tiNest( tmpl, data, options ) {
		// nested template, using {{tmpl}} tag
		return jQuery.tmpl( jQuery.template( tmpl ), data, options, this );
	}

	function tiWrap( call, wrapped ) {
		// nested template, using {{wrap}} tag
		var options = call.options || {};
		options.wrapped = wrapped;
		// Apply the template, which may incorporate wrapped content,
		return jQuery.tmpl( jQuery.template( call.tmpl ), call.data, options, call.item );
	}

	function tiHtml( filter, textOnly ) {
		var wrapped = this._wrap;
		return jQuery.map(
			jQuery( jQuery.isArray( wrapped ) ? wrapped.join("") : wrapped ).filter( filter || "*" ),
			function(e) {
				return textOnly ?
					e.innerText || e.textContent :
					e.outerHTML || outerHtml(e);
			});
	}

	function tiUpdate() {
		var coll = this.nodes;
		jQuery.tmpl( null, null, null, this).insertBefore( coll[0] );
		jQuery( coll ).remove();
	}
})( jQuery );
var JSHINT=(function(){"use strict";var anonname,bang={'<':true,'<=':true,'==':true,'===':true,'!==':true,'!=':true,'>':true,'>=':true,'+':true,'-':true,'*':true,'/':true,'%':true},boolOptions={asi:true,bitwise:true,boss:true,browser:true,couch:true,curly:true,debug:true,devel:true,dojo:true,eqeqeq:true,eqnull:true,es5:true,esnext:true,evil:true,expr:true,forin:true,funcscope:true,globalstrict:true,immed:true,iterator:true,jquery:true,lastsemic:true,latedef:true,laxbreak:true,laxcomma:true,loopfunc:true,mootools:true,multistr:true,newcap:true,noarg:true,node:true,noempty:true,nonew:true,nonstandard:true,nomen:true,onevar:true,onecase:true,passfail:true,plusplus:true,proto:true,prototypejs:true,regexdash:true,regexp:true,rhino:true,undef:true,scripturl:true,shadow:true,smarttabs:true,strict:true,sub:true,supernew:true,trailing:true,validthis:true,withstmt:true,white:true,wsh:true},valOptions={maxlen:false,indent:false,maxerr:false,predef:false},browser={ArrayBuffer:false,ArrayBufferView:false,Audio:false,addEventListener:false,applicationCache:false,atob:false,blur:false,btoa:false,clearInterval:false,clearTimeout:false,close:false,closed:false,DataView:false,DOMParser:false,defaultStatus:false,document:false,event:false,FileReader:false,Float32Array:false,Float64Array:false,FormData:false,focus:false,frames:false,getComputedStyle:false,HTMLElement:false,HTMLAnchorElement:false,HTMLBaseElement:false,HTMLBlockquoteElement:false,HTMLBodyElement:false,HTMLBRElement:false,HTMLButtonElement:false,HTMLCanvasElement:false,HTMLDirectoryElement:false,HTMLDivElement:false,HTMLDListElement:false,HTMLFieldSetElement:false,HTMLFontElement:false,HTMLFormElement:false,HTMLFrameElement:false,HTMLFrameSetElement:false,HTMLHeadElement:false,HTMLHeadingElement:false,HTMLHRElement:false,HTMLHtmlElement:false,HTMLIFrameElement:false,HTMLImageElement:false,HTMLInputElement:false,HTMLIsIndexElement:false,HTMLLabelElement:false,HTMLLayerElement:false,HTMLLegendElement:false,HTMLLIElement:false,HTMLLinkElement:false,HTMLMapElement:false,HTMLMenuElement:false,HTMLMetaElement:false,HTMLModElement:false,HTMLObjectElement:false,HTMLOListElement:false,HTMLOptGroupElement:false,HTMLOptionElement:false,HTMLParagraphElement:false,HTMLParamElement:false,HTMLPreElement:false,HTMLQuoteElement:false,HTMLScriptElement:false,HTMLSelectElement:false,HTMLStyleElement:false,HTMLTableCaptionElement:false,HTMLTableCellElement:false,HTMLTableColElement:false,HTMLTableElement:false,HTMLTableRowElement:false,HTMLTableSectionElement:false,HTMLTextAreaElement:false,HTMLTitleElement:false,HTMLUListElement:false,HTMLVideoElement:false,history:false,Int16Array:false,Int32Array:false,Int8Array:false,Image:false,length:false,localStorage:false,location:false,MessageChannel:false,MessageEvent:false,MessagePort:false,moveBy:false,moveTo:false,name:false,navigator:false,onbeforeunload:true,onblur:true,onerror:true,onfocus:true,onload:true,onresize:true,onunload:true,open:false,openDatabase:false,opener:false,Option:false,parent:false,print:false,removeEventListener:false,resizeBy:false,resizeTo:false,screen:false,scroll:false,scrollBy:false,scrollTo:false,sessionStorage:false,setInterval:false,setTimeout:false,SharedWorker:false,status:false,top:false,Uint16Array:false,Uint32Array:false,Uint8Array:false,WebSocket:false,window:false,Worker:false,XMLHttpRequest:false,XMLSerializer:false,XPathEvaluator:false,XPathException:false,XPathExpression:false,XPathNamespace:false,XPathNSResolver:false,XPathResult:false},couch={"require":false,respond:false,getRow:false,emit:false,send:false,start:false,sum:false,log:false,exports:false,module:false,provides:false},devel={alert:false,confirm:false,console:false,Debug:false,opera:false,prompt:false},dojo={dojo:false,dijit:false,dojox:false,define:false,"require":false},escapes={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','/':'\\/','\\':'\\\\'},funct,functionicity=['closure','exception','global','label','outer','unused','var'],functions,global,implied,inblock,indent,jsonmode,jquery={'$':false,jQuery:false},lines,lookahead,member,membersOnly,mootools={'$':false,'$$':false,Assets:false,Browser:false,Chain:false,Class:false,Color:false,Cookie:false,Core:false,Document:false,DomReady:false,DOMReady:false,Drag:false,Element:false,Elements:false,Event:false,Events:false,Fx:false,Group:false,Hash:false,HtmlTable:false,Iframe:false,IframeShim:false,InputValidator:false,instanceOf:false,Keyboard:false,Locale:false,Mask:false,MooTools:false,Native:false,Options:false,OverText:false,Request:false,Scroller:false,Slick:false,Slider:false,Sortables:false,Spinner:false,Swiff:false,Tips:false,Type:false,typeOf:false,URI:false,Window:false},nexttoken,node={__filename:false,__dirname:false,Buffer:false,console:false,exports:false,GLOBAL:false,global:false,module:false,process:false,require:false,setTimeout:false,clearTimeout:false,setInterval:false,clearInterval:false},noreach,option,predefined,prereg,prevtoken,prototypejs={'$':false,'$$':false,'$A':false,'$F':false,'$H':false,'$R':false,'$break':false,'$continue':false,'$w':false,Abstract:false,Ajax:false,Class:false,Enumerable:false,Element:false,Event:false,Field:false,Form:false,Hash:false,Insertion:false,ObjectRange:false,PeriodicalExecuter:false,Position:false,Prototype:false,Selector:false,Template:false,Toggle:false,Try:false,Autocompleter:false,Builder:false,Control:false,Draggable:false,Draggables:false,Droppables:false,Effect:false,Sortable:false,SortableObserver:false,Sound:false,Scriptaculous:false},rhino={defineClass:false,deserialize:false,gc:false,help:false,importPackage:false,"java":false,load:false,loadClass:false,print:false,quit:false,readFile:false,readUrl:false,runCommand:false,seal:false,serialize:false,spawn:false,sync:false,toint32:false,version:false},scope,stack,standard={Array:false,Boolean:false,Date:false,decodeURI:false,decodeURIComponent:false,encodeURI:false,encodeURIComponent:false,Error:false,'eval':false,EvalError:false,Function:false,hasOwnProperty:false,isFinite:false,isNaN:false,JSON:false,Math:false,Number:false,Object:false,parseInt:false,parseFloat:false,RangeError:false,ReferenceError:false,RegExp:false,String:false,SyntaxError:false,TypeError:false,URIError:false},nonstandard={escape:false,unescape:false},standard_member={E:true,LN2:true,LN10:true,LOG2E:true,LOG10E:true,MAX_VALUE:true,MIN_VALUE:true,NEGATIVE_INFINITY:true,PI:true,POSITIVE_INFINITY:true,SQRT1_2:true,SQRT2:true},directive,syntax={},tab,token,urls,useESNextSyntax,warnings,wsh={ActiveXObject:true,Enumerator:true,GetObject:true,ScriptEngine:true,ScriptEngineBuildVersion:true,ScriptEngineMajorVersion:true,ScriptEngineMinorVersion:true,VBArray:true,WSH:true,WScript:true,XDomainRequest:true};var ax,cx,tx,nx,nxg,lx,ix,jx,ft;(function(){ax=/@cc|<\/?|script|\]\s*\]|<\s*!|&lt/i;cx=/[\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/;tx=/^\s*([(){}\[.,:;'"~\?\]#@]|==?=?|\/(\*(jshint|jslint|members?|global)?|=|\/)?|\*[\/=]?|\+(?:=|\++)?|-(?:=|-+)?|%=?|&[&=]?|\|[|=]?|>>?>?=?|<([\/=!]|\!(\[|--)?|<=?)?|\^=?|\!=?=?|[a-zA-Z_$][a-zA-Z0-9_$]*|[0-9]+([xX][0-9a-fA-F]+|\.[0-9]*)?([eE][+\-]?[0-9]+)?)/;nx=/[\u0000-\u001f&<"\/\\\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/;nxg=/[\u0000-\u001f&<"\/\\\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;lx=/\*\/|\/\*/;ix=/^([a-zA-Z_$][a-zA-Z0-9_$]*)$/;jx=/^(?:javascript|jscript|ecmascript|vbscript|mocha|livescript)\s*:/i;ft=/^\s*\/\*\s*falls\sthrough\s*\*\/\s*$/}());function F(){}function is_own(object,name){return Object.prototype.hasOwnProperty.call(object,name)}function checkOption(name,t){if(valOptions[name]===undefined&&boolOptions[name]===undefined){warning("Bad option: '"+name+"'.",t)}}if(typeof Array.isArray!=='function'){Array.isArray=function(o){return Object.prototype.toString.apply(o)==='[object Array]'}}if(typeof Object.create!=='function'){Object.create=function(o){F.prototype=o;return new F()}}if(typeof Object.keys!=='function'){Object.keys=function(o){var a=[],k;for(k in o){if(is_own(o,k)){a.push(k)}}return a}}if(typeof String.prototype.entityify!=='function'){String.prototype.entityify=function(){return this.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}}if(typeof String.prototype.isAlpha!=='function'){String.prototype.isAlpha=function(){return(this>='a'&&this<='z\uffff')||(this>='A'&&this<='Z\uffff')}}if(typeof String.prototype.isDigit!=='function'){String.prototype.isDigit=function(){return(this>='0'&&this<='9')}}if(typeof String.prototype.supplant!=='function'){String.prototype.supplant=function(o){return this.replace(/\{([^{}]*)\}/g,function(a,b){var r=o[b];return typeof r==='string'||typeof r==='number'?r:a})}}if(typeof String.prototype.name!=='function'){String.prototype.name=function(){if(ix.test(this)){return this}if(nx.test(this)){return'"'+this.replace(nxg,function(a){var c=escapes[a];if(c){return c}return'\\u'+('0000'+a.charCodeAt().toString(16)).slice(-4)})+'"'}return'"'+this+'"'}}function combine(t,o){var n;for(n in o){if(is_own(o,n)){t[n]=o[n]}}}function assume(){if(option.couch){combine(predefined,couch)}if(option.rhino){combine(predefined,rhino)}if(option.prototypejs){combine(predefined,prototypejs)}if(option.node){combine(predefined,node);option.globalstrict=true}if(option.devel){combine(predefined,devel)}if(option.dojo){combine(predefined,dojo)}if(option.browser){combine(predefined,browser)}if(option.nonstandard){combine(predefined,nonstandard)}if(option.jquery){combine(predefined,jquery)}if(option.mootools){combine(predefined,mootools)}if(option.wsh){combine(predefined,wsh)}if(option.esnext){useESNextSyntax()}if(option.globalstrict&&option.strict!==false){option.strict=true}}function quit(message,line,chr){var percentage=Math.floor((line/lines.length)*100);throw{name:'JSHintError',line:line,character:chr,message:message+" ("+percentage+"% scanned).",raw:message}}function isundef(scope,m,t,a){return JSHINT.undefs.push([scope,m,t,a])}function warning(m,t,a,b,c,d){var ch,l,w;t=t||nexttoken;if(t.id==='(end)'){t=token}l=t.line||0;ch=t.from||0;w={id:'(error)',raw:m,evidence:lines[l-1]||'',line:l,character:ch,a:a,b:b,c:c,d:d};w.reason=m.supplant(w);JSHINT.errors.push(w);if(option.passfail){quit('Stopping. ',l,ch)}warnings+=1;if(warnings>=option.maxerr){quit("Too many errors.",l,ch)}return w}function warningAt(m,l,ch,a,b,c,d){return warning(m,{line:l,from:ch},a,b,c,d)}function error(m,t,a,b,c,d){var w=warning(m,t,a,b,c,d)}function errorAt(m,l,ch,a,b,c,d){return error(m,{line:l,from:ch},a,b,c,d)}var lex=(function lex(){var character,from,line,s;function nextLine(){var at,tw;if(line>=lines.length)return false;character=1;s=lines[line];line+=1;if(option.smarttabs)at=s.search(/ \t/);else at=s.search(/ \t|\t /);if(at>=0)warningAt("Mixed spaces and tabs.",line,at+1);s=s.replace(/\t/g,tab);at=s.search(cx);if(at>=0)warningAt("Unsafe character.",line,at);if(option.maxlen&&option.maxlen<s.length)warningAt("Line too long.",line,s.length);tw=option.trailing&&s.match(/^(.*?)\s+$/);if(tw&&!/^\s+$/.test(s)){warningAt("Trailing whitespace.",line,tw[1].length+1)}return true}function it(type,value){var i,t;if(type==='(color)'||type==='(range)'){t={type:type}}else if(type==='(punctuator)'||(type==='(identifier)'&&is_own(syntax,value))){t=syntax[value]||syntax['(error)']}else{t=syntax[type]}t=Object.create(t);if(type==='(string)'||type==='(range)'){if(!option.scripturl&&jx.test(value)){warningAt("Script URL.",line,from)}}if(type==='(identifier)'){t.identifier=true;if(value==='__proto__'&&!option.proto){warningAt("The '{a}' property is deprecated.",line,from,value)}else if(value==='__iterator__'&&!option.iterator){warningAt("'{a}' is only available in JavaScript 1.7.",line,from,value)}else if(option.nomen&&(value.charAt(0)==='_'||value.charAt(value.length-1)==='_')){if(!option.node||token.id==='.'||(value!=='__dirname'&&value!=='__filename')){warningAt("Unexpected {a} in '{b}'.",line,from,"dangling '_'",value)}}}t.value=value;t.line=line;t.character=character;t.from=from;i=t.id;if(i!=='(endline)'){prereg=i&&(('(,=:[!&|?{};'.indexOf(i.charAt(i.length-1))>=0)||i==='return'||i==='case')}return t}return{init:function(source){if(typeof source==='string'){lines=source.replace(/\r\n/g,'\n').replace(/\r/g,'\n').split('\n')}else{lines=source}if(lines[0]&&lines[0].substr(0,2)==='#!')lines[0]='';line=0;nextLine();from=1},range:function(begin,end){var c,value='';from=character;if(s.charAt(0)!==begin){errorAt("Expected '{a}' and instead saw '{b}'.",line,character,begin,s.charAt(0))}for(;;){s=s.slice(1);character+=1;c=s.charAt(0);switch(c){case'':errorAt("Missing '{a}'.",line,character,c);break;case end:s=s.slice(1);character+=1;return it('(range)',value);case'\\':warningAt("Unexpected '{a}'.",line,character,c)}value+=c}},token:function(){var b,c,captures,d,depth,high,i,l,low,q,t,isLiteral,isInRange,n;function match(x){var r=x.exec(s),r1;if(r){l=r[0].length;r1=r[1];c=r1.charAt(0);s=s.substr(l);from=character+l-r1.length;character+=l;return r1}}function string(x){var c,j,r='',allowNewLine=false;if(jsonmode&&x!=='"'){warningAt("Strings must use doublequote.",line,character)}function esc(n){var i=parseInt(s.substr(j+1,n),16);j+=n;if(i>=32&&i<=126&&i!==34&&i!==92&&i!==39){warningAt("Unnecessary escapement.",line,character)}character+=n;c=String.fromCharCode(i)}j=0;unclosedString:for(;;){while(j>=s.length){j=0;var cl=line,cf=from;if(!nextLine()){errorAt("Unclosed string.",cl,cf);break unclosedString}if(allowNewLine){allowNewLine=false}else{warningAt("Unclosed string.",cl,cf)}}c=s.charAt(j);if(c===x){character+=1;s=s.substr(j+1);return it('(string)',r,x)}if(c<' '){if(c==='\n'||c==='\r'){break}warningAt("Control character in string: {a}.",line,character+j,s.slice(0,j))}else if(c==='\\'){j+=1;character+=1;c=s.charAt(j);n=s.charAt(j+1);switch(c){case'\\':case'"':case'/':break;case'\'':if(jsonmode){warningAt("Avoid \\'.",line,character)}break;case'b':c='\b';break;case'f':c='\f';break;case'n':c='\n';break;case'r':c='\r';break;case't':c='\t';break;case'0':c='\0';if(n>=0&&n<=7&&directive["use strict"]){warningAt("Octal literals are not allowed in strict mode.",line,character)}break;case'u':esc(4);break;case'v':if(jsonmode){warningAt("Avoid \\v.",line,character)}c='\v';break;case'x':if(jsonmode){warningAt("Avoid \\x-.",line,character)}esc(2);break;case'':allowNewLine=true;if(option.multistr){if(jsonmode){warningAt("Avoid EOL escapement.",line,character)}c='';character-=1;break}warningAt("Bad escapement of EOL. Use option multistr if needed.",line,character);break;default:warningAt("Bad escapement.",line,character)}}r+=c;character+=1;j+=1}}for(;;){if(!s){return it(nextLine()?'(endline)':'(end)','')}t=match(tx);if(!t){t='';c='';while(s&&s<'!'){s=s.substr(1)}if(s){errorAt("Unexpected '{a}'.",line,character,s.substr(0,1));s=''}}else{if(c.isAlpha()||c==='_'||c==='$'){return it('(identifier)',t)}if(c.isDigit()){if(!isFinite(Number(t))){warningAt("Bad number '{a}'.",line,character,t)}if(s.substr(0,1).isAlpha()){warningAt("Missing space after '{a}'.",line,character,t)}if(c==='0'){d=t.substr(1,1);if(d.isDigit()){if(token.id!=='.'){warningAt("Don't use extra leading zeros '{a}'.",line,character,t)}}else if(jsonmode&&(d==='x'||d==='X')){warningAt("Avoid 0x-. '{a}'.",line,character,t)}}if(t.substr(t.length-1)==='.'){warningAt("A trailing decimal point can be confused with a dot '{a}'.",line,character,t)}return it('(number)',t)}switch(t){case'"':case"'":return string(t);case'//':s='';token.comment=true;break;case'/*':for(;;){i=s.search(lx);if(i>=0){break}if(!nextLine()){errorAt("Unclosed comment.",line,character)}}character+=i+2;if(s.substr(i,1)==='/'){errorAt("Nested comment.",line,character)}s=s.substr(i+2);token.comment=true;break;case'/*members':case'/*member':case'/*jshint':case'/*jslint':case'/*global':case'*/':return{value:t,type:'special',line:line,character:character,from:from};case'':break;case'/':if(token.id==='/='){errorAt("A regular expression literal can be confused with '/='.",line,from)}if(prereg){depth=0;captures=0;l=0;for(;;){b=true;c=s.charAt(l);l+=1;switch(c){case'':errorAt("Unclosed regular expression.",line,from);return quit('Stopping.',line,from);case'/':if(depth>0){warningAt("{a} unterminated regular expression "+"group(s).",line,from+l,depth)}c=s.substr(0,l-1);q={g:true,i:true,m:true};while(q[s.charAt(l)]===true){q[s.charAt(l)]=false;l+=1}character+=l;s=s.substr(l);q=s.charAt(0);if(q==='/'||q==='*'){errorAt("Confusing regular expression.",line,from)}return it('(regexp)',c);case'\\':c=s.charAt(l);if(c<' '){warningAt("Unexpected control character in regular expression.",line,from+l)}else if(c==='<'){warningAt("Unexpected escaped character '{a}' in regular expression.",line,from+l,c)}l+=1;break;case'(':depth+=1;b=false;if(s.charAt(l)==='?'){l+=1;switch(s.charAt(l)){case':':case'=':case'!':l+=1;break;default:warningAt("Expected '{a}' and instead saw '{b}'.",line,from+l,':',s.charAt(l))}}else{captures+=1}break;case'|':b=false;break;case')':if(depth===0){warningAt("Unescaped '{a}'.",line,from+l,')')}else{depth-=1}break;case' ':q=1;while(s.charAt(l)===' '){l+=1;q+=1}if(q>1){warningAt("Spaces are hard to count. Use {{a}}.",line,from+l,q)}break;case'[':c=s.charAt(l);if(c==='^'){l+=1;if(option.regexp){warningAt("Insecure '{a}'.",line,from+l,c)}else if(s.charAt(l)===']'){errorAt("Unescaped '{a}'.",line,from+l,'^')}}if(c===']'){warningAt("Empty class.",line,from+l-1)}isLiteral=false;isInRange=false;klass:do{c=s.charAt(l);l+=1;switch(c){case'[':case'^':warningAt("Unescaped '{a}'.",line,from+l,c);if(isInRange){isInRange=false}else{isLiteral=true}break;case'-':if(isLiteral&&!isInRange){isLiteral=false;isInRange=true}else if(isInRange){isInRange=false}else if(s.charAt(l)===']'){isInRange=true}else{if(option.regexdash!==(l===2||(l===3&&s.charAt(1)==='^'))){warningAt("Unescaped '{a}'.",line,from+l-1,'-')}isLiteral=true}break;case']':if(isInRange&&!option.regexdash){warningAt("Unescaped '{a}'.",line,from+l-1,'-')}break klass;case'\\':c=s.charAt(l);if(c<' '){warningAt("Unexpected control character in regular expression.",line,from+l)}else if(c==='<'){warningAt("Unexpected escaped character '{a}' in regular expression.",line,from+l,c)}l+=1;if(/[wsd]/i.test(c)){if(isInRange){warningAt("Unescaped '{a}'.",line,from+l,'-');isInRange=false}isLiteral=false}else if(isInRange){isInRange=false}else{isLiteral=true}break;case'/':warningAt("Unescaped '{a}'.",line,from+l-1,'/');if(isInRange){isInRange=false}else{isLiteral=true}break;case'<':if(isInRange){isInRange=false}else{isLiteral=true}break;default:if(isInRange){isInRange=false}else{isLiteral=true}}}while(c);break;case'.':if(option.regexp){warningAt("Insecure '{a}'.",line,from+l,c)}break;case']':case'?':case'{':case'}':case'+':case'*':warningAt("Unescaped '{a}'.",line,from+l,c)}if(b){switch(s.charAt(l)){case'?':case'+':case'*':l+=1;if(s.charAt(l)==='?'){l+=1}break;case'{':l+=1;c=s.charAt(l);if(c<'0'||c>'9'){warningAt("Expected a number and instead saw '{a}'.",line,from+l,c)}l+=1;low=+c;for(;;){c=s.charAt(l);if(c<'0'||c>'9'){break}l+=1;low=+c+(low*10)}high=low;if(c===','){l+=1;high=Infinity;c=s.charAt(l);if(c>='0'&&c<='9'){l+=1;high=+c;for(;;){c=s.charAt(l);if(c<'0'||c>'9'){break}l+=1;high=+c+(high*10)}}}if(s.charAt(l)!=='}'){warningAt("Expected '{a}' and instead saw '{b}'.",line,from+l,'}',c)}else{l+=1}if(s.charAt(l)==='?'){l+=1}if(low>high){warningAt("'{a}' should not be greater than '{b}'.",line,from+l,low,high)}}}}c=s.substr(0,l-1);character+=l;s=s.substr(l);return it('(regexp)',c)}return it('(punctuator)',t);case'#':return it('(punctuator)',t);default:return it('(punctuator)',t)}}}}}}());function addlabel(t,type){if(t==='hasOwnProperty'){warning("'hasOwnProperty' is a really bad name.")}if(is_own(funct,t)&&!funct['(global)']){if(funct[t]===true){if(option.latedef)warning("'{a}' was used before it was defined.",nexttoken,t)}else{if(!option.shadow&&type!=="exception")warning("'{a}' is already defined.",nexttoken,t)}}funct[t]=type;if(funct['(global)']){global[t]=funct;if(is_own(implied,t)){if(option.latedef)warning("'{a}' was used before it was defined.",nexttoken,t);delete implied[t]}}else{scope[t]=funct}}function doOption(){var b,obj,filter,o=nexttoken.value,t,v;switch(o){case'*/':error("Unbegun comment.");break;case'/*members':case'/*member':o='/*members';if(!membersOnly){membersOnly={}}obj=membersOnly;break;case'/*jshint':case'/*jslint':obj=option;filter=boolOptions;break;case'/*global':obj=predefined;break;default:error("What?")}t=lex.token();loop:for(;;){for(;;){if(t.type==='special'&&t.value==='*/'){break loop}if(t.id!=='(endline)'&&t.id!==','){break}t=lex.token()}if(t.type!=='(string)'&&t.type!=='(identifier)'&&o!=='/*members'){error("Bad option.",t)}v=lex.token();if(v.id===':'){v=lex.token();if(obj===membersOnly){error("Expected '{a}' and instead saw '{b}'.",t,'*/',':')}if(o==='/*jshint'){checkOption(t.value,t)}if(t.value==='indent'&&(o==='/*jshint'||o==='/*jslint')){b=+v.value;if(typeof b!=='number'||!isFinite(b)||b<=0||Math.floor(b)!==b){error("Expected a small integer and instead saw '{a}'.",v,v.value)}obj.white=true;obj.indent=b}else if(t.value==='maxerr'&&(o==='/*jshint'||o==='/*jslint')){b=+v.value;if(typeof b!=='number'||!isFinite(b)||b<=0||Math.floor(b)!==b){error("Expected a small integer and instead saw '{a}'.",v,v.value)}obj.maxerr=b}else if(t.value==='maxlen'&&(o==='/*jshint'||o==='/*jslint')){b=+v.value;if(typeof b!=='number'||!isFinite(b)||b<=0||Math.floor(b)!==b){error("Expected a small integer and instead saw '{a}'.",v,v.value)}obj.maxlen=b}else if(t.value==='validthis'){if(funct['(global)']){error("Option 'validthis' can't be used in a global scope.")}else{if(v.value==='true'||v.value==='false')obj[t.value]=v.value==='true';else error("Bad option value.",v)}}else if(v.value==='true'){obj[t.value]=true}else if(v.value==='false'){obj[t.value]=false}else{error("Bad option value.",v)}t=lex.token()}else{if(o==='/*jshint'||o==='/*jslint'){error("Missing option value.",t)}obj[t.value]=false;t=v}}if(filter){assume()}}function peek(p){var i=p||0,j=0,t;while(j<=i){t=lookahead[j];if(!t){t=lookahead[j]=lex.token()}j+=1}return t}function advance(id,t){switch(token.id){case'(number)':if(nexttoken.id==='.'){warning("A dot following a number can be confused with a decimal point.",token)}break;case'-':if(nexttoken.id==='-'||nexttoken.id==='--'){warning("Confusing minusses.")}break;case'+':if(nexttoken.id==='+'||nexttoken.id==='++'){warning("Confusing plusses.")}break}if(token.type==='(string)'||token.identifier){anonname=token.value}if(id&&nexttoken.id!==id){if(t){if(nexttoken.id==='(end)'){warning("Unmatched '{a}'.",t,t.id)}else{warning("Expected '{a}' to match '{b}' from line {c} and instead saw '{d}'.",nexttoken,id,t.id,t.line,nexttoken.value)}}else if(nexttoken.type!=='(identifier)'||nexttoken.value!==id){warning("Expected '{a}' and instead saw '{b}'.",nexttoken,id,nexttoken.value)}}prevtoken=token;token=nexttoken;for(;;){nexttoken=lookahead.shift()||lex.token();if(nexttoken.id==='(end)'||nexttoken.id==='(error)'){return}if(nexttoken.type==='special'){doOption()}else{if(nexttoken.id!=='(endline)'){break}}}}function expression(rbp,initial){var left,isArray=false,isObject=false;if(nexttoken.id==='(end)')error("Unexpected early end of program.",token);advance();if(initial){anonname='anonymous';funct['(verb)']=token.value}if(initial===true&&token.fud){left=token.fud()}else{if(token.nud){left=token.nud()}else{if(nexttoken.type==='(number)'&&token.id==='.'){warning("A leading decimal point can be confused with a dot: '.{a}'.",token,nexttoken.value);advance();return token}else{error("Expected an identifier and instead saw '{a}'.",token,token.id)}}while(rbp<nexttoken.lbp){isArray=token.value==='Array';isObject=token.value==='Object';advance();if(isArray&&token.id==='('&&nexttoken.id===')')warning("Use the array literal notation [].",token);if(isObject&&token.id==='('&&nexttoken.id===')')warning("Use the object literal notation {}.",token);if(token.led){left=token.led(left)}else{error("Expected an operator and instead saw '{a}'.",token,token.id)}}}return left}function adjacent(left,right){left=left||token;right=right||nexttoken;if(option.white){if(left.character!==right.from&&left.line===right.line){left.from+=(left.character-left.from);warning("Unexpected space after '{a}'.",left,left.value)}}}function nobreak(left,right){left=left||token;right=right||nexttoken;if(option.white&&(left.character!==right.from||left.line!==right.line)){warning("Unexpected space before '{a}'.",right,right.value)}}function nospace(left,right){left=left||token;right=right||nexttoken;if(option.white&&!left.comment){if(left.line===right.line){adjacent(left,right)}}}function nonadjacent(left,right){if(option.white){left=left||token;right=right||nexttoken;if(left.line===right.line&&left.character===right.from){left.from+=(left.character-left.from);warning("Missing space after '{a}'.",left,left.value)}}}function nobreaknonadjacent(left,right){left=left||token;right=right||nexttoken;if(!option.laxbreak&&left.line!==right.line){warning("Bad line breaking before '{a}'.",right,right.id)}else if(option.white){left=left||token;right=right||nexttoken;if(left.character===right.from){left.from+=(left.character-left.from);warning("Missing space after '{a}'.",left,left.value)}}}function indentation(bias){var i;if(option.white&&nexttoken.id!=='(end)'){i=indent+(bias||0);if(nexttoken.from!==i){warning("Expected '{a}' to have an indentation at {b} instead at {c}.",nexttoken,nexttoken.value,i,nexttoken.from)}}}function nolinebreak(t){t=t||token;if(t.line!==nexttoken.line){warning("Line breaking error '{a}'.",t,t.value)}}function comma(){if(token.line!==nexttoken.line){if(!option.laxcomma){if(comma.first){warning("Comma warnings can be turned off with 'laxcomma'");comma.first=false}warning("Bad line breaking before '{a}'.",token,nexttoken.id)}}else if(!token.comment&&token.character!==nexttoken.from&&option.white){token.from+=(token.character-token.from);warning("Unexpected space after '{a}'.",token,token.value)}advance(',');nonadjacent(token,nexttoken)}function symbol(s,p){var x=syntax[s];if(!x||typeof x!=='object'){syntax[s]=x={id:s,lbp:p,value:s}}return x}function delim(s){return symbol(s,0)}function stmt(s,f){var x=delim(s);x.identifier=x.reserved=true;x.fud=f;return x}function blockstmt(s,f){var x=stmt(s,f);x.block=true;return x}function reserveName(x){var c=x.id.charAt(0);if((c>='a'&&c<='z')||(c>='A'&&c<='Z')){x.identifier=x.reserved=true}return x}function prefix(s,f){var x=symbol(s,150);reserveName(x);x.nud=(typeof f==='function')?f:function(){this.right=expression(150);this.arity='unary';if(this.id==='++'||this.id==='--'){if(option.plusplus){warning("Unexpected use of '{a}'.",this,this.id)}else if((!this.right.identifier||this.right.reserved)&&this.right.id!=='.'&&this.right.id!=='['){warning("Bad operand.",this)}}return this};return x}function type(s,f){var x=delim(s);x.type=s;x.nud=f;return x}function reserve(s,f){var x=type(s,f);x.identifier=x.reserved=true;return x}function reservevar(s,v){return reserve(s,function(){if(typeof v==='function'){v(this)}return this})}function infix(s,f,p,w){var x=symbol(s,p);reserveName(x);x.led=function(left){if(!w){nobreaknonadjacent(prevtoken,token);nonadjacent(token,nexttoken)}if(s==="in"&&left.id==="!"){warning("Confusing use of '{a}'.",left,'!')}if(typeof f==='function'){return f(left,this)}else{this.left=left;this.right=expression(p);return this}};return x}function relation(s,f){var x=symbol(s,100);x.led=function(left){nobreaknonadjacent(prevtoken,token);nonadjacent(token,nexttoken);var right=expression(100);if((left&&left.id==='NaN')||(right&&right.id==='NaN')){warning("Use the isNaN function to compare with NaN.",this)}else if(f){f.apply(this,[left,right])}if(left.id==='!'){warning("Confusing use of '{a}'.",left,'!')}if(right.id==='!'){warning("Confusing use of '{a}'.",right,'!')}this.left=left;this.right=right;return this};return x}function isPoorRelation(node){return node&&((node.type==='(number)'&&+node.value===0)||(node.type==='(string)'&&node.value==='')||(node.type==='null'&&!option.eqnull)||node.type==='true'||node.type==='false'||node.type==='undefined')}function assignop(s,f){symbol(s,20).exps=true;return infix(s,function(left,that){var l;that.left=left;if(predefined[left.value]===false&&scope[left.value]['(global)']===true){warning("Read only.",left)}else if(left['function']){warning("'{a}' is a function.",left,left.value)}if(left){if(option.esnext&&funct[left.value]==='const'){warning("Attempting to override '{a}' which is a constant",left,left.value)}if(left.id==='.'||left.id==='['){if(!left.left||left.left.value==='arguments'){warning('Bad assignment.',that)}that.right=expression(19);return that}else if(left.identifier&&!left.reserved){if(funct[left.value]==='exception'){warning("Do not assign to the exception parameter.",left)}that.right=expression(19);return that}if(left===syntax['function']){warning("Expected an identifier in an assignment and instead saw a function invocation.",token)}}error("Bad assignment.",that)},20)}function bitwise(s,f,p){var x=symbol(s,p);reserveName(x);x.led=(typeof f==='function')?f:function(left){if(option.bitwise){warning("Unexpected use of '{a}'.",this,this.id)}this.left=left;this.right=expression(p);return this};return x}function bitwiseassignop(s){symbol(s,20).exps=true;return infix(s,function(left,that){if(option.bitwise){warning("Unexpected use of '{a}'.",that,that.id)}nonadjacent(prevtoken,token);nonadjacent(token,nexttoken);if(left){if(left.id==='.'||left.id==='['||(left.identifier&&!left.reserved)){expression(19);return that}if(left===syntax['function']){warning("Expected an identifier in an assignment, and instead saw a function invocation.",token)}return that}error("Bad assignment.",that)},20)}function suffix(s,f){var x=symbol(s,150);x.led=function(left){if(option.plusplus){warning("Unexpected use of '{a}'.",this,this.id)}else if((!left.identifier||left.reserved)&&left.id!=='.'&&left.id!=='['){warning("Bad operand.",this)}this.left=left;return this};return x}function optionalidentifier(fnparam){if(nexttoken.identifier){advance();if(token.reserved&&!option.es5){if(!fnparam||token.value!=='undefined'){warning("Expected an identifier and instead saw '{a}' (a reserved word).",token,token.id)}}return token.value}}function identifier(fnparam){var i=optionalidentifier(fnparam);if(i){return i}if(token.id==='function'&&nexttoken.id==='('){warning("Missing name in function declaration.")}else{error("Expected an identifier and instead saw '{a}'.",nexttoken,nexttoken.value)}}function reachable(s){var i=0,t;if(nexttoken.id!==';'||noreach){return}for(;;){t=peek(i);if(t.reach){return}if(t.id!=='(endline)'){if(t.id==='function'){if(!option.latedef){break}warning("Inner functions should be listed at the top of the outer function.",t);break}warning("Unreachable '{a}' after '{b}'.",t,t.value,s);break}i+=1}}function statement(noindent){var i=indent,r,s=scope,t=nexttoken;if(t.id===";"){advance(";");return}if(t.identifier&&!t.reserved&&peek().id===':'){advance();advance(':');scope=Object.create(s);addlabel(t.value,'label');if(!nexttoken.labelled){warning("Label '{a}' on {b} statement.",nexttoken,t.value,nexttoken.value)}if(jx.test(t.value+':')){warning("Label '{a}' looks like a javascript url.",t,t.value)}nexttoken.label=t.value;t=nexttoken}if(!noindent){indentation()}r=expression(0,true);if(!t.block){if(!option.expr&&(!r||!r.exps)){warning("Expected an assignment or function call and instead saw an expression.",token)}else if(option.nonew&&r.id==='('&&r.left.id==='new'){warning("Do not use 'new' for side effects.")}if(nexttoken.id===','){return comma()}if(nexttoken.id!==';'){if(!option.asi){if(!option.lastsemic||nexttoken.id!=='}'||nexttoken.line!==token.line){warningAt("Missing semicolon.",token.line,token.character)}}}else{adjacent(token,nexttoken);advance(';');nonadjacent(token,nexttoken)}}indent=i;scope=s;return r}function statements(startLine){var a=[],f,p;while(!nexttoken.reach&&nexttoken.id!=='(end)'){if(nexttoken.id===';'){p=peek();if(!p||p.id!=="("){warning("Unnecessary semicolon.")}advance(';')}else{a.push(statement(startLine===nexttoken.line))}}return a}function directives(){var i,p,pn;for(;;){if(nexttoken.id==="(string)"){p=peek(0);if(p.id==="(endline)"){i=1;do{pn=peek(i);i=i+1}while(pn.id==="(endline)");if(pn.id!==";"){if(pn.id!=="(string)"&&pn.id!=="(number)"&&pn.id!=="(regexp)"&&pn.identifier!==true&&pn.id!=="}"){break}warning("Missing semicolon.",nexttoken)}else{p=pn}}else if(p.id==="}"){warning("Missing semicolon.",p)}else if(p.id!==";"){break}indentation();advance();if(directive[token.value]){warning("Unnecessary directive \"{a}\".",token,token.value)}if(token.value==="use strict"){option.newcap=true;option.undef=true}directive[token.value]=true;if(p.id===";"){advance(";")}continue}break}}function block(ordinary,stmt,isfunc){var a,b=inblock,old_indent=indent,m,s=scope,t,line,d;inblock=ordinary;if(!ordinary||!option.funcscope)scope=Object.create(scope);nonadjacent(token,nexttoken);t=nexttoken;if(nexttoken.id==='{'){advance('{');line=token.line;if(nexttoken.id!=='}'){indent+=option.indent;while(!ordinary&&nexttoken.from>indent){indent+=option.indent}if(isfunc){m={};for(d in directive){if(is_own(directive,d)){m[d]=directive[d]}}directives();if(option.strict&&funct['(context)']['(global)']){if(!m["use strict"]&&!directive["use strict"]){warning("Missing \"use strict\" statement.")}}}a=statements(line);if(isfunc){directive=m}indent-=option.indent;if(line!==nexttoken.line){indentation()}}else if(line!==nexttoken.line){indentation()}advance('}',t);indent=old_indent}else if(!ordinary){error("Expected '{a}' and instead saw '{b}'.",nexttoken,'{',nexttoken.value)}else{if(!stmt||option.curly)warning("Expected '{a}' and instead saw '{b}'.",nexttoken,'{',nexttoken.value);noreach=true;indent+=option.indent;a=[statement(nexttoken.line===token.line)];indent-=option.indent;noreach=false}funct['(verb)']=null;if(!ordinary||!option.funcscope)scope=s;inblock=b;if(ordinary&&option.noempty&&(!a||a.length===0)){warning("Empty block.")}return a}function countMember(m){if(membersOnly&&typeof membersOnly[m]!=='boolean'){warning("Unexpected /*member '{a}'.",token,m)}if(typeof member[m]==='number'){member[m]+=1}else{member[m]=1}}function note_implied(token){var name=token.value,line=token.line,a=implied[name];if(typeof a==='function'){a=false}if(!a){a=[line];implied[name]=a}else if(a[a.length-1]!==line){a.push(line)}}type('(number)',function(){return this});type('(string)',function(){return this});syntax['(identifier)']={type:'(identifier)',lbp:0,identifier:true,nud:function(){var v=this.value,s=scope[v],f;if(typeof s==='function'){s=undefined}else if(typeof s==='boolean'){f=funct;funct=functions[0];addlabel(v,'var');s=funct;funct=f}if(funct===s){switch(funct[v]){case'unused':funct[v]='var';break;case'unction':funct[v]='function';this['function']=true;break;case'function':this['function']=true;break;case'label':warning("'{a}' is a statement label.",token,v);break}}else if(funct['(global)']){if(option.undef&&typeof predefined[v]!=='boolean'){if(!(anonname==='typeof'||anonname==='delete')||(nexttoken&&(nexttoken.value==='.'||nexttoken.value==='['))){isundef(funct,"'{a}' is not defined.",token,v)}}note_implied(token)}else{switch(funct[v]){case'closure':case'function':case'var':case'unused':warning("'{a}' used out of scope.",token,v);break;case'label':warning("'{a}' is a statement label.",token,v);break;case'outer':case'global':break;default:if(s===true){funct[v]=true}else if(s===null){warning("'{a}' is not allowed.",token,v);note_implied(token)}else if(typeof s!=='object'){if(option.undef){if(!(anonname==='typeof'||anonname==='delete')||(nexttoken&&(nexttoken.value==='.'||nexttoken.value==='['))){isundef(funct,"'{a}' is not defined.",token,v)}}funct[v]=true;note_implied(token)}else{switch(s[v]){case'function':case'unction':this['function']=true;s[v]='closure';funct[v]=s['(global)']?'global':'outer';break;case'var':case'unused':s[v]='closure';funct[v]=s['(global)']?'global':'outer';break;case'closure':case'parameter':funct[v]=s['(global)']?'global':'outer';break;case'label':warning("'{a}' is a statement label.",token,v)}}}}return this},led:function(){error("Expected an operator and instead saw '{a}'.",nexttoken,nexttoken.value)}};type('(regexp)',function(){return this});delim('(endline)');delim('(begin)');delim('(end)').reach=true;delim('</').reach=true;delim('<!');delim('<!--');delim('-->');delim('(error)').reach=true;delim('}').reach=true;delim(')');delim(']');delim('"').reach=true;delim("'").reach=true;delim(';');delim(':').reach=true;delim(',');delim('#');delim('@');reserve('else');reserve('case').reach=true;reserve('catch');reserve('default').reach=true;reserve('finally');reservevar('arguments',function(x){if(directive['use strict']&&funct['(global)']){warning("Strict violation.",x)}});reservevar('eval');reservevar('false');reservevar('Infinity');reservevar('NaN');reservevar('null');reservevar('this',function(x){if(directive['use strict']&&!option.validthis&&((funct['(statement)']&&funct['(name)'].charAt(0)>'Z')||funct['(global)'])){warning("Possible strict violation.",x)}});reservevar('true');reservevar('undefined');assignop('=','assign',20);assignop('+=','assignadd',20);assignop('-=','assignsub',20);assignop('*=','assignmult',20);assignop('/=','assigndiv',20).nud=function(){error("A regular expression literal can be confused with '/='.")};assignop('%=','assignmod',20);bitwiseassignop('&=','assignbitand',20);bitwiseassignop('|=','assignbitor',20);bitwiseassignop('^=','assignbitxor',20);bitwiseassignop('<<=','assignshiftleft',20);bitwiseassignop('>>=','assignshiftright',20);bitwiseassignop('>>>=','assignshiftrightunsigned',20);infix('?',function(left,that){that.left=left;that.right=expression(10);advance(':');that['else']=expression(10);return that},30);infix('||','or',40);infix('&&','and',50);bitwise('|','bitor',70);bitwise('^','bitxor',80);bitwise('&','bitand',90);relation('==',function(left,right){var eqnull=option.eqnull&&(left.value==='null'||right.value==='null');if(!eqnull&&option.eqeqeq)warning("Expected '{a}' and instead saw '{b}'.",this,'===','==');else if(isPoorRelation(left))warning("Use '{a}' to compare with '{b}'.",this,'===',left.value);else if(isPoorRelation(right))warning("Use '{a}' to compare with '{b}'.",this,'===',right.value);return this});relation('===');relation('!=',function(left,right){var eqnull=option.eqnull&&(left.value==='null'||right.value==='null');if(!eqnull&&option.eqeqeq){warning("Expected '{a}' and instead saw '{b}'.",this,'!==','!=')}else if(isPoorRelation(left)){warning("Use '{a}' to compare with '{b}'.",this,'!==',left.value)}else if(isPoorRelation(right)){warning("Use '{a}' to compare with '{b}'.",this,'!==',right.value)}return this});relation('!==');relation('<');relation('>');relation('<=');relation('>=');bitwise('<<','shiftleft',120);bitwise('>>','shiftright',120);bitwise('>>>','shiftrightunsigned',120);infix('in','in',120);infix('instanceof','instanceof',120);infix('+',function(left,that){var right=expression(130);if(left&&right&&left.id==='(string)'&&right.id==='(string)'){left.value+=right.value;left.character=right.character;if(!option.scripturl&&jx.test(left.value)){warning("JavaScript URL.",left)}return left}that.left=left;that.right=right;return that},130);prefix('+','num');prefix('+++',function(){warning("Confusing pluses.");this.right=expression(150);this.arity='unary';return this});infix('+++',function(left){warning("Confusing pluses.");this.left=left;this.right=expression(130);return this},130);infix('-','sub',130);prefix('-','neg');prefix('---',function(){warning("Confusing minuses.");this.right=expression(150);this.arity='unary';return this});infix('---',function(left){warning("Confusing minuses.");this.left=left;this.right=expression(130);return this},130);infix('*','mult',140);infix('/','div',140);infix('%','mod',140);suffix('++','postinc');prefix('++','preinc');syntax['++'].exps=true;suffix('--','postdec');prefix('--','predec');syntax['--'].exps=true;prefix('delete',function(){var p=expression(0);if(!p||(p.id!=='.'&&p.id!=='[')){warning("Variables should not be deleted.")}this.first=p;return this}).exps=true;prefix('~',function(){if(option.bitwise){warning("Unexpected '{a}'.",this,'~')}expression(150);return this});prefix('!',function(){this.right=expression(150);this.arity='unary';if(bang[this.right.id]===true){warning("Confusing use of '{a}'.",this,'!')}return this});prefix('typeof','typeof');prefix('new',function(){var c=expression(155),i;if(c&&c.id!=='function'){if(c.identifier){c['new']=true;switch(c.value){case'Number':case'String':case'Boolean':case'Math':case'JSON':warning("Do not use {a} as a constructor.",token,c.value);break;case'Function':if(!option.evil){warning("The Function constructor is eval.")}break;case'Date':case'RegExp':break;default:if(c.id!=='function'){i=c.value.substr(0,1);if(option.newcap&&(i<'A'||i>'Z')){warning("A constructor name should start with an uppercase letter.",token)}}}}else{if(c.id!=='.'&&c.id!=='['&&c.id!=='('){warning("Bad constructor.",token)}}}else{if(!option.supernew)warning("Weird construction. Delete 'new'.",this)}adjacent(token,nexttoken);if(nexttoken.id!=='('&&!option.supernew){warning("Missing '()' invoking a constructor.")}this.first=c;return this});syntax['new'].exps=true;prefix('void').exps=true;infix('.',function(left,that){adjacent(prevtoken,token);nobreak();var m=identifier();if(typeof m==='string'){countMember(m)}that.left=left;that.right=m;if(left&&left.value==='arguments'&&(m==='callee'||m==='caller')){if(option.noarg)warning("Avoid arguments.{a}.",left,m);else if(directive['use strict'])error('Strict violation.')}else if(!option.evil&&left&&left.value==='document'&&(m==='write'||m==='writeln')){warning("document.write can be a form of eval.",left)}if(!option.evil&&(m==='eval'||m==='execScript')){warning('eval is evil.')}return that},160,true);infix('(',function(left,that){if(prevtoken.id!=='}'&&prevtoken.id!==')'){nobreak(prevtoken,token)}nospace();if(option.immed&&!left.immed&&left.id==='function'){warning("Wrap an immediate function invocation in parentheses "+"to assist the reader in understanding that the expression "+"is the result of a function, and not the function itself.")}var n=0,p=[];if(left){if(left.type==='(identifier)'){if(left.value.match(/^[A-Z]([A-Z0-9_$]*[a-z][A-Za-z0-9_$]*)?$/)){if(left.value!=='Number'&&left.value!=='String'&&left.value!=='Boolean'&&left.value!=='Date'){if(left.value==='Math'){warning("Math is not a function.",left)}else if(option.newcap){warning("Missing 'new' prefix when invoking a constructor.",left)}}}}}if(nexttoken.id!==')'){for(;;){p[p.length]=expression(10);n+=1;if(nexttoken.id!==','){break}comma()}}advance(')');nospace(prevtoken,token);if(typeof left==='object'){if(left.value==='parseInt'&&n===1){warning("Missing radix parameter.",left)}if(!option.evil){if(left.value==='eval'||left.value==='Function'||left.value==='execScript'){warning("eval is evil.",left)}else if(p[0]&&p[0].id==='(string)'&&(left.value==='setTimeout'||left.value==='setInterval')){warning("Implied eval is evil. Pass a function instead of a string.",left)}}if(!left.identifier&&left.id!=='.'&&left.id!=='['&&left.id!=='('&&left.id!=='&&'&&left.id!=='||'&&left.id!=='?'){warning("Bad invocation.",left)}}that.left=left;return that},155,true).exps=true;prefix('(',function(){nospace();if(nexttoken.id==='function'){nexttoken.immed=true}var v=expression(0);advance(')',this);nospace(prevtoken,token);if(option.immed&&v.id==='function'){if(nexttoken.id==='('||(nexttoken.id==='.'&&(peek().value==='call'||peek().value==='apply'))){warning("Move the invocation into the parens that contain the function.",nexttoken)}else{warning("Do not wrap function literals in parens unless they are to be immediately invoked.",this)}}return v});infix('[',function(left,that){nobreak(prevtoken,token);nospace();var e=expression(0),s;if(e&&e.type==='(string)'){if(!option.evil&&(e.value==='eval'||e.value==='execScript')){warning("eval is evil.",that)}countMember(e.value);if(!option.sub&&ix.test(e.value)){s=syntax[e.value];if(!s||!s.reserved){warning("['{a}'] is better written in dot notation.",e,e.value)}}}advance(']',that);nospace(prevtoken,token);that.left=left;that.right=e;return that},160,true);prefix('[',function(){var b=token.line!==nexttoken.line;this.first=[];if(b){indent+=option.indent;if(nexttoken.from===indent+option.indent){indent+=option.indent}}while(nexttoken.id!=='(end)'){while(nexttoken.id===','){warning("Extra comma.");advance(',')}if(nexttoken.id===']'){break}if(b&&token.line!==nexttoken.line){indentation()}this.first.push(expression(10));if(nexttoken.id===','){comma();if(nexttoken.id===']'&&!option.es5){warning("Extra comma.",token);break}}else{break}}if(b){indent-=option.indent;indentation()}advance(']',this);return this},160);function property_name(){var id=optionalidentifier(true);if(!id){if(nexttoken.id==='(string)'){id=nexttoken.value;advance()}else if(nexttoken.id==='(number)'){id=nexttoken.value.toString();advance()}}return id}function functionparams(){var i,t=nexttoken,p=[];advance('(');nospace();if(nexttoken.id===')'){advance(')');return}for(;;){i=identifier(true);p.push(i);addlabel(i,'parameter');if(nexttoken.id===','){comma()}else{advance(')',t);nospace(prevtoken,token);return p}}}function doFunction(i,statement){var f,oldOption=option,oldScope=scope;option=Object.create(option);scope=Object.create(scope);funct={'(name)':i||'"'+anonname+'"','(line)':nexttoken.line,'(context)':funct,'(breakage)':0,'(loopage)':0,'(scope)':scope,'(statement)':statement};f=funct;token.funct=funct;functions.push(funct);if(i){addlabel(i,'function')}funct['(params)']=functionparams();block(false,false,true);scope=oldScope;option=oldOption;funct['(last)']=token.line;funct=funct['(context)'];return f}(function(x){x.nud=function(){var b,f,i,j,p,t;var props={};function saveProperty(name,token){if(props[name]&&is_own(props,name))warning("Duplicate member '{a}'.",nexttoken,i);else props[name]={};props[name].basic=true;props[name].basicToken=token}function saveSetter(name,token){if(props[name]&&is_own(props,name)){if(props[name].basic||props[name].setter)warning("Duplicate member '{a}'.",nexttoken,i)}else{props[name]={}}props[name].setter=true;props[name].setterToken=token}function saveGetter(name){if(props[name]&&is_own(props,name)){if(props[name].basic||props[name].getter)warning("Duplicate member '{a}'.",nexttoken,i)}else{props[name]={}}props[name].getter=true;props[name].getterToken=token}b=token.line!==nexttoken.line;if(b){indent+=option.indent;if(nexttoken.from===indent+option.indent){indent+=option.indent}}for(;;){if(nexttoken.id==='}'){break}if(b){indentation()}if(nexttoken.value==='get'&&peek().id!==':'){advance('get');if(!option.es5){error("get/set are ES5 features.")}i=property_name();if(!i){error("Missing property name.")}saveGetter(i);t=nexttoken;adjacent(token,nexttoken);f=doFunction();p=f['(params)'];if(p){warning("Unexpected parameter '{a}' in get {b} function.",t,p[0],i)}adjacent(token,nexttoken)}else if(nexttoken.value==='set'&&peek().id!==':'){advance('set');if(!option.es5){error("get/set are ES5 features.")}i=property_name();if(!i){error("Missing property name.")}saveSetter(i,nexttoken);t=nexttoken;adjacent(token,nexttoken);f=doFunction();p=f['(params)'];if(!p||p.length!==1){warning("Expected a single parameter in set {a} function.",t,i)}}else{i=property_name();saveProperty(i,nexttoken);if(typeof i!=='string'){break}advance(':');nonadjacent(token,nexttoken);expression(10)}countMember(i);if(nexttoken.id===','){comma();if(nexttoken.id===','){warning("Extra comma.",token)}else if(nexttoken.id==='}'&&!option.es5){warning("Extra comma.",token)}}else{break}}if(b){indent-=option.indent;indentation()}advance('}',this);if(option.es5){for(var name in props){if(is_own(props,name)&&props[name].setter&&!props[name].getter){warning("Setter is defined without getter.",props[name].setterToken)}}}return this};x.fud=function(){error("Expected to see a statement and instead saw a block.",token)}}(delim('{')));useESNextSyntax=function(){var conststatement=stmt('const',function(prefix){var id,name,value;this.first=[];for(;;){nonadjacent(token,nexttoken);id=identifier();if(funct[id]==="const"){warning("const '"+id+"' has already been declared")}if(funct['(global)']&&predefined[id]===false){warning("Redefinition of '{a}'.",token,id)}addlabel(id,'const');if(prefix){break}name=token;this.first.push(token);if(nexttoken.id!=="="){warning("const "+"'{a}' is initialized to 'undefined'.",token,id)}if(nexttoken.id==='='){nonadjacent(token,nexttoken);advance('=');nonadjacent(token,nexttoken);if(nexttoken.id==='undefined'){warning("It is not necessary to initialize "+"'{a}' to 'undefined'.",token,id)}if(peek(0).id==='='&&nexttoken.identifier){error("Constant {a} was not declared correctly.",nexttoken,nexttoken.value)}value=expression(0);name.first=value}if(nexttoken.id!==','){break}comma()}return this});conststatement.exps=true};var varstatement=stmt('var',function(prefix){var id,name,value;if(funct['(onevar)']&&option.onevar){warning("Too many var statements.")}else if(!funct['(global)']){funct['(onevar)']=true}this.first=[];for(;;){nonadjacent(token,nexttoken);id=identifier();if(option.esnext&&funct[id]==="const"){warning("const '"+id+"' has already been declared")}if(funct['(global)']&&predefined[id]===false){warning("Redefinition of '{a}'.",token,id)}addlabel(id,'unused');if(prefix){break}name=token;this.first.push(token);if(nexttoken.id==='='){nonadjacent(token,nexttoken);advance('=');nonadjacent(token,nexttoken);if(nexttoken.id==='undefined'){warning("It is not necessary to initialize '{a}' to 'undefined'.",token,id)}if(peek(0).id==='='&&nexttoken.identifier){error("Variable {a} was not declared correctly.",nexttoken,nexttoken.value)}value=expression(0);name.first=value}if(nexttoken.id!==','){break}comma()}return this});varstatement.exps=true;blockstmt('function',function(){if(inblock){warning("Function declarations should not be placed in blocks. "+"Use a function expression or move the statement to the top of "+"the outer function.",token)}var i=identifier();if(option.esnext&&funct[i]==="const"){warning("const '"+i+"' has already been declared")}adjacent(token,nexttoken);addlabel(i,'unction');doFunction(i,true);if(nexttoken.id==='('&&nexttoken.line===token.line){error("Function declarations are not invocable. Wrap the whole function invocation in parens.")}return this});prefix('function',function(){var i=optionalidentifier();if(i){adjacent(token,nexttoken)}else{nonadjacent(token,nexttoken)}doFunction(i);if(!option.loopfunc&&funct['(loopage)']){warning("Don't make functions within a loop.")}return this});blockstmt('if',function(){var t=nexttoken;advance('(');nonadjacent(this,t);nospace();expression(20);if(nexttoken.id==='='){if(!option.boss)warning("Expected a conditional expression and instead saw an assignment.");advance('=');expression(20)}advance(')',t);nospace(prevtoken,token);block(true,true);if(nexttoken.id==='else'){nonadjacent(token,nexttoken);advance('else');if(nexttoken.id==='if'||nexttoken.id==='switch'){statement(true)}else{block(true,true)}}return this});blockstmt('try',function(){var b,e,s;block(false);if(nexttoken.id==='catch'){advance('catch');nonadjacent(token,nexttoken);advance('(');s=scope;scope=Object.create(s);e=nexttoken.value;if(nexttoken.type!=='(identifier)'){warning("Expected an identifier and instead saw '{a}'.",nexttoken,e)}else{addlabel(e,'exception')}advance();advance(')');block(false);b=true;scope=s}if(nexttoken.id==='finally'){advance('finally');block(false);return}else if(!b){error("Expected '{a}' and instead saw '{b}'.",nexttoken,'catch',nexttoken.value)}return this});blockstmt('while',function(){var t=nexttoken;funct['(breakage)']+=1;funct['(loopage)']+=1;advance('(');nonadjacent(this,t);nospace();expression(20);if(nexttoken.id==='='){if(!option.boss)warning("Expected a conditional expression and instead saw an assignment.");advance('=');expression(20)}advance(')',t);nospace(prevtoken,token);block(true,true);funct['(breakage)']-=1;funct['(loopage)']-=1;return this}).labelled=true;blockstmt('with',function(){var t=nexttoken;if(directive['use strict']){error("'with' is not allowed in strict mode.",token)}else if(!option.withstmt){warning("Don't use 'with'.",token)}advance('(');nonadjacent(this,t);nospace();expression(0);advance(')',t);nospace(prevtoken,token);block(true,true);return this});blockstmt('switch',function(){var t=nexttoken,g=false;funct['(breakage)']+=1;advance('(');nonadjacent(this,t);nospace();this.condition=expression(20);advance(')',t);nospace(prevtoken,token);nonadjacent(token,nexttoken);t=nexttoken;advance('{');nonadjacent(token,nexttoken);indent+=option.indent;this.cases=[];for(;;){switch(nexttoken.id){case'case':switch(funct['(verb)']){case'break':case'case':case'continue':case'return':case'switch':case'throw':break;default:if(!ft.test(lines[nexttoken.line-2])){warning("Expected a 'break' statement before 'case'.",token)}}indentation(-option.indent);advance('case');this.cases.push(expression(20));g=true;advance(':');funct['(verb)']='case';break;case'default':switch(funct['(verb)']){case'break':case'continue':case'return':case'throw':break;default:if(!ft.test(lines[nexttoken.line-2])){warning("Expected a 'break' statement before 'default'.",token)}}indentation(-option.indent);advance('default');g=true;advance(':');break;case'}':indent-=option.indent;indentation();advance('}',t);if(this.cases.length===1||this.condition.id==='true'||this.condition.id==='false'){if(!option.onecase)warning("This 'switch' should be an 'if'.",this)}funct['(breakage)']-=1;funct['(verb)']=undefined;return;case'(end)':error("Missing '{a}'.",nexttoken,'}');return;default:if(g){switch(token.id){case',':error("Each value should have its own case label.");return;case':':g=false;statements();break;default:error("Missing ':' on a case clause.",token);return}}else{if(token.id===':'){advance(':');error("Unexpected '{a}'.",token,':');statements()}else{error("Expected '{a}' and instead saw '{b}'.",nexttoken,'case',nexttoken.value);return}}}}}).labelled=true;stmt('debugger',function(){if(!option.debug){warning("All 'debugger' statements should be removed.")}return this}).exps=true;(function(){var x=stmt('do',function(){funct['(breakage)']+=1;funct['(loopage)']+=1;this.first=block(true);advance('while');var t=nexttoken;nonadjacent(token,t);advance('(');nospace();expression(20);if(nexttoken.id==='='){if(!option.boss)warning("Expected a conditional expression and instead saw an assignment.");advance('=');expression(20)}advance(')',t);nospace(prevtoken,token);funct['(breakage)']-=1;funct['(loopage)']-=1;return this});x.labelled=true;x.exps=true}());blockstmt('for',function(){var s,t=nexttoken;funct['(breakage)']+=1;funct['(loopage)']+=1;advance('(');nonadjacent(this,t);nospace();if(peek(nexttoken.id==='var'?1:0).id==='in'){if(nexttoken.id==='var'){advance('var');varstatement.fud.call(varstatement,true)}else{switch(funct[nexttoken.value]){case'unused':funct[nexttoken.value]='var';break;case'var':break;default:warning("Bad for in variable '{a}'.",nexttoken,nexttoken.value)}advance()}advance('in');expression(20);advance(')',t);s=block(true,true);if(option.forin&&s&&(s.length>1||typeof s[0]!=='object'||s[0].value!=='if')){warning("The body of a for in should be wrapped in an if statement to filter "+"unwanted properties from the prototype.",this)}funct['(breakage)']-=1;funct['(loopage)']-=1;return this}else{if(nexttoken.id!==';'){if(nexttoken.id==='var'){advance('var');varstatement.fud.call(varstatement)}else{for(;;){expression(0,'for');if(nexttoken.id!==','){break}comma()}}}nolinebreak(token);advance(';');if(nexttoken.id!==';'){expression(20);if(nexttoken.id==='='){if(!option.boss)warning("Expected a conditional expression and instead saw an assignment.");advance('=');expression(20)}}nolinebreak(token);advance(';');if(nexttoken.id===';'){error("Expected '{a}' and instead saw '{b}'.",nexttoken,')',';')}if(nexttoken.id!==')'){for(;;){expression(0,'for');if(nexttoken.id!==','){break}comma()}}advance(')',t);nospace(prevtoken,token);block(true,true);funct['(breakage)']-=1;funct['(loopage)']-=1;return this}}).labelled=true;stmt('break',function(){var v=nexttoken.value;if(funct['(breakage)']===0)warning("Unexpected '{a}'.",nexttoken,this.value);if(!option.asi)nolinebreak(this);if(nexttoken.id!==';'){if(token.line===nexttoken.line){if(funct[v]!=='label'){warning("'{a}' is not a statement label.",nexttoken,v)}else if(scope[v]!==funct){warning("'{a}' is out of scope.",nexttoken,v)}this.first=nexttoken;advance()}}reachable('break');return this}).exps=true;stmt('continue',function(){var v=nexttoken.value;if(funct['(breakage)']===0)warning("Unexpected '{a}'.",nexttoken,this.value);if(!option.asi)nolinebreak(this);if(nexttoken.id!==';'){if(token.line===nexttoken.line){if(funct[v]!=='label'){warning("'{a}' is not a statement label.",nexttoken,v)}else if(scope[v]!==funct){warning("'{a}' is out of scope.",nexttoken,v)}this.first=nexttoken;advance()}}else if(!funct['(loopage)']){warning("Unexpected '{a}'.",nexttoken,this.value)}reachable('continue');return this}).exps=true;stmt('return',function(){if(this.line===nexttoken.line){if(nexttoken.id==='(regexp)')warning("Wrap the /regexp/ literal in parens to disambiguate the slash operator.");if(nexttoken.id!==';'&&!nexttoken.reach){nonadjacent(token,nexttoken);if(peek().value==="="&&!option.boss){warningAt("Did you mean to return a conditional instead of an assignment?",token.line,token.character+1)}this.first=expression(0)}}else if(!option.asi){nolinebreak(this)}reachable('return');return this}).exps=true;stmt('throw',function(){nolinebreak(this);nonadjacent(token,nexttoken);this.first=expression(20);reachable('throw');return this}).exps=true;reserve('class');reserve('const');reserve('enum');reserve('export');reserve('extends');reserve('import');reserve('super');reserve('let');reserve('yield');reserve('implements');reserve('interface');reserve('package');reserve('private');reserve('protected');reserve('public');reserve('static');function jsonValue(){function jsonObject(){var o={},t=nexttoken;advance('{');if(nexttoken.id!=='}'){for(;;){if(nexttoken.id==='(end)'){error("Missing '}' to match '{' from line {a}.",nexttoken,t.line)}else if(nexttoken.id==='}'){warning("Unexpected comma.",token);break}else if(nexttoken.id===','){error("Unexpected comma.",nexttoken)}else if(nexttoken.id!=='(string)'){warning("Expected a string and instead saw {a}.",nexttoken,nexttoken.value)}if(o[nexttoken.value]===true){warning("Duplicate key '{a}'.",nexttoken,nexttoken.value)}else if((nexttoken.value==='__proto__'&&!option.proto)||(nexttoken.value==='__iterator__'&&!option.iterator)){warning("The '{a}' key may produce unexpected results.",nexttoken,nexttoken.value)}else{o[nexttoken.value]=true}advance();advance(':');jsonValue();if(nexttoken.id!==','){break}advance(',')}}advance('}')}function jsonArray(){var t=nexttoken;advance('[');if(nexttoken.id!==']'){for(;;){if(nexttoken.id==='(end)'){error("Missing ']' to match '[' from line {a}.",nexttoken,t.line)}else if(nexttoken.id===']'){warning("Unexpected comma.",token);break}else if(nexttoken.id===','){error("Unexpected comma.",nexttoken)}jsonValue();if(nexttoken.id!==','){break}advance(',')}}advance(']')}switch(nexttoken.id){case'{':jsonObject();break;case'[':jsonArray();break;case'true':case'false':case'null':case'(number)':case'(string)':advance();break;case'-':advance('-');if(token.character!==nexttoken.from){warning("Unexpected space after '-'.",token)}adjacent(token,nexttoken);advance('(number)');break;default:error("Expected a JSON value.",nexttoken)}}var itself=function(s,o,g){var a,i,k;JSHINT.errors=[];JSHINT.undefs=[];predefined=Object.create(standard);combine(predefined,g||{});if(o){a=o.predef;if(a){if(Array.isArray(a)){for(i=0;i<a.length;i+=1){predefined[a[i]]=true}}else if(typeof a==='object'){k=Object.keys(a);for(i=0;i<k.length;i+=1){predefined[k[i]]=!!a[k[i]]}}}option=o}else{option={}}option.indent=option.indent||4;option.maxerr=option.maxerr||50;tab='';for(i=0;i<option.indent;i+=1){tab+=' '}indent=1;global=Object.create(predefined);scope=global;funct={'(global)':true,'(name)':'(global)','(scope)':scope,'(breakage)':0,'(loopage)':0};functions=[funct];urls=[];stack=null;member={};membersOnly=null;implied={};inblock=false;lookahead=[];jsonmode=false;warnings=0;lex.init(s);prereg=true;directive={};prevtoken=token=nexttoken=syntax['(begin)'];for(var name in o){if(is_own(o,name)){checkOption(name,token)}}assume();combine(predefined,g||{});comma.first=true;try{advance();switch(nexttoken.id){case'{':case'[':option.laxbreak=true;jsonmode=true;jsonValue();break;default:directives();if(directive["use strict"]&&!option.globalstrict){warning("Use the function form of \"use strict\".",prevtoken)}statements()}advance('(end)');var markDefined=function(name,context){do{if(typeof context[name]==='string'){if(context[name]==='unused')context[name]='var';else if(context[name]==='unction')context[name]='closure';return true}context=context['(context)']}while(context);return false};var clearImplied=function(name,line){if(!implied[name])return;var newImplied=[];for(var i=0;i<implied[name].length;i+=1){if(implied[name][i]!==line)newImplied.push(implied[name][i])}if(newImplied.length===0)delete implied[name];else implied[name]=newImplied};for(i=0;i<JSHINT.undefs.length;i+=1){k=JSHINT.undefs[i].slice(0);if(markDefined(k[2].value,k[0])){clearImplied(k[2].value,k[2].line)}else{warning.apply(warning,k.slice(1))}}}catch(e){if(e){var nt=nexttoken||{};JSHINT.errors.push({raw:e.raw,reason:e.message,line:e.line||nt.line,character:e.character||nt.from},null)}}return JSHINT.errors.length===0};itself.data=function(){var data={functions:[],options:option},fu,globals,implieds=[],f,i,j,members=[],n,unused=[],v;if(itself.errors.length){data.errors=itself.errors}if(jsonmode){data.json=true}for(n in implied){if(is_own(implied,n)){implieds.push({name:n,line:implied[n]})}}if(implieds.length>0){data.implieds=implieds}if(urls.length>0){data.urls=urls}globals=Object.keys(scope);if(globals.length>0){data.globals=globals}for(i=1;i<functions.length;i+=1){f=functions[i];fu={};for(j=0;j<functionicity.length;j+=1){fu[functionicity[j]]=[]}for(n in f){if(is_own(f,n)&&n.charAt(0)!=='('){v=f[n];if(v==='unction'){v='unused'}if(Array.isArray(fu[v])){fu[v].push(n);if(v==='unused'){unused.push({name:n,line:f['(line)'],'function':f['(name)']})}}}}for(j=0;j<functionicity.length;j+=1){if(fu[functionicity[j]].length===0){delete fu[functionicity[j]]}}fu.name=f['(name)'];fu.param=f['(params)'];fu.line=f['(line)'];fu.last=f['(last)'];data.functions.push(fu)}if(unused.length>0){data.unused=unused}members=[];for(n in member){if(typeof member[n]==='number'){data.member=member;break}}return data};itself.report=function(option){var data=itself.data();var a=[],c,e,err,f,i,k,l,m='',n,o=[],s;function detail(h,array){var b,i,singularity;if(array){o.push('<div><i>'+h+'</i> ');array=array.sort();for(i=0;i<array.length;i+=1){if(array[i]!==singularity){singularity=array[i];o.push((b?', ':'')+singularity);b=true}}o.push('</div>')}}if(data.errors||data.implieds||data.unused){err=true;o.push('<div id=errors><i>Error:</i>');if(data.errors){for(i=0;i<data.errors.length;i+=1){c=data.errors[i];if(c){e=c.evidence||'';o.push('<p>Problem'+(isFinite(c.line)?' at line '+c.line+' character '+c.character:'')+': '+c.reason.entityify()+'</p><p class=evidence>'+(e&&(e.length>80?e.slice(0,77)+'...':e).entityify())+'</p>')}}}if(data.implieds){s=[];for(i=0;i<data.implieds.length;i+=1){s[i]='<code>'+data.implieds[i].name+'</code>&nbsp;<i>'+data.implieds[i].line+'</i>'}o.push('<p><i>Implied global:</i> '+s.join(', ')+'</p>')}if(data.unused){s=[];for(i=0;i<data.unused.length;i+=1){s[i]='<code><u>'+data.unused[i].name+'</u></code>&nbsp;<i>'+data.unused[i].line+'</i> <code>'+data.unused[i]['function']+'</code>'}o.push('<p><i>Unused variable:</i> '+s.join(', ')+'</p>')}if(data.json){o.push('<p>JSON: bad.</p>')}o.push('</div>')}if(!option){o.push('<br><div id=functions>');if(data.urls){detail("URLs<br>",data.urls,'<br>')}if(data.json&&!err){o.push('<p>JSON: good.</p>')}else if(data.globals){o.push('<div><i>Global</i> '+data.globals.sort().join(', ')+'</div>')}else{o.push('<div><i>No new global variables introduced.</i></div>')}for(i=0;i<data.functions.length;i+=1){f=data.functions[i];o.push('<br><div class=function><i>'+f.line+'-'+f.last+'</i> '+(f.name||'')+'('+(f.param?f.param.join(', '):'')+')</div>');detail('<big><b>Unused</b></big>',f.unused);detail('Closure',f.closure);detail('Variable',f['var']);detail('Exception',f.exception);detail('Outer',f.outer);detail('Global',f.global);detail('Label',f.label)}if(data.member){a=Object.keys(data.member);if(a.length){a=a.sort();m='<br><pre id=members>/*members ';l=10;for(i=0;i<a.length;i+=1){k=a[i];n=k.name();if(l+n.length>72){o.push(m+'<br>');m='    ';l=1}l+=n.length+2;if(data.member[k]===1){n='<i>'+n+'</i>'}if(i<a.length-1){n+=', '}m+=n}o.push(m+'<br>*/</pre>')}o.push('</div>')}}return o.join('')};itself.jshint=itself;return itself}());if(typeof exports==='object'&&exports)exports.JSHINT=JSHINT;/* Jison generated parser */
var jsonlint = (function(){
var parser = {trace: function trace() { },
yy: {},
symbols_: {"error":2,"JSONString":3,"STRING":4,"JSONNumber":5,"NUMBER":6,"JSONNullLiteral":7,"NULL":8,"JSONBooleanLiteral":9,"TRUE":10,"FALSE":11,"JSONText":12,"JSONValue":13,"EOF":14,"JSONObject":15,"JSONArray":16,"{":17,"}":18,"JSONMemberList":19,"JSONMember":20,":":21,",":22,"[":23,"]":24,"JSONElementList":25,"$accept":0,"$end":1},
terminals_: {2:"error",4:"STRING",6:"NUMBER",8:"NULL",10:"TRUE",11:"FALSE",14:"EOF",17:"{",18:"}",21:":",22:",",23:"[",24:"]"},
productions_: [0,[3,1],[5,1],[7,1],[9,1],[9,1],[12,2],[13,1],[13,1],[13,1],[13,1],[13,1],[13,1],[15,2],[15,3],[20,3],[19,1],[19,3],[16,2],[16,3],[25,1],[25,3]],
performAction: function anonymous(yytext,yyleng,yylineno,yy,yystate,$$,_$) {

var $0 = $$.length - 1;
switch (yystate) {
case 1: // replace escaped characters with actual character
          this.$ = yytext.replace(/\\(\\|")/g, "$"+"1")
                     .replace(/\\n/g,'\n')
                     .replace(/\\r/g,'\r')
                     .replace(/\\t/g,'\t')
                     .replace(/\\v/g,'\v')
                     .replace(/\\f/g,'\f')
                     .replace(/\\b/g,'\b');
        
break;
case 2:this.$ = Number(yytext);
break;
case 3:this.$ = null;
break;
case 4:this.$ = true;
break;
case 5:this.$ = false;
break;
case 6:return this.$ = $$[$0-1];
break;
case 13:this.$ = {};
break;
case 14:this.$ = $$[$0-1];
break;
case 15:this.$ = [$$[$0-2], $$[$0]];
break;
case 16:this.$ = {}; this.$[$$[$0][0]] = $$[$0][1];
break;
case 17:this.$ = $$[$0-2]; $$[$0-2][$$[$0][0]] = $$[$0][1];
break;
case 18:this.$ = [];
break;
case 19:this.$ = $$[$0-1];
break;
case 20:this.$ = [$$[$0]];
break;
case 21:this.$ = $$[$0-2]; $$[$0-2].push($$[$0]);
break;
}
},
table: [{3:5,4:[1,12],5:6,6:[1,13],7:3,8:[1,9],9:4,10:[1,10],11:[1,11],12:1,13:2,15:7,16:8,17:[1,14],23:[1,15]},{1:[3]},{14:[1,16]},{14:[2,7],18:[2,7],22:[2,7],24:[2,7]},{14:[2,8],18:[2,8],22:[2,8],24:[2,8]},{14:[2,9],18:[2,9],22:[2,9],24:[2,9]},{14:[2,10],18:[2,10],22:[2,10],24:[2,10]},{14:[2,11],18:[2,11],22:[2,11],24:[2,11]},{14:[2,12],18:[2,12],22:[2,12],24:[2,12]},{14:[2,3],18:[2,3],22:[2,3],24:[2,3]},{14:[2,4],18:[2,4],22:[2,4],24:[2,4]},{14:[2,5],18:[2,5],22:[2,5],24:[2,5]},{14:[2,1],18:[2,1],21:[2,1],22:[2,1],24:[2,1]},{14:[2,2],18:[2,2],22:[2,2],24:[2,2]},{3:20,4:[1,12],18:[1,17],19:18,20:19},{3:5,4:[1,12],5:6,6:[1,13],7:3,8:[1,9],9:4,10:[1,10],11:[1,11],13:23,15:7,16:8,17:[1,14],23:[1,15],24:[1,21],25:22},{1:[2,6]},{14:[2,13],18:[2,13],22:[2,13],24:[2,13]},{18:[1,24],22:[1,25]},{18:[2,16],22:[2,16]},{21:[1,26]},{14:[2,18],18:[2,18],22:[2,18],24:[2,18]},{22:[1,28],24:[1,27]},{22:[2,20],24:[2,20]},{14:[2,14],18:[2,14],22:[2,14],24:[2,14]},{3:20,4:[1,12],20:29},{3:5,4:[1,12],5:6,6:[1,13],7:3,8:[1,9],9:4,10:[1,10],11:[1,11],13:30,15:7,16:8,17:[1,14],23:[1,15]},{14:[2,19],18:[2,19],22:[2,19],24:[2,19]},{3:5,4:[1,12],5:6,6:[1,13],7:3,8:[1,9],9:4,10:[1,10],11:[1,11],13:31,15:7,16:8,17:[1,14],23:[1,15]},{18:[2,17],22:[2,17]},{18:[2,15],22:[2,15]},{22:[2,21],24:[2,21]}],
defaultActions: {16:[2,6]},
parseError: function parseError(str, hash) {
    throw str;
},
parse: function parse(input) {
    var self = this,
        stack = [0],
        vstack = [null], // semantic value stack
        lstack = [], // location stack
        table = this.table,
        yytext = '',
        yylineno = 0,
        yyleng = 0,
        recovering = 0,
        TERROR = 2,
        EOF = 1;

    //this.reductionCount = this.shiftCount = 0;

    this.lexer.setInput(input);
    this.lexer.yy = this.yy;
    this.yy.lexer = this.lexer;
    if (typeof this.lexer.yylloc == 'undefined')
        this.lexer.yylloc = {};
    var yyloc = this.lexer.yylloc;
    lstack.push(yyloc);

    if (typeof this.yy.parseError === 'function')
        this.parseError = this.yy.parseError;

    function popStack (n) {
        stack.length = stack.length - 2*n;
        vstack.length = vstack.length - n;
        lstack.length = lstack.length - n;
    }

    function lex() {
        var token;
        token = self.lexer.lex() || 1; // $end = 1
        // if token isn't its numeric value, convert
        if (typeof token !== 'number') {
            token = self.symbols_[token] || token;
        }
        return token;
    }

    var symbol, preErrorSymbol, state, action, a, r, yyval={},p,len,newState, expected;
    while (true) {
        // retreive state number from top of stack
        state = stack[stack.length-1];

        // use default actions if available
        if (this.defaultActions[state]) {
            action = this.defaultActions[state];
        } else {
            if (symbol == null)
                symbol = lex();
            // read action for current state and first input
            action = table[state] && table[state][symbol];
        }

        // handle parse error
        _handle_error:
        if (typeof action === 'undefined' || !action.length || !action[0]) {

            if (!recovering) {
                // Report error
                expected = [];
                for (p in table[state]) if (this.terminals_[p] && p > 2) {
                    expected.push("'"+this.terminals_[p]+"'");
                }
                var errStr = '';
                if (this.lexer.showPosition) {
                    errStr = 'Parse error on line '+(yylineno+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+expected.join(', ') + ", got '" + this.terminals_[symbol]+ "'";
                } else {
                    errStr = 'Parse error on line '+(yylineno+1)+": Unexpected " +
                                  (symbol == 1 /*EOF*/ ? "end of input" :
                                              ("'"+(this.terminals_[symbol] || symbol)+"'"));
                }
                
                return errStr;
                this.parseError(errStr,
                    {text: this.lexer.match, token: this.terminals_[symbol] || symbol, line: this.lexer.yylineno, loc: yyloc, expected: expected});
            }

            // just recovered from another error
            if (recovering == 3) {
                if (symbol == EOF) {
                    throw errStr || 'Parsing halted.';
                }

                // discard current lookahead and grab another
                yyleng = this.lexer.yyleng;
                yytext = this.lexer.yytext;
                yylineno = this.lexer.yylineno;
                yyloc = this.lexer.yylloc;
                symbol = lex();
            }

            // try to recover from error
            while (1) {
                // check for error recovery rule in this state
                if ((TERROR.toString()) in table[state]) {
                    break;
                }
                if (state == 0) {
                    throw errStr || 'Parsing halted.';
                }
                popStack(1);
                state = stack[stack.length-1];
            }

            preErrorSymbol = symbol; // save the lookahead token
            symbol = TERROR;         // insert generic error symbol as new lookahead
            state = stack[stack.length-1];
            action = table[state] && table[state][TERROR];
            recovering = 3; // allow 3 real symbols to be shifted before reporting a new error
        }

        // this shouldn't happen, unless resolve defaults are off
        if (action[0] instanceof Array && action.length > 1) {
            throw 'Parse Error: multiple actions possible at state: '+state+', token: '+symbol;
        }

        switch (action[0]) {

            case 1: // shift
                //this.shiftCount++;

                stack.push(symbol);
                vstack.push(this.lexer.yytext);
                lstack.push(this.lexer.yylloc);
                stack.push(action[1]); // push state
                symbol = null;
                if (!preErrorSymbol) { // normal execution/no error
                    yyleng = this.lexer.yyleng;
                    yytext = this.lexer.yytext;
                    yylineno = this.lexer.yylineno;
                    yyloc = this.lexer.yylloc;
                    if (recovering > 0)
                        recovering--;
                } else { // error just occurred, resume old lookahead f/ before error
                    symbol = preErrorSymbol;
                    preErrorSymbol = null;
                }
                break;

            case 2: // reduce
                //this.reductionCount++;

                len = this.productions_[action[1]][1];

                // perform semantic action
                yyval.$ = vstack[vstack.length-len]; // default to $$ = $1
                // default location, uses first token for firsts, last for lasts
                yyval._$ = {
                    first_line: lstack[lstack.length-(len||1)].first_line,
                    last_line: lstack[lstack.length-1].last_line,
                    first_column: lstack[lstack.length-(len||1)].first_column,
                    last_column: lstack[lstack.length-1].last_column
                };
                r = this.performAction.call(yyval, yytext, yyleng, yylineno, this.yy, action[1], vstack, lstack);

                if (typeof r !== 'undefined') {
                    return r;
                }

                // pop off stack
                if (len) {
                    stack = stack.slice(0,-1*len*2);
                    vstack = vstack.slice(0, -1*len);
                    lstack = lstack.slice(0, -1*len);
                }

                stack.push(this.productions_[action[1]][0]);    // push nonterminal (reduce)
                vstack.push(yyval.$);
                lstack.push(yyval._$);
                // goto new state = table[STATE][NONTERMINAL]
                newState = table[stack[stack.length-2]][stack[stack.length-1]];
                stack.push(newState);
                break;

            case 3: // accept
                return true;
        }

    }

    return true;
}};
/* Jison generated lexer */
var lexer = (function(){
var lexer = ({EOF:1,
parseError:function parseError(str, hash) {
        if (this.yy.parseError) {
            this.yy.parseError(str, hash);
        } else {
            throw str;
        }
    },
setInput:function (input) {
        this._input = input;
        this._more = this._less = this.done = false;
        this.yylineno = this.yyleng = 0;
        this.yytext = this.matched = this.match = '';
        this.conditionStack = ['INITIAL'];
        this.yylloc = {first_line:1,first_column:0,last_line:1,last_column:0};
        return this;
    },
input:function () {
        var ch = this._input[0];
        this.yytext+=ch;
        this.yyleng++;
        this.match+=ch;
        this.matched+=ch;
        var lines = ch.match(/\n/);
        if (lines) this.yylineno++;
        this._input = this._input.slice(1);
        return ch;
    },
unput:function (ch) {
        this._input = ch + this._input;
        return this;
    },
more:function () {
        this._more = true;
        return this;
    },
less:function (n) {
        this._input = this.match.slice(n) + this._input;
    },
pastInput:function () {
        var past = this.matched.substr(0, this.matched.length - this.match.length);
        return (past.length > 20 ? '...':'') + past.substr(-20).replace(/\n/g, "");
    },
upcomingInput:function () {
        var next = this.match;
        if (next.length < 20) {
            next += this._input.substr(0, 20-next.length);
        }
        return (next.substr(0,20)+(next.length > 20 ? '...':'')).replace(/\n/g, "");
    },
showPosition:function () {
        var pre = this.pastInput();
        var c = new Array(pre.length + 1).join("-");
        return pre + this.upcomingInput() + "\n" + c+"^";
    },
next:function () {
        if (this.done) {
            return this.EOF;
        }
        if (!this._input) this.done = true;

        var token,
            match,
            tempMatch,
            index,
            col,
            lines;
        if (!this._more) {
            this.yytext = '';
            this.match = '';
        }
        var rules = this._currentRules();
        for (var i=0;i < rules.length; i++) {
            tempMatch = this._input.match(this.rules[rules[i]]);
            if (tempMatch && (!match || tempMatch[0].length > match[0].length)) {
                match = tempMatch;
                index = i;
                if (!this.options.flex) break;
            }
        }
        if (match) {
            lines = match[0].match(/\n.*/g);
            if (lines) this.yylineno += lines.length;
            this.yylloc = {first_line: this.yylloc.last_line,
                           last_line: this.yylineno+1,
                           first_column: this.yylloc.last_column,
                           last_column: lines ? lines[lines.length-1].length-1 : this.yylloc.last_column + match[0].length}
            this.yytext += match[0];
            this.match += match[0];
            this.yyleng = this.yytext.length;
            this._more = false;
            this._input = this._input.slice(match[0].length);
            this.matched += match[0];
            token = this.performAction.call(this, this.yy, this, rules[index],this.conditionStack[this.conditionStack.length-1]);
            if (this.done && this._input) this.done = false;
            if (token) return token;
            else return;
        }
        if (this._input === "") {
            return this.EOF;
        } else {
            return 'Lexical error on line '+(this.yylineno+1)+'. Unrecognized text.\n'+this.showPosition(), 
                    {text: "", token: null, line: this.yylineno};
        }
    },
lex:function lex() {
        var r = this.next();
        if (typeof r !== 'undefined') {
            return r;
        } else {
            return this.lex();
        }
    },
begin:function begin(condition) {
        this.conditionStack.push(condition);
    },
popState:function popState() {
        return this.conditionStack.pop();
    },
_currentRules:function _currentRules() {
        return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules;
    },
topState:function () {
        return this.conditionStack[this.conditionStack.length-2];
    },
pushState:function begin(condition) {
        this.begin(condition);
    }});
lexer.options = {};
lexer.performAction = function anonymous(yy,yy_,$avoiding_name_collisions,YY_START) {

var YYSTATE=YY_START
switch($avoiding_name_collisions) {
case 0:/* skip whitespace */
break;
case 1:return 6
break;
case 2:yy_.yytext = yy_.yytext.substr(1,yy_.yyleng-2); return 4
break;
case 3:return 17
break;
case 4:return 18
break;
case 5:return 23
break;
case 6:return 24
break;
case 7:return 22
break;
case 8:return 21
break;
case 9:return 10
break;
case 10:return 11
break;
case 11:return 8
break;
case 12:return 14
break;
case 13:return 'INVALID'
break;
}
};
lexer.rules = [/^(?:\s+)/,/^(?:(-?([0-9]|[1-9][0-9]+))(\.[0-9]+)?([eE][-+]?[0-9]+)?\b)/,/^(?:"(?:\\[\\"bfnrt/]|\\u[a-fA-F0-9]{4}|[^\\\0-\x09\x0a-\x1f"])*")/,/^(?:\{)/,/^(?:\})/,/^(?:\[)/,/^(?:\])/,/^(?:,)/,/^(?::)/,/^(?:true\b)/,/^(?:false\b)/,/^(?:null\b)/,/^(?:$)/,/^(?:.)/];
lexer.conditions = {"INITIAL":{"rules":[0,1,2,3,4,5,6,7,8,9,10,11,12,13],"inclusive":true}};


;
return lexer;})()
parser.lexer = lexer;
return parser;
})();
if (typeof require !== 'undefined' && typeof exports !== 'undefined') {
exports.parser = jsonlint;
exports.parse = function () { return jsonlint.parse.apply(jsonlint, arguments); }
exports.main = function commonjsMain(args) {
    if (!args[1])
        throw 'Usage: '+args[0]+' FILE';
    if (typeof process !== 'undefined') {
        var source = require('fs').readFileSync(require('path').join(process.cwd(), args[1]), "utf8");
    } else {
        var cwd = require("file").path(require("file").cwd());
        var source = cwd.join(args[1]).read({charset: "utf-8"});
    }
    return exports.parser.parse(source);
}
if (typeof module !== 'undefined' && require.main === module) {
  exports.main(typeof process !== 'undefined' ? process.argv.slice(1) : require("system").args);
}
}

/* FROM: http://joncom.be/code/javascript-json-formatter/ 

    NO LISCENSES FOUND. IF YOU HAVE AN ISSUE, I WILL WRITE MY OWN. IF YOU WROTE IT, 
    LET ME BUY YOU A BEER.

*/

function RealTypeOf(v) {
  if (typeof(v) == "object") {
    if (v === null) return "null";
    if (v.constructor == (new Array).constructor) return "array";
    if (v.constructor == (new Date).constructor) return "date";
    if (v.constructor == (new RegExp).constructor) return "regex";
    return "object";
  }
  return typeof(v);
}

function FormatJSON(oData, sIndent) {
    if (arguments.length < 2) {
        var sIndent = "";
    }
    var sIndentStyle = "    ";
    var sDataType = RealTypeOf(oData);

    // open object
    if (sDataType == "array") {
        if (oData.length == 0) {
            return "[]";
        }
        var sHTML = "[";
    } else {
        var iCount = 0;
        $.each(oData, function() {
            iCount++;
            return;
        });
        if (iCount == 0) { // object is empty
            return "{}";
        }
        var sHTML = "{";
    }

    // loop through items
    var iCount = 0;
    $.each(oData, function(sKey, vValue) {
        if (iCount > 0) {
            sHTML += ",";
        }
        if (sDataType == "array") {
            sHTML += ("\n" + sIndent + sIndentStyle);
        } else {
            sHTML += ("\n" + sIndent + sIndentStyle + "\"" + sKey + "\"" + ": ");
        }

        // display relevant data type
        switch (RealTypeOf(vValue)) {
            case "array":
            case "object":
                sHTML += FormatJSON(vValue, (sIndent + sIndentStyle));
                break;
            case "boolean":
            case "number":
                sHTML += vValue.toString();
                break;
            case "null":
                sHTML += "null";
                break;
            case "string":
                sHTML += ("\"" + vValue + "\"");
                break;
            default:
                sHTML += ("TYPEOF: " + typeof(vValue));
        }

        // loop
        iCount++;
    });

    // close object
    if (sDataType == "array") {
        sHTML += ("\n" + sIndent + "]");
    } else {
        sHTML += ("\n" + sIndent + "}");
    }

    // return
    return sHTML;
}// Domain Public by Eric Wendelin http://eriwen.com/ (2008)
//                  Luke Smith http://lucassmith.name/ (2008)
//                  Loic Dachary <loic@dachary.org> (2008)
//                  Johan Euphrosine <proppy@aminche.com> (2008)
//                  Oyvind Sean Kinsey http://kinsey.no/blog (2010)
//                  Victor Homyakov <victor-homyakov@users.sourceforge.net> (2010)

/**
 * Main function giving a function stack trace with a forced or passed in Error
 *
 * @cfg {Error} e The error to create a stacktrace from (optional)
 * @cfg {Boolean} guess If we should try to resolve the names of anonymous functions
 * @return {Array} of Strings with functions, lines, files, and arguments where possible
 */
function printStackTrace(options) {
    options = options || {guess: true};
    var ex = options.e || null, guess = !!options.guess;
    var p = new printStackTrace.implementation(), result = p.run(ex);
    return (guess) ? p.guessAnonymousFunctions(result) : result;
}

printStackTrace.implementation = function() {
};

printStackTrace.implementation.prototype = {
    /**
     * @param {Error} ex The error to create a stacktrace from (optional)
     * @param {String} mode Forced mode (optional, mostly for unit tests)
     */
    run: function(ex, mode) {
        ex = ex || this.createException();
        // examine exception properties w/o debugger
        //for (var prop in ex) {alert("Ex['" + prop + "']=" + ex[prop]);}
        mode = mode || this.mode(ex);
        if (mode === 'other') {
            return this.other(arguments.callee);
        } else {
            return this[mode](ex);
        }
    },

    createException: function() {
        try {
            this.undef();
        } catch (e) {
            return e;
        }
    },

    /**
     * Mode could differ for different exception, e.g.
     * exceptions in Chrome may or may not have arguments or stack.
     *
     * @return {String} mode of operation for the exception
     */
    mode: function(e) {
        if (e['arguments'] && e.stack) {
            return 'chrome';
        } else if (e.stack && e.sourceURL) {
            return 'safari';
        } else if (e.stack && e.number) {
            return 'ie';
        } else if (typeof e.message === 'string' && typeof window !== 'undefined' && window.opera) {
            // e.message.indexOf("Backtrace:") > -1 -> opera
            // !e.stacktrace -> opera
            if (!e.stacktrace) {
                return 'opera9'; // use e.message
            }
            // 'opera#sourceloc' in e -> opera9, opera10a
            if (e.message.indexOf('\n') > -1 && e.message.split('\n').length > e.stacktrace.split('\n').length) {
                return 'opera9'; // use e.message
            }
            // e.stacktrace && !e.stack -> opera10a
            if (!e.stack) {
                return 'opera10a'; // use e.stacktrace
            }
            // e.stacktrace && e.stack -> opera10b
            if (e.stacktrace.indexOf("called from line") < 0) {
                return 'opera10b'; // use e.stacktrace, format differs from 'opera10a'
            }
            // e.stacktrace && e.stack -> opera11
            return 'opera11'; // use e.stacktrace, format differs from 'opera10a', 'opera10b'
        } else if (e.stack) {
            return 'firefox';
        }
        return 'other';
    },

    /**
     * Given a context, function name, and callback function, overwrite it so that it calls
     * printStackTrace() first with a callback and then runs the rest of the body.
     *
     * @param {Object} context of execution (e.g. window)
     * @param {String} functionName to instrument
     * @param {Function} function to call with a stack trace on invocation
     */
    instrumentFunction: function(context, functionName, callback) {
        context = context || window;
        var original = context[functionName];
        context[functionName] = function instrumented() {
            callback.call(this, printStackTrace().slice(4));
            return context[functionName]._instrumented.apply(this, arguments);
        };
        context[functionName]._instrumented = original;
    },

    /**
     * Given a context and function name of a function that has been
     * instrumented, revert the function to it's original (non-instrumented)
     * state.
     *
     * @param {Object} context of execution (e.g. window)
     * @param {String} functionName to de-instrument
     */
    deinstrumentFunction: function(context, functionName) {
        if (context[functionName].constructor === Function &&
                context[functionName]._instrumented &&
                context[functionName]._instrumented.constructor === Function) {
            context[functionName] = context[functionName]._instrumented;
        }
    },

    /**
     * Given an Error object, return a formatted Array based on Chrome's stack string.
     *
     * @param e - Error object to inspect
     * @return Array<String> of function calls, files and line numbers
     */
    chrome: function(e) {
        var stack = (e.stack + '\n').replace(/^\S[^\(]+?[\n$]/gm, '').
          replace(/^\s+(at eval )?at\s+/gm, '').
          replace(/^([^\(]+?)([\n$])/gm, '{anonymous}()@$1$2').
          replace(/^Object.<anonymous>\s*\(([^\)]+)\)/gm, '{anonymous}()@$1').split('\n');
        stack.pop();
        return stack;
    },

    /**
     * Given an Error object, return a formatted Array based on Safari's stack string.
     *
     * @param e - Error object to inspect
     * @return Array<String> of function calls, files and line numbers
     */
    safari: function(e) {
        return e.stack.replace(/\[native code\]\n/m, '')
            .replace(/^(?=\w+Error\:).*$\n/m, '')
            .replace(/^@/gm, '{anonymous}()@')
            .split('\n');
    },

    /**
     * Given an Error object, return a formatted Array based on IE's stack string.
     *
     * @param e - Error object to inspect
     * @return Array<String> of function calls, files and line numbers
     */
    ie: function(e) {
        var lineRE = /^.*at (\w+) \(([^\)]+)\)$/gm;
        return e.stack.replace(/at Anonymous function /gm, '{anonymous}()@')
            .replace(lineRE, '$1@$2')
            .split('\n');
    },

    /**
     * Given an Error object, return a formatted Array based on Firefox's stack string.
     *
     * @param e - Error object to inspect
     * @return Array<String> of function calls, files and line numbers
     */
    firefox: function(e) {
        return e.stack.replace(/(?:\n@:0)?\s+$/m, '').replace(/^[\(@]/gm, '{anonymous}()@').split('\n');
    },

    opera11: function(e) {
        var ANON = '{anonymous}', lineRE = /^.*line (\d+), column (\d+)(?: in (.+))? in (\S+):$/;
        var lines = e.stacktrace.split('\n'), result = [];

        for (var i = 0, len = lines.length; i < len; i += 2) {
            var match = lineRE.exec(lines[i]);
            if (match) {
                var location = match[4] + ':' + match[1] + ':' + match[2];
                var fnName = match[3] || "global code";
                fnName = fnName.replace(/<anonymous function: (\S+)>/, "$1").replace(/<anonymous function>/, ANON);
                result.push(fnName + '@' + location + ' -- ' + lines[i + 1].replace(/^\s+/, ''));
            }
        }

        return result;
    },

    opera10b: function(e) {
        // "<anonymous function: run>([arguments not available])@file://localhost/G:/js/stacktrace.js:27\n" +
        // "printStackTrace([arguments not available])@file://localhost/G:/js/stacktrace.js:18\n" +
        // "@file://localhost/G:/js/test/functional/testcase1.html:15"
        var lineRE = /^(.*)@(.+):(\d+)$/;
        var lines = e.stacktrace.split('\n'), result = [];

        for (var i = 0, len = lines.length; i < len; i++) {
            var match = lineRE.exec(lines[i]);
            if (match) {
                var fnName = match[1]? (match[1] + '()') : "global code";
                result.push(fnName + '@' + match[2] + ':' + match[3]);
            }
        }

        return result;
    },

    /**
     * Given an Error object, return a formatted Array based on Opera 10's stacktrace string.
     *
     * @param e - Error object to inspect
     * @return Array<String> of function calls, files and line numbers
     */
    opera10a: function(e) {
        // "  Line 27 of linked script file://localhost/G:/js/stacktrace.js\n"
        // "  Line 11 of inline#1 script in file://localhost/G:/js/test/functional/testcase1.html: In function foo\n"
        var ANON = '{anonymous}', lineRE = /Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i;
        var lines = e.stacktrace.split('\n'), result = [];

        for (var i = 0, len = lines.length; i < len; i += 2) {
            var match = lineRE.exec(lines[i]);
            if (match) {
                var fnName = match[3] || ANON;
                result.push(fnName + '()@' + match[2] + ':' + match[1] + ' -- ' + lines[i + 1].replace(/^\s+/, ''));
            }
        }

        return result;
    },

    // Opera 7.x-9.2x only!
    opera9: function(e) {
        // "  Line 43 of linked script file://localhost/G:/js/stacktrace.js\n"
        // "  Line 7 of inline#1 script in file://localhost/G:/js/test/functional/testcase1.html\n"
        var ANON = '{anonymous}', lineRE = /Line (\d+).*script (?:in )?(\S+)/i;
        var lines = e.message.split('\n'), result = [];

        for (var i = 2, len = lines.length; i < len; i += 2) {
            var match = lineRE.exec(lines[i]);
            if (match) {
                result.push(ANON + '()@' + match[2] + ':' + match[1] + ' -- ' + lines[i + 1].replace(/^\s+/, ''));
            }
        }

        return result;
    },

    // Safari 5-, IE 9-, and others
    other: function(curr) {
        var ANON = '{anonymous}', fnRE = /function\s*([\w\-$]+)?\s*\(/i, stack = [], fn, args, maxStackSize = 10;
        while (curr && curr['arguments'] && stack.length < maxStackSize) {
            fn = fnRE.test(curr.toString()) ? RegExp.$1 || ANON : ANON;
            args = Array.prototype.slice.call(curr['arguments'] || []);
            stack[stack.length] = fn + '(' + this.stringifyArguments(args) + ')';
            curr = curr.caller;
        }
        return stack;
    },

    /**
     * Given arguments array as a String, subsituting type names for non-string types.
     *
     * @param {Arguments} args
     * @return {Array} of Strings with stringified arguments
     */
    stringifyArguments: function(args) {
        var result = [];
        var slice = Array.prototype.slice;
        for (var i = 0; i < args.length; ++i) {
            var arg = args[i];
            if (arg === undefined) {
                result[i] = 'undefined';
            } else if (arg === null) {
                result[i] = 'null';
            } else if (arg.constructor) {
                if (arg.constructor === Array) {
                    if (arg.length < 3) {
                        result[i] = '[' + this.stringifyArguments(arg) + ']';
                    } else {
                        result[i] = '[' + this.stringifyArguments(slice.call(arg, 0, 1)) + '...' + this.stringifyArguments(slice.call(arg, -1)) + ']';
                    }
                } else if (arg.constructor === Object) {
                    result[i] = '#object';
                } else if (arg.constructor === Function) {
                    result[i] = '#function';
                } else if (arg.constructor === String) {
                    result[i] = '"' + arg + '"';
                } else if (arg.constructor === Number) {
                    result[i] = arg;
                }
            }
        }
        return result.join(',');
    },

    sourceCache: {},

    /**
     * @return the text from a given URL
     */
    ajax: function(url) {
        var req = this.createXMLHTTPObject();
        if (req) {
            try {
                req.open('GET', url, false);
                //req.overrideMimeType('text/plain');
                //req.overrideMimeType('text/javascript');
                req.send(null);
                //return req.status == 200 ? req.responseText : '';
                return req.responseText;
            } catch (e) {
            }
        }
        return '';
    },

    /**
     * Try XHR methods in order and store XHR factory.
     *
     * @return <Function> XHR function or equivalent
     */
    createXMLHTTPObject: function() {
        var xmlhttp, XMLHttpFactories = [
            function() {
                return new XMLHttpRequest();
            }, function() {
                return new ActiveXObject('Msxml2.XMLHTTP');
            }, function() {
                return new ActiveXObject('Msxml3.XMLHTTP');
            }, function() {
                return new ActiveXObject('Microsoft.XMLHTTP');
            }
        ];
        for (var i = 0; i < XMLHttpFactories.length; i++) {
            try {
                xmlhttp = XMLHttpFactories[i]();
                // Use memoization to cache the factory
                this.createXMLHTTPObject = XMLHttpFactories[i];
                return xmlhttp;
            } catch (e) {
            }
        }
    },

    /**
     * Given a URL, check if it is in the same domain (so we can get the source
     * via Ajax).
     *
     * @param url <String> source url
     * @return False if we need a cross-domain request
     */
    isSameDomain: function(url) {
        return typeof location !== "undefined" && url.indexOf(location.hostname) !== -1; // location may not be defined, e.g. when running from nodejs.
    },

    /**
     * Get source code from given URL if in the same domain.
     *
     * @param url <String> JS source URL
     * @return <Array> Array of source code lines
     */
    getSource: function(url) {
        // TODO reuse source from script tags?
        if (!(url in this.sourceCache)) {
            this.sourceCache[url] = this.ajax(url).split('\n');
        }
        return this.sourceCache[url];
    },

    guessAnonymousFunctions: function(stack) {
        for (var i = 0; i < stack.length; ++i) {
            var reStack = /\{anonymous\}\(.*\)@(.*)/,
                reRef = /^(.*?)(?::(\d+))(?::(\d+))?(?: -- .+)?$/,
                frame = stack[i], ref = reStack.exec(frame);

            if (ref) {
                var m = reRef.exec(ref[1]);
                if (m) { // If falsey, we did not get any file/line information
                    var file = m[1], lineno = m[2], charno = m[3] || 0;
                    if (file && this.isSameDomain(file) && lineno) {
                        var functionName = this.guessAnonymousFunction(file, lineno, charno);
                        stack[i] = frame.replace('{anonymous}', functionName);
                    }
                }
            }
        }
        return stack;
    },

    guessAnonymousFunction: function(url, lineNo, charNo) {
        var ret;
        try {
            ret = this.findFunctionName(this.getSource(url), lineNo);
        } catch (e) {
            ret = 'getSource failed with url: ' + url + ', exception: ' + e.toString();
        }
        return ret;
    },

    findFunctionName: function(source, lineNo) {
        // FIXME findFunctionName fails for compressed source
        // (more than one function on the same line)
        // TODO use captured args
        // function {name}({args}) m[1]=name m[2]=args
        var reFunctionDeclaration = /function\s+([^(]*?)\s*\(([^)]*)\)/;
        // {name} = function ({args}) TODO args capture
        // /['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*function(?:[^(]*)/
        var reFunctionExpression = /['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*function\b/;
        // {name} = eval()
        var reFunctionEvaluation = /['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*(?:eval|new Function)\b/;
        // Walk backwards in the source lines until we find
        // the line which matches one of the patterns above
        var code = "", line, maxLines = Math.min(lineNo, 20), m, commentPos;
        for (var i = 0; i < maxLines; ++i) {
            // lineNo is 1-based, source[] is 0-based
            line = source[lineNo - i - 1];
            commentPos = line.indexOf('//');
            if (commentPos >= 0) {
                line = line.substr(0, commentPos);
            }
            // TODO check other types of comments? Commented code may lead to false positive
            if (line) {
                code = line + code;
                m = reFunctionExpression.exec(code);
                if (m && m[1]) {
                    return m[1];
                }
                m = reFunctionDeclaration.exec(code);
                if (m && m[1]) {
                    //return m[1] + "(" + (m[2] || "") + ")";
                    return m[1];
                }
                m = reFunctionEvaluation.exec(code);
                if (m && m[1]) {
                    return m[1];
                }
            }
        }
        return '(?)';
    }
};
/**

JSZip - A Javascript class for generating Zip files
<http://stuartk.com/jszip>

(c) 2009 Stuart Knightley <stuart [at] stuartk.com>
Licenced under the GPLv3 and the MIT licences

(I choose MIT - jr. 8/27/2012 - nametag)

Usage:
   zip = new JSZip();
   zip.file("hello.txt", "Hello, World!").add("tempfile", "nothing");
   zip.folder("images").file("smile.gif", base64Data, {base64: true});
   zip.file("Xmas.txt", "Ho ho ho !", {date : new Date("December 25, 2007 00:00:01")});
   zip.remove("tempfile");

   base64zip = zip.generate();

**/

/**
 * Representation a of zip file in js
 * @constructor
 * @param {String=} data the data to load, if any (optional).
 * @param {Object=} options the options for creating this objects (optional).
 */
var JSZip = function(data, options)
{
   // object containing the files :
   // {
   //   "folder/" : {...},
   //   "folder/data.txt" : {...}
   // }
   this.files = {};

   // Where we are in the hierarchy
   this.root = "";

   if(data) this.load(data, options);
}

JSZip.signature = {
   LOCAL_FILE_HEADER : "\x50\x4b\x03\x04",
   CENTRAL_FILE_HEADER : "\x50\x4b\x01\x02",
   CENTRAL_DIRECTORY_END : "\x50\x4b\x05\x06",
   ZIP64_CENTRAL_DIRECTORY_LOCATOR : "\x50\x4b\x06\x07",
   ZIP64_CENTRAL_DIRECTORY_END : "\x50\x4b\x06\x06",
   DATA_DESCRIPTOR : "\x50\x4b\x07\x08"
};

// Default properties for a new file
JSZip.defaults = {
   base64: false,
   binary: false,
   dir: false,
   date: null
};


JSZip.prototype = (function ()
{
   /**
    * A simple object representing a file in the zip file.
    * @constructor
    * @param {string} name the name of the file
    * @param {string} data the data
    * @param {Object} options the options of the file
    */
   var ZipObject = function (name, data, options)
   {
      this.name = name;
      this.data = data;
      this.options = options;
   };

   ZipObject.prototype = {
      /**
       * Return the content as UTF8 string.
       * @return {string} the UTF8 string.
       */
      asText : function ()
      {
         return this.options.binary ? JSZip.prototype.utf8decode(this.data) : this.data;
      },
      /**
       * Returns the binary content.
       * @return {string} the content as binary.
       */
      asBinary : function ()
      {
         return this.options.binary ? this.data : JSZip.prototype.utf8encode(this.data);
      }
   };

   /**
    * Transform an integer into a string in hexadecimal.
    * @private
    * @param {number} dec the number to convert.
    * @param {number} bytes the number of bytes to generate.
    * @returns {string} the result.
    */
   var decToHex = function(dec, bytes)
   {
      var hex = "", i;
      for(i = 0; i < bytes; i++)
      {
         hex += String.fromCharCode(dec&0xff);
         dec=dec>>>8;
      }
      return hex;
   };

   /**
    * Merge the objects passed as parameters into a new one.
    * @private
    * @param {...Object} var_args All objects to merge.
    * @return {Object} a new object with the data of the others.
    */
   var extend = function ()
   {
      var result = {}, i, attr;
      for (i = 0; i < arguments.length; i++) // arguments is not enumerable in some browsers
      {
         for (attr in arguments[i])
         {
            if(typeof result[attr] === "undefined")
            {
               result[attr] = arguments[i][attr];
            }
         }
      }
      return result;
   };

   /**
    * Transforms the (incomplete) options from the user into the complete
    * set of options to create a file.
    * @private
    * @param {Object} o the options from the user.
    * @return {Object} the complete set of options.
    */
   var prepareFileAttrs = function (o)
   {
      o = o || {};
      if (o.base64 === true && o.binary == null) o.binary = true;
      o = extend(o, JSZip.defaults);
      o.date = o.date || new Date();

      return o;
   }

  /**
   * Add a file in the current folder.
   * @private
   * @param {string} name the name of the file
   * @param {string} data the data of the file
   * @param {Object} o the options of the file
   * @return {Object} the new file.
   */
   var fileAdd = function (name, data, o)
   {
      // be sure sub folders exist
      var parent = parentFolder(name);
      if (parent) folderAdd.call(this, parent);

      o = prepareFileAttrs(o);

      return this.files[name] = {name: name, data: data, options:o};
   };


   /**
    * Find the parent folder of the path.
    * @private
    * @param {string} path the path to use
    * @return {string} the parent folder, or ""
    */
   var parentFolder = function (path)
   {
      if (path.slice(-1) == '/')
      {
         path = path.substring(0, path.length - 1);
      }
      var lastSlash = path.lastIndexOf('/');
      return (lastSlash > 0) ? path.substring(0, lastSlash) : "";
   };

   /**
    * Add a (sub) folder in the current folder.
    * @private
    * @param {string} name the folder's name
    * @return {Object} the new folder.
    */
   var folderAdd = function (name)
   {
      // Check the name ends with a /
      if (name.slice(-1) != "/") name += "/"; // IE doesn't like substr(-1)

      // Does this folder already exist?
      if (!this.files[name])
      {
         // be sure sub folders exist
         var parent = parentFolder(name);
         if (parent) folderAdd.call(this, parent);

         fileAdd.call(this, name, '', {dir:true});
      }
      return this.files[name];
   };

   /**
    * Generate the data found in the local header of a zip file.
    * Do not create it now, as some parts are re-used later.
    * @private
    * @param {Object} file the file to use.
    * @param {string} utfEncodedFileName the file name, utf8 encoded.
    * @param {string} compressionType the compression to use.
    * @return {Object} an object containing header and compressedData.
    */
   var prepareLocalHeaderData = function(file, utfEncodedFileName, compressionType)
   {
      var useUTF8 = utfEncodedFileName !== file.name,
          data    = file.data,
          o       = file.options,
          dosTime,
          dosDate;

      // date
      // @see http://www.delorie.com/djgpp/doc/rbinter/it/52/13.html
      // @see http://www.delorie.com/djgpp/doc/rbinter/it/65/16.html
      // @see http://www.delorie.com/djgpp/doc/rbinter/it/66/16.html

      dosTime = o.date.getHours();
      dosTime = dosTime << 6;
      dosTime = dosTime | o.date.getMinutes();
      dosTime = dosTime << 5;
      dosTime = dosTime | o.date.getSeconds() / 2;

      dosDate = o.date.getFullYear() - 1980;
      dosDate = dosDate << 4;
      dosDate = dosDate | (o.date.getMonth() + 1);
      dosDate = dosDate << 5;
      dosDate = dosDate | o.date.getDate();

      if (o.base64 === true) data = JSZipBase64.decode(data);
      // decode UTF-8 strings if we are dealing with text data
      if(o.binary === false) data = this.utf8encode(data);


      var compression    = JSZip.compressions[compressionType];
      var compressedData = compression.compress(data);

      var header = "";

      // version needed to extract
      header += "\x0A\x00";
      // general purpose bit flag
      // set bit 11 if utf8
      header += useUTF8 ? "\x00\x08" : "\x00\x00";
      // compression method
      header += compression.magic;
      // last mod file time
      header += decToHex(dosTime, 2);
      // last mod file date
      header += decToHex(dosDate, 2);
      // crc-32
      header += decToHex(this.crc32(data), 4);
      // compressed size
      header += decToHex(compressedData.length, 4);
      // uncompressed size
      header += decToHex(data.length, 4);
      // file name length
      header += decToHex(utfEncodedFileName.length, 2);
      // extra field length
      header += "\x00\x00";

      return {
         header:header,
         compressedData:compressedData
      };
   };


   // return the actual prototype of JSZip
   return {
      /**
       * Read an existing zip and merge the data in the current JSZip object.
       * The implementation is in jszip-load.js, don't forget to include it.
       * @param {string} stream  The stream to load
       * @param {Object} options Options for loading the stream.
       *  options.base64 : is the stream in base64 ? default : false
       * @return {JSZip} the current JSZip object
       */
      load : function (stream, options)
      {
         throw new Error("Load method is not defined. Is the file jszip-load.js included ?");
      },

      /**
       * Filter nested files/folders with the specified function.
       * @param {Function} search the predicate to use :
       * function (relativePath, file) {...}
       * It takes 2 arguments : the relative path and the file.
       * @return {Array} An array of matching elements.
       */
      filter : function (search)
      {
         var result = [], filename, relativePath, file, fileClone;
         for (filename in this.files)
         {
            file = this.files[filename];
            // return a new object, don't let the user mess with our internal objects :)
            fileClone = new ZipObject(file.name, file.data, extend(file.options));
            relativePath = filename.slice(this.root.length, filename.length);
            if (filename.slice(0, this.root.length) === this.root // the file is in the current root
                && search(relativePath, fileClone)) // and the file matches the function
            {
               result.push(fileClone);
            }
         }
         return result;
      },

      /**
       * Add a file to the zip file, or search a file.
       * @param   {string|RegExp} name The name of the file to add (if data is defined),
       * the name of the file to find (if no data) or a regex to match files.
       * @param   {string} data  The file data, either raw or base64 encoded
       * @param   {Object} o     File options
       * @return  {JSZip|Object|Array} this JSZip object (when adding a file),
       * a file (when searching by string) or an array of files (when searching by regex).
       */
      file : function(name, data, o)
      {
         if (arguments.length === 1)
         {
            if (name instanceof RegExp)
            {
               var regexp = name;
               return this.filter(function(relativePath, file) {
                  return !file.options.dir && regexp.test(relativePath);
               });
            }
            else // text
            {
               return this.filter(function (relativePath, file) {
                  return !file.options.dir && relativePath === name;
               })[0]||null;
            }
         }
         else // more than one argument : we have data !
         {
            name = this.root+name;
            fileAdd.call(this, name, data, o);
         }
         return this;
      },

      /**
       * Add a directory to the zip file, or search.
       * @param   {String|RegExp} arg The name of the directory to add, or a regex to search folders.
       * @return  {JSZip} an object with the new directory as the root, or an array containing matching folders.
       */
      folder : function(arg)
      {
         if (!arg)
         {
            throw new Error("folder : wrong argument");
         }

         if (arg instanceof RegExp)
         {
            return this.filter(function(relativePath, file) {
               return file.options.dir && arg.test(relativePath);
            });
         }

         // else, name is a new folder
         var name = this.root + arg;
         var newFolder = folderAdd.call(this, name);

         // Allow chaining by returning a new object with this folder as the root
         var ret = this.clone();
         ret.root = newFolder.name;
         return ret;
      },

      /**
       * Delete a file, or a directory and all sub-files, from the zip
       * @param {string} name the name of the file to delete
       * @return {JSZip} this JSZip object
       */
      remove : function(name)
      {
         name = this.root + name;
         var file = this.files[name];
         if (!file)
         {
            // Look for any folders
            if (name.slice(-1) != "/") name += "/";
            file = this.files[name];
         }

         if (file)
         {
            if (!file.options.dir)
            {
               // file
               delete this.files[name];
            }
            else
            {
               // folder
               var kids = this.filter(function (relativePath, file) {
                  return file.name.slice(0, name.length) === name;
               });
               for (var i = 0; i < kids.length; i++)
               {
                  delete this.files[kids[i].name];
               }
            }
         }

         return this;
      },

      /**
       * Generate the complete zip file
       * @param {Object} options the options to generate the zip file :
       * - base64, true to generate base64.
       * - compression, "STORE" by default.
       * @return {string} the zip file
       */
      generate : function(options)
      {
         options = extend(options || {}, {
            base64 : true,
            compression : "STORE"
         });
         var compression = options.compression.toUpperCase();

         // The central directory, and files data
         var directory = [], files = [], fileOffset = 0;

         if (!JSZip.compressions[compression]) {
            throw compression + " is not a valid compression method !";
         }

         for (var name in this.files)
         {
            if( !this.files.hasOwnProperty(name) ) { continue; }

            var file = this.files[name];

            var utfEncodedFileName = this.utf8encode(file.name);

            var fileRecord = "",
            dirRecord = "",
            data = prepareLocalHeaderData.call(this, file, utfEncodedFileName, compression);
            fileRecord = JSZip.signature.LOCAL_FILE_HEADER + data.header + utfEncodedFileName + data.compressedData;

            dirRecord = JSZip.signature.CENTRAL_FILE_HEADER +
            // version made by (00: DOS)
            "\x14\x00" +
            // file header (common to file and central directory)
            data.header +
            // file comment length
            "\x00\x00" +
            // disk number start
            "\x00\x00" +
            // internal file attributes TODO
            "\x00\x00" +
            // external file attributes
            (this.files[name].dir===true?"\x10\x00\x00\x00":"\x00\x00\x00\x00")+
            // relative offset of local header
            decToHex(fileOffset, 4) +
            // file name
            utfEncodedFileName;

            fileOffset += fileRecord.length;

            files.push(fileRecord);
            directory.push(dirRecord);
         }

         var fileData = files.join("");
         var dirData = directory.join("");

         var dirEnd = "";

         // end of central dir signature
         dirEnd = JSZip.signature.CENTRAL_DIRECTORY_END +
         // number of this disk
         "\x00\x00" +
         // number of the disk with the start of the central directory
         "\x00\x00" +
         // total number of entries in the central directory on this disk
         decToHex(files.length, 2) +
         // total number of entries in the central directory
         decToHex(files.length, 2) +
         // size of the central directory   4 bytes
         decToHex(dirData.length, 4) +
         // offset of start of central directory with respect to the starting disk number
         decToHex(fileData.length, 4) +
         // .ZIP file comment length
         "\x00\x00";

         var zip = fileData + dirData + dirEnd;
         return (options.base64) ? JSZipBase64.encode(zip) : zip;
      },

      /**
       *
       *  Javascript crc32
       *  http://www.webtoolkit.info/
       *
       */
      crc32 : function(str, crc)
      {

         if (str === "" || typeof str === "undefined") return 0;

         var table = "00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D";

         if (typeof(crc) == "undefined") { crc = 0; }
         var x = 0;
         var y = 0;

         crc = crc ^ (-1);
         for( var i = 0, iTop = str.length; i < iTop; i++ ) {
            y = ( crc ^ str.charCodeAt( i ) ) & 0xFF;
            x = "0x" + table.substr( y * 9, 8 );
            crc = ( crc >>> 8 ) ^ x;
         }

         return crc ^ (-1);

      },

      // Inspired by http://my.opera.com/GreyWyvern/blog/show.dml/1725165
      clone : function()
      {
         var newObj = new JSZip();
         for (var i in this)
         {
            if (typeof this[i] !== "function")
            {
               newObj[i] = this[i];
            }
         }
         return newObj;
      },


      /**
       * http://www.webtoolkit.info/javascript-utf8.html
       */
      utf8encode : function (string) {
         string = string.replace(/\r\n/g,"\n");
         var utftext = "";

         for (var n = 0; n < string.length; n++) {

            var c = string.charCodeAt(n);

            if (c < 128) {
               utftext += String.fromCharCode(c);
            }
            else if((c > 127) && (c < 2048)) {
               utftext += String.fromCharCode((c >> 6) | 192);
               utftext += String.fromCharCode((c & 63) | 128);
            }
            else {
               utftext += String.fromCharCode((c >> 12) | 224);
               utftext += String.fromCharCode(((c >> 6) & 63) | 128);
               utftext += String.fromCharCode((c & 63) | 128);
            }

         }

         return utftext;
      },

      /**
       * http://www.webtoolkit.info/javascript-utf8.html
       */
      utf8decode : function (utftext) {
         var string = "";
         var i = 0;
         var c = 0, c1 = 0, c2 = 0, c3 = 0;

         while ( i < utftext.length ) {

            c = utftext.charCodeAt(i);

            if (c < 128) {
               string += String.fromCharCode(c);
               i++;
            }
            else if((c > 191) && (c < 224)) {
               c2 = utftext.charCodeAt(i+1);
               string += String.fromCharCode(((c & 31) << 6) | (c2 & 63));
               i += 2;
            }
            else {
               c2 = utftext.charCodeAt(i+1);
               c3 = utftext.charCodeAt(i+2);
               string += String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));
               i += 3;
            }

         }

         return string;
      }
   };
})();

/*
 * Compression methods
 * This object is filled in as follow :
 * name : {
 *    magic // the 2 bytes indentifying the compression method
 *    compress // function, take the uncompressed content and return it compressed.
 *    uncompress // function, take the compressed content and return it uncompressed.
 * }
 *
 * STORE is the default compression method, so it's included in this file.
 * Other methods should go to separated files : the user wants modularity.
 */
JSZip.compressions = {
   "STORE" : {
      magic : "\x00\x00",
      compress : function (content)
      {
         return content; // no compression
      },
      uncompress : function (content)
      {
         return content; // no compression
      }
   }
};

/**
 *
 *  Base64 encode / decode
 *  http://www.webtoolkit.info/
 *
 *  Hacked so that it doesn't utf8 en/decode everything
 **/
var JSZipBase64 = function() {
   // private property
   var _keyStr = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";

   return {
      // public method for encoding
      encode : function(input, utf8) {
         var output = "";
         var chr1, chr2, chr3, enc1, enc2, enc3, enc4;
         var i = 0;

         while (i < input.length) {

            chr1 = input.charCodeAt(i++);
            chr2 = input.charCodeAt(i++);
            chr3 = input.charCodeAt(i++);

            enc1 = chr1 >> 2;
            enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);
            enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);
            enc4 = chr3 & 63;

            if (isNaN(chr2)) {
               enc3 = enc4 = 64;
            } else if (isNaN(chr3)) {
               enc4 = 64;
            }

            output = output +
               _keyStr.charAt(enc1) + _keyStr.charAt(enc2) +
               _keyStr.charAt(enc3) + _keyStr.charAt(enc4);

         }

         return output;
      },

      // public method for decoding
      decode : function(input, utf8) {
         var output = "";
         var chr1, chr2, chr3;
         var enc1, enc2, enc3, enc4;
         var i = 0;

         input = input.replace(/[^A-Za-z0-9\+\/\=]/g, "");

         while (i < input.length) {

            enc1 = _keyStr.indexOf(input.charAt(i++));
            enc2 = _keyStr.indexOf(input.charAt(i++));
            enc3 = _keyStr.indexOf(input.charAt(i++));
            enc4 = _keyStr.indexOf(input.charAt(i++));

            chr1 = (enc1 << 2) | (enc2 >> 4);
            chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);
            chr3 = ((enc3 & 3) << 6) | enc4;

            output = output + String.fromCharCode(chr1);

            if (enc3 != 64) {
               output = output + String.fromCharCode(chr2);
            }
            if (enc4 != 64) {
               output = output + String.fromCharCode(chr3);
            }

         }

         return output;

      }
   };
}();

// enforcing Stuk's coding style
// vim: set shiftwidth=3 softtabstop=3:
/**

JSZip - A Javascript class for generating Zip files
<http://stuartk.com/jszip>

(c) 2011 David Duponchel <d.duponchel@gmail.com>
Licenced under the GPLv3 and the MIT licences

**/
(function () {

   /**
    * Prettify a string read as binary.
    * @param {string} str the string to prettify.
    * @return {string} a pretty string.
    */
   var pretty = function (str)
   {
      var res = '', code, i;
      for (i = 0; i < str.length; i++)
      {
         code = str.charCodeAt(i);
         res += '\\x' + (code < 10 ? "0" : "") + code.toString(16);
      }
      return res;
   };

   /**
    * Find a compression registered in JSZip.
    * @param {string} compressionMethod the method magic to find.
    * @return {Object|null} the JSZip compression object, null if none found.
    */
   var findCompression = function (compressionMethod)
   {
      for (var method in JSZip.compressions)
      {
         if (JSZip.compressions[method].magic === compressionMethod)
         {
            return JSZip.compressions[method];
         }
      }
      return null;
   };

   // class StreamReader {{{
   /**
    * Read bytes from a stream.
    * @constructor
    * @param {string} stream the stream to read.
    */
   function StreamReader(stream) {
      this.stream = stream;
      this.index = 0;
   }
   StreamReader.prototype = {
      /**
       * Check that the offset will not go too far.
       * @param {string} offset the additional offset to check.
       * @throws {Error} an Error if the offset is out of bounds.
       */
      checkOffset : function (offset)
      {
         this.checkIndex(this.index + offset);
      },
      /**
       * Check that the specifed index will not be too far.
       * @param {string} newIndex the index to check.
       * @throws {Error} an Error if the index is out of bounds.
       */
      checkIndex : function (newIndex)
      {
         if (this.stream.length < newIndex || newIndex < 0)
         {
            throw new Error("End of stream reached (stream length = " +
                            this.stream.length + ", asked index = " +
                            (newIndex) + "). Corrupted zip ?");
         }
      },
      /**
       * Change the index.
       * @param {number} newIndex The new index.
       * @throws {Error} if the new index is out of the stream.
       */
      setIndex : function (newIndex)
      {
         this.checkIndex(newIndex);
         this.index = newIndex;
      },
      /**
       * Check if the end of the file has been reached.
       * @return {boolean} true if it is the case, false otherwise.
       */
      eof : function ()
      {
         return this.index >= this.stream.length;
      },
      /**
       * Get the byte at the specified index.
       * @param {number} i the index to use.
       * @return {number} a byte.
       */
      byteAt : function(i)
      {
         return this.stream.charCodeAt(i) & 0xff;
      },
      /**
       * Get the next byte of this stream.
       * @return {string} the next byte.
       */
      readByte : function ()
      {
         this.checkOffset(1);
         return this.byteAt(1 + this.index++);
      },
      /**
       * Get the next number with a given byte size.
       * @param {number} size the number of bytes to read.
       * @return {number} the corresponding number.
       */
      readInt : function (size)
      {
         var result = 0, i;
         this.checkOffset(size);
         for(i = size - 1; i >= 0; i--)
         {
            result = (result << 8) + this.byteAt(this.index + i);
         }
         this.index += size;
         return result;
      },
      /**
       * Get the next string with a given byte size.
       * @param {number} size the number of bytes to read.
       * @return {string} the corresponding string.
       */
      readString : function (size)
      {
         var result = "", i, code;
         this.checkOffset(size);
         for(i = 0; i < size; i++)
         {
            code = this.byteAt(this.index + i);
            result += String.fromCharCode(code);
         }
         this.index += size;
         return result;
      },
      /**
       * Get the next date.
       * @return {Date} the date.
       */
      readDate : function ()
      {
         var dostime = this.readInt(4);
         return new Date(
            ((dostime >> 25) & 0x7f) + 1980, // year
            ((dostime >> 21) & 0x0f) - 1, // month
            (dostime >> 16) & 0x1f, // day
            (dostime >> 11) & 0x1f, // hour
            (dostime >> 5) & 0x3f, // minute
            (dostime & 0x1f) << 1); // second
      }
   };
   // }}} end of StreamReader

   // class ZipEntry {{{
   /**
    * An entry in the zip file.
    * @constructor
    * @param {Object} options Options of the current file.
    * @param {Object} loadOptions Options for loading the stream.
    */
   function ZipEntry(options, loadOptions)
   {
      this.options = options;
      this.loadOptions = loadOptions;
   }
   ZipEntry.prototype = {
      /**
       * say if the file is encrypted.
       * @return {boolean} true if the file is encrypted, false otherwise.
       */
      isEncrypted : function ()
      {
         // bit 1 is set
         return (this.bitFlag & 0x0001) === 0x0001;
      },
      /**
       * say if the file has a data decriptor.
       * @return {boolean} true if the file has a data descriptor, false otherwise.
       */
      hasDataDescriptor : function ()
      {
         // bit 3 is set
         return (this.bitFlag & 0x0008) === 0x0008;
      },
      /**
       * say if the file has utf-8 filename/comment.
       * @return {boolean} true if the filename/comment is in utf-8, false otherwise.
       */
      useUTF8 : function ()
      {
         // bit 11 is set
         return (this.bitFlag & 0x0800) === 0x0800;
      },
      /**
       * say if the file is a zip64 file.
       * @return {boolean} true if the file is zip64, false otherwise.
       */
      isZIP64 : function ()
      {
         return this.options.zip64;
      },
      /**
       * Read the local part header of a zip file and add the info in this object.
       * @param {StreamReader} reader the reader to use.
       */
      readLocalPartHeader : function(reader)
      {
         // the signature has already been consumed
         this.versionNeeded     = reader.readInt(2);
         this.bitFlag           = reader.readInt(2);
         this.compressionMethod = reader.readString(2);
         this.date              = reader.readDate();
         this.crc32             = reader.readInt(4);
         this.compressedSize    = reader.readInt(4);
         this.uncompressedSize  = reader.readInt(4);
         this.fileNameLength    = reader.readInt(2);
         this.extraFieldsLength = reader.readInt(2);

         if (this.isEncrypted())
         {
            throw new Error("Encrypted zip are not supported");
         }
      },
      /**
       * Read the local part of a zip file and add the info in this object.
       * @param {StreamReader} reader the reader to use.
       */
      readLocalPart : function(reader)
      {
         var compression;

         this.readLocalPartHeader(reader);

         this.fileName = reader.readString(this.fileNameLength);
         this.readExtraFields(reader);

         if (!this.hasDataDescriptor())
         {
            // easy : we know the file length
            this.compressedFileData = reader.readString(this.compressedSize);
         }
         else
         {
            // hard way : find the data descriptor manually
            this.compressedFileData = this.findDataUntilDataDescriptor(reader);
            this.crc32              = reader.readInt(4);
            this.compressedSize     = reader.readInt(this.isZIP64() ? 8 : 4);
            this.uncompressedSize   = reader.readInt(this.isZIP64() ? 8 : 4);

            if (this.compressedFileData.length !== this.compressedSize)
            {
               throw new Error("Bug : data descriptor incorrectly read (size mismatch)");
            }
         }
         this.uncompressedFileData = null;

         compression = findCompression(this.compressionMethod);
         if (compression === null) // no compression found
         {
            throw new Error("Corrupted zip : compression " + pretty(this.compressionMethod) +
                            " unknown (inner file : " + this.fileName + ")");
         }
         this.uncompressedFileData = compression.uncompress(this.compressedFileData);

         if (this.loadOptions.checkCRC32 && JSZip.prototype.crc32(this.uncompressedFileData) !== this.crc32)
         {
            throw new Error("Corrupted zip : CRC32 mismatch");
         }

         if (this.useUTF8())
         {
            this.fileName = JSZip.prototype.utf8decode(this.fileName);
         }
      },

      /**
       * Read data until a data descriptor signature is found.
       * @param {StreamReader} reader the reader to use.
       */
      findDataUntilDataDescriptor : function(reader)
      {
         var data = "",
         buffer = reader.readString(4),
         aByte;

         while(buffer !== JSZip.signature.DATA_DESCRIPTOR)
         {
            aByte = reader.readString(1);
            data += buffer.slice(0, 1);
            buffer = (buffer + aByte).slice(-4);
         }
         return data;
      },
      /**
       * Read the central part of a zip file and add the info in this object.
       * @param {StreamReader} reader the reader to use.
       */
      readCentralPart : function(reader)
      {
         this.versionMadeBy = reader.readString(2);

         this.readLocalPartHeader(reader);

         this.fileCommentLength      = reader.readInt(2);
         this.diskNumberStart        = reader.readInt(2);
         this.internalFileAttributes = reader.readInt(2);
         this.externalFileAttributes = reader.readInt(4);
         this.localHeaderOffset      = reader.readInt(4);

         this.fileName = reader.readString(this.fileNameLength);
         this.readExtraFields(reader);
         this.fileComment = reader.readString(this.fileCommentLength);
         if (this.useUTF8())
         {
            this.fileName    = JSZip.prototype.utf8decode(this.fileName);
            this.fileComment = JSZip.prototype.utf8decode(this.fileComment);
         }

         // warning, this is true only for zip with madeBy == DOS (plateform dependent feature)
         this.dir = this.externalFileAttributes & 0x00000010 ? true : false;
      },
      /**
       * Parse the ZIP64 extra field and merge the info in the current ZipEntry.
       * @param {StreamReader} reader the reader to use.
       */
      parseZIP64ExtraField : function(reader)
      {
         // should be something, preparing the extra reader
         var extraReader = new StreamReader(this.extraFields[0x0001].value);
         if(this.uncompressedSize === -1)
         {
            this.uncompressedSize = extraReader.readInt(8);
         }
         if(this.compressedSize === -1)
         {
            this.compressedSize = extraReader.readInt(8);
         }
         if(this.localHeaderOffset === -1)
         {
            this.localHeaderOffset = extraReader.readInt(8);
         }
         if(this.diskNumberStart === -1)
         {
            this.diskNumberStart = extraReader.readInt(4);
         }
      },
      /**
       * Read the central part of a zip file and add the info in this object.
       * @param {StreamReader} reader the reader to use.
       */
      readExtraFields : function(reader)
      {
         var start = reader.index,
             extraFieldId,
             extraFieldLength,
             extraFieldValue;

         this.extraFields = this.extraFields || {};

         while (reader.index < start + this.extraFieldsLength)
         {
            extraFieldId     = reader.readInt(2);
            extraFieldLength = reader.readInt(2);
            extraFieldValue  = reader.readString(extraFieldLength);

            this.extraFields[extraFieldId] = {
               id:     extraFieldId,
               length: extraFieldLength,
               value:  extraFieldValue
            };
         }

         if(this.isZIP64() && this.extraFields[0x0001])
         {
            this.parseZIP64ExtraField(reader);
         }
      }
   };
   // }}} end of ZipEntry

   //  class ZipEntries {{{
   /**
    * All the entries in the zip file.
    * @constructor
    * @param {string} data the binary stream to load.
    * @param {Object} loadOptions Options for loading the stream.
    */
   function ZipEntries(data, loadOptions)
   {
      this.files = [];
      this.loadOptions = loadOptions;
      if (data) this.load(data);
   }
   ZipEntries.prototype = {
      /**
       * Check that the reader is on the speficied signature.
       * @param {string} expectedSignature the expected signature.
       * @throws {Error} if it is an other signature.
       */
      checkSignature : function(expectedSignature)
      {
         var signature = this.reader.readString(4);
         if (signature !== expectedSignature)
         {
            throw new Error("Corrupted zip or bug : unexpected signature " +
                            "(" + pretty(signature) + ", expected " + pretty(expectedSignature) + ")");
         }
      },
      /**
       * Read the end of the central directory.
       */
      readBlockEndOfCentral : function ()
      {
         this.diskNumber                  = this.reader.readInt(2);
         this.diskWithCentralDirStart     = this.reader.readInt(2);
         this.centralDirRecordsOnThisDisk = this.reader.readInt(2);
         this.centralDirRecords           = this.reader.readInt(2);
         this.centralDirSize              = this.reader.readInt(4);
         this.centralDirOffset            = this.reader.readInt(4);

         this.zipCommentLength            = this.reader.readInt(2);
         this.zipComment                  = this.reader.readString(this.zipCommentLength);
      },
      /**
       * Read the end of the Zip 64 central directory.
       * Not merged with the method readEndOfCentral :
       * The end of central can coexist with its Zip64 brother,
       * I don't want to read the wrong number of bytes !
       */
      readBlockZip64EndOfCentral : function ()
      {
         this.zip64EndOfCentralSize       = this.reader.readInt(8);
         this.versionMadeBy               = this.reader.readString(2);
         this.versionNeeded               = this.reader.readInt(2);
         this.diskNumber                  = this.reader.readInt(4);
         this.diskWithCentralDirStart     = this.reader.readInt(4);
         this.centralDirRecordsOnThisDisk = this.reader.readInt(8);
         this.centralDirRecords           = this.reader.readInt(8);
         this.centralDirSize              = this.reader.readInt(8);
         this.centralDirOffset            = this.reader.readInt(8);

         this.zip64ExtensibleData = {};
         var extraDataSize = this.zip64EndOfCentralSize - 44,
         index = 0,
         extraFieldId,
         extraFieldLength,
         extraFieldValue;
         while(index < extraDataSize)
         {
            extraFieldId     = this.reader.readInt(2);
            extraFieldLength = this.reader.readInt(4);
            extraFieldValue  = this.reader.readString(extraFieldLength);
            this.zip64ExtensibleData[extraFieldId] = {
               id:     extraFieldId,
               length: extraFieldLength,
               value:  extraFieldValue
            };
         }
      },
      /**
       * Read the end of the Zip 64 central directory locator.
       */
      readBlockZip64EndOfCentralLocator : function ()
      {
         this.diskWithZip64CentralDirStart       = this.reader.readInt(4);
         this.relativeOffsetEndOfZip64CentralDir = this.reader.readInt(8);
         this.disksCount                         = this.reader.readInt(4);
         if (this.disksCount > 1)
         {
            throw new Error("Multi-volumes zip are not supported");
         }
      },
      /**
       * Read the local files, based on the offset read in the central part.
       */
      readLocalFiles : function()
      {
         var i, file;
         for(i = 0; i < this.files.length; i++)
         {
            file = this.files[i];
            this.reader.setIndex(file.localHeaderOffset);
            this.checkSignature(JSZip.signature.LOCAL_FILE_HEADER);
            file.readLocalPart(this.reader);
         }
      },
      /**
       * Read the central directory.
       */
      readCentralDir : function()
      {
         var file;

         this.reader.setIndex(this.centralDirOffset);
         while(this.reader.readString(4) === JSZip.signature.CENTRAL_FILE_HEADER)
         {
            file = new ZipEntry({
               zip64: this.zip64
            }, this.loadOptions);
            file.readCentralPart(this.reader);
            this.files.push(file);
         }
      },
      /**
       * Read the end of central directory.
       */
      readEndOfCentral : function()
      {
         // zip 64 ?
         var offset = this.reader.stream.lastIndexOf(JSZip.signature.ZIP64_CENTRAL_DIRECTORY_LOCATOR);
         if (offset === -1) // nope
         {
            this.zip64 = false;
            offset = this.reader.stream.lastIndexOf(JSZip.signature.CENTRAL_DIRECTORY_END);
            if (offset === -1)
            {
               throw new Error("Corrupted zip : can't find end of central directory");
            }

            this.reader.setIndex(offset);
            this.checkSignature(JSZip.signature.CENTRAL_DIRECTORY_END);
            this.readBlockEndOfCentral();
         }
         else // zip 64 !
         {
            this.zip64 = true;
            this.reader.setIndex(offset);
            this.checkSignature(JSZip.signature.ZIP64_CENTRAL_DIRECTORY_LOCATOR);
            this.readBlockZip64EndOfCentralLocator();

            this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir);
            this.checkSignature(JSZip.signature.ZIP64_CENTRAL_DIRECTORY_END);
            this.readBlockZip64EndOfCentral();
         }
      },
      /**
       * Read a zip file and create ZipEntries.
       * @param {string} data the binary string representing a zip file.
       */
      load : function(data)
      {
         this.reader = new StreamReader(data);

         this.readEndOfCentral();
         this.readCentralDir();
         this.readLocalFiles();
      }
   };
   // }}} end of ZipEntries

   /**
    * Implementation of the load method of JSZip.
    * It uses the above classes to decode a zip file, and load every files.
    * @param {string} data the data to load.
    * @param {Object} options Options for loading the stream.
    *  options.base64 : is the stream in base64 ? default : false
    */
   JSZip.prototype.load = function(data, options)
   {
      var files, zipEntries, i, input;
      options = options || {};
      if(options.base64)
      {
         data = JSZipBase64.decode(data);
      }

      zipEntries = new ZipEntries(data, options);
      files = zipEntries.files;
      for (i in files)
      {
         input = files[i];
         this.file(input.fileName, input.uncompressedFileData, {
            binary:true,
            date:input.date,
            dir:input.dir
         });
      }

      return this;
   };

})();
// enforcing Stuk's coding style
// vim: set shiftwidth=3 softtabstop=3 foldmethod=marker:
// moment.js
// version : 1.7.2
// author : Tim Wood
// license : MIT
// momentjs.com
(function(a){function E(a,b,c,d){var e=c.lang();return e[a].call?e[a](c,d):e[a][b]}function F(a,b){return function(c){return K(a.call(this,c),b)}}function G(a){return function(b){var c=a.call(this,b);return c+this.lang().ordinal(c)}}function H(a,b,c){this._d=a,this._isUTC=!!b,this._a=a._a||null,this._lang=c||!1}function I(a){var b=this._data={},c=a.years||a.y||0,d=a.months||a.M||0,e=a.weeks||a.w||0,f=a.days||a.d||0,g=a.hours||a.h||0,h=a.minutes||a.m||0,i=a.seconds||a.s||0,j=a.milliseconds||a.ms||0;this._milliseconds=j+i*1e3+h*6e4+g*36e5,this._days=f+e*7,this._months=d+c*12,b.milliseconds=j%1e3,i+=J(j/1e3),b.seconds=i%60,h+=J(i/60),b.minutes=h%60,g+=J(h/60),b.hours=g%24,f+=J(g/24),f+=e*7,b.days=f%30,d+=J(f/30),b.months=d%12,c+=J(d/12),b.years=c,this._lang=!1}function J(a){return a<0?Math.ceil(a):Math.floor(a)}function K(a,b){var c=a+"";while(c.length<b)c="0"+c;return c}function L(a,b,c){var d=b._milliseconds,e=b._days,f=b._months,g;d&&a._d.setTime(+a+d*c),e&&a.date(a.date()+e*c),f&&(g=a.date(),a.date(1).month(a.month()+f*c).date(Math.min(g,a.daysInMonth())))}function M(a){return Object.prototype.toString.call(a)==="[object Array]"}function N(a,b){var c=Math.min(a.length,b.length),d=Math.abs(a.length-b.length),e=0,f;for(f=0;f<c;f++)~~a[f]!==~~b[f]&&e++;return e+d}function O(a,b,c,d){var e,f,g=[];for(e=0;e<7;e++)g[e]=a[e]=a[e]==null?e===2?1:0:a[e];return a[7]=g[7]=b,a[8]!=null&&(g[8]=a[8]),a[3]+=c||0,a[4]+=d||0,f=new Date(0),b?(f.setUTCFullYear(a[0],a[1],a[2]),f.setUTCHours(a[3],a[4],a[5],a[6])):(f.setFullYear(a[0],a[1],a[2]),f.setHours(a[3],a[4],a[5],a[6])),f._a=g,f}function P(a,c){var d,e,g=[];!c&&h&&(c=require("./lang/"+a));for(d=0;d<i.length;d++)c[i[d]]=c[i[d]]||f.en[i[d]];for(d=0;d<12;d++)e=b([2e3,d]),g[d]=new RegExp("^"+(c.months[d]||c.months(e,""))+"|^"+(c.monthsShort[d]||c.monthsShort(e,"")).replace(".",""),"i");return c.monthsParse=c.monthsParse||g,f[a]=c,c}function Q(a){var c=typeof a=="string"&&a||a&&a._lang||null;return c?f[c]||P(c):b}function R(a){return a.match(/\[.*\]/)?a.replace(/^\[|\]$/g,""):a.replace(/\\/g,"")}function S(a){var b=a.match(k),c,d;for(c=0,d=b.length;c<d;c++)D[b[c]]?b[c]=D[b[c]]:b[c]=R(b[c]);return function(e){var f="";for(c=0;c<d;c++)f+=typeof b[c].call=="function"?b[c].call(e,a):b[c];return f}}function T(a,b){function d(b){return a.lang().longDateFormat[b]||b}var c=5;while(c--&&l.test(b))b=b.replace(l,d);return A[b]||(A[b]=S(b)),A[b](a)}function U(a){switch(a){case"DDDD":return p;case"YYYY":return q;case"S":case"SS":case"SSS":case"DDD":return o;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":case"a":case"A":return r;case"Z":case"ZZ":return s;case"T":return t;case"MM":case"DD":case"YY":case"HH":case"hh":case"mm":case"ss":case"M":case"D":case"d":case"H":case"h":case"m":case"s":return n;default:return new RegExp(a.replace("\\",""))}}function V(a,b,c,d){var e,f;switch(a){case"M":case"MM":c[1]=b==null?0:~~b-1;break;case"MMM":case"MMMM":for(e=0;e<12;e++)if(Q().monthsParse[e].test(b)){c[1]=e,f=!0;break}f||(c[8]=!1);break;case"D":case"DD":case"DDD":case"DDDD":b!=null&&(c[2]=~~b);break;case"YY":c[0]=~~b+(~~b>70?1900:2e3);break;case"YYYY":c[0]=~~Math.abs(b);break;case"a":case"A":d.isPm=(b+"").toLowerCase()==="pm";break;case"H":case"HH":case"h":case"hh":c[3]=~~b;break;case"m":case"mm":c[4]=~~b;break;case"s":case"ss":c[5]=~~b;break;case"S":case"SS":case"SSS":c[6]=~~(("0."+b)*1e3);break;case"Z":case"ZZ":d.isUTC=!0,e=(b+"").match(x),e&&e[1]&&(d.tzh=~~e[1]),e&&e[2]&&(d.tzm=~~e[2]),e&&e[0]==="+"&&(d.tzh=-d.tzh,d.tzm=-d.tzm)}b==null&&(c[8]=!1)}function W(a,b){var c=[0,0,1,0,0,0,0],d={tzh:0,tzm:0},e=b.match(k),f,g;for(f=0;f<e.length;f++)g=(U(e[f]).exec(a)||[])[0],g&&(a=a.slice(a.indexOf(g)+g.length)),D[e[f]]&&V(e[f],g,c,d);return d.isPm&&c[3]<12&&(c[3]+=12),d.isPm===!1&&c[3]===12&&(c[3]=0),O(c,d.isUTC,d.tzh,d.tzm)}function X(a,b){var c,d=a.match(m)||[],e,f=99,g,h,i;for(g=0;g<b.length;g++)h=W(a,b[g]),e=T(new H(h),b[g]).match(m)||[],i=N(d,e),i<f&&(f=i,c=h);return c}function Y(a){var b="YYYY-MM-DDT",c;if(u.exec(a)){for(c=0;c<4;c++)if(w[c][1].exec(a)){b+=w[c][0];break}return s.exec(a)?W(a,b+" Z"):W(a,b)}return new Date(a)}function Z(a,b,c,d,e){var f=e.relativeTime[a];return typeof f=="function"?f(b||1,!!c,a,d):f.replace(/%d/i,b||1)}function $(a,b,c){var e=d(Math.abs(a)/1e3),f=d(e/60),g=d(f/60),h=d(g/24),i=d(h/365),j=e<45&&["s",e]||f===1&&["m"]||f<45&&["mm",f]||g===1&&["h"]||g<22&&["hh",g]||h===1&&["d"]||h<=25&&["dd",h]||h<=45&&["M"]||h<345&&["MM",d(h/30)]||i===1&&["y"]||["yy",i];return j[2]=b,j[3]=a>0,j[4]=c,Z.apply({},j)}function _(a,c){b.fn[a]=function(a){var b=this._isUTC?"UTC":"";return a!=null?(this._d["set"+b+c](a),this):this._d["get"+b+c]()}}function ab(a){b.duration.fn[a]=function(){return this._data[a]}}function bb(a,c){b.duration.fn["as"+a]=function(){return+this/c}}var b,c="1.7.2",d=Math.round,e,f={},g="en",h=typeof module!="undefined"&&module.exports,i="months|monthsShort|weekdays|weekdaysShort|weekdaysMin|longDateFormat|calendar|relativeTime|ordinal|meridiem".split("|"),j=/^\/?Date\((\-?\d+)/i,k=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|YYYY|YY|a|A|hh?|HH?|mm?|ss?|SS?S?|zz?|ZZ?|.)/g,l=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?)/g,m=/([0-9a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)/gi,n=/\d\d?/,o=/\d{1,3}/,p=/\d{3}/,q=/\d{1,4}/,r=/[0-9a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+/i,s=/Z|[\+\-]\d\d:?\d\d/i,t=/T/i,u=/^\s*\d{4}-\d\d-\d\d(T(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/,v="YYYY-MM-DDTHH:mm:ssZ",w=[["HH:mm:ss.S",/T\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/T\d\d:\d\d:\d\d/],["HH:mm",/T\d\d:\d\d/],["HH",/T\d\d/]],x=/([\+\-]|\d\d)/gi,y="Month|Date|Hours|Minutes|Seconds|Milliseconds".split("|"),z={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},A={},B="DDD w M D d".split(" "),C="M D H h m s w".split(" "),D={M:function(){return this.month()+1},MMM:function(a){return E("monthsShort",this.month(),this,a)},MMMM:function(a){return E("months",this.month(),this,a)},D:function(){return this.date()},DDD:function(){var a=new Date(this.year(),this.month(),this.date()),b=new Date(this.year(),0,1);return~~((a-b)/864e5+1.5)},d:function(){return this.day()},dd:function(a){return E("weekdaysMin",this.day(),this,a)},ddd:function(a){return E("weekdaysShort",this.day(),this,a)},dddd:function(a){return E("weekdays",this.day(),this,a)},w:function(){var a=new Date(this.year(),this.month(),this.date()-this.day()+5),b=new Date(a.getFullYear(),0,4);return~~((a-b)/864e5/7+1.5)},YY:function(){return K(this.year()%100,2)},YYYY:function(){return K(this.year(),4)},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return~~(this.milliseconds()/100)},SS:function(){return K(~~(this.milliseconds()/10),2)},SSS:function(){return K(this.milliseconds(),3)},Z:function(){var a=-this.zone(),b="+";return a<0&&(a=-a,b="-"),b+K(~~(a/60),2)+":"+K(~~a%60,2)},ZZ:function(){var a=-this.zone(),b="+";return a<0&&(a=-a,b="-"),b+K(~~(10*a/6),4)}};while(B.length)e=B.pop(),D[e+"o"]=G(D[e]);while(C.length)e=C.pop(),D[e+e]=F(D[e],2);D.DDDD=F(D.DDD,3),b=function(c,d){if(c===null||c==="")return null;var e,f;return b.isMoment(c)?new H(new Date(+c._d),c._isUTC,c._lang):(d?M(d)?e=X(c,d):e=W(c,d):(f=j.exec(c),e=c===a?new Date:f?new Date(+f[1]):c instanceof Date?c:M(c)?O(c):typeof c=="string"?Y(c):new Date(c)),new H(e))},b.utc=function(a,c){return M(a)?new H(O(a,!0),!0):(typeof a=="string"&&!s.exec(a)&&(a+=" +0000",c&&(c+=" Z")),b(a,c).utc())},b.unix=function(a){return b(a*1e3)},b.duration=function(a,c){var d=b.isDuration(a),e=typeof a=="number",f=d?a._data:e?{}:a,g;return e&&(c?f[c]=a:f.milliseconds=a),g=new I(f),d&&(g._lang=a._lang),g},b.humanizeDuration=function(a,c,d){return b.duration(a,c===!0?null:c).humanize(c===!0?!0:d)},b.version=c,b.defaultFormat=v,b.lang=function(a,c){var d;if(!a)return g;(c||!f[a])&&P(a,c);if(f[a]){for(d=0;d<i.length;d++)b[i[d]]=f[a][i[d]];b.monthsParse=f[a].monthsParse,g=a}},b.langData=Q,b.isMoment=function(a){return a instanceof H},b.isDuration=function(a){return a instanceof I},b.lang("en",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},meridiem:function(a,b,c){return a>11?c?"pm":"PM":c?"am":"AM"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinal:function(a){var b=a%10;return~~(a%100/10)===1?"th":b===1?"st":b===2?"nd":b===3?"rd":"th"}}),b.fn=H.prototype={clone:function(){return b(this)},valueOf:function(){return+this._d},unix:function(){return Math.floor(+this._d/1e3)},toString:function(){return this._d.toString()},toDate:function(){return this._d},toArray:function(){var a=this;return[a.year(),a.month(),a.date(),a.hours(),a.minutes(),a.seconds(),a.milliseconds(),!!this._isUTC]},isValid:function(){return this._a?this._a[8]!=null?!!this._a[8]:!N(this._a,(this._a[7]?b.utc(this._a):b(this._a)).toArray()):!isNaN(this._d.getTime())},utc:function(){return this._isUTC=!0,this},local:function(){return this._isUTC=!1,this},format:function(a){return T(this,a?a:b.defaultFormat)},add:function(a,c){var d=c?b.duration(+c,a):b.duration(a);return L(this,d,1),this},subtract:function(a,c){var d=c?b.duration(+c,a):b.duration(a);return L(this,d,-1),this},diff:function(a,c,e){var f=this._isUTC?b(a).utc():b(a).local(),g=(this.zone()-f.zone())*6e4,h=this._d-f._d-g,i=this.year()-f.year(),j=this.month()-f.month(),k=this.date()-f.date(),l;return c==="months"?l=i*12+j+k/30:c==="years"?l=i+(j+k/30)/12:l=c==="seconds"?h/1e3:c==="minutes"?h/6e4:c==="hours"?h/36e5:c==="days"?h/864e5:c==="weeks"?h/6048e5:h,e?l:d(l)},from:function(a,c){return b.duration(this.diff(a)).lang(this._lang).humanize(!c)},fromNow:function(a){return this.from(b(),a)},calendar:function(){var a=this.diff(b().sod(),"days",!0),c=this.lang().calendar,d=c.sameElse,e=a<-6?d:a<-1?c.lastWeek:a<0?c.lastDay:a<1?c.sameDay:a<2?c.nextDay:a<7?c.nextWeek:d;return this.format(typeof e=="function"?e.apply(this):e)},isLeapYear:function(){var a=this.year();return a%4===0&&a%100!==0||a%400===0},isDST:function(){return this.zone()<b([this.year()]).zone()||this.zone()<b([this.year(),5]).zone()},day:function(a){var b=this._isUTC?this._d.getUTCDay():this._d.getDay();return a==null?b:this.add({d:a-b})},startOf:function(a){switch(a.replace(/s$/,"")){case"year":this.month(0);case"month":this.date(1);case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return this},endOf:function(a){return this.startOf(a).add(a.replace(/s?$/,"s"),1).subtract("ms",1)},sod:function(){return this.clone().startOf("day")},eod:function(){return this.clone().endOf("day")},zone:function(){return this._isUTC?0:this._d.getTimezoneOffset()},daysInMonth:function(){return b.utc([this.year(),this.month()+1,0]).date()},lang:function(b){return b===a?Q(this):(this._lang=b,this)}};for(e=0;e<y.length;e++)_(y[e].toLowerCase(),y[e]);_("year","FullYear"),b.duration.fn=I.prototype={weeks:function(){return J(this.days()/7)},valueOf:function(){return this._milliseconds+this._days*864e5+this._months*2592e6},humanize:function(a){var b=+this,c=this.lang().relativeTime,d=$(b,!a,this.lang()),e=b<=0?c.past:c.future;return a&&(typeof e=="function"?d=e(d):d=e.replace(/%s/i,d)),d},lang:b.fn.lang};for(e in z)z.hasOwnProperty(e)&&(bb(e,z[e]),ab(e.toLowerCase()));bb("Weeks",6048e5),h&&(module.exports=b),typeof ender=="undefined"&&(this.moment=b),typeof define=="function"&&define.amd&&define("moment",[],function(){return b})}).call(this);/* from http://www.zachstronaut.com/posts/2009/08/07/jquery-animate-css-rotate-scale.html */


(function ($) {
    // Monkey patch jQuery 1.3.1+ css() method to support CSS 'transform'
    // property uniformly across Safari/Chrome/Webkit, Firefox 3.5+, IE 9+, and Opera 11+.
    // 2009-2011 Zachary Johnson www.zachstronaut.com
    // Updated 2011.05.04 (May the fourth be with you!)
    function getTransformProperty(element)
    {
        // Try transform first for forward compatibility
        // In some versions of IE9, it is critical for msTransform to be in
        // this list before MozTranform.
        var properties = ['transform', 'WebkitTransform', 'msTransform', 'MozTransform', 'OTransform'];
        var p;
        while (p = properties.shift())
        {
            if (typeof element.style[p] != 'undefined')
            {
                return p;
            }
        }
        
        // Default to transform also
        return 'transform';
    }
    
    var _propsObj = null;
    
    var proxied = $.fn.css;
    $.fn.css = function (arg, val)
    {
        // Temporary solution for current 1.6.x incompatibility, while
        // preserving 1.3.x compatibility, until I can rewrite using CSS Hooks
        if (_propsObj === null)
        {
            if (typeof $.cssProps != 'undefined')
            {
                _propsObj = $.cssProps;
            }
            else if (typeof $.props != 'undefined')
            {
                _propsObj = $.props;
            }
            else
            {
                _propsObj = {}
            }
        }
        
        // Find the correct browser specific property and setup the mapping using
        // $.props which is used internally by jQuery.attr() when setting CSS
        // properties via either the css(name, value) or css(properties) method.
        // The problem with doing this once outside of css() method is that you
        // need a DOM node to find the right CSS property, and there is some risk
        // that somebody would call the css() method before body has loaded or any
        // DOM-is-ready events have fired.
        if
        (
            typeof _propsObj['transform'] == 'undefined'
            &&
            (
                arg == 'transform'
                ||
                (
                    typeof arg == 'object'
                    && typeof arg['transform'] != 'undefined'
                )
            )
        )
        {
            _propsObj['transform'] = getTransformProperty(this.get(0));
        }
        
        // We force the property mapping here because jQuery.attr() does
        // property mapping with jQuery.props when setting a CSS property,
        // but curCSS() does *not* do property mapping when *getting* a
        // CSS property.  (It probably should since it manually does it
        // for 'float' now anyway... but that'd require more testing.)
        //
        // But, only do the forced mapping if the correct CSS property
        // is not 'transform' and is something else.
        if (_propsObj['transform'] != 'transform')
        {
            // Call in form of css('transform' ...)
            if (arg == 'transform')
            {
                arg = _propsObj['transform'];
                
                // User wants to GET the transform CSS, and in jQuery 1.4.3
                // calls to css() for transforms return a matrix rather than
                // the actual string specified by the user... avoid that
                // behavior and return the string by calling jQuery.style()
                // directly
                if (typeof val == 'undefined' && jQuery.style)
                {
                    return jQuery.style(this.get(0), arg);
                }
            }

            // Call in form of css({'transform': ...})
            else if
            (
                typeof arg == 'object'
                && typeof arg['transform'] != 'undefined'
            )
            {
                arg[_propsObj['transform']] = arg['transform'];
                delete arg['transform'];
            }
        }
        
        return proxied.apply(this, arguments);
    };
})(jQuery);


/*!
/**
 * Monkey patch jQuery 1.3.1+ to add support for setting or animating CSS
 * scale and rotation independently.
 * https://github.com/zachstronaut/jquery-animate-css-rotate-scale
 * Released under dual MIT/GPL license just like jQuery.
 * 2009-2012 Zachary Johnson www.zachstronaut.com
 */
(function ($) {
    // Updated 2010.11.06
    // Updated 2012.10.13 - Firefox 16 transform style returns a matrix rather than a string of transform functions.  This broke the features of this jQuery patch in Firefox 16.  It should be possible to parse the matrix for both scale and rotate (especially when scale is the same for both the X and Y axis), however the matrix does have disadvantages such as using its own units and also 45deg being indistinguishable from 45+360deg.  To get around these issues, this patch tracks internally the scale, rotation, and rotation units for any elements that are .scale()'ed, .rotate()'ed, or animated.  The major consequences of this are that 1. the scaled/rotated element will blow away any other transform rules applied to the same element (such as skew or translate), and 2. the scaled/rotated element is unaware of any preset scale or rotation initally set by page CSS rules.  You will have to explicitly set the starting scale/rotation value.
    
    function initData($el) {
        var _ARS_data = $el.data('_ARS_data');
        if (!_ARS_data) {
            _ARS_data = {
                rotateUnits: 'deg',
                scale: 1,
                rotate: 0
            };
            
            $el.data('_ARS_data', _ARS_data);
        }
        
        return _ARS_data;
    }
    
    function setTransform($el, data) {
        $el.css('transform', 'rotate(' + data.rotate + data.rotateUnits + ') scale(' + data.scale + ',' + data.scale + ')');
    }
    
    $.fn.rotate = function (val) {
        var $self = $(this), m, data = initData($self);
                        
        if (typeof val == 'undefined') {
            return data.rotate + data.rotateUnits;
        }
        
        m = val.toString().match(/^(-?\d+(\.\d+)?)(.+)?$/);
        if (m) {
            if (m[3]) {
                data.rotateUnits = m[3];
            }
            
            data.rotate = m[1];
            
            setTransform($self, data);
        }
        
        return this;
    };
    
    // Note that scale is unitless.
    $.fn.scale = function (val) {
        var $self = $(this), data = initData($self);
        
        if (typeof val == 'undefined') {
            return data.scale;
        }
        
        data.scale = val;
        
        setTransform($self, data);
        
        return this;
    };

    // fx.cur() must be monkey patched because otherwise it would always
    // return 0 for current rotate and scale values
    var curProxied = $.fx.prototype.cur;
    $.fx.prototype.cur = function () {
        if (this.prop == 'rotate') {
            return parseFloat($(this.elem).rotate());
            
        } else if (this.prop == 'scale') {
            return parseFloat($(this.elem).scale());
        }
        
        return curProxied.apply(this, arguments);
    };
    
    $.fx.step.rotate = function (fx) {
        var data = initData($(fx.elem));
        $(fx.elem).rotate(fx.now + data.rotateUnits);
    };
    
    $.fx.step.scale = function (fx) {
        $(fx.elem).scale(fx.now);
    };
    
    /*
    
    Starting on line 3905 of jquery-1.3.2.js we have this code:
    
    // We need to compute starting value
    if ( unit != "px" ) {
        self.style[ name ] = (end || 1) + unit;
        start = ((end || 1) / e.cur(true)) * start;
        self.style[ name ] = start + unit;
    }
    
    This creates a problem where we cannot give units to our custom animation
    because if we do then this code will execute and because self.style[name]
    does not exist where name is our custom animation's name then e.cur(true)
    will likely return zero and create a divide by zero bug which will set
    start to NaN.
    
    The following monkey patch for animate() gets around this by storing the
    units used in the rotation definition and then stripping the units off.
    
    */
    
    var animateProxied = $.fn.animate;
    $.fn.animate = function (prop) {
        if (typeof prop['rotate'] != 'undefined') {
            var $self, data, m = prop['rotate'].toString().match(/^(([+-]=)?(-?\d+(\.\d+)?))(.+)?$/);
            if (m && m[5]) {
                $self = $(this);
                data = initData($self);
                data.rotateUnits = m[5];
            }
            
            prop['rotate'] = m[1];
        }
        
        return animateProxied.apply(this, arguments);
    };
})(jQuery);var Hypertag=Nametag={};var GLOBAL=this;Hypertag.Debugger={exceptions:[]};Hypertag.Debugger.error=function(msg){if(GLOBAL.fat){while(fat.stop()){}}Hypertag.Runtime.ErrorExpanding=true;var trace=printStackTrace().slice(4).join("\n");var msg=String(arguments[0])+"\n";for(var i=1;i<arguments.length;i++){msg+="    "+String(arguments[i])+" ";}console.error("(ERROR)\n"+msg);};Hypertag.Debugger.warning=function(msg){var trace=printStackTrace().slice(4).join("\n");var msg=String(arguments[0])+"\n";for(var i=1;i<arguments.length;i++){msg+="    "+String(arguments[i])+" ";}console.warn("(warning)\n"+msg);};Hypertag.Debugger.comment=function(msg){var trace=printStackTrace().slice(4).join("\n");var msg=String(arguments[0])+"\n";for(var i=1;i<arguments.length;i++){msg+="    "+String(arguments[i])+" ";}console.log("(comment)\n"+msg);};$(document).ready(function(){Hypertag.$Body=$("body");Hypertag.Body=Hypertag.$Body[0];Hypertag.$Body.fadeTo(0,0);Hypertag.Runtime._loadTemplateDumpsIfAny();var StartExpanding=function(){send(Hypertag,"__init__");Hypertag.Runtime.ExpandHypertags();send(Hypertag,"__ready__");Hypertag.$Body.fadeTo(0,1);};if(GLOBAL.CompilerClass){Hypertag.SHML=new SHMLClass();Hypertag.Compiler=new CompilerClass();Hypertag.Compiler._LoadLibrariesFromScripts(function(){Hypertag.Compiler._BuildTemplateLookups();Hypertag.useSHML!==false&&Hypertag.Compiler._ProcessSHMLTemplateTags();var to_import="";for(var key in Hypertag.Runtime.Builtins){to_import+=Hypertag.Runtime.Builtins[key]+"\n";}Hypertag.Compiler.ImportTemplatesFromText(to_import,true);StartExpanding();});}else{StartExpanding();}});Hypertag.Methods={};GLOBAL.isAltPressed=false;GLOBAL.isCrtlPressed=false;GLOBAL.isMetaPressed=false;GLOBAL.isShiftPressed=false;GLOBAL.isCommandPressed=false;var _setAllKeysUp=function(){GLOBAL.isMetaPressed=false;GLOBAL.isShiftPressed=false;GLOBAL.isCommandPressed=false;GLOBAL.isAltPressed=false;GLOBAL.isCrtlPressed=false;};var _alert=alert;GLOBAL.alert=function(msg){_setAllKeysUp();return _alert(msg);};var _confirm=confirm;GLOBAL.confirm=function(msg){_setAllKeysUp();return _confirm(msg);};var _prompt=prompt;GLOBAL.prompt=function(msg){_setAllKeysUp();return _prompt(msg);};var RuntimeClass=function(){var self=this;self.TemplateNodesByServer={};self.CompiledTemplateCache={};self.CompiledTemplateOptionsCache={};self.CompiledTemplateOptionsTextCache={},self.CompiledTemplateAttributeNames={};self.TemplateLowercaseLookup={};self.TemplateTagType={};self.ExtendsTemplateLookup={};self.AnonymousTemplatesForTemplate={};self.CompiledTemplatesWithoutContent={};self.WorkflowLifetimes={};self.EvalScript=function(text){return window.eval(text);};self.SourcesLoaded={};self.SavedCompiledTemplateCache={};self.SavedCompiledTemplateOptionsCache={};self.SavedTemplateLowercaseLookup=[];self.SavedTemplateTagType=[];self.SavedExtendsTemplateLookup=[];self.FirstLoadEvents=[];self.LoadItemEvents=[];self.LoadedItemEvents=[];self.PreloadTagEvents=[];self.LoadTagEvents=[];self.LoadedTagEvents=[];self.SetupTagEvents=[];self.ReadyTagEvents=[];self.AfterTagEvents=[];self.FinallyTagEvents=[];self.FinishedTagEvents=[];self.PenultimatelyTagEvents=[];self.UltimatelyTagEvents=[];self.Expanding=false;self.html_tag_names={a:true,abbr:true,acronym:true,address:true,applet:true,area:true,article:true,aside:true,audio:true,b:true,base:true,basefont:true,bdi:true,bdo:true,big:true,blink:true,blockquote:true,body:true,br:true,button:true,canvas:true,caption:true,center:true,cite:true,code:true,col:true,colgroup:true,command:true,data:true,datalist:true,dd:true,del:true,details:true,dfn:true,dir:true,div:true,dl:true,dt:true,em:true,fieldset:true,figcaption:true,figure:true,font:true,footer:true,form:true,frame:true,frameset:true,htrue:true,h1:true,h2:true,h3:true,h4:true,h5:true,h6:true,head:true,header:true,hgroup:true,hr:true,html:true,i:true,iframe:true,img:true,input:true,ins:true,isindex:true,kbd:true,keygen:true,label:true,legend:true,li:true,link:true,map:true,mark:true,marquee:true,menu:true,meta:true,meter:true,nav:true,noframes:true,noscript:true,object:true,ol:true,optgroup:true,option:true,output:true,p:true,param:true,pre:true,progress:true,q:true,rp:true,rt:true,ruby:true,s:true,samp:true,script:true,section:true,select:true,small:true,list:true,span:true,strike:true,strikeout:true,strong:true,style:true,sub:true,summary:true,sup:true,table:true,tbody:true,td:true,textarea:true,tfoot:true,th:true,thead:true,time:true,title:true,tr:true,track:true,tt:true,u:true,ul:true,video:true,wbr:true,xmp:true};self.Builtins={fullview:'<script id="run" type="text/hypertag">\n'};self.html_tag_names["var"]=true;self.styles={};self.cancelDoubleClickFlag=false;self.debug=true;self.enableTemplateCompilation=true;self.doubleClickDelay=200;self.TemplateReverseAliases={};self.attributes_to_autohitch=["width","height","top","left","opacity"];self.dragdelay=450;self.CSSTraits={};self.QueryString=parseQueryString(window.location.search.substring(1));return self;};RuntimeClass.prototype.addCSSTrait=function(css_class_name,method){var self=this;var dict_to_merge={};dict_to_merge[css_class_name]=method;if(!self.CSSTraits[css_class_name]){self.CSSTraits[css_class_name]=method;}else{HypertagClass.prototype.mergespace(dict_to_merge,self.CSSTraits,true);}};RuntimeClass.prototype.removeCSSTrait=function(css_class_name,method){var self=this;delete self.CSSTraits[css_class_name];};RuntimeClass.prototype.ExpandHypertags=function(target){if(!target){target=Hypertag.Body;}try{if(!Hypertag.Runtime.Expanding){Hypertag.Runtime.Expanding=target;}var hypertags_to_expand=[];var all_items=[target[0]||target];var item;while(item=all_items.shift()){if(hasClass(item,"hypertag")){hypertags_to_expand.push([item,Hypertag.Runtime._extractCodeblock(item)||""]);$(item).empty().removeClass("hypertag").addClass("isHypertag");}var children=$.makeArray(item.childNodes);for(var i=0,node;(node=children[i]);i++){if(node.nodeType==1){all_items.push(node);}}}while((item=hypertags_to_expand.pop())){try{new HypertagClass(item[0],item[1]);}catch(e){var err_msg=String(e);var final_err_msg="Construct error ------------\n\n    "+err_msg;if(!err_msg.startswith("SYNTAX ERROR: ")){final_err_msg+="\n\nContext was -------------------------------\n    "+item[1];}if(Hypertag.Debugger.exceptions.length){for(var i=0;i<Hypertag.Debugger.exceptions.length;i++){final_err_msg+=Hypertag.Debugger.exceptions[i]+"\n";}Hypertag.Debugger.exceptions=[];}Hypertag.Debugger.error(final_err_msg);console.log("Tag associated with last error is: ",item[0]);}}if(target==Hypertag.Runtime.Expanding){var debug_state=[];for(;;){try{if(Hypertag.Runtime.FirstLoadEvents.length){var hypertag=Hypertag.Runtime.FirstLoadEvents.shift();debug_state[0]="FirstLoadEvents";debug_state[1]=hypertag.template||hypertag.inner_template;hypertag.reload();}else{if(Hypertag.Runtime.LoadItemEvents.length){var state=Hypertag.Runtime.LoadItemEvents.pop();debug_state[0]="LoadItemEvents";debug_state[1]=state[0].__loaditem__||state[0];state[0].fire("__loaditem__",state[1]);}else{if(Hypertag.Runtime.PreloadTagEvents.length){var hypertag=Hypertag.Runtime.PreloadTagEvents.pop();debug_state[0]="PreloadTagEvents";debug_state[1]=hypertag.__preload__||hypertag;hypertag._resolveSelectorSyntax();hypertag.fire("__preload__");}else{if(Hypertag.Runtime.LoadTagEvents.length){var hypertag=Hypertag.Runtime.LoadTagEvents.pop();debug_state[0]="LoadTagEvents";debug_state[1]=hypertag.__load__||hypertag;hypertag.fire("__load__");}else{if(Hypertag.Runtime.LoadedItemEvents.length){var state=Hypertag.Runtime.LoadedItemEvents.pop();debug_state[0]="LoadedItemEvents";debug_state[1]=state[0].__loadeditem__||state[0];state[0].fire("__loadeditem__",state[1]);}else{if(Hypertag.Runtime.LoadedTagEvents.length){var hypertag=Hypertag.Runtime.LoadedTagEvents.pop();debug_state[0]="LoadedTagEvents";debug_state[1]=hypertag.__loaded__||hypertag;hypertag.fire("__loaded__");}else{if(Hypertag.Runtime.SetupTagEvents.length){var hypertag=Hypertag.Runtime.SetupTagEvents.pop();debug_state[0]="SetupTagEvents";debug_state[1]=hypertag.__setup__||hypertag;hypertag.fire("__setup__");}else{if(Hypertag.Runtime.ReadyTagEvents.length){var hypertag=Hypertag.Runtime.ReadyTagEvents.pop();debug_state[0]="ReadyTagEvents";debug_state[1]=hypertag.__ready__||hypertag;hypertag.fire("__ready__");}else{if(Hypertag.Runtime.AfterTagEvents.length){var hypertag=Hypertag.Runtime.AfterTagEvents.pop();debug_state[0]="AfterTagEvents";debug_state[1]=hypertag.__after__||hypertag;hypertag.fire("__after__");}else{if(Hypertag.Runtime.FinallyTagEvents.length){var hypertag=Hypertag.Runtime.FinallyTagEvents.pop();debug_state[0]="FinallyTagEvents";debug_state[1]=hypertag.__finally__||hypertag;hypertag.fire("__finally__");}else{if(Hypertag.Runtime.FinishedTagEvents.length){var hypertag=Hypertag.Runtime.FinishedTagEvents.shift();debug_state[0]="FinishedTagEvents";debug_state[1]=hypertag.__finished__||hypertag;hypertag.fire("__finished__");}else{if(Hypertag.Runtime.PenultimatelyTagEvents.length){var hypertag=Hypertag.Runtime.PenultimatelyTagEvents.pop();debug_state[0]="PenultimatelyTagEvents";debug_state[1]=hypertag.__penultimately__||hypertag;setTimeout(function(hypertag){return function(){hypertag.fire("__penultimately__");};}(hypertag));}else{if(Hypertag.Runtime.UltimatelyTagEvents.length){var hypertag=Hypertag.Runtime.UltimatelyTagEvents.pop();debug_state[0]="UltimatelyTagEvents";debug_state[1]=hypertag.__ultimately__||hypertag;setTimeout(function(hypertag){return function(){hypertag.fire("__ultimately__");};}(hypertag));}else{break;}}}}}}}}}}}}}}catch(err){if(Hypertag.Debugger.exceptions.length){var final_err_msg="";for(var i=0;i<Hypertag.Debugger.exceptions.length;i++){final_err_msg+=Hypertag.Debugger.exceptions[i]+"\n";}Hypertag.Debugger.error(final_err_msg);Hypertag.Debugger.exceptions=[];}else{Hypertag.Runtime.Expanding=false;throw err;}}}Hypertag.Runtime.Expanding=false;var $target=$(target);if(Hypertag.GUI.focus){$target.find("input[type!='button'], textarea, select").blur(Hypertag.GUI.focus.blurInputMethod).focus(Hypertag.GUI.focus.focusInputMethod);if((target.getAttribute("type")=="button"&&target.tagName=="input")||target.tagName=="textarea"||target.tagName=="select"){$target.blur(Hypertag.GUI.focus.blurInputMethod).focus(Hypertag.GUI.focus.focusInputMethod);}}for(var class_name in Hypertag.Runtime.CSSTraits){$target.find(class_name).each(function(){var applied_trait_flag="_CSSTrait_"+class_name;if(!this[applied_trait_flag]){Hypertag.Runtime.CSSTraits[class_name].call(this,this);this[applied_trait_flag]=true;}});}}}catch(err){Hypertag.Runtime.Expanding=false;Hypertag.Runtime.isCompiling=false;if(Hypertag.Debugger.exceptions.length){var final_err_msg="";for(var i=0;i<Hypertag.Debugger.exceptions.length;i++){final_err_msg+=Hypertag.Debugger.exceptions[i]+"\n";}Hypertag.Debugger.error(final_err_msg);Hypertag.Debugger.exceptions=[];}else{throw err;}}};RuntimeClass.prototype.addLineNumbers=function(buf){var text_block_with_line_numbers="";var text_block_split_up=String(buf).split("\n");for(var i=0;i<text_block_split_up.length;i++){text_block_with_line_numbers+=(i+1)+": "+text_block_split_up[i]+"\n";}return text_block_with_line_numbers;};RuntimeClass.prototype.TemplateCache=function(template_name){if(template_name.indexOf("/")==-1){template_name="*/"+template_name;}if(Hypertag.Runtime.CompiledTemplateCache[template_name]!==undefined){return Hypertag.Runtime.CompiledTemplateCache[template_name];}if(Hypertag.Runtime.SavedCompiledTemplateCache&&!Hypertag.Runtime.CompiledTemplateCache[template_name]&&Hypertag.Runtime.SavedCompiledTemplateCache[template_name]){var jq_tmpl_method;try{eval("var jq_tmpl_method = "+Base64.decode(Hypertag.Runtime.SavedCompiledTemplateCache[template_name]));}catch(err){err.message="\nIn the context of the template: "+template_name+":\n\n"+err.message;throw err;}Hypertag.Runtime.CompiledTemplateCache[template_name]=jq_tmpl_method;Hypertag.Runtime.CompiledTemplateOptionsCache[template_name]=Base64.decode(Hypertag.Runtime.SavedCompiledTemplateOptionsCache[template_name]);return Hypertag.Runtime.CompiledTemplateCache[template_name];}else{if(Hypertag.Compiler){Hypertag.Compiler.ImportIntoTemplateCache(template_name);return Hypertag.Runtime.CompiledTemplateCache[template_name];}else{throw"Hypertag requires the Hypertag.Compiler system be present, as running the template "+template_name+" would require";}}};RuntimeClass.prototype.info=function(path){var data={};path=fat.normalizePath(path);var pointer=fat.reference(path);if(!pointer){console.error("info could not find",path);return false;}if(path.endswith(".compiled")){try{var file_contents=fat.read(path,false);}catch(err){throw path+" doesn't exist";}try{data=JSON.parse(file_contents);}catch(err){try{data=JSON.parse(new JSZip(file_contents,{base64:true}).file("compiled.app").data);}catch(err){try{data=JSON.parse(Base64.decode(file_contents));}catch(err){throw path+" is not readable as .compiled app.";}}}}else{if(path.endswith(".app")){data.appid=pointer.__uuid__;}else{throw"The path "+path+" was neither a .compiled or .app file";}}if(!data.apppath){data.apppath=path;}if(!data.icon){data.icon=data.icon||pointer.__icon__||"/common/Images/application/appicon.png";}if(!data.label){data.label=justFileName(pointer.__path__);}if(!data.description){data.description=data.label;}data.using=data.appid;return data;};RuntimeClass.prototype.runAsInner=function(path,initvalues,create_target){return this.run(path,initvalues,create_target,true);};RuntimeClass.prototype.run=function(path,initvalues,create_target,inner_template_flag){if(path.endswith(".app")){throw"The runtime cannot compile .app files. Please provide a .compiled file instead.";}var compiled_app=this.load(path);if(create_target!==false){return create_target?create(create_target,compiled_app.appid,initvalues,undefined,inner_template_flag):Hypertag.GUI.Desktop.addApp(path,initvalues);}else{return compiled_app.appid;}};RuntimeClass.prototype.loadFromString=function(buf){return this.load(buf,true);};RuntimeClass.prototype.load=function(path,pathIsValueFlag){var self=this;if(pathIsValueFlag!==true){if(!fat.exists(path)){return false;}var file_contents=fat.read(path,false);}else{var file_contents=path;}try{var compiled_app=JSON.parse(file_contents);}catch(err){try{var compiled_app=JSON.parse(new JSZip(file_contents,{base64:true}).file("compiled.app").data);console.log("ZIPPED COMPILED FILE! "+path);}catch(err){try{var compiled_app=JSON.parse(Base64.decode(file_contents));}catch(err){throw"Cannot load the app "+(pathIsValueFlag===true?"(from string)":path)+". May require the compilation module."+err;}}}if(!Hypertag.Runtime.CompiledTemplateCache["*/"+compiled_app.appid]){for(var full_hypertag_name in compiled_app.hypertags){var entry=compiled_app.hypertags[full_hypertag_name];var jq_tmpl_method;eval("jq_tmpl_method = "+entry.hypertag);Hypertag.Runtime.CompiledTemplateCache[full_hypertag_name]=jq_tmpl_method;var jq_tmpl_options;eval("jq_tmpl_options = "+entry.options);Hypertag.Runtime.CompiledTemplateOptionsCache[full_hypertag_name]=jq_tmpl_options;Hypertag.Runtime.ExtendsTemplateLookup[full_hypertag_name]=JSON.parse(entry.does_extend);if(entry.tagtype){Hypertag.Runtime.TemplateTagType[full_hypertag_name.toLowerCase()]=entry.tagtype;}Hypertag.Runtime.TemplateLowercaseLookup[full_hypertag_name.toLowerCase()]=full_hypertag_name;Hypertag.Runtime.TemplateReverseAliases["*/"+compiled_app.appid]=entry.name;}self._addCSSByKey(compiled_app.css,compiled_app.appid);}compiled_app.using=compiled_app.appid;return compiled_app;};RuntimeClass.prototype.tag=function(path){return this.load(path).appid;};RuntimeClass.prototype._executeJSInApp=function(javascript,app){try{console.log("    ... running global javascript for",app.data.apppath);window.eval(javascript);}catch(err){throw"Error in Javascript:\n\n"+Hypertag.Runtime.addLineNumbers(javascript)+"\n\nError executing script. Error is:\n\n"+String(err);}};RuntimeClass.prototype._addCSSByKey=function(csstext,key){var self=this;var sheet=document.createElement("style");if(Hypertag.Runtime.styles[key]){$(Hypertag.Runtime.styles[key]).remove();}Hypertag.Runtime.styles[key]=sheet;sheet.innerHTML=csstext;document.body.appendChild(sheet);return csstext;};RuntimeClass.prototype._removeCSSByKey=function(key){if(Hypertag.Runtime.styles[key]){$(Hypertag.Runtime.styles[key]).remove();delete Hypertag.Runtime.styles[key];}};RuntimeClass.prototype._loadTemplateDumpsIfAny=function(){if(this.SavedTemplateLowercaseLookup.length){for(var i=0;i<this.SavedTemplateLowercaseLookup.length;i++){copy(JSON.parse(Base64.decode(this.SavedTemplateLowercaseLookup[i])),this.TemplateLowercaseLookup);}}if(this.SavedTemplateTagType.length){for(var i=0;i<this.SavedTemplateTagType.length;i++){copy(JSON.parse(Base64.decode(this.SavedTemplateTagType[i])),this.TemplateTagType);}}if(this.SavedExtendsTemplateLookup.length){for(var i=0;i<this.SavedExtendsTemplateLookup.length;i++){copy(JSON.parse(Base64.decode(this.SavedExtendsTemplateLookup[i])),this.ExtendsTemplateLookup);}}};RuntimeClass.prototype._extractCodeblock=function(item){var codeblock="";var firsttextblock=true;var nodesToRemove=[];for(var i=0,node;(node=item.childNodes[i]);i++){if(node.nodeType==3){codeblock+=node.nodeValue;nodesToRemove.push(node);}else{if(node.nodeType==8){nodesToRemove.push(node);}}}var node;while((node=nodesToRemove.shift())){item.removeChild(node);}return codeblock;};RuntimeClass.prototype.makeElementNavigable=function(self){var references=HypertagClass.prototype._resolveParentReferences.call(self);self.parentHypertag=self.parent=references[0];self.templateroot=self.root=references[1];self.itemroot=references[2];self.directory=references[3];var elementMethods=HypertagClass.prototype;self.jsibling=elementMethods.jsibling;self.jchild=elementMethods.jchild;self.jnamed=elementMethods.jnamed;self.$sibling=elementMethods.$sibling;self.$child=elementMethods.$child;self.$named=elementMethods.$named;self.child=elementMethods.child;self.named=elementMethods.named;self.sibling=elementMethods.sibling;self.hasChild=elementMethods.hasChild;self.hasNamed=elementMethods.hasNamed;self.hasSibling=elementMethods.hasSibling;self.lookup=elementMethods.lookup;self.lookupobj=elementMethods.lookupview;self.lookupview=elementMethods.lookupview;self.lookuptag=elementMethods.lookuptemplate;self.lookuptemplate=elementMethods.lookuptemplate;self.lookupname=elementMethods.lookupname;self.lookupset=elementMethods.lookupset;self.lookuplisten=elementMethods.lookuplisten;};Hypertag.Runtime=new RuntimeClass();var HypertagClass=function(element,text_of_tag){if(element===undefined){return this;}for(var key in this){element[key]=this[key];}var $element=$(element);element.isHypertag=element;element.__super__=false;element.initialized=false;element.isReset=true;element.template=false;element.inner_template=false;element.use_inner_template=true;element.traits=[];element.extend="";element.server="*";element.autoload=true;element.autoreload=true;element.children={};element.list=false;element.filelist=false;element.filekind=false;element.filetype=false;element.evaluated_list=[];element.query={};element.__filter__=false;element.optimized=false;element.optimizedreload=false;element.optimizeditems=false;element.lazy=false;element._use_shadow_items=false;element.selectable=false;element.selectfirst=false;element.selectedItems=[];element.selection=false;element.multiselectable=true;element.linearselectable=true;element.keyselectable=false;element.keyremovable=false;element.keyremovableconfirm=false;element.verticalarrowkeys=true;element.horizontalarrowkeys=false;element.reversearrowkeys=false;element.autofocus=false;element.mouseselectable=true;element.stickyselected=false;element.reselectable=false;element.unselectable=true;element.textselectable=false;element.hoverselectable=false;element.dragselectable=false;element.toggleselect=false;element.unsetselection=true;element.autoscrollable=false;element.loopscrollable=true;element.drag=false;element.dragtemplate=false;element.drop=false;element.droponchild=false;element.droponothers=true;element.droponself=false;element.selectondrag=true;element.droponcontainer=false;element.dragdataonly=false;element.onlyaltselectable=false;element.autosized=true;element.autoanimated=false;element._autohitches=[];element._hitchestext={};element._traitsFromProperties=[];element._selectorsToResolve={};element.focusring=true;var references=element._resolveParentReferences();element.parentHypertag=element.parent=references[0];element.templateroot=element.root=references[1];element.itemroot=references[2];element.directory=references[3];var elem_name=element.getAttribute("name");if(elem_name&&element.parent){element.parent.children[elem_name]=element;}var attr_dict={};for(var i=0,attr;(attr=element.attributes[i]);i++){attr_dict[attr.nodeName]=attr.nodeValue;}elementcopy(element.scanAttributes(attr_dict,element,undefined,undefined,true),element);if(element.template){element.template_name=element.template;element.template=(element.server||"*")+"/"+element.template;}if(element.data){elementcopy(element.data,element);}if(element.template){if(!Hypertag.Runtime.CompiledTemplateCache[element.template]){Hypertag.Runtime.TemplateCache(element.template);}var tmpl_options=Hypertag.Runtime.CompiledTemplateOptionsCache[element.template].call(element,element);if(tmpl_options){if(tmpl_options.__defaults__){elementcopy(tmpl_options.__defaults__,tmpl_options);}element.mergespace(tmpl_options);var strings_to_process={};for(var key in tmpl_options){var isString=typed(tmpl_options[key],String);if(key.slice(-1)=="$"||isString||(isString&&key[0]=="$")){strings_to_process[key]=tmpl_options[key];}}copy(element.scanAttributes(strings_to_process,element),element);}tmpl_options=null;}var codeblock=text_of_tag.trim();if(codeblock.slice(-1)==","){codeblock=codeblock.slice(0,codeblock.length-1);}codeblock="{"+codeblock+"}";if(Hypertag.Runtime.debug){var result=checkDictionaryForErrors(codeblock);if(result){throw"SYNTAX ERROR: "+result+"\n\nCode is:\n\n"+Hypertag.Runtime.addLineNumbers(codeblock);}}var codeblock_function;try{eval("codeblock_function = function(self){return "+codeblock+";};");}catch(err){err.message="\nIn the context of the code:\n\n"+codeblock+"\n\n...\n\n"+err.message;throw err;}var codeblock_dict=codeblock_function.call(element,element);codeblock_function=null;element.mergespace(codeblock_dict);var strings_to_process={};for(var key in codeblock_dict){var isString=typed(codeblock_dict[key],String);if(key.slice(-1)=="$"||isString||(isString&&key[0]=="$")){strings_to_process[key]=codeblock_dict[key];}}copy(element.scanAttributes(strings_to_process,element),element);codeblock_dict=null;if(element.data){elementcopy(element.data,element);}var continue_init=element.fire("__constructing__",element);if(continue_init===false){element.forceremove();return false;}element._applyTraits();if(element.optimized){element._use_shadow_items=true;}else{if(element.lazy){element.loopscrollable=false;element._use_shadow_items=true;}}element.drop&&element._drop();if(element.autosized){element._autosizingSetup();}if(element._filelists&&element.filelist){element._filelists();}element.reload=element.list?element._reloadAsList:element._reloadAsTemplate;if(element.list){element.items=[];if(element.drag&&!element.selectable){element.selectable=[false,"none"];}if(element.list&&element.optimized){element._optimized();}else{if(element.list&&element.lazy){element._lazy();}}if(element.selectable){var ClickingMethods=Hypertag.Methods.Clicking;for(var key in ClickingMethods){element[key]=ClickingMethods[key];}if(typed(element.selectable,String)){element.selectable=stringToList(element.selectable);}if(element.autoscrollable){element._autoscrollable();}if(element.keyselectable){element._keyselectable();}if(element.hoverselectable){element._hoverselectable();}if(element.dragselectable){element._dragselectable();}}listen(element,"__filter__",function(){element._evaluateFilter();});}if(element.classes){var classes=stringToList(element.classes);for(var i=0;i<classes.length;i++){$element.addClass(classes[i]);}}if(element.autoload&&element.autoload!==true){var isHypertagEventMethod;if(typed(element.autoload,Function)){element.autoload=element.autoload();}if(!(element.autoload instanceof Array)){element.autoload=[element.autoload,"__loaded__"];}if(element.autoload[1].startsendswith("__")){isHypertagEventMethod=true;}listen(element.autoload[0],element.autoload[1],function(val){if(val||isHypertagEventMethod){element.reload();}else{element.reset();}});}Hypertag.Runtime.SetupTagEvents.push(element);if(element.template){$element.addClass(element.template_name);}if(element.autoload===true||element.autoload===undefined){Hypertag.Runtime.FirstLoadEvents.push(element);}if(element.autoreload&&element.autoreload!==true){var isHypertagEventMethod;if(typed(element.autoreload,Function)){element.autoreload=element.autoreload();}if(!(element.autoreload instanceof Array)){element.autoreload=[element.autoreload,"__loaded__"];}if(element.autoreload[1].startsendswith("__")){isHypertagEventMethod=true;}listen(element.autoreload[0],element.autoreload[1],function(val){if(val||isHypertagEventMethod){element.reload();}else{if(!element.isReset){element.reset();}}});}if(Hypertag.Runtime.debug){if(element.template){if(Hypertag.Runtime.TemplateReverseAliases&&Hypertag.Runtime.TemplateReverseAliases[element.template]){element.setAttribute("debug_template_path",Hypertag.Runtime.TemplateReverseAliases[element.template]);}else{element.setAttribute("debug_template_path",element.template);}}if(element.inner_template){if(Hypertag.Runtime.TemplateReverseAliases&&Hypertag.Runtime.TemplateReverseAliases[element.inner_template]){element.setAttribute("debug_inner_template_path",Hypertag.Runtime.TemplateReverseAliases[element.inner_template]);}}}element.fire("__constructed__",element);if(element.width&&String(element.width)[0]!="%"){$element.width(element.width);}if(element.height&&String(element.height)[0]!="%"){$element.css("height",element.height);}if(element.top&&String(element.top)[0]!="%"){$element.top(element.top);}if(element.left&&String(element.left)[0]!="%"){$element.left(element.left);}element.mergespace({__after__:element._to_do_on_reload,__finally__:element._to_do_on_reload});(element.__click__||element.__dblclick__)&&$element.singleclick(element._on_click,element._on_dblclick,element._on_mouseup);element.__mousedown__&&$element.mousedown(element._on_mousedown);element.__hover__&&$element.hover(element._on_hover_over,element._on_hover_out);element.__keyup__&&$element.keyup(element._on_keyup);element.__keydown__&&$element.keydown(element._on_keydown);element.__change__&&$element.change(element._on_change);element.autofocus&&element.mergespace({__finished__:element._on_autofocus});return element;};HypertagClass.prototype._on_autofocus=function(e){Hypertag.GUI.focus.setFocused(this);};HypertagClass.prototype._on_mousedown=function(e){var self=this;return fire(this,"__mousedown__",e)||false;};HypertagClass.prototype._on_mouseup=function(e){var self=this;return fire(this,"__mouseup__",e)||false;};HypertagClass.prototype._on_click=function(e){var self=this;return fire(this,"__click__",e)||false;};HypertagClass.prototype._on_dblclick=function(e){var self=this;return fire(this,"__dblclick__",e)||false;};HypertagClass.prototype._on_hover_over=function(e){var self=this;return fire(this,"__hover__",true,e)||false;};HypertagClass.prototype._on_hover_out=function(e){var self=this;return fire(this,"__hover__",false,e)||false;};HypertagClass.prototype._on_change=function(e){var self=this;return fire(this,"__change__",e)||false;};HypertagClass.prototype._on_keydown=function(e){var self=this;return fire(this,"__keydown__",e)||false;};HypertagClass.prototype._on_keyup=function(e){var self=this;return fire(this,"__keyup__",e)||false;};HypertagClass.prototype._to_do_on_reload=function(){var self=this;if(!self._firstAfterOccured){self._firstAfterOccured=true;return;}if((!self.initialized||!self.stickyselected)&&self.list&&self.selectfirst&&self.items.length){self.items[0].setSelection();}};HypertagClass.prototype.mergespace=function(source,element,forcechain){var self=this;element=element||self;var generateError=function(context,new_entry,err){if(!(Hypertag.Debugger.exceptions instanceof Array)){return;}if(!Hypertag.Debugger.exceptions.length){var roots=[];var root=context.template?context:context.root;while(root){var loc=root.template;if(root.directory){loc+=" at "+root.directory;}roots.push(loc);root=root.root;}roots.reverse();Hypertag.Debugger.exceptions.push(String(err)+"\n\nROOTPATH: "+roots.join(" :: ")+"\n\nIN METHOD "+key+"\n----------------------\n"+Hypertag.Runtime.addLineNumbers(String(new_entry)));}else{Hypertag.Debugger.exceptions.push("CALLED FROM "+key+"\n----------------------\n"+Hypertag.Runtime.addLineNumbers(String(new_entry)));}};for(var key in source){var new_entry=source[key];var existing_entry=element[key];if(!element.initialized||forcechain){if(typed(new_entry,Function)){if((key.slice(0,2)=="__"&&key.slice(-2)=="__")||forcechain){new_entry=function(existing_entry,new_entry,key){return function(){var retval1=undefined,retval2=undefined;if(existing_entry){retval1=existing_entry.apply(self,arguments);}try{retval2=new_entry.apply(self,arguments);}catch(err){generateError(self,new_entry,err);throw err;}return retval1!==undefined?retval1:retval2;};}(existing_entry,new_entry,key);}else{new_entry=function(existing_entry,new_entry,key){return function(){try{self.__super__=existing_entry?existing_entry:false;var ret=new_entry.apply(self,arguments);self.__super__=false;return ret;}catch(err){generateError(self,new_entry,err);throw err;}};}(existing_entry,new_entry,key);}}element[key]=new_entry;}else{if(!typed(new_entry,Function)&&!element[key]){element[key]=new_entry;}}new_entry=null;existing_entry=null;}element=null;};HypertagClass.prototype._performAutohitches=function(){var self=this;var $self=$(self);while(self._autohitches.length){var item=self._autohitches.pop();var obj=item[0],attr=item[1],hitch=item[2];try{hitch.call(self,obj[attr]);}catch(e){Hypertag.Debugger.error("HypertagOS Engine --------------------------\nHitch Error ------------\n    "+String(e)+"\n\nTarget was: "+item[3]+"\n\nXML of node is"+PrintXML(self));}}};HypertagClass.prototype._autosizingSetup=function(){var self=this;var $self=$(self);var autoduration=parseInt(self.autoduration)||Hypertag.GUI.duration;if(!self.autoanimated){var attributes_to_animate=[];}else{var attributes_to_animate=self.autoanimated===true||self.autoanimated.trim().toLowerCase()=="true"?Hypertag.Runtime.attributes_to_autohitch:stringToList(self.autoanimated);}if(attributes_to_animate.indexOf("top")!==-1){listen(self,"top",function(val){if(String(val).slice(0,1)=="%"){return;}animate(self,{top:val},autoduration||Hypertag.GUI.duration);});}else{listen(self,"top",function(val){if(String(val).slice(0,1)=="%"){return;}if("px%".indexOf(String(val).slice(-2))===-1){val+="px";}$self.top(val);});}if(attributes_to_animate.indexOf("left")!==-1){listen(self,"left",function(val){if(String(val).slice(0,1)=="%"){return;}if("px%".indexOf(String(val).slice(-2))===-1){val+="px";}animate(self,{left:val},autoduration||Hypertag.GUI.duration);});}else{listen(self,"left",function(val){if(String(val).slice(0,1)=="%"){return;}if("px%".indexOf(String(val).slice(-2))===-1){val+="px";}$self.left(val);});}if(attributes_to_animate.indexOf("opacity")!==-1){listen(self,"opacity",function(val){if(String(val).slice(0,1)=="%"){return;}animate(self,{opacity:parseFloat(val)},autoduration||Hypertag.GUI.duration);});}else{listen(self,"opacity",function(val){if(String(val).slice(0,1)=="%"){return;}$self.css("opacity",parseFloat(val));});}if(attributes_to_animate.indexOf("height")!==-1){listen(self,"height",function(val){if(String(val).slice(0,1)=="%"){return;}if("px%".indexOf(String(val).slice(-2))===-1){val+="px";}animate(self,{height:val},autoduration||Hypertag.GUI.duration);});}else{listen(self,"height",function(val){if(String(val).slice(0,1)=="%"){return;}if("px%".indexOf(String(val).slice(-2))===-1){val+="px";}$self.css("height",val);});}if(attributes_to_animate.indexOf("width")!==-1){listen(self,"width",function(val){if(String(val).slice(0,1)=="%"){return;}if("px%".indexOf(String(val).slice(-2))===-1){val+="px";}animate(self,{width:val},self.autoduration||Hypertag.GUI.duration);});}else{listen(self,"width",function(val){if(String(val).slice(0,1)=="%"){return;}if("px%".indexOf(String(val).slice(-2))===-1){val+="px";}$self.css("width",val);});}};HypertagClass.prototype.shuffleToFront=function(child){if(child){this.appendChild(child);}else{$(this).parent()[0].appendChild(this);}};HypertagClass.prototype.shuffleToBack=function(child){if(child&&this.firstChild!=child){this.insertBefore(child,this.firstChild);}else{var parent=$(this).parent()[0];parent.insertBefore(this,parent.firstChild);}};HypertagClass.prototype.shuffleItemBehind=function(child,behind){this.insertBefore(child,behind);};HypertagClass.prototype.getParentItem=function(){var node=$(this);while(node=node.parent()){if(node[0].itemlist){return node[0];}else{if(node[0]===undefined){return false;}}}};HypertagClass.prototype.lookup=function(attr,testfunc){if(testfunc&&!typed(testfunc,Function)){eval("testfunc = function(self){return "+testfunc+"};");}var scope=this;while(scope){if(scope[attr]&&(testfunc===undefined||testfunc.call(scope,scope))){return scope[attr];}else{scope=scope.parentHypertag;}}return false;};HypertagClass.prototype.lookupview=function(attr,testfunc){if(testfunc&&!typed(testfunc,Function)){eval("testfunc = function(self){return "+testfunc+"};");}var scope=this.parentHypertag;while(scope){if(scope[attr]&&(testfunc===undefined||testfunc.call(scope,scope))){return scope;}else{scope=scope.parentHypertag;}}return false;};HypertagClass.prototype.lookupobj=HypertagClass.prototype.lookupview;HypertagClass.prototype.lookupname=function(tag_name,testfunc){if(testfunc&&typed(testfunc,Function)){eval("testfunc = function(self){return "+testfunc+"};");}var scope=this.parentHypertag;while(scope){var name=scope.name;if(name==tag_name&&(!testfunc||testfunc.call(scope,scope))){return scope;}else{scope=scope.parentHypertag;}}return false;};HypertagClass.prototype.lookuptemplate=function(tagname,testfunc){if(testfunc&&typed(testfunc,Function)){eval("testfunc = function(self){return "+testfunc+"};");}var scope=this.parentHypertag;while(scope){if(!scope.template){scope=scope.parentHypertag;}else{var template=scope.template.slice(0,2)=="*/"?scope.template.slice(2):scope.template;if(template&&template.toLowerCase()==tagname.toLowerCase()&&(!testfunc||testfunc.call(scope,scope))){return scope;}else{scope=scope.parentHypertag;}}}return false;};HypertagClass.prototype.lookuptag=HypertagClass.prototype.lookuptemplate;HypertagClass.prototype.lookupset=function(attr,testfuncOrValue,value){var scope=this.parentHypertag;if(value!==undefined&&!typed(testfuncOrValue,Function)){eval("testfuncOrValue = function(self){return "+testfuncOrValue+"};");}while(scope){if(scope[attr]&&((testfuncOrValue!==undefined&&value!==undefined&&testfuncOrValue.call(scope,scope))||(value===undefined))){set(scope,attr,value!==undefined?value:testfuncOrValue);return scope;}else{scope=scope.parentHypertag;}}return false;};HypertagClass.prototype.lookuplisten=function(attr,method,test_func){var self=this;if(test_func!==undefined&&!typed(test_func,Function)){eval("testfuncOrValue = function(self){return "+test_func+"};");}var scope=this.parentHypertag;while(scope){if(scope[attr]&&(test_func===undefined||testfuncOrValue.call(scope,scope))){self.listen(scope,attr,method);return scope;}else{scope=scope.parentHypertag;}}return false;};HypertagClass.prototype._getTemplateroot=function(){var node=$(this);while(node=node.parent()){if(node[0]===undefined){return false;}var possible_hypertag_element=node[0];if(possible_hypertag_element.isHypertag){if(possible_hypertag_element.template){return possible_hypertag_element;}else{if(possible_hypertag_element.root){return possible_hypertag_element.root;}}}}};HypertagClass.prototype._applyTraits=function(){var self=this;var $self=$(self);self.traits=stringToList(self.traits);self._applied_traits=[];for(var i=0;i<self.traits.length;i++){self._applied_traits.pushUniquely(self.traits[i].indexOf("/")==-1?"*/"+self.traits[i]:self.traits[i]);}for(var i=0;i<self._traitsFromProperties.length;i++){self._applied_traits.pushUniquely(self._traitsFromProperties[i].indexOf("/")==-1?"*/"+self._traitsFromProperties[i]:self._traitsFromProperties[i]);}self._traitsFromProperties=[];if(self.template){var name_to_use=self.template.indexOf("/")==-1?"*/"+self.template:self.template;var extend_by=Hypertag.Runtime.ExtendsTemplateLookup[name_to_use]||[];for(var i=0;i<extend_by.length;i++){self._applied_traits.push(extend_by[i]);}}for(var i=0;i<self._applied_traits.length;i++){var server_and_name=self._applied_traits[i];if(!Hypertag.Runtime.CompiledTemplateCache[server_and_name]){Hypertag.Runtime.TemplateCache(server_and_name);}var properties=Hypertag.Runtime.CompiledTemplateOptionsCache[server_and_name]?Hypertag.Runtime.CompiledTemplateOptionsCache[server_and_name].call(self,self):{};self.mergespace(properties);var strings_to_process={};for(var key in properties){var isString=typed(properties[key],String);if(isString||key.slice(-1)=="$"||isString&&key[0]=="$"){strings_to_process[key]=properties[key];}}copy(self.scanAttributes(strings_to_process,self),self);for(var j=0;j<self._traitsFromProperties.length;j++){self._applied_traits.pushUniquely(self._traitsFromProperties[j].indexOf("/")==-1?"*/"+self._traitsFromProperties[j]:self._traitsFromProperties[j]);}self._traitsFromProperties=[];if(properties.classes){var classes=stringToList(properties.classes);for(var i=0;i<classes.length;i++){$self.addClass(classes[i]);}}}$self.addClass(self._applied_traits);};HypertagClass.prototype._autoscrollable=function(){var self=this;self.mergespace({__init__:function(){$(self).addClass("rel");},__selection__:function(elem){self._pauseScrollUpdating=true;var $self=$(self.autoscrollable!==true?self.autoscrollable:self);var container_height=self.height||$self.height();var elem_height=self.optimized?self.optimized[1]:elem.height||$(elem).height();var elem_offsetTop=self.optimized?elem_height*elem.data.i:elem.offsetTop;if(self.scrollTop-elem_offsetTop>0||self.scrollTop+container_height-elem_height<elem_offsetTop){if(elem_height>=container_height){var where_to=elem_offsetTop+5;}else{var where_to=elem_offsetTop-(container_height/2)+(elem_height/2);}}animate(self,{scrollTop:where_to},Hypertag.GUI.duration/2);self._pauseScrollUpdating=false;}});};HypertagClass.prototype._reloadAsTemplate=function(data){var self=this;var $self=$(self);data=data||{};if(!(data instanceof Object)){data={item:data};}if(!self.initialized){data=self.fire("__init__",data||self.data)||data;}else{data=self.fire("__reloading__",data||self.data)||data;}if(self.initialized&&!self.isReset){self.reset(true);}self.set("isReset",false);self._reevaluateOptions(data);data=self.fire("__preloading__",data||self.data)||data;data=self.fire("__loading__",data||self.data)||data;self._reevaluateOptions(data);self.evaluated_list=[self];try{var new_item=createJQueryTemplateUsingHypertag_andData_at(self,self,self)[0];}catch(e){throw"(an error occurred)\nTemplate Name: "+(self.template||self.inner_template)+"\n"+e+"\n\nHTML of target is: "+$("<div></div>").append(self.parent).html();}if(self.template){$self.addClass(self.template_name);}if(!self.initialized&&self.autoload!==true&&self.classes){var classes=stringToList(self.classes);for(var i=0;i<classes.length;i++){$self.addClass(classes[i]);}}self._initHypertag();return self;};HypertagClass.prototype._resolveSelectorSyntax=function(){var self=this;var $self=$(self);for(var propname in self._selectorsToResolve){var selector_info=self._selectorsToResolve[propname];var propvalue=selector_info[0];var deref=selector_info[1];try{var ref=$self.find(propvalue);self[propname]=deref?ref[0]:ref;}catch(err){Hypertag.Debugger.error("Could not find the element given by the selector specified as "+propvalue+".\n\nError: "+err);}}};HypertagClass.prototype._reloadAsList=function(data,overrideListData){var self=this;data&&copy(data,self);if(typed(self.list,String)&&!overrideListData){$.ajax({url:self.list,async:true,complete:function(response){try{var listobj=JSON.parse(response.responseText);}catch(err){Hypertag.Debugger.error("Parsing JSON from url '"+self.list+"' had a problem: "+String(err)+". The text was:\n\n"+response.responseText+"\n---- end bad json");return self;}listobj&&self.reload(undefined,listobj);}});return self;}if(!self.initialized){var classes=stringToList(self.classes);if(self.autoload!==true&&self.classes){for(var i=0;i<classes.length;i++){$(self).addClass(classes[i]);}}data=self.fire("__init__",data)||data;}var was_selected=[];if(self.initialized){data=self.fire("__reloading__",data)||data;if(self.stickyselected&&self.selectedItems.length){for(var i=0;i<self.selectedItems.length;i++){was_selected.push(deepcopyitem(self.selectedItems[i].data,{}));}}if(self.optimized&&self.optimizedreload){self._optimizedRemove();}else{if(!self.isReset){self.reset(true);}}}self.set("isReset",false);if(this.selectedItems){this.selectedItems=[];}self.items=new Array;self._reevaluateOptions(data);data=self.fire("__preloading__",data)||data;data=self.fire("__loading__",data)||data;self._reevaluateOptions(data);if(typed(self.selectable,String)){self.selectable=stringToList(self.selectable);}if(self.template){Hypertag.Runtime.TemplateCache(self.template);}var list=overrideListData||self.list;if(typed(list,Function)){list=list.call(self,self);}if(!(list instanceof Array)){list=[list];}list=self._prepareListItems(list);self.evaluated_list=list;self._createItemsFromObjs(list);self._initHypertag();if(was_selected.length){self._stickySelectedMethod(was_selected);}return self;};HypertagClass.prototype._stickySelectedMethod=function(was_selected){var self=this;for(var i=0;i<was_selected.length;i++){for(var key in was_selected[i]){if(was_selected[i][key] instanceof Object){delete was_selected[i][key];}}if(was_selected[i].i!==undefined){delete was_selected[i].i;}var item=self.findItem(was_selected[i]);if(item){item.uneventfulSelect();}}};HypertagClass.prototype._reevaluateOptions=function(data){var self=this;if(!self.data){self.data={};}if(!self.initialized){var skipAttrs=self.autoload&&!self.initialized?["template","inner_template"]:[];var attr_dict={};for(var i=0,attr;(attr=self.attributes[i]);i++){if(skipAttrs.indexOf(attr.nodeName)===-1){attr_dict[attr.nodeName]=attr.nodeValue;}}elementcopy(self.scanAttributes(attr_dict,self,false,undefined,true),self);}if(data){elementcopy(data,self.data);elementcopy(self.data,self);}return self;};HypertagClass.prototype._initItem=function(item,obj,doNotAddToChildren){var self=this;if(obj===undefined){obj={};}if(!item){throw"A template is empty - at least one node required. template:\n"+self.template;}item.itemlist=self;item.data=obj;item.data.self=self;item.root=item.itemlist.root;item.directory=item.itemlist.directory;if(doNotAddToChildren===undefined){self.items.push(item);}var DataMethods=Hypertag.Methods.Data;for(var key in DataMethods){item[key]=DataMethods[key];}if(item.ELEMENT_NODE!==undefined){if(item.classes){var classes=stringToList(item.classes);for(var i=0;i<classes.length;i++){$(item).addClass(classes[i]);}}item.jchild=self.jchild;item.jnamed=self.jnamed;item.jsibling=self.jsibling;item.$child=self.$child;item.$named=self.$named;item.$sibling=self.$sibling;item.child=self.child;item.named=self.named;item.sibling=self.sibling;item.hasChild=self.hasChild;item.hasNamed=self.hasNamed;item.hasSibling=self.hasSibling;if(self.selectable){self._selectableItem(item);}if(self.drag){self._dragItem(item);}if(self.droponchild){self._dropChild(item);}if(self.selectable[2]){$(item).addClass(self.selectable[2]);}if(!self._use_shadow_items){Hypertag.Runtime.LoadItemEvents.push([self,item]);Hypertag.Runtime.LoadedItemEvents.push([self,item]);}Hypertag.Runtime.ExpandHypertags(item);}else{if(self.selectable){var SelectingMethods=Hypertag.Methods.Selecting;for(var key in SelectingMethods){item[key]=SelectingMethods[key];}}}return item;};HypertagClass.prototype._createItemsFromObjs=function(objs){var self=this;if(self.template&&self.template.indexOf("*")==-1){self.template_name=self.template;self.template=(self.server||"*")+"/"+self.template;}try{var new_objs=[];self.items=[];for(var i=0;i<objs.length;i++){var new_obj=copy(objs[i],{});new_obj.i=i;if(!self._use_shadow_items){if(self.__preloadingitem__){new_obj=self.__preloadingitem__(new_obj)||new_obj;}if(self.__loadingitem__){new_obj=self.__loadingitem__(new_obj)||new_obj;}}new_objs.push(new_obj);}if(self._use_shadow_items){for(var i=0;i<new_objs.length;i++){var obj_to_use={selected:false,itemlist:self};new_objs[i].self=new_objs[i];self._initItem(obj_to_use,new_objs[i]);}}else{var new_items=createJQueryTemplateUsingHypertag_andData_at(self,new_objs,self);if(!new_items){return;}if(new_items.length!=new_objs.length){throw"A list-hypertag whos template-to-use has more then one top level node has been found. Templates used in a list mode hypertag may only have one top level element, at template: "+self.template+self.inner_template+"\n\nDir of new_items"+dir(new_items);}for(var i=0;i<new_items.length;i++){self._initItem(new_items[i],new_objs[i]);}}}catch(err){throw"An error in a template ("+(self.template||"anonymous template")+" most likely), is: \n"+err+"\n\n whos html is:\n\n"+$("<div></div>").append(self).html();}};HypertagClass.prototype._updateItemsUsingObjs=function(updated_items,objs){var items_to_be_removed=[];var new_items=new Array;for(var i=0;i<objs.length;i++){if(objs[i]===false){new_items.push(updated_items[i]);}else{if(typed(objs[i],Object)&&getkeys(objs[i]).length){new_items.push(updated_items[i].refresh(objs[i]));}else{items_to_be_removed.push(updated_items[i]);}}}for(var i=0;i<items_to_be_removed.length;i++){items_to_be_removed[i].remove();}return new_items;};HypertagClass.prototype._initHypertag=function(){var self=this;var $self=$(self);Hypertag.Runtime.PreloadTagEvents.push(self);Hypertag.Runtime.LoadTagEvents.push(self);Hypertag.Runtime.LoadedTagEvents.push(self);Hypertag.Runtime.AfterTagEvents.push(self);if(self.drop&&typed(self.drop,String)){self.drop=stringToList(self.drop);}if(self.drag&&typed(self.drag,String)){self.drag=stringToList(self.drag);}if(!self.initialized){Hypertag.Runtime.ReadyTagEvents.push(self);Hypertag.Runtime.FinallyTagEvents.push(self);Hypertag.Runtime.FinishedTagEvents.push(self);Hypertag.Runtime.PenultimatelyTagEvents.push(self);Hypertag.Runtime.UltimatelyTagEvents.push(self);self._performAutohitches();if(["TEXTAREA","INPUT"].indexOf(self.tagName.toUpperCase())!==-1){$self.addClass("selectable");}else{if(self.selectable&&self.textselectable===false){$self.addClass("notselectable");}else{$self.addClass("textselectable");}}}if(self.__filter__){send(self,"__filter__");}Hypertag.Runtime.ExpandHypertags(self);self.initialized=true;};HypertagClass.prototype.forceremove=function(){this.remove(true);};HypertagClass.prototype.removeItems=function(elements){if(!(elements instanceof Array)){elements=[elements];}elements=copy(elements,[]);for(var i=0;i<elements.length;i++){elements[i].remove(undefined,true);}this.fire("__subtracted__",[elements]);this.fire("__changed__",[elements]);};HypertagClass.prototype.remove=function(erase_unconditionally,uneventfully){var self=this;var result=removeAllDescendantListensFrom(self,erase_unconditionally);if(erase_unconditionally||result!==false){if(self.itemlist&&self.itemlist!=self){if(self.selected){self._removeFromSelected();}var items=[];for(var i=0;i<self.itemlist.items.length;i++){if(self.itemlist.items[i]!=self){items.push(self.itemlist.items[i]);}}self.itemlist.items=items;self.itemlist.renumberItems();}$(self).remove();if(self.itemlist&&self.itemlist!=self&&uneventfully!==true){self.itemlist.fire("__subtracted__",[self]);self.itemlist.fire("__changed__",[self]);}}};HypertagClass.prototype.set=function(attr){var args=[this,attr];for(var i=1;i<arguments.length;i++){args.push(arguments[i]);}set.apply(this,args);};HypertagClass.prototype.ensure=function(attr,val){return ensure(this,attr,val);};HypertagClass.prototype.toggle=function(attr){return toggle(this,attr);};HypertagClass.prototype.is=function(attr){return is(this,attr);};HypertagClass.prototype.isnt=function(attr){return isnt(this,attr);};HypertagClass.prototype.unset=function(attr){return unset(this,attr);};HypertagClass.prototype.send=function(attr,value){var args=[this,attr];for(var i=1;i<arguments.length;i++){args.push(arguments[i]);}send.apply(this,args);};HypertagClass.prototype.fire=function(attr,value){var args=[this,attr];for(var i=1;i<arguments.length;i++){args.push(arguments[i]);}return fire.apply(this,args);};HypertagClass.prototype.listen=function(obj,attr,method,context){if(GLOBAL.FATObject&&obj instanceof FATObject){fat.listen(obj.path(),attr,method,context?context:this);}else{if(obj instanceof Object){listen(obj,attr,method,context,this);}else{fat.listen(obj,attr,method,context?context:this);}}};HypertagClass.prototype.listenNow=function(obj,attr,method,context){if(obj instanceof FATObject){fat.listenNow(obj.path(),attr,method,context?context:this);}else{if(obj instanceof Object){listenNow(obj,attr,method,context,this);}else{fat.listenNow(obj,attr,method,context?context:this);}}};HypertagClass.prototype.forcereset=function(){this.reset(true);};HypertagClass.prototype.reset=function(erase_unconditionally){var self=this;var result=removeAllDescendantListensFrom(self,erase_unconditionally,"__reset__");if(result!==false){$(self).empty();self.set("isReset",true);}};var removeAllDescendantListensFrom=function(target,erase_unconditionally,eventtype){if(eventtype===undefined){eventtype="__removing__";}var all_items=[target];var item;while(item=all_items.shift()){if(!erase_unconditionally&&item[eventtype]){if(fire(item,eventtype,item)===false){return false;}}var children=$.makeArray(item.childNodes);for(var i=0,node;(node=children[i]);i++){if(node.nodeType==1){all_items.unshift(node);}}if(eventtype=="__removing__"){fire(item,"__remove__",item);}if(item.release){item.release();}if(eventtype=="__removing__"&&item._hitchBindings&&item._hitchBindings.release){item._hitchBindings.release();}if(eventtype!="__reset__"){if(item.__listeners__){for(var key in item.__listeners__){item.__listeners__[key]=null;}}if(item.__listening__){for(var key in item.__listening__){item.__listening__[key]=null;}}if(item.data){for(var key in item.data){item.data=null;}item.data=null;}if(item.isHypertag){var name=item.getAttribute("name");if(name&&item.parent&&item.parent.children&&item.parent.children[name]){delete item.parent.children[name];}HypertagClass.prototype.mergespace({__deleteSelf__:_deleteSelf},item,true);item.__deleteSelf__();item.parent=item.parentHypertag=null;item.templateroot=item.root=null;item.itemroot=null;item.directory=null;item.items=[];for(var key in item){if(key.startsendswith("__")){item[key]=false;}}item.isHypertag=null;}}eventtype="__removing__";erase_unconditionally=true;item=null;}return true;};var _deleteSelf=function(){self=null;};HypertagClass.prototype._resolveParentReferences=function(){var node=this,self=this;var root,itemroot,parentHypertag,directory;if(self.itemlist){itemroot=false;}var nodesontheway=[];while(1){node=node.parentNode;nodesontheway.push(node);if(!node||(root!==undefined&&itemroot!==undefined&&parentHypertag!==undefined)){return[parentHypertag,root,itemroot,directory];}if(itemroot===undefined&&node.itemlist){itemroot=node;}if(parentHypertag===undefined&&node.isHypertag){parentHypertag=node;directory=node.directory;}if(root===undefined&&node.isHypertag){if(node.template){root=node;}else{if(node.root){root=node.root;}}}}};HypertagClass.prototype.child=function(names){return $(this).child(names);};HypertagClass.prototype.named=function(names){return $(this).named(names);};HypertagClass.prototype.sibling=function(names){return $(this).sibling(names);};HypertagClass.prototype.jchild=function(names){return $(this).jchild(names);};HypertagClass.prototype.jnamed=function(names){return $(this).jnamed(names);};HypertagClass.prototype.jsibling=function(names){return $(this).jsibling(names);};HypertagClass.prototype.$child=function(names,tagtype){return $(this).$child(names);};HypertagClass.prototype.$named=function(names){return $(this).$named(names);};HypertagClass.prototype.$sibling=function(names,tagtype){return $(this).$sibling(names);};HypertagClass.prototype.indexOf=function(elem){return this.items.indexOf(elem);};HypertagClass.prototype.hasChild=function(names,tagtype){return $(this).hasChild(names);};HypertagClass.prototype.hasNamed=function(names){return $(this).hasNamed(names);};HypertagClass.prototype.hasSibling=function(names,tagtype){return $(this).hasSibling(names);};HypertagClass.prototype.findItems=function(testdict,oneach,breakOnFirstFlag){if(!this.list){throw"findItems is being called on a non-list hypertag.";}var found_items=[];for(var i=0;i<this.items.length;i++){var found=true;for(var key in testdict){if(testdict[key]===undefined){continue;}if(this.items[i].data[key]!=testdict[key]){found=false;break;}}if(found){found_items.push([this.items[i],i]);if(breakOnFirstFlag){break;}}}if(oneach){for(var i=0;i<found_items.length;i++){oneach.call(self,found_items[i][0],found_items[i][1]);}}var output=[];for(var i=0;i<found_items.length;i++){output.push(found_items[i][0]);}return output;};HypertagClass.prototype.findItem=function(testdict,oneach){var result=this.findItems(testdict,oneach,true);return result.length?result[0]:false;};HypertagClass.prototype.dataFromItems=function(filterkeys){var data=[];if(filterkeys!==undefined){filterkeys=stringToList(filterkeys);}var items=this.items;for(var i=0;i<items.length;i++){var json_item=copy(items[i].data,{});if(json_item.self){delete json_item.self;}if(json_item.itemlist){delete json_item.itemlist;}if(filterkeys!==undefined){for(var key in json_item){if(filterkeys.indexOf(key)===-1){delete json_item[key];}}}data.push(json_item);}return data;};HypertagClass.prototype.dataFromSelected=function(filterkeys){var data=[];filterkeys=stringToList(filterkeys);var items=this.selectedItems;for(var i=0;i<items.length;i++){var json_item=copy(items[i].data,{});if(json_item.self){delete json_item.self;}if(json_item.itemlist){delete json_item.itemlist;}if(filterkeys!==undefined){var to_push={};for(var i=0;i<filterkeys.length;i++){to_push[filterkeys[i]]=json_item[filterkeys[i]];}}data.push(json_item);}return data;};HypertagClass.prototype.renumberItems=function(rangenum){if(rangenum===undefined){var start=0;var end=this.items.length-1;}else{var start=rangenum;var end=this.items.length-1;}for(var i=start;i<end;i++){if(this.items[i]===undefined){continue;}this.items[i].i=i;this.items[i].data.i=i;}};HypertagClass.prototype.create=function(template_name,data,server,inner_template_flag){return create(this,template_name,data,server,inner_template_flag);};HypertagClass.prototype.createItem=function(template_name,data){return createItem(this,template_name,data);};HypertagClass.prototype.createUnaddedItem=function(template_name,data){return createItem(this,template_name,data,true);};HypertagClass.prototype.dataFromInputs=function(){var self=this;var $self=$(self);var objs={};$self.find("input[type=field]").each(function(){if(this["name"]){objs[this.name]=$(this).val();}});$self.find("input[type=password]").each(function(){if(this["name"]){objs[this.name]=$(this).val();}});$self.find("select").each(function(){if(this["name"]){objs[this.name]=$(this).val();}});return objs;};HypertagClass.prototype.dataToInputs=function(data){var self=this;if(!data){data=self.data;}for(var key in data){var items=$(self).find("[name="+key+"]");for(var i=0;i!=items.length;i++){if(items[i].getAttribute("type")=="field"){$(items[i]).val(data[key]);}else{$(items[i]).text(data[key]);}}}};HypertagClass.prototype.markItemsForDelete=function(items){for(var i=0;i<items.length;i++){items[i].data.__delete__=true;}return items;};HypertagClass.prototype._evaluateFilter=function(){var self=this;if(!self.__filter__){self.__filter__=function(x){return true;};}for(var i=0;i<self.items.length;i++){if(!self.__filter__(self.items[i])){if(self.items[i].selected){self.items[i].unselect();}$(self.items[i]).addClass("hidden");}else{$(self.items[i]).removeClass("hidden");}}};HypertagClass.prototype._prepareListItems=function(initial_values){if(initial_values===undefined){initial_values=[{}];}else{if(!(initial_values instanceof Array)){initial_values=[initial_values];}else{initial_values=copy(initial_values);}}for(var i=0;i<initial_values.length;i++){if(initial_values[i]&&initial_values[i].itemlist){initial_values[i]=initial_values[i].data;}else{if(initial_values[i].constructor!==Object){initial_values[i]={item:initial_values[i]};}}}return initial_values;};HypertagClass.prototype.appendItems=HypertagClass.prototype.addItems=function(initial_values,uneventfully){var self=this;var new_item;var output_items=[];initial_values=self._prepareListItems(initial_values);for(var i=0;i<initial_values.length;i++){var new_obj={};var data_from_entry=initial_values[i];copy(data_from_entry,new_obj);new_obj.i=self.items.length;if(self._use_shadow_items&&self.lazyreversed&&!self._lazyreversedLoaded){var new_item={data:new_obj,selected:false};}else{if(self._use_shadow_items&&!self.lazyreversed&&self.items[self.items.length-1]&&self.items[self.items.length-1].ELEMENT_NODE===undefined){var new_item={data:new_obj,selected:false};}else{if(self.__preloadingitem__){new_obj=self.__preloadingitem__(new_obj)||new_obj;}if(self.__loadingitem__){new_obj=self.__loadingitem__(new_obj)||new_obj;}try{var new_item=createJQueryTemplateUsingHypertag_andData_at(self,new_obj,self)[0];if(!new_item){var msg="No template or anonymous template provided when loading a template from URL, at: "+$("<div></div>").append(self).html();}}catch(e){throw"error in template: "+e+" in "+self.template+"\n\n(not having a template defined can cause this too)";}}}output_items.push(new_item);self._initItem(new_item,new_obj);if(self.selectable&&self.selectnew){self.items[self.items.length-1].setSelection();$(self.container).scrollToBottom();}}if(uneventfully!==true){self.fire("__added__",output_items);self.fire("__changed__",output_items);}return output_items.length>1?output_items:output_items[0];};HypertagClass.prototype.appendItemsUniquely=HypertagClass.prototype.addItemsUniquely=function(initial_values,uneventfully){var self=this;initial_values=self._prepareListItems(initial_values);var deduplicated_items_to_make=[];for(var i=0;i<initial_values.length;i++){var item=initial_values[i].ELEMENT_NODE?initial_values[i].data:initial_values[i];var compare_item=deepcopyitem(item);for(var key in compare_item){if(compare_item[key] instanceof Object){delete compare_item[key];}}if(compare_item.i!==undefined){delete compare_item.i;}if(!self.findItem(compare_item)){deduplicated_items_to_make.push(item);}}return self.appendItems(deduplicated_items_to_make,uneventfully);};HypertagClass.prototype.prependItems=function(initial_values,uneventfully){var self=this;var new_item;var output_items=[];initial_values=self._prepareListItems(initial_values);for(var i=0;i<initial_values.length;i++){var new_obj={};var data_from_entry=initial_values[i];copy(data_from_entry,new_obj);if(self._use_shadow_items&&self.items[0]&&self.items[0].ELEMENT_NODE===undefined){var new_item={data:new_obj,selected:false};}else{if(self.__preloadingitem__){new_obj=self.__preloadingitem__(new_obj)||new_obj;}if(self.__loadingitem__){new_obj=self.__loadingitem__(new_obj)||new_obj;}try{var new_item=createJQueryTemplateUsingHypertag_andData_at(self,new_obj,self,false)[0];if(!new_item){var msg="No template or anonymous template provided when loading a template from URL, at: "+$("<div></div>").append(self).html();}}catch(e){throw"error in template: "+e+" in "+self.template+"\n\n(not having a template defined can cause this too)";}}self.items.insert(new_item,0);self.renumberItems();self._initItem(new_item,new_obj,true);output_items.push(new_item);}if(uneventfully!==true){self.fire("__added__",output_items);self.fire("__changed__",output_items);}return output_items.length>1?output_items:output_items[0];};HypertagClass.prototype.prependItemsUniquely=function(initial_values,uneventfully){var self=this;initial_values=self._prepareListItems(initial_values);var deduplicated_items_to_make=[];for(var i=0;i<initial_values.length;i++){var item=initial_values[i].ELEMENT_NODE?initial_values[i].data:initial_values[i];var compare_item=deepcopyitem(item);for(var key in compare_item){if(compare_item[key] instanceof Object){delete compare_item[key];}}if(compare_item.i!==undefined){delete compare_item.i;}if(!self.findItem(compare_item)){deduplicated_items_to_make.push(item);}}return self.prependItems(deduplicated_items_to_make,uneventfully);};Hypertag.Methods.Data={};Hypertag.Methods.Data.sortBy=function(key,direction){if(self.selectable&&self.selectedItems.length){self.unselectAll();}if(self.initialized&&!self.isReset){self.reset(true);}self.set("isReset",false);self.items=new Array;var sortedFields=new Array;if(direction){this._sort_direction=direction;}for(var i=0;i<this.items.length;i++){sortedFields.push([this.items[i].data[key],this.items[i].data]);}sortedFields.sort();if(!this._sort_direction){sortedFields.reverse();}var newObjs=new Array;for(var i=0;i<sortedFields.length;i++){newObjs.push(sortedFields[i][1]);}this._createItemsFromObjs(newObjs);this._sort_direction=!this._sort_direction;};Hypertag.Methods.Data.remove=HypertagClass.prototype.remove;Hypertag.Methods.Data.forceremove=HypertagClass.prototype.forceremove;HypertagClass.prototype.moveItems=function(items,child){var self=this;if(!(items instanceof Array)){items=[items];}if(child&&child!=self.items[self.items.length-1]){for(var i=0;i!=items.length;i++){self.insertBefore(items[i],child);}if(self.list){for(var i=0;i!=items.length;i++){self.items.remove(self.items.indexOf(items[i]));self.items.insert(items[i],Math.min(self.items.indexOf(child),self.items.length-1));}}}else{for(var i=0;i!=items.length;i++){self.appendChild(items[i]);}if(self.list){for(var i=0;i!=items.length;i++){self.items.remove(self.items.indexOf(items[i]));self.items.push(items[i]);}}}self.renumberItems();self.fire("__changed__");};HypertagClass.prototype.insertItems=function(objs,elem,uneventfully){var output_items=[];var self=this;var firstidx;if(typed(elem,Number)){firstidx=elem;elem=self.items[elem];}else{firstidx=self.items.indexOf(elem);}objs=self._prepareListItems(objs);for(var i=0;i<objs.length;i++){var were_selected=self.selectedItems;self.unselectAll();var idx=firstidx+i;var new_obj={i:idx};copy(objs[i],new_obj);if(self._use_shadow_items&&(!self._lazyreversedLoaded||!self.items[firstidx+i].ELEMENT_NODE)){var new_item={data:new_obj,selected:false};}else{if(self.__preloadingitem__){new_obj=self.__preloadingitem__(new_obj)||new_obj;}if(self.__loadingitem__){new_obj=self.__loadingitem__(new_obj)||new_obj;}try{var new_item=createJQueryTemplateUsingHypertag_andData_at(self,new_obj,elem,true)[0];if(!new_item){throw"No template or anonymous template provided when inserting a template at: "+$("<div></div>").append(self).html();}}catch(e){throw"error in __template__: "+e+" in "+self.template+"\n\n(not having a template defined can cause this too)";}}output_items.push(new_item);self._initItem(new_item,new_obj,true);self.items.insert(new_item,firstidx+i);}self.renumberItems(firstidx);if(uneventfully!==true){self.fire("__added__",output_items);self.fire("__changed__");}return output_items.length>1?output_items:output_items[0];};Hypertag.Methods.Data.getData=function(){var self=this;var data=copy(self.data);delete data.i;delete data.self;return data;};Hypertag.Methods.Data.refresh=function(data){data&&copy(data,this.data);if(this._undergoingRefresh){return false;}this._undergoingRefresh=true;this.data=fire(this,"__reloading__",this.data)||this.data;var was_selection=this.itemlist.selection==this;var was_selected=this.selected?true:false;if(was_selected){this._removeFromSelected();}var idx=this.itemlist.items.indexOf(this);var new_obj={i:idx};copy(this.data,new_obj);if(!this.ELEMENT_NODE){var new_item={data:new_obj,selected:this.selected};}else{if(this.itemlist.__preloadingitem__){new_obj=this.itemlist.__preloadingitem__(new_obj)||new_obj;}if(this.itemlist.__loadingitem__){new_obj=this.itemlist.__loadingitem__(new_obj)||new_obj;}try{var new_item=createJQueryTemplateUsingHypertag_andData_at(this.itemlist,new_obj,this,true)[0];if(!new_item){throw"No template or anonymous template provided when inserting a template at: "+$("<div></div>").append(this.itemlist).html();}}catch(e){throw"error in __template__: "+e+" in "+self.template+"\n\n(not having a template defined can cause this too)";}removeAllDescendantListensFrom(this,true);$(this).remove();}this.itemlist.items[idx]=this.itemlist._initItem(new_item,new_obj,true);if(was_selection){new_item.uneventfulSelection();}else{if(was_selected){new_item.uneventfulSelect();}}this.itemlist.fire("__changed__",[new_item]);this._undergoingRefresh=false;return new_item;};HypertagClass.prototype._lazy=function(){var self=this;self.mergespace({__init__:function(){self.lazy=self.lazy===true?"height":self.lazy;self._atScrollBoundary=true;$(self).addClass("rel");$(self).scroll(self.updateLazyItems);if(self.addEventListener){self.addEventListener("mousewheel",self.updateVisibleItems,false);}else{self.onmousewheel=self.updateLazyItems;}listen(self,self.lazy,function(){self.updateLazyItems();});},__load__:function(){self._lazyIndex=self.lazyreversed?self.items.length-1:0;self._lazyreversedLoaded=false;self._atScrollBoundary=true;},__after__:function(){self.updateLazyItems();},__changed__:function(){self.updateLazyItems();},__subtracted__:function(){self._lazyIndex=Math.max(self._lazyIndex-1,0);},createLazyItem:function(){var shadow_item=self.items[self._lazyIndex];if(shadow_item&&shadow_item.ELEMENT_NODE===undefined){var process_flag=self.fire("__lazyitem__",self._lazyIndex);if(process_flag!==false){var new_data=shadow_item.data;if(self.__preloadingitem__){shadow_item.data=self.__preloadingitem__(shadow_item.data)||shadow_item.data;}if(self.__loadingitem__){shadow_item.data=self.__loadingitem__(shadow_item.data)||shadow_item.data;}var template=self.inner_template&&self.use_inner_template?self.inner_template:self.template;shadow_item.itemlist=self;shadow_item.data.self=self;var new_item=self.createUnaddedItem(template,shadow_item.data);self.items[self._lazyIndex]=new_item;var $new_item=$(new_item);Hypertag.Runtime.LoadItemEvents.push([self,new_item]);Hypertag.Runtime.LoadedItemEvents.push([self,new_item]);if(self.selection===shadow_item){self.selection=new_item;}if(self.selectable&&shadow_item.selected){new_item.selected=true;var selected_idx=self.selectedItems.indexOf(shadow_item);self.selectedItems[selected_idx]=new_item;$new_item.addClass(self.selectable[1]);}else{if(self.selectable[2]){$new_item.addClass(self.selectable[2]);}}}}if(self.lazyreversed){self._lazyIndex-=1;if(self._lazyreversedLoaded){animate(self,{scrollTop:5},0);}}else{self._lazyIndex+=1;}setTimeout(self.updateLazyItems);},updateLazyItems:function(returnValueOnlyFlag){if(self._pauseScrollUpdating){return false;}self._pauseScrollUpdating=true;if(self.lazyreversed){if(self.lazy=="height"&&self._lazyreversedLoaded&&self.scrollTop==0){self._lazyIndex!=-1?self.createLazyItem():self.fire("__lazybegin__")||(self._lazyIndex!=-1&&setTimeout(self.createLazyItem));}else{if(self.lazy=="height"&&self.offsetHeight-self.scrollHeight>=0){self._lazyIndex!=-1?self.createLazyItem():self.fire("__lazybegin__")||(self._lazyIndex!=-1&&setTimeout(self.createLazyItem));}}if(self.lazy=="width"&&self._lazyreversedLoaded&&self.scrollLeft==0){self._lazyIndex!=-1?self.createLazyItem():self.fire("__lazybegin__")||(self._lazyIndex!=-1&&setTimeout(self.createLazyItem));}else{if(self.lazy=="width"&&self.offsetWidth-self.scrollWidth>=0){self._lazyIndex!=-1?self.createLazyItem():self.fire("__lazybegin__")||(self._lazyIndex!=-1&&setTimeout(self.createLazyItem));}else{if(!self._lazyreversedLoaded){if(self.lazy=="height"){animate(self,{scrollTop:$(self).prop("scrollHeight")},0);}else{if(self.lazy=="width"){animate(self,{scrollLeft:$(self).prop("scrollWidth")},0);}}self._lazyreversedLoaded=true;}}}}else{if(self.lazy=="height"&&self.scrollHeight-3<=self.scrollTop+self.offsetHeight){self._lazyIndex<=self.items.length-1?self.createLazyItem():self.fire("__lazyend__")||(self._lazyIndex<=self.items.length-1&&setTimeout(self.createLazyItem));}if(self.lazy=="width"&&self.scrollWidth-3<=self.scrollLeft+self.offsetWidth){self._lazyIndex<=self.items.length-1?self.createLazyItem():self.fire("__lazyend__")||(self._lazyIndex<=self.items.length-1&&setTimeout(self.createLazyItem));}}self._pauseScrollUpdating=false;return true;}});};HypertagClass.prototype._optimized=function(){var self=this;self.mergespace({__after__:function(){self.resize();self.updateVisibleItems();},__changed__:function(){self.resize();self.updateVisibleItems();},__init__:function(){$(self).addClass("rel");self.optimized=stringToList(self.optimized);self.optimized[1]=parseInt(self.optimized[1],10);self.optimized[2]=self.optimized[2]?parseInt(self.optimized[2],10):10;},__ready__:function(){$(self).scroll(self.updateVisibleItems);if(self.addEventListener){self.addEventListener("mousewheel",self.updateVisibleItems,false);}else{self.onmousewheel=self.updateVisibleItems;}listen(self,self.optimized[0],function(){self.updateVisibleItems();});},__loaded__:function(){if(self._sizingdiv===undefined){self._sizingdiv=self.create();self._sizingdiv.OPTIMIZED_SIZING_DIV=true;$(self._sizingdiv).addClass("rel");}},_optimizedRemove:function(){var $self=$(self);var children=$.makeArray($self.children());self._pauseScrollUpdating=true;removeAllDescendantListensFrom(self,true,"__reset__");try{for(var i=children.length-1;i>=0;i--){var item=children[i];if(item.ELEMENT_NODE&&!item.OPTIMIZED_SIZING_DIV){$(item).remove();}}}catch(err){throw"HypertagOS Engine\n    A Runtime error occurred when reloading optimized list (removing items):\n\n    "+String(err);}self._pauseScrollUpdating=false;},_optimizedRemoveUnseen:function(start,stop){var $self=$(self);var children=$.makeArray($self.children());self._pauseScrollUpdating=true;try{var scrollTop=self.scrollTop-(self.optimized[1]*self.optimized[2]);var self_height=$self.height()+(self.optimized[1]*self.optimized[2]);for(var i=children.length-1;i>=0;i--){var item=children[i];if(!item.OPTIMIZED_SIZING_DIV&&(item.data.i<start||item.data.i>stop)){self._dehydrateOptimizedItem(item);}}}catch(err){throw"HypertagOS Engine\n    A Runtime error occurred when reloading optimized list (removing items):\n\n    "+String(err);}self._pauseScrollUpdating=false;},_dehydrateOptimizedItem:function(item){var shadow_item={data:copy(item.data),itemlist:self};shadow_item.data.self=shadow_item;if(self.selectable){var SelectingMethods=Hypertag.Methods.Selecting;for(var key in SelectingMethods){shadow_item[key]=SelectingMethods[key];}}if(self.selection===item){self.selection=shadow_item;self.selectedItems=[item];}else{if(item.selected){shadow_item.selected=true;var idx=self.selectedItems.indexOf(item);self.selectedItems[idx]=shadow_item;}}self.items[shadow_item.data.i]=shadow_item;removeAllDescendantListensFrom(item,true);$(item).remove();},_hydrateOptimizedItem:function(offsetDirection,idx){var shadow_item=self.items[idx];var new_data=self.items[idx].data;if(shadow_item.ELEMENT_NODE===undefined){if(self.__preloadingitem__){self.items[idx].data=self.__preloadingitem__(self.items[idx].data)||self.items[idx].data;}if(self.__loadingitem__){self.items[idx].data=self.__loadingitem__(self.items[idx].data)||self.items[idx].data;}var template=self.inner_template&&self.use_inner_template?self.inner_template:self.template;shadow_item.itemlist=self;shadow_item.data.self=self;var new_item=self.createUnaddedItem(template,shadow_item.data);self.items[idx]=new_item;var $new_item=$(new_item);if(self.selection===shadow_item){self.selection=new_item;self.selectedItems=[new_item];}else{if(self.selectable&&shadow_item.selected){new_item.selected=true;var selected_idx=self.selectedItems.indexOf(shadow_item);self.selectedItems[selected_idx]=new_item;$new_item.addClass(self.selectable[1]);}else{if(self.selectable[2]){$new_item.addClass(self.selectable[2]);}}}$(self.items[idx]).css(offsetDirection,idx*self.optimized[1]+"px");self.fire("__loaditem__",new_item);self.fire("__loadeditem__",new_item);}else{$(self.items[idx]).css(offsetDirection,idx*self.optimized[1]+"px");}},updateRange:function(start,stop){if(self.isUpdating===true){return false;}self.isUpdating=true;var offsetDirection=self.optimized[0]=="height"?"top":"left";var to_process=[];if(self.optimizeditems){self._optimizedRemoveUnseen(start,stop);}for(var i=Math.max(start,0);i<=Math.min(stop,self.items.length-1);i++){to_process.push(i);}if(to_process.length){self.fire("__optimize__",to_process);}while(to_process.length){self._hydrateOptimizedItem(offsetDirection,to_process.shift());}self.isUpdating=false;},resize:function(){set(self._sizingdiv,self.optimized[0],self.optimized[1]*self.items.length);},updateVisibleItems:function(returnValueOnlyFlag){if(self._pauseScrollUpdating){return false;}self._pauseScrollUpdating=true;var frame_start=self.scrollTop/self._sizingdiv[self.optimized[0]];var frame_stop=(self.scrollTop+self.offsetHeight)/self._sizingdiv[self.optimized[0]];self.startrange=Math.max(0,Math.ceil(self.items.length*frame_start)-self.optimized[2]);self.stoprange=Math.min(self.items.length,Math.ceil(self.items.length*frame_stop)+self.optimized[2]);self.resize();self.updateRange(self.startrange,self.stoprange);self._pauseScrollUpdating=false;Hypertag.GUI.focus.setFocused(self);return true;}});};HypertagClass.prototype._hoverselectable=function(item){var self=this;var tagspace={__hoverover__:function(item,e){self._waitingForHoverSelectable=true;if(Hypertag.Dragging.isDragging&&!self.doubleTriggerGuard){self.doubleTriggerGuard=true;setTimeout(function(){if(self._waitingForHoverSelectable&&Hypertag.Dragging.isDragging){item.setSelection();}self.doubleTriggerGuard=false;},Hypertag.Runtime.dragdelay*4);}},__hoverout__:function(item,e){self._waitingForHoverSelectable=false;}};self.mergespace(tagspace);};var makeHoverSelectable=function(what,onhover){var self=what;$(self).hover(function(e){self._waitingForHoverSelectable=true;if(Hypertag.Dragging.isDragging&&!self.doubleTriggerGuard){self.doubleTriggerGuard=true;setTimeout(function(){if(self._waitingForHoverSelectable&&Hypertag.Dragging.isDragging){onhover?onhover.call(self,self,e):$(self).trigger("click");}self.doubleTriggerGuard=false;},Hypertag.Runtime.dragdelay*3);return false;}},function(){self._waitingForHoverSelectable=false;return false;});};HypertagClass.prototype._dragselectable=function(item){var self=this;var tagspace={__hoverout__:function(item,e){if(!GLOBAL.isCommandPressed||!GLOBAL.isAltPressed){return;}if(!Hypertag.Dragging.isDragging&&!GLOBAL.isShiftPressed){if(isMouseMoving()){!item.selected?item.select():item.unselect();}}}};self.mergespace(tagspace);};HypertagClass.prototype._keyselectable=function(){var self=this;var tagspace={};if(self.multiselectable){tagspace.__keypress__=function(e){if(GLOBAL.isCommandPressed){if(e.keyCode==65){self.selectAll();return false;}else{if(e.keyCode==85){self.unselectAll();return false;}}}else{return true;}};}tagspace.__selection__=function(){Hypertag.GUI.focus.setFocused(self);};tagspace.__selected__=function(){if(self.selectedItems.length!==1){Hypertag.GUI.focus.setFocused(self);}};if(self.keyremovable){tagspace.__backspace__=function(){if(self.selectedItems.length&&(!self.keyremovableconfirm||GLOBAL.isCommandPressed)){var items=self.selectedItems.copy();var idx=self.items.indexOf(self.selectedItems.last());for(var i=0;i!=items.length;i++){items[i].remove();}if(self.items[idx]){self.items[idx].setSelection();}else{if(self.items[idx-1]){self.items[idx-1].setSelection();}else{if(self.items[idx+1]){self.items[idx+1].setSelection();}else{if(self.items[0]){self.items[0].setSelection();}}}}}};}if(self.linearselectable){var uparrow_function=function(){if(self.items.length!==0){if(GLOBAL.isShiftPressed){self.scrollTop=0;self.items[0].setSelection();}else{if(!self.selection&&self.loopscrollable){self.scrollTop=self.scrollHeight-1;self.items.last().setSelection();}else{var idx=self.items.indexOf(self.selection);if(self.lazy&&self.lazyreversed&&self.items[idx-1]&&!self.items[idx-1].ELEMENT_NODE){animate(self,{scrollTop:0},0);setTimeout(function(){if(self.items[idx-1]){self.items[idx-1].setSelection();}else{if(self.loopscrollable){self.items[self.items.length-1].setSelection();}else{self.fire("__scrollbegin__");}}});}else{if(self.items[idx-1]){self.items[idx-1].setSelection();}else{if(self.loopscrollable){self.scrollTop=self.scrollHeight-1;self.items[self.items.length-1].setSelection();}else{self.fire("__scrollbegin__");}}}}}}};var downarrow_function=function(){if(self.items.length!==0){if(GLOBAL.isShiftPressed){self.scrollTop=self.scrollHeight;self.items.last().setSelection();}else{if(!self.selection&&self.loopscrollable){self.scrollTop=1;self.items[0].setSelection();}else{var idx=self.items.indexOf(self.selection);var next_item=self.items[idx+1];if(self.lazy&&next_item&&!next_item.ELEMENT_NODE){$(self).scrollToBottom();}else{if(next_item){self.items[idx+1].setSelection();}else{if(self.loopscrollable){self.scrollTop=1;self.items[0].setSelection();}else{self.fire("__scrollend__");}}}}}}};if(!self.reversearrowkeys){if(self.verticalarrowkeys){tagspace.__uparrow__=uparrow_function;tagspace.__downarrow__=downarrow_function;}if(self.horizontalarrowkeys){tagspace.__leftarrow__=uparrow_function;tagspace.__rightarrow__=downarrow_function;}}else{if(self.verticalarrowkeys){tagspace.__uparrow__=downarrow_function;tagspace.__downarrow__=uparrow_function;}if(self.horizontalarrowkeys){tagspace.__rightarrow__=uparrow_function;tagspace.__leftarrow__=downarrow_function;}}}self.mergespace(tagspace);};HypertagClass.prototype._selectableItem=function(item){var jitem=$(item);var list=item.itemlist;if(item.selected===undefined){item.selected=false;}var SelectingMethods=Hypertag.Methods.Selecting;for(var key in SelectingMethods){item[key]=SelectingMethods[key];}if(list.selectable[0]){jitem.hover(function(e){var list=this.itemlist;var jitem=$(this);if(!list.mouseselectable){return;}list.fire("__hoverover__",this,e)!==false;if(Hypertag.Dragging.state=="dragging"||e.shiftKey){return;}if(!this.selected||list.reselectable){list.selectable[2]&&jitem.removeClass(list.selectable[2]);jitem.removeClass(list.selectable[1]);jitem.addClass(list.selectable[0]);}},function(e){var list=this.itemlist;var jitem=$(this);if(!list.mouseselectable){return;}list.fire("__hoverout__",this,e)!==false;jitem.removeClass(list.selectable[0]);if(this.selected){list.selectable[1]&&jitem.addClass(list.selectable[1]);}else{list.selectable[2]&&jitem.addClass(list.selectable[2]);}});jitem.singleclick(list._hypertagClick,list._hypertagDblclick);}};HypertagClass.prototype.unselectAll=function(unsetselection_flag){var items_selected=copy(this.selectedItems);var obj;while((obj=this.selectedItems.pop())){obj._toggleSelected(false,false);}for(var i=0;i<items_selected.length;i++){fire(this,"__unselected__",items_selected[i]);}this._sendSelectionEventIfSingleElementSelected(undefined,unsetselection_flag);};HypertagClass.prototype.selectAll=function(){this.unselectAll();for(var i=0;i<this.items.length;i++){this.items[i]._toggleSelected(true,false);this.items[i]._addItemToSelected();}if(this.__selected__){for(var i=0;i<this.selectedItems.length;i++){fire(this,"__selecting__",this.selectedItems[i]);fire(this,"__selected__",this.selectedItems[i]);}}this._sendSelectionEventIfSingleElementSelected();};HypertagClass.prototype.selectItems=function(dict){return this.findItems(dict,function(item){item.select();});};HypertagClass.prototype.setSelectionFor=function(dict){return this.findItem(dict,function(item){item.setSelection();});};Hypertag.Methods.Selecting={isSelectable:true};Hypertag.Methods.Selecting.select=function(unsetselection_flag){if(this.isSelectable){if(this.itemlist.multiselectable===false){this.itemlist.unselectAll();}this._addItemToSelected();this._toggleSelected(true,undefined,unsetselection_flag);fire(this.itemlist,"__selecting__",this);fire(this.itemlist,"__selected__",this);}};Hypertag.Methods.Selecting.unselect=function(){if(this.isSelectable){if(this.selected){this._removeFromSelected();this._toggleSelected(false);fire(this.itemlist,"__unselected__",this);}}};Hypertag.Methods.Selecting.toggleSelected=function(){this.selected?this.unselect():this.select();};Hypertag.Methods.Selecting.setSelection=function(){if(this.isSelectable){this.itemlist.unselectAll(false);this.select(false);}};Hypertag.Methods.Selecting.uneventfulSelect=function(){if(this.isSelectable){this.selected=true;this._addItemToSelected();if(this.itemlist.selectedItems.length==1){this.itemlist.selectionindex=this.itemlist.indexOf(this);this.itemlist.selection=this;}else{this.itemlist.selectionindex=-1;this.itemlist.selection=false;}if(this.ELEMENT_NODE!==undefined){var jitem=$(this);if(this.itemlist.selectable[2]){jitem.removeClass(this.itemlist.selectable[2]);}jitem.addClass(this.itemlist.selectable[1]);}}};Hypertag.Methods.Selecting.uneventfulSelection=function(){if(this.isSelectable){if(this.itemlist.selection&&this.itemlist.selection.ELEMENT_NODE!==undefined){var selection=this.itemlist.selection;var jselection=$(this.itemlist.selection);if(this.itemlist.selectable[2]){jselection.removeClass(this.itemlist.selectable[2]);}jselection.addClass(this.itemlist.selectable[1]);}this.itemlist.unselectAll();this.selected=true;this._addItemToSelected();this.itemlist.selectionindex=this.itemlist.indexOf(this);this.itemlist.selection=this;if(this.ELEMENT_NODE!==undefined){var jitem=$(this);if(this.itemlist.selectable[2]){jitem.removeClass(this.itemlist.selectable[2]);}jitem.addClass(this.itemlist.selectable[1]);}}};Hypertag.Methods.Selecting._sortItemsByKey=function(items,key,direction){var to_sort=[];for(var i=0;i<items.length;i++){to_sort.push([items[i][key],items[i]]);}to_sort.sort();var output=[];for(var i=0;i<to_sort.length;i++){output.push(to_sort[i][1]);}if(direction){output.reverse();}return output;};Hypertag.Methods.Selecting._sortSelectedByIndex=function(a,b){return a.itemlist.indexOf(a)>b.itemlist.indexOf(b);};Hypertag.Methods.Selecting._addItemToSelected=function(){if(this.itemlist.selectedItems.indexOf(this)===-1){this.itemlist.selectedItems.push(this);}};Hypertag.Methods.Selecting._removeFromSelected=function(){var idx=this.itemlist.selectedItems.indexOf(this);this.itemlist.selectedItems.remove(idx);this.itemlist._sendSelectionEventIfSingleElementSelected();};Hypertag.Methods.Selecting._toggleSelected=function(to,supress_selection_events,unsetselection_flag){this.selected=to!==undefined?to:!this.selected;var jitem=$(this);if(this.ELEMENT_NODE!==undefined){if(this.itemlist.selectable[1]){if(this.selected){this.itemlist.selectable[2]&&jitem.removeClass(this.itemlist.selectable[2]);jitem.removeClass(this.itemlist.selectable[0]);jitem.addClass(this.itemlist.selectable[1]);}else{jitem.removeClass(this.itemlist.selectable[1]);this.itemlist.selectable[2]&&jitem.addClass(this.itemlist.selectable[2]);}}this.itemlist._sendSelectionEventIfSingleElementSelected(undefined,unsetselection_flag);}};HypertagClass.prototype._sendSelectionEventIfSingleElementSelected=function(event,unsetselection_flag){if(this.selectedItems.length==1){var lastselection=this.selection;set(this,"selectionindex",this.indexOf(this.selectedItems[0]));set(this,"selection",this.selectedItems[0]);fire(this,"__preselection__",this.selectedItems[0],event,lastselection);fire(this,"__selection__",this.selectedItems[0],event,lastselection);}else{if(this.selection){set(this,"selectionindex",-1);this.unselection=this.selection;this.selection=false;if(this.unsetselection===false&&unsetselection_flag===false){return;}fire(this,"__unselection__",this.unselection,event);}}};Hypertag.Methods.Clicking={};Hypertag.Methods.Clicking._selectable_click_handler=function(what){var list=what.itemlist;if(!what||!list.mouseselectable){return true;}if(GLOBAL.isCommandPressed&&list.multiselectable!==false){if(list.unselectable){what.toggleSelected();list._sendSelectionEventIfSingleElementSelected();}}else{if(GLOBAL.isCommandPressed&&list.multiselectable==false){if(list.unselectable){what.unselect();}}else{if(GLOBAL.isShiftPressed&&list.multiselectable&&list.linearselectable){var i=list.items.indexOf(what);var to_select=[];while(i>=0&&list.items[i].selected!==true){to_select.push(i);--i;}to_select.reverse();for(var i=0;i<to_select.length;i++){if(!list.items[to_select[i]].selected){list.items[to_select[i]].select();}}}else{if(list.toggleselect){what.toggleSelected();}else{if(!what.selected||list.multiclickable===false||list.reselectable){what.setSelection();}else{if(list.keyselectable){Hypertag.GUI.focus.setFocused(list);}}}}}}};Hypertag.Methods.Clicking._hypertagClick=function(event){var item=this;var scope=item.itemlist._determineClosestClickableHypertag(event);if(scope===item||scope===item.itemlist){Hypertag.Runtime._doubleClickNotDetected=true;setTimeout(function(){if(Hypertag.Runtime._doubleClickNotDetected&&item.itemlist.mouseselectable&&item.isSelectable){if(item.itemlist._selectable_click_handler){item.itemlist._selectable_click_handler(item,event);}fire(item.itemlist,"__clickitem__",item,event);}},Hypertag.Runtime.doubleClickDelay);return false;}return true;};Hypertag.Methods.Clicking._hypertagDblclick=function(event){var list=this.itemlist;if(list.mouseselectable&&this.isSelectable){Hypertag.Runtime._doubleClickNotDetected=false;fire(list,"__dblclickitem__",this,event);return false;}};Hypertag.Methods.Clicking._determineClosestClickableHypertag=function(event){var scope=event.target;while(scope){if(scope.tagName){var tagname=scope.tagName.toUpperCase();if(tagname=="INPUT"||tagname=="SELECT"||tagname=="TEXTAREA"){return false;}else{if(scope.itemlist&&scope.itemlist.selectable&&scope.itemlist.mouseselectable&&scope.isSelectable){return scope;}}}scope=scope.parentNode;}return false;};Hypertag.Dragging={state:"idle",isDragging:false,cancel:function(){HypertagDraggingClass.prototype.dragDropping(null,null);}};HypertagClass.prototype._drag=function(){var self=this;if(typed(self.drag,String)){self.drag=stringToList(self.drag);}};HypertagClass.prototype._dragItem=function(item){$(item).mousedown(HypertagDraggingClass.prototype.dragItemMouseDown);};HypertagClass.prototype._drop=function(){var self=this;var dragmethods=HypertagDraggingClass.prototype;$(self).mouseup(dragmethods.dropMouseUp);if(!self.droponchild||self.droponcontainer){$(self).mouseenter(dragmethods.dropMouseOver);$(self).mouseleave(dragmethods.dropMouseOut);}};HypertagClass.prototype._dropChild=function(self){var dragmethods=HypertagDraggingClass.prototype;$(self).mouseup(dragmethods.dropChildMouseUp);$(self).mouseenter(dragmethods.dropChildMouseOver);$(self).mouseleave(dragmethods.dropChildMouseOut);};$(window).keyup(function(e){if(e.keyCode==27&&Hypertag.Dragging.state=="dragging"){HypertagDraggingClass.prototype.dragDropping(null,null);}return true;});var HypertagDraggingClass=function(){return this;};HypertagDraggingClass.prototype.dragDragging=function(event){var Dragging=Hypertag.Dragging;event.offsetX=(event.offsetX!=null)?event.offsetX:event.originalEvent.layerX;event.offsetY=(event.offsetY!=null)?event.offsetY:event.originalEvent.layerY;var results=fire(Dragging.tag,"__dragging__",Dragging._draggedItems,Dragging.tag.drag);if(results===false){Dragging.state="idle";return false;}Dragging.state="dragging";set(Dragging,"isDragging",true);Dragging.droppedchild=false;Dragging.tag.isDragging=true;Dragging.item.isDragging=true;if(Dragging.tag.selectondrag){if(!Dragging.tag.multiselectable){Dragging.item.setSelection();}else{Dragging.item.select();}}else{if(!Dragging.item.selected){Dragging.item.setSelection();}}Dragging._draggedItems=[];for(var i=0;i<Dragging.tag.selectedItems.length;i++){Dragging._draggedItems.push({data:copy(Dragging.tag.selectedItems[i].data),item:Dragging.tag.selectedItems[i]});}Dragging.originalPosition=[event.pageX-event.offsetX,event.pageY-event.offsetY];if(Dragging.tag.__manualdragging__===undefined){Dragging.icon=EmptyDiv.cloneNode(true);Dragging.tag.drag=stringToList(Dragging.tag.drag);if(Dragging.tag.dragtemplate){create(Dragging.icon,Dragging.tag.dragtemplate,{items:Dragging.tag.dataFromSelected()});}else{var offsetDirection=Dragging.tag.optimized&&Dragging.tag.optimized[0]=="height"?"top":"left";var dragicons_to_add=Dragging._draggedItems;dragicons_to_add=dragicons_to_add.slice(0,Math.min(dragicons_to_add.length,5));for(var i=0;i<dragicons_to_add.length;i++){var idx=dragicons_to_add[i].item.data.i;if(!dragicons_to_add[i].item.ELEMENT_NODE){Dragging.tag._hydrateOptimizedItem(offsetDirection,idx);}var item=Dragging.tag.items[idx].cloneNode(true);var jitem=$(item);Dragging.icon.appendChild(item);jitem.css("position","relative").css("text-align","left").css("top","0px").css("left","0px").css("height",$(Dragging.item).height()+"px").css("width",$(Dragging.item).width()+"px").css("opacity",0.8/(i+1));if(Dragging.tag.selectable){jitem.removeClass(Dragging.tag.selectable[0]).removeClass(Dragging.tag.selectable[1]);if(Dragging.tag.selectable[2]){jitem.addClass(Dragging.tag.selectable[2]);}}}}var jdragicon=$(Dragging.icon);jdragicon.addClass("abs").css("top",event.pageY+1).css("left",event.pageX+1).css("font-size","0.8em").css("z-index",99999);jdragicon.appendTo(Hypertag.Body);}else{for(var i=0;i<Dragging._draggedItems.length;i++){var item=Dragging._draggedItems[i].item;item._baseX=$(item).left();item._baseY=$(item).top();}}var bodytop=Hypertag.$Body.offset().top;var bodyleft=Hypertag.$Body.offset().left;$(document).mousemove(function(e){if(Dragging.tag.__manualdragging__===undefined){jdragicon.css("top",e.pageY+11-bodytop).css("left",e.pageX+11-bodyleft);}else{var items_to_send=Dragging.tag.multiselectable!==false?Dragging._draggedItems:Dragging._draggedItems[0];var dx=e.pageX-Dragging.baseX,dy=e.pageY-Dragging.baseY;fire(Dragging.tag,"__manualdragging__",items_to_send,dx,dy);}return true;});send(Hypertag,"Dragging");};HypertagDraggingClass.prototype.dragDropping=function(target,event){if(event){event.offsetX=(event.offsetX!=null&&!event.originalEvent)?event.offsetX:event.originalEvent.layerX;event.offsetY=(event.offsetY!=null&&!event.originalEvent)?event.offsetY:event.originalEvent.layerY;}var Dragging=Hypertag.Dragging;var dragmethods=HypertagDraggingClass.prototype;Dragging.state="idle";set(Dragging,"isDragging",false);Dragging.item.isDragging=false;Dragging.tag.isDragging=false;$(document).unbind("mousemove");if(Dragging.tag.__manualdragging__){target===null?Dragging.tag.fire("__manuallyaborted__",event):Dragging.tag.fire("__manuallydropped__",target,event);return false;}if(!target){if(Dragging.originalPosition){animate(Dragging.icon,{top:Dragging.originalPosition[1],left:Dragging.originalPosition[0]},{duration:Hypertag.GUI.duration});setTimeout(dragmethods.removeDragItems,Hypertag.GUI.duration+1);}}else{HypertagDraggingClass.prototype.removeDragItems();var draggedItems=[];if(Dragging.tag.data!==null){for(var i=0;i<Dragging._draggedItems.length;i++){draggedItems.push(Dragging._draggedItems[i].item);}}else{draggedItems=Dragging._draggedItems;}if(Dragging.tag.fire("__dropping__",draggedItems,target,event)!==false){if(target.droponchild&&Dragging.droppedchild){var afterFlag=false;if(target.childNodes.length===0){afterFlag=true;}else{if(target.items.indexOf(Dragging.droppedchild)==target.items.length-1){afterFlag=true;}}var droppedchild=afterFlag?false:Dragging.droppedchild;target.fire("__drop__",draggedItems,droppedchild,Dragging.tag.drag,Dragging.tag,event);target.fire("__dropped__",draggedItems,droppedchild,Dragging.tag.drag,Dragging.tag,event);}else{if(target.droponcontainer){target.fire("__drop__",draggedItems,target,Dragging.tag.drag,Dragging.tag,event);target.fire("__dropped__",draggedItems,target,Dragging.tag.drag,Dragging.tag,event);}else{target.fire("__drop__",draggedItems,Dragging.tag.drag,Dragging.tag,event);target.fire("__dropped__",draggedItems,Dragging.tag.drag,Dragging.tag,event);}}Dragging.tag.fire("__droppingdone__",draggedItems,target,event);}}Dragging._draggedItems=null;send(Hypertag,"Dragging");return false;};HypertagDraggingClass.prototype.removeDragItems=function(){var Dragging=Hypertag.Dragging;var children=$.makeArray($(Dragging.icon).children());if(Dragging.tag.dragtemplate){for(var i=0;i<children.length;i++){children[i].remove();}}else{for(var i=0;i<children.length;i++){$(children[i]).remove();}}};HypertagDraggingClass.prototype._nonDraggableTargetTypes=["input","textarea","select"];HypertagDraggingClass.prototype.dragItemMouseDown=function(event){if((event.which!=1||event.which===undefined)||!this.isSelectable){return true;}var tagname=event.target.tagName.toLowerCase();if(tagname=="input"||tagname=="textarea"||tagname=="select"){return true;}var item=this;var Dragging=Hypertag.Dragging;var dragmethods=HypertagDraggingClass.prototype;if(Dragging.state!="idle"){return true;}Dragging.state="waiting";Dragging.item=item;Dragging.tag=item.itemlist;Dragging.baseX=event.pageX;Dragging.baseY=event.pageY;if(Dragging.tag.__manualdragging__){dragmethods.dragDragging(event);}else{setTimeout(function(){if(Dragging.state=="waiting"&&Dragging.item==item){dragmethods.dragDragging(event);}},Hypertag.Runtime.dragdelay);}return false;};HypertagDraggingClass.prototype.dropMouseUp=function(event,list){event.offsetX=(event.offsetX!=null||!event.originalEvent)?event.offsetX:event.originalEvent.layerX;event.offsetY=(event.offsetY!=null||!event.originalEvent)?event.offsetY:event.originalEvent.layerY;var self=list||this;var Dragging=Hypertag.Dragging;var dragmethods=HypertagDraggingClass.prototype;if(Dragging.drugOver){if(self.__dragout__){self.__dragout__(Dragging.drugOver);}Dragging.drugOver=false;}if(Dragging.drugOverChild){if(Dragging.drugOverChild.itemlist&&Dragging.drugOverChild.itemlist.__dragout__){Dragging.drugOverChild.itemlist.__dragout__(Dragging.drugOverChild);}Dragging.drugOverChild=false;}if(!Dragging.tag||!Dragging.item||Dragging.state=="idle"){return true;}else{if(Dragging.item&&Dragging.state!="dragging"){Dragging.state="idle";return false;}else{if(Dragging.state=="dragging"){if(HypertagDraggingClass.prototype.isDragAccepted(self)){dragmethods.dragDropping(self,event);return false;}else{dragmethods.dragDropping(false,false);}}}}return true;};HypertagDraggingClass.prototype.isDragAccepted=function(self){var Dragging=Hypertag.Dragging;if(Dragging.tag.droponothers===false&&self!==Dragging.tag){return false;}else{if(!Dragging.tag.droponself&&self==Dragging.tag){return false;}else{if(self.droponchild&&!self.droponcontainer){if(!Dragging.droppedchild||Dragging.tag.droponself!==true&&self.isDragging||Dragging.droppedchild.isDragging){return false;}}else{if(self.isDragging&&Dragging.tag.droponself!==true&&Dragging.tag.droponcontainer!==true){return false;}}}}if(self.drop.length&&self.drop.intersect(Dragging.tag.drag)||self.drop=="*"){return true;}return false;};HypertagDraggingClass.prototype.dropMouseOver=function(e){var self=this;var Dragging=Hypertag.Dragging;if(Dragging.state=="dragging"){if(HypertagDraggingClass.prototype.isDragAccepted(self)){if(self.__dragover__){self.__dragover__(self);}Dragging.drugOver=self;return false;}}return true;};HypertagDraggingClass.prototype.dropMouseOut=function(e){var self=this;var Dragging=Hypertag.Dragging;if(Dragging.drugOver){if(self.__dragout__){self.__dragout__(Dragging.drugOver);}Dragging.drugOver=false;return false;}return true;};HypertagDraggingClass.prototype.dropChildMouseUp=function(e){var self=this;var Dragging=Hypertag.Dragging;var dragmethods=HypertagDraggingClass.prototype;if(Dragging.state!="dragging"&&Dragging.item){Dragging.state="idle";return false;}if(Dragging.drugOverChild&&Dragging.drugOverChild.itemlist&&Dragging.drugOverChild.itemlist.__dragout__){Dragging.drugOverChild.itemlist.__dragout__(Dragging.drugOverChild);}if(Dragging.drugOver&&Dragging.drugOver.itemlist){if(Dragging.drugOver.itemlist.__dragout__){Dragging.drugOver.itemlist.__dragout__(Dragging.drugOver);}Dragging.drugOver=false;}Dragging.droppedchild=self;return dragmethods.dropMouseUp(e,self.itemlist);};HypertagDraggingClass.prototype.dropChildMouseOver=function(){var self=this;var Dragging=Hypertag.Dragging;if(!Dragging.tag){return true;}if(Dragging.state=="dragging"){if(self.itemlist.drop&&self.itemlist.drop.intersect(Dragging.tag.drag)){if((!self.selected||(self.itemlist!=Dragging.tag))&&(Dragging.tag.droponself!==true||self.isDragging!==true)&&(Dragging.tag.droponself===true||self.itemlist.isDragging!==true)&&(Dragging.tag.droponothers!==false||self.itemlist===Dragging.tag)){fire(self.itemlist,"__dragover__",self);Dragging.drugOverChild=self;return false;}}}return true;};HypertagDraggingClass.prototype.dropChildMouseOut=function(){var self=this;var Dragging=Hypertag.Dragging;if(Dragging.drugOverChild){fire(self.itemlist,"__dragout__",Dragging.drugOverChild);Dragging.drugOverChild=false;return false;}return true;};HypertagClass.prototype.rehitch=function(){var element=this;if(element._hitchBindings.release){element._hitchBindings.release();}var references=element._resolveParentReferences();element.parentHypertag=element.parent=references[0];element.root=element.root=references[1];element.itemroot=references[2];element.directory=references[3];copy(element.scanAttributes(element._hitchestext,element,true,true),element);setTimeout(function(){element._performAutohitches();});};HypertagClass.prototype.unhitch=function(){var element=this;if(element._hitchBindings.release){element._hitchBindings.release();}};HypertagClass.prototype.scanAttributes=function(incoming_dict,context,process_hitches,forceReloadOfHitches,promoteDelegateTextToFunction){var output={};for(var key in incoming_dict){try{if(key.slice(-1)=="$"){context._traitsFromProperties.push(key.slice(0,-1));output[key]=incoming_dict[key];}else{if(!context.initialized&&key[0]=="$"){context._selectorsToResolve[key]=[context[key],key[1]=="$"];output[key]=incoming_dict[key];}else{if(incoming_dict[key].slice(0,2)=="%{"&&incoming_dict[key].slice(-1)=="}"){var attr_text=incoming_dict[key].slice(2,-1);try{eval("output[key] = function(self){return "+attr_text+";}");output[key]=output[key].call(context,context);}catch(err){err.message="\nIn the context of the code:\n\n"+attr_text+"\n\n...\n\n"+err.message;throw err;}context._hitchestext[key]=String(incoming_dict[key]);}else{if(process_hitches!==false&&incoming_dict[key].slice(0,3)=="%%{"&&incoming_dict[key].slice(-1)=="}"){var hitch=undefined,hitch_parts=undefined,hitch_target_parts=undefined,hitch_delay_function=undefined,hitch_targets=undefined,hitch_conditional_segments=undefined,first_hitch_target=undefined,first_hitch_attr=undefined,hitch_conditional_target=undefined,hitch_conditional_attr=undefined,hitch_conditional_or=undefined;var autohitch_flag=false;if(context.initialized&&forceReloadOfHitches===undefined){continue;}context._hitchestext[key]=String(incoming_dict[key]);var attr_text=incoming_dict[key].slice(3,-1).trim();if(attr_text[0]=="!"){autohitch_flag=true;attr_text=attr_text.slice(1);}hitch_conditional_segments=attr_text.split("::");if(hitch_conditional_segments[1]){try{eval("hitch_conditional_or = function(self, value){return "+hitch_conditional_segments[1]+";};");}catch(err){err.message="\nIn the context of the code:\n\n"+hitch_conditional_segments[1]+"\n\n...\n\n"+err.message;throw err;}}hitch_parts=hitch_conditional_segments[0].split(";;");hitch_target_parts=hitch_parts[0].split("??");hitch_delay_value_parts=hitch_target_parts[0].split("...");if(hitch_delay_value_parts.length>1){hitch_target_parts[0]=hitch_delay_value_parts.slice(1).join("");var hitch_delay_text=hitch_delay_value_parts[0];var get_obj_reference;try{eval("hitch_delay_function = function(self){return "+hitch_delay_text+";}");}catch(err){err.message="\nIn the context of the code, when evaluating hitch delay function:\n\n"+hitch_delay_text+"\n\n...\n\n"+err.message;throw err;}}if(hitch_target_parts.length>1){var hitch_conditional_pair=hitch_target_parts[0].trim().split(".");hitch_conditional_target=hitch_conditional_pair.slice(0,-1).join(".");hitch_conditional_attr=hitch_conditional_pair.slice(-1)[0];var get_obj_reference;try{eval("get_obj_reference = function(self){return "+hitch_conditional_target+";}");hitch_conditional_target=get_obj_reference.call(context,context);}catch(err){err.message="\nIn the context of the code:\n\n"+hitch_conditional_target+"\n\n...\n\n"+err.message;throw err;}hitch_targets=stringToList(hitch_target_parts[1].trim());}else{hitch_targets=stringToList(hitch_target_parts[0].trim());}if(!hitch_delay_function&&hitch_targets.length){var maxtime=0;for(var i=0;i<hitch_targets.length;i++){var obj=hitch_targets[i].split(".").slice(0,-1).join(".");var attr=hitch_targets[i].split(".").slice(-1)[0];var get_obj_reference;var obj_reference;try{eval("get_obj_reference = function(self){return "+obj+";}");obj_reference=get_obj_reference.call(context,context);}catch(err){err.message="\nIn the context of the maxtime code:\n\n"+hitch_targets[i]+"\n\n...\n\n"+err.message;throw err;}if(obj_reference&&obj_reference.autoanimated&&(obj_reference.autoanimated.indexOf(attr)||obj_reference.autoanimated===true||obj_reference.autoanimated.toLowerCase()=="true")){maxtime=Math.max(maxtime,obj_reference.autospeed||Hypertag.GUI.duration/2);}}if(maxtime>0){var get_obj_reference;try{eval("hitch_delay_function = function(self){return "+maxtime+";}");}catch(err){err.message="\nIn the context of the code, when evaluating hitch delay function:\n\n"+maxtime+"\n\n...\n\n"+err.message;throw err;}}}if(hitch_targets.length){var target_parts=hitch_targets[0].split(".");var objname=target_parts.slice(0,-1).join(".");first_hitch_attr=target_parts.slice(-1)[0];var get_obj_reference;try{eval("get_obj_reference = function(self){return "+objname+";}");first_hitch_target=get_obj_reference.call(context,context);}catch(err){err.message="\nIn the context of the code:\n\n"+objname+"\n\n...\n\n"+err.message;throw err;}}if(hitch_parts.length===1){if(hitch_conditional_target){hitch=function(self,key,first_hitch_target,first_hitch_attr,hitch_conditional_target,hitch_conditional_attr,hitch_conditional_or,hitch_delay_function){return function(){if(hitch_delay_function){setTimeout(function(){if(hitch_conditional_target[hitch_conditional_attr]){set(self,key,first_hitch_target[first_hitch_attr]);}else{if(hitch_conditional_or){set(self,key,hitch_conditional_or.call(self,self,first_hitch_target[first_hitch_attr]));}}},hitch_delay_function.call(context,context));}else{if(hitch_conditional_target[hitch_conditional_attr]){set(self,key,first_hitch_target[first_hitch_attr]);}else{if(hitch_conditional_or){set(self,key,hitch_conditional_or.call(self,self,first_hitch_target[first_hitch_attr]));}}}};}(context,key,first_hitch_target,first_hitch_attr,hitch_conditional_target,hitch_conditional_attr,hitch_conditional_or,hitch_delay_function);}else{hitch=function(self,key,hitch_delay_function){return function(value){if(hitch_delay_function){setTimeout(function(){set(self,key,value);},hitch_delay_function.call(self,self));}else{set(self,key,value);}};}(context,key,hitch_delay_function);}}else{var codeblock=hitch_parts[1].trim();if(codeblock){if(codeblock.slice(-1)==";"){codeblock=codeblock.slice(0,-1);}if(hitch_targets.length){if(hitch_conditional_target){var custom_function;try{eval("custom_function = function(self, value, target){return "+codeblock+";}");}catch(err){err.message="\nIn the context of the code:\n\n"+codeblock+"\n\n...\n\n"+err.message;throw err;}hitch=function(self,key,custom_function,first_hitch_target,first_hitch_attr,hitch_conditional_target,hitch_conditional_attr,hitch_conditional_or,hitch_delay_function){return function(){if(hitch_delay_function){setTimeout(function(){if(hitch_conditional_target[hitch_conditional_attr]){set(self,key,custom_function.call(self,self,first_hitch_target[first_hitch_attr],first_hitch_target));}else{if(hitch_conditional_or){set(self,key,hitch_conditional_or.call(self,self,first_hitch_target[first_hitch_attr],first_hitch_target));}}},hitch_delay_function.call(self,self));}else{if(hitch_conditional_target[hitch_conditional_attr]){set(self,key,custom_function.call(self,self,first_hitch_target[first_hitch_attr],first_hitch_target));}else{if(hitch_conditional_or){set(self,key,hitch_conditional_or.call(self,self,first_hitch_target[first_hitch_attr],first_hitch_target));}}}};}(context,key,custom_function,first_hitch_target,first_hitch_attr,hitch_conditional_target,hitch_conditional_attr,hitch_conditional_or,hitch_delay_function);}else{var custom_function;try{eval("custom_function = function(self, value, target){return "+codeblock+";}");}catch(err){err.message="\nIn the context of the code:\n\n"+codeblock+"\n\n...\n\n"+err.message;throw err;}hitch=function(self,key,custom_function,first_hitch_target,first_hitch_attr,hitch_delay_function){return function(){if(hitch_delay_function){setTimeout(function(){return set(self,key,custom_function.call(self,self,first_hitch_target[first_hitch_attr],first_hitch_target));},hitch_delay_function.call(self,self));}else{return set(self,key,custom_function.call(self,self,first_hitch_target[first_hitch_attr],first_hitch_target));}};}(context,key,custom_function,first_hitch_target,first_hitch_attr,hitch_delay_function);}}else{var custom_function;try{eval("custom_function = function(self, value){"+codeblock+";}");}catch(err){err.message="\nIn the context of the code:\n\n"+codeblock+"\n\n...\n\n"+err.message;throw err;}if(hitch_conditional_target){hitch=function(self,key,custom_function,hitch_conditional_target,hitch_conditional_attr,hitch_conditional_or,hitch_delay_function){return function(value){if(hitch_delay_function){setTimeout(function(){if(hitch_conditional_target[hitch_conditional_attr]){custom_function.call(self,self,value);}else{if(hitch_conditional_or){set(self,key,hitch_conditional_or.call(self,self,value));}}},hitch_delay_function.call(self,self));}else{if(hitch_conditional_target[hitch_conditional_attr]){custom_function.call(self,self,value);}else{if(hitch_conditional_or){set(self,key,hitch_conditional_or.call(self,self,value));}}}};}(context,key,custom_function,hitch_conditional_target,hitch_conditional_attr,hitch_conditional_or,hitch_delay_function);}else{hitch=function(self,key,custom_function,hitch_delay_function){return function(value){if(hitch_delay_function){setTimeout(function(){custom_function.call(self,self,value);},hitch_delay_function.call(self,self));}else{custom_function.call(self,self,value);}};}(context,key,custom_function,hitch_delay_function);}}}}if(!context._hitchBindings){context._hitchBindings={};}if(hitch_targets.length===0){hitch_targets.push(false);}for(var i=0;i<hitch_targets.length;i++){var obj,attr;if(hitch_targets[i]){var target_parts=hitch_targets[i].split(".");var objname=target_parts.slice(0,-1).join(".");attr=target_parts.slice(-1)[0];var get_obj_reference;try{eval("get_obj_reference = function(self){return "+objname+";}");obj=get_obj_reference.call(context,context);}catch(err){err.message="\nIn the context of the code:\n\n"+objname+"\n\n...\n\n"+err.message;throw err;}if(autohitch_flag||Hypertag.Runtime.attributes_to_autohitch.indexOf(key)!==-1){context._autohitches.push([obj,attr,hitch,String(incoming_dict[key])]);}output[key]=undefined;}else{obj=context;attr=key;}listen(obj,attr,hitch,context,context._hitchBindings);if(hitch_conditional_target){listen(hitch_conditional_target,hitch_conditional_attr,hitch,context,context._hitchBindings);}if(i===0){if(hitch_parts.length>2){var default_value=hitch_parts[2].trim();if(default_value){if(default_value.slice(-1)==";"){default_value=default_value.slice(0,-1);}var get_obj_reference;try{eval("get_obj_reference = function(value){var self = this; return "+default_value+";}");var result=get_obj_reference.call(context,obj[attr]);}catch(err){err.message="\nIn the context of the code:\n\n"+default_value+"\n\n...\n\n"+err.message;throw err;}output[key]=result;}}if(hitch_parts.length>3){var default_value=hitch_parts[3].trim();if(default_value.slice(-1)==";"){default_value=default_value.slice(0,-1);}var get_obj_reference;try{eval("get_obj_reference = function(value){var self = this; return "+default_value+";}");var result=get_obj_reference.call(context,obj[attr]);}catch(err){err.message="\nIn the context of the code:\n\n"+default_value+"\n\n...\n\n"+err.message;throw err;}}}}}else{if(promoteDelegateTextToFunction&&key.startsendswith("__")&&typed(incoming_dict[key],String)){try{var self=context;eval("output[key] = function(){"+incoming_dict[key]+";}");}catch(err){err.message="Error when converting text to function on delegate method. Error is: "+String(err)+", text of attribute is: "+incoming_dict[key];throw err;}}else{output[key]=incoming_dict[key];}}}}}}catch(e){Hypertag.Debugger.error("Attribute "+key+", function had a problem, '"+key+"', had an error. Text of attr is:\n\n"+incoming_dict[key]+"\n\nand the error is: "+e);console.log("ATTRIBUTE ERROR CONTEXT",context);}finally{hitch=null;hitch_parts=null;hitch_target_parts=null;hitch_targets=null;hitch_conditional_segments=null;hitch_delay_function=null,first_hitch_target=null;first_hitch_attr=null;hitch_conditional_target=null;hitch_conditional_attr=null;hitch_conditional_or=null;}}return output;};var create=function(target,template_name,data,server,inner_template_flag){if(!data){data={};}if(!server){server="*";}var tag="div";if(template_name){var template_and_server=server+"/"+template_name.toLowerCase();tag=Hypertag.Runtime.TemplateTagType[template_and_server]||"div";}var new_element=$("<"+tag+"></"+tag+">")[0];target=target[0]||target;target.appendChild(new_element);$(new_element).addClass("hypertag");if(template_name){$(new_element).attr(inner_template_flag===undefined?"template":"inner_template",template_name);}$(new_element).attr("server",server);new_element.data=data;Hypertag.Runtime.ExpandHypertags(new_element);return new_element;};var createUnaddedItem=function(target,template_name,data){return createItem(target,template_name,data,true);};var createItem=function(target,template_name,data,suppressAddToItemsFlag){var self=this;if(!data){data={};}var startInvisible=false;if(data){if(data._startInvisible){delete data._startInvisible;var startInvisible=true;}}target=target[0]||target;var server="*";if(template_name.indexOf("/")==-1){var template_and_server=server+"/"+template_name;var template_and_server_lower=server+"/"+template_name.toLowerCase();}else{var template_and_server=template_name;var template_and_server_lower=template_name.toLowerCase();}var tag=Hypertag.Runtime.TemplateTagType[template_and_server_lower]||"div";var template=Hypertag.Runtime.TemplateCache(template_and_server);var new_element=$.tmpl(template,data||{})[0];var jnew_element=$(new_element);new_element.data=data;data.self=new_element;var elementMethods=HypertagClass.prototype;new_element.jchild=elementMethods.jchild;new_element.jnamed=elementMethods.jnamed;new_element.jsibling=elementMethods.jsibling;new_element.$child=elementMethods.$child;new_element.$named=elementMethods.$named;new_element.$sibling=elementMethods.$sibling;new_element.child=elementMethods.child;new_element.named=elementMethods.named;new_element.sibling=elementMethods.sibling;new_element.remove=elementMethods.remove;new_element.itemlist=target.isHypertag?target:new_element;if(target.isHypertag&&target.list){var DataMethods=Hypertag.Methods.Data;for(var key in DataMethods){new_element[key]=DataMethods[key];}if(target.selectable){elementMethods._selectableItem(new_element);}if(target.drag){elementMethods._dragItem(new_element);}if(target.droponchild){elementMethods._dropChild(new_element);}}jnew_element.addClass(template_name);if(startInvisible){jnew_element.fadeTo(0,0);}if(target){if(target.lazyreversed){$(new_element).prependTo(target);}else{$(target).append(new_element);}if(target.items&&suppressAddToItemsFlag===undefined){target.items.push(new_element);}}Hypertag.Runtime.ExpandHypertags(new_element);return new_element;};var createJQueryTemplateUsingHypertag_andData_at=function(hypertag,data,target,beforeFlag){var self=this;if(data instanceof Array){for(var i=0;i<data.length;i++){data[i].self=hypertag;}}else{if(data instanceof Object){data.self=hypertag;}}var sum_of_both_templates=[];if(hypertag.template){var new_nodes_from_template=[];try{new_nodes_from_template=$.tmpl(Hypertag.Runtime.TemplateCache(hypertag.template),data);}catch(err){Hypertag.Debugger.error("Template: "+hypertag.template,String(err));}for(var i=0;i<new_nodes_from_template.length;i++){sum_of_both_templates.push(new_nodes_from_template[i]);}}if(hypertag.use_inner_template&&hypertag.inner_template){var new_nodes_from_inner_template=[];try{new_nodes_from_inner_template=$.tmpl(Hypertag.Runtime.TemplateCache(hypertag.inner_template),data);}catch(err){Hypertag.Debugger.error("Inner Template:",String(err));}for(var i=0;i<new_nodes_from_inner_template.length;i++){sum_of_both_templates.push(new_nodes_from_inner_template[i]);}}if(hypertag._applied_traits&&hypertag._applied_traits.length){for(var i=0;i!=hypertag._applied_traits.length;i++){var new_nodes_from_template=[];try{new_nodes_from_template=$.tmpl(Hypertag.Runtime.TemplateCache(hypertag._applied_traits[i]),data);}catch(err){Hypertag.Debugger.error("Template: "+hypertag._applied_traits[i],String(err));}for(var j=0;j<new_nodes_from_template.length;j++){sum_of_both_templates.push(new_nodes_from_template[j]);}}}if(beforeFlag===undefined){$(sum_of_both_templates).appendTo(target);}else{if(beforeFlag===false){$(sum_of_both_templates).prependTo(target);}else{$(sum_of_both_templates).insertBefore(target);}}return sum_of_both_templates;};var hasClass=function(node,classname){var classes=node.getAttribute("class");return classes&&classes.split(" ").indexOf(classname)!==-1;};var ParseXML=function(xmlText){try{var parser=new DOMParser();var xmlDoc=parser.parseFromString(xmlText,"application/xml");return xmlDoc.documentElement;}catch(e){var xmlDoc=new ActiveXObject("Microsoft.XMLDOM");xmlDoc.async="false";xmlDoc.loadXML(xmlText);return xmlDoc.documentElement;}};var PrintXML=function(node){if(typed(node,Object)){var output="";for(var i=0,elem;(elem=node[i])!=undefined;i++){output+=PrintXML(elem).trim();}return output.trim();}else{return HTMLSerializer(node).trim();}};var PrintInnerXML=function(node){var output="";for(var i=0;i<node.childNodes.length;i++){output+=PrintXML(node.childNodes[i]);}return output;};var indexOf=function(list,item){for(var i=0;i<list.length;i++){if(list[i]===item){return i;}}return -1;};function HTMLSerializer(n){var emptyElements={area:true,base:true,basefont:true,br:true,col:true,frame:true,hr:true,img:true,input:true,isindex:true,link:true,meta:true,param:true};var CDATAElements={script:true,style:true};function htmlEscape(s){s=s.replace(/&/g,"&amp;");s=s.replace(/>/g,"&gt;");s=s.replace(/</g,"&lt;");return s;}function quoteEscape(s){s=s.replace(/"/g,"&quot;");return s;}function serializeAttributes(n){var i,attr;var r="";for(i=0;attr=n.attributes[i];++i){r+=" "+attr.name+'="'+quoteEscape(htmlEscape(attr.value))+'"';}return r;}function hasNonTextChildren(n){var i,child;for(i=0;child=n.childNodes[i];++i){if(child.nodeType!=3){return true;}}return false;}function serializeSubtree(n,addXMLNSforHTML){switch(n.nodeType){case 3:return htmlEscape(n.data);case 8:return"<!--"+n.data+"-->";case 1:var tag=n.tagName.toLowerCase();var serializedChildren="";var i,child;for(i=0;child=n.childNodes[i];++i){serializedChildren+=serializeSubtree(n.childNodes[i],false);}if(emptyElements[tag]){if(serializedChildren.trim()){console.error("HTMLSerializer found content in a self closing tag:\n\n<"+tag+serializeAttributes(n)+">"+serializedChildren+"</"+tag+">.\n\nYou cannot have inner content in these tags.");}var start="<"+tag+serializeAttributes(n)+"/>";return start;}else{var start="<"+tag+serializeAttributes(n)+">";var end="</"+tag+">";return start+serializedChildren+end;}default:throw"serializeHTML: Unexpected node type "+n.nodeType+": "+PrintXML(n.documentElement);}}var output=serializeSubtree(n||document.documentElement);return output;}var EmptyDiv=ParseXML("<div xmlns='http://www.w3.org/1999/xhtml'></div>");var EmptyTemplate=ParseXML("<script xmlns='http://www.w3.org/1999/xhtml'><\/script>");Math.bound=function(lower,upper,val){return Math.min(Math.max(lower,val),upper);};if(Array.prototype.has==undefined){Array.prototype.has=function(what){return this.indexOf(what)!==-1;};}else{throw new Error("Warning: tried to give array a has method, but it already has one!");}if(Array.prototype.pushUniquely==undefined){Array.prototype.pushUniquely=function(what){if(this.indexOf(what)===-1){this.push(what);}return this;};}else{throw new Error("Warning: tried to give array a has method, but it already has one!");}if(Array.prototype.remove==undefined){Array.prototype.remove=function(index){return this.splice(index,1);};}else{throw new Error("Warning: tried to give array a remove method, but it already has one!");}if(Array.prototype.insert==undefined){Array.prototype.insert=function(what,at){return this.splice(at,0,what);};}else{throw new Error("Warning: tried to give array an insert method, but it already has one!");}if(Array.prototype.first==undefined){Array.prototype.first=function(default_value){return this[0]===undefined?default_value:this[0];};}else{throw new Error("Warning: tried to give array a first method, but it already has one!");}if(Array.prototype.last==undefined){Array.prototype.last=function(default_value){return this[this.length-1]===undefined?default_value:this[this.length-1];};}else{throw new Error("Warning: tried to give array a last method, but it already has one!");}if(Array.prototype.each===undefined){Array.prototype.each=function(method){for(var i=0;i!=this.length;i++){var val=method(this[i]);if(val!==undefined){this[i]=val;}}return this;};}else{throw new Error("Warning: tried to give array a each method, but it already has one!");}if(String.prototype.user_id==undefined){String.prototype.user_id=function(what){var trust_id=this.split("::");var user_id=trust_id[0].trim();var membership=trust_id[1].trim();return user_id;};}else{throw new Error("Warning: tried to give string a endswith method, but it already has one!");}if(String.prototype.membership==undefined){String.prototype.membership=function(what){var trust_id=this.split("::");var user_id=trust_id[0].trim();var membership=trust_id[1].trim();return membership;};}else{throw new Error("Warning: tried to give string a endswith method, but it already has one!");}if(String.prototype.endswith==undefined){String.prototype.endswith=function(what){for(var i=0;i<arguments.length;i++){if(this.slice(-arguments[i].length)==arguments[i]){return true;}}return false;};}else{throw new Error("Warning: tried to give string a endswith method, but it already has one!");}if(String.prototype.startswith==undefined){String.prototype.startswith=function(what){return what&&this.length>=what.length&&this.slice(0,what.length)==what;};}else{throw new Error("Warning: tried to give string a startswith method, but it already has one!");}if(String.prototype.startsendswith===undefined){String.prototype.startsendswith=function(what){return what&&this.slice(0,what.length)==what&&this.slice(-what.length)==what;};}else{throw new Error("Warning: tried to give string a startsendswith method, but it already has one!");}if(String.prototype.ltrim===undefined||String.prototype.rtrim===undefined){var _WHITESPACE_REGEX="\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF";var _WHITESPACE_REGEX="["+_WHITESPACE_REGEX+"]";var trimBeginRegexp=new RegExp("^"+_WHITESPACE_REGEX+_WHITESPACE_REGEX+"*"),trimEndRegexp=new RegExp(_WHITESPACE_REGEX+_WHITESPACE_REGEX+"*$");String.prototype.ltrim=function(){return String(this).replace(trimBeginRegexp,"");};String.prototype.rtrim=function(){return String(this).replace(trimEndRegexp,"");};}else{throw new Error("Warning: tried to give string a rtrim/ltrim method, but it already has one!");}if(String.prototype.cd===undefined){String.prototype.cd=function(path){return fat.cd(this+(path!==undefined?"/"+path:""));};}else{throw new Error("Warning: tried to give string a fat method, but it already has one!");}if(String.prototype.reference===undefined){String.prototype.reference=function(path){return fat.reference(this+(path!==undefined?"/"+path:""));};}else{throw new Error("Warning: tried to give string a reference method, but it already has one!");}if(String.prototype.pointer===undefined){String.prototype.pointer=function(path){return fat.pointer(this+(path!==undefined?"/"+path:""));};}else{throw new Error("Warning: tried to give string a pointer method, but it already has one!");}if(Array.prototype.copy===undefined){Array.prototype.copy=function(){var new_list=[];for(var i=0;i<this.length;i++){new_list.push(this[i]);}return new_list;};}else{throw new Error("Warning: tried to give array a copy method, but it already has one!");}if(!Array.prototype.intersect){Array.prototype.intersect=function(arr){if(!(arr instanceof Array)){arr=[arr];}for(var i=0;i<this.length;i++){for(var j=0;j<arr.length;j++){if(this[i]==arr[j]){return true;}}}return false;};}else{throw new Error("Warning: tried to give array an intersect method, but it already has one!");}Array.prototype.find=function(what){var i;for(i=0;i<this.length;i++){var found=true;for(var key in what){if(what[key]!=this[i][key]){found=false;break;}}if(found){return i;}}return -1;};function listen(obj,attrlist,method,context,boundobject){if(!(obj instanceof Object)){throw'A non-object was passed to listen for the attribute "'+attr+'" and is an error. Object: '+String(obj)+".";}if(boundobject!==undefined){if(boundobject.__listening__===undefined){boundobject.__listening__=[];}if(boundobject.release===undefined){boundobject.release=_releaseListens;}}attrlist=stringToList(attrlist);var releaselist=[];for(var i=0;i<attrlist.length;i++){var attr=attrlist[i];if(obj.__listeners__===undefined){obj.__listeners__={};}if(obj.__listeners__[attr]===undefined){obj.__listeners__[attr]=new Array;}obj.__listeners__[attr].push([method,context]);releaselist.push([obj,attr,method,context,boundobject]);}if(boundobject){boundobject.__listening__.extend(releaselist);}return releaselist;}function release(releaselist){for(var i=0;i<releaselist.length;i++){var entry=releaselist[i];var obj=entry[0],attr=entry[1],method=entry[2],context=entry[3],boundobject=entry[4];var listened_list=obj.__listeners__[attr]||[];for(var j=listened_list.length-1;j!=-1;j--){if(listened_list[j][0]==method&&listened_list[j][1]==context){listened_list.remove(j);if(listened_list.length==0){delete obj.__listeners__[attr];}break;}}if(boundobject){var listening_list=boundobject.__listening__||[];for(var j=listening_list.length-1;j!=-1;j--){if(listening_list[j][0]==obj&&listening_list[j][1]==attr&&listening_list[j][2]==method){listening_list.remove(j);break;}}}}}function _releaseListens(){var attrs_setup_list=this.__listening__||[];for(var i=this.__listening__.length-1;i>=0;i--){var obj=this.__listening__[i][0];var attr=this.__listening__[i][1];var method=this.__listening__[i][2];var listened_list=obj.__listeners__[attr]||[];for(var j=listened_list.length-1;j>=0;j--){if(listened_list[j][0]==method){obj.__listeners__[attr].remove(j);if(obj.__listeners__[attr].length==0){delete obj.__listeners__[attr];}break;}}this.__listening__.remove(i);}}function listenNow(obj,attrlist,method,context,boundobject){listen(obj,attrlist,method,context,boundobject);attrlist=stringToList(attrlist);for(var i=0;i<attrlist.length;i++){method.call(context||this,obj[attrlist[i]]);}return obj;}function send(obj,attr,val){if(val===undefined){val=obj[attr];}var args=Array();for(var i=0;i<arguments.length;i++){args.push(arguments[i]);}args=args.length>3?args.slice(2):false;if(!obj.__listeners__||!obj.__listeners__[attr]){return;}var regAttrs=obj.__listeners__[attr];var to_run=[];for(var i=0;i<regAttrs.length;i++){to_run.push([regAttrs[i][0],regAttrs[i][1]]);}if(args===false){for(var i=0;i<to_run.length;i++){if(to_run[i][0]){to_run[i][0].call(to_run[i][1]?to_run[i][1]:obj,val,obj,attr);}}}else{for(var i=0;i<to_run.length;i++){if(to_run[i][0]){to_run[i][0].apply(to_run[i][1]?to_run[i][1]:obj,args);}}}return obj;}function fire(obj,attr,val){var args=Array();for(var i=0;i<arguments.length;i++){args.push(arguments[i]);}args=args.slice(2);var retval;if(typed(obj[attr],Function)){retval=obj[attr].apply(obj,args);}if(retval===false){return false;}if(!obj.__listeners__||!obj.__listeners__[attr]){return retval;}var regAttrs=obj.__listeners__[attr];var to_run=[];for(var i=0;i<regAttrs.length;i++){to_run.push([regAttrs[i][0],regAttrs[i][1]]);}if(args.length){for(var i=0;i<to_run.length;i++){if(to_run[i][0]){to_run[i][0].call(to_run[i][1]?to_run[i][1]:obj,val,obj,attr);}}}else{for(var i=0;i<to_run.length;i++){if(to_run[i][0]){to_run[i][0].apply(to_run[i][1]?to_run[i][1]:obj,args);}}}return retval;}function set(obj,attr,val){obj[attr]=val;var args=Array();for(var i=0;i<arguments.length;i++){args.push(arguments[i]);}if(args.length>3){args=args.slice(2);args.insert(obj,0);args.insert(attr,1);send.apply(this,args);}else{send(obj,attr,val);}return obj;}function toggle(obj,attr){set(obj,attr,!obj[attr]);return obj;}function ensure(obj,attr,val){obj[attr]!=val&&set(obj,attr,val);return obj;}function is(obj,attr){!obj[attr]&&set(obj,attr,true);return obj;}function isnt(obj,attr){obj[attr]&&set(obj,attr,false);return obj;}var unset=function(obj,attr){set(obj,attr);return obj;};var conditionalSend=function(obj,attr,custom_function){if(!obj.__listeners__||!obj.__listeners__[attr]){return;}var listeners=obj.__listeners__[attr]||[];var to_run=[];for(var j=0;j<listeners.length;j++){to_run.push([listeners[j][0],listeners[j][1]]);}try{for(var j=0;j<to_run.length;j++){if(to_run[j][0]&&(custom_function(to_run[j][0],to_run[j][1])===false)){return false;}}}catch(err){return false;}return;};var _traversalFunction=function(target,initialOperation,names,returnJQObjFlag,suppress_no_name_error){names=names.split(".");var tagtype="";if(names[0].indexOf(".")!==-1){var parts=names[0].split(":");tagtype=parts[0];names[0]=parts[1];}var whereto=[[initialOperation,names[0],tagtype]];for(var i=1;i<names.length;i++){var mode=0;if(names[i].length===0){mode=1;++i;}var tagtype="";if(names[i].indexOf(".")!==-1){var parts=names[i].split(".");tagtype=parts[0];names[i]=parts[1];}var sibling=undefined;if(names[i].indexOf(":")!==-1){var parts=names[i].split("|");names[i]=parts[0];sibling=parts[1];}whereto.push([mode,names[i],tagtype]);if(sibling){var tagtype="";if(sibling.indexOf(".")!==-1){var parts=sibling.split(":");tagtype=parts[0];sibling=parts[1];}whereto.push([2,sibling,tagtype]);}}for(var i=0;i<whereto.length;i++){var entry=whereto[i];if(entry[0]===0){target=target.children(entry[2]+" [name="+entry[1]+"]");}else{if(entry[0]===1){target=target.find(entry[2]+" [name="+entry[1]+"]");}else{if(entry[0]===2){target=target.parent().children(entry[2]+" [name="+entry[1]+"]");}}}if(target[1]){throw"traversal over "+names+" returned more then one node named '"+entry[2]+" "+entry[1]+"' in:\n\n"+PrintXML(target);}else{if(!target){throw"traversal over "+names+" returned no nodes node named '"+entry[2]+" "+entry[1]+"' in:\n\n"+PrintXML(target);}}}var to_return=returnJQObjFlag?target:target[0];if(!suppress_no_name_error&&!to_return){var mode_names=["child","named","sibling"];throw"We tried to find something "+mode_names[initialOperation]+" '"+names+"' returned nothing, in:\n\n"+PrintXML(target);}return to_return;};if($.fn.child){throw new Error("$.fn['child'] already defined! (hypertag.js trying to redefine it)");}$.fn.child=function(names){return _traversalFunction(this,0,names,false,false);};if($.fn.named){throw new Error("$.fn['named'] already defined! (hypertag.js trying to redefine it)");}$.fn.named=function(names){return _traversalFunction(this,1,names,false,false);};if($.fn.sibling){throw new Error("$.fn['named'] already defined! (hypertag.js trying to redefine it)");}$.fn.sibling=function(names){return _traversalFunction(this,2,names,false,false);};if($.fn.jchild){throw new Error("$.fn['jchild'] already defined! (hypertag.js trying to redefine it)");}$.fn.jchild=function(names){return _traversalFunction(this,0,names,true,false);};if($.fn.jnamed){throw new Error("$.fn['jnamed'] already defined! (hypertag.js trying to redefine it)");}$.fn.jnamed=function(names){return _traversalFunction(this,1,names,true,false);};if($.fn.jsibling){throw new Error("$.fn['jsibling'] already defined! (hypertag.js trying to redefine it)");}$.fn.jsibling=function(names){return _traversalFunction(this,2,names,true,false);};if($.fn["$child"]){throw new Error("$.fn['$child'] already defined! (hypertag.js trying to redefine it)");}$.fn.$child=function(names){return _traversalFunction(this,0,names,true,false);};if($.fn["$named"]){throw new Error("$.fn['$named'] already defined! (hypertag.js trying to redefine it)");}$.fn.$named=function(names){return _traversalFunction(this,1,names,true,false);};if($.fn["$sibling"]){throw new Error("$.fn['$sibling'] already defined! (hypertag.js trying to redefine it)");}$.fn.$sibling=function(names){return _traversalFunction(this,2,names,true,false);};if($.fn.hasChild){throw new Error("$.fn['hasChild'] already defined! (hypertag.js trying to redefine it)");}$.fn.hasChild=function(names){return _traversalFunction(this,0,names,false,true);};if($.fn.hasNamed){throw new Error("$.fn['hasNamed'] already defined! (hypertag.js trying to redefine it)");}$.fn.hasNamed=function(names){return _traversalFunction(this,1,names,false,true);};if($.fn.hasSibling){throw new Error("$.fn['hasSibling'] already defined! (hypertag.js trying to redefine it)");}$.fn.hasSibling=function(names){return _traversalFunction(this,2,names,false,true);};if($.fn.top){throw new Error("$.fn['top'] already defined! (hypertag.js trying to redefine it)");}$.fn.top=function(val){return val!==undefined?this.css("top","px%".indexOf(String(val).slice(-2))===-1?String(val)+"px":val):parseInt(this.css("top").slice(0,-2),10);};if($.fn.left){throw new Error("$.fn['top'] already defined! (hypertag.js trying to redefine it)");}$.fn.left=function(val){return val!==undefined?this.css("left","px%".indexOf(String(val).slice(-2))===-1?String(val)+"px":val):parseInt(this.css("left").slice(0,-2),10);};if($.fn.bottom){throw new Error("$.fn['bottom'] already defined! (hypertag.js trying to redefine it)");}$.fn.bottom=function(val){return val!==undefined?this.css("bottom","px%".indexOf(String(val).slice(-2))===-1?String(val)+"px":val):parseInt(this.css("bottom").slice(0,-2),10);};if($.fn.right){throw new Error("$.fn['right'] already defined! (hypertag.js trying to redefine it)");}$.fn.right=function(val){return val!==undefined?this.css("right","px%".indexOf(String(val).slice(-2))===-1?String(val)+"px":val):parseInt(this.css("right").slice(0,-2),10);};if($.fn.opacity){throw new Error("$.fn['top'] already defined! (hypertag.js trying to redefine it)");}$.fn.opacity=function(val){return val!==undefined?this.css("opacity",val):parseFloat(this.css("opacity"));};if($.fn.zindex){throw new Error("$.fn['zindex'] already defined! (hypertag.js trying to redefine it)");}$.fn.zindex=function(val){return val!==undefined?this.css("z-index",val):this.css("z-index");};if($.fn.reverse){throw new Error("$.fn['reverse'] already defined! (hypertag.js trying to redefine it)");}$.fn.reverse=function(){this.pushStack(this.get().reverse());return this;};if($.fn.scrollToBottom){throw new Error("$.fn['scrollToBottom'] already defined! (hypertag.js trying to redefine it)");}$.fn.scrollToBottom=function(){animate(this,{scrollTop:$(this).prop("scrollHeight")},Hypertag.GUI.duration);};if($.fn.scrollToTop){throw new Error("$.fn['scrollToTop'] already defined! (hypertag.js trying to redefine it)");}$.fn.scrollToTop=function(){animate(this,{scrollTop:0},Hypertag.GUI.duration);};if($.fn.scrollTo){throw new Error("$.fn['scrollToTop'] already defined! (hypertag.js trying to redefine it)");}$.fn.scrollTo=function(y,noanimFlag){var self=this[0];animate(this,{scrollTop:y},noanimFlag!==undefined?0:Hypertag.GUI.duration);set(self,"scrolledTo",y);};if($.fn.singleclick){throw new Error("$.fn['singleclick'] already defined! (hypertag.js trying to redefine it)");}$.fn.singleclick=function(onclick,ondblclick,onmouseup){var self=this[0];self._single_click_state=false;self._single_click_mouseclicks=0;self._single_click_upevent=false;$(self).mousedown(function(e){var type=e.target.getAttribute("type");if(HypertagDraggingClass.prototype._nonDraggableTargetTypes.indexOf(e.target.tagName.toLowerCase())!==-1){return true;}if(!self.drag&&!self.__dblclick__&&(!self.itemlist||!self.itemlist.__dblclickitem__)){return onclick.call(self,e);}else{e.offsetX=(e.offsetX!=null)?e.offsetX:e.originalEvent.layerX;e.offsetY=(e.offsetY!=null)?e.offsetY:e.originalEvent.layerY;self._single_click_mouseclicks+=1;self._single_click_state={x:e.offsetX,y:e.offsetY};if(self._single_click_mouseclicks==2){clearTimeout(self._single_click_timer);Math.abs(self._single_click_state.x-self._single_click_upevent.offsetX)<8&&Math.abs(self._single_click_state.y-self._single_click_upevent.offsetY)<8&&ondblclick.call(self,e);self._single_click_mouseclicks=0;self._single_click_upevent=false;}else{self._single_click_timer=setTimeout(function(){self._single_click_upevent&&self._single_click_mouseclicks==1&&Math.abs(self._single_click_state.x-self._single_click_upevent.offsetX)<8&&Math.abs(self._single_click_state.y-self._single_click_upevent.offsetY)<8&&onclick.call(self,e);self._single_click_mouseclicks=0;self._single_click_upevent=false;},Hypertag.Runtime.doubleClickDelay+1);}}return true;});$(self).mouseup(function(e){e.offsetX=(e.offsetX!=null)?e.offsetX:e.originalEvent.layerX;e.offsetY=(e.offsetY!=null)?e.offsetY:e.originalEvent.layerY;self._single_click_upevent=e;onmouseup&&onmouseup.call(self,e);return true;});};var $$=function(selector){var output=$.makeArray($(selector));return(output.length==1)?output[0]:output;};if(typeof String.prototype.trim!=="function"){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"");};}var gettype=function(obj,type){return({}).toString.call(obj).match(/\s([a-zA-Z]+)/)[1].toLowerCase();};var typed=function(obj,type){return obj&&obj.constructor===type;};var getkeys=function(dict){var keys=new Array;try{for(var o in dict){keys.push(o);}}catch(err){return["BAD KEY IN GETKEYS"];}return keys;};var stringToList=function(buf,delim){if(delim===undefined){delim=",";}if(!buf){return[];}var output=[];var comma_sep_list=String(buf).split(delim);while(comma_sep_list.length){var entry=comma_sep_list.shift().trim();if(entry){output.push(entry);}}return output;};var dir=function(obj,dontexpand){var output="";if(dontexpand===undefined){output+="Repr: "+obj+"\n";if(!(obj instanceof Array)){output+="\nAttributes: ";for(var key in obj){output+=key+", ";}output+="\n";}output+="\nContents:\n";}if(obj instanceof Array&&obj.length==0){output+="(previous is empty array)\n";}else{if(obj instanceof Array){for(var i=0;i<obj.length;i++){var val=obj[i]=="function"?"[FUNCTION]":obj[i];try{val=(typed(val,String)&&val.length>50)?(val.substr(0,50).replace("\n","")+" [...]"):val;output+=(dontexpand!==undefined?"        ":"")+i+") = "+val+"\n";}catch(err){output+=(dontexpand!==undefined?"        ":"")+i+") = (cant convert)\n";}if(dontexpand===undefined){if(obj[i] instanceof Array||obj[i] instanceof Object){output+=dir(obj[i],true);}}}}else{if(obj instanceof Object&&getkeys(obj).length==0){output+="(previous is empty dictionary)\n";}else{if(obj instanceof Object){for(var key in obj){var val=typed(obj[key],Function)?"[FUNCTION]":obj[key];try{val=(typed(val,String)&&val.length>50)?(val.substr(0,50).replace("\n","")+" [...]"):val;output+=(dontexpand!==undefined?"        ":"")+key+" = "+val+"\n";}catch(err){output+=(dontexpand!==undefined?"        ":"")+key+" = (cant convert)\n";}if(dontexpand===undefined||key=="obj"){if(obj[key] instanceof Array||obj[key] instanceof Object||key=="obj"){output+=dir(obj[key],true);}}}}else{output+="...is of type "+gettype(obj).toUpperCase();}}}}return output;};var iftest=function(what,t,f){return what?t:f;};var lessthan=function(a,b){return a<b;};var greaterthan=function(a,b){return a>b;};var copy=function(source,dest){if(!source){return dest;}if(typed(source,String)){return String(source);}if(typed(source,Number)){return Number(source);}if(dest===undefined){dest=source instanceof Array?[]:{};}if(source instanceof Array){for(var i=0;i<source.length;i++){dest[i]=source[i];}}else{if(source instanceof Object){for(var key in source){dest[key]=source[key];}}}return dest;};function deepcopy(source,dest,exclude){if(!(exclude instanceof Array)){exclude=[exclude];}if(typed(source,String)){return String(source);}if(typed(source,Number)){return Number(source);}if(dest===undefined){dest=source instanceof Array?[]:{};}var tmpspace={};for(var i=0;i!=exclude.length;i++){if(source[exclude[i]]){tmpspace[exclude[i]]=source[exclude[i]];source[exclude[i]]=undefined;}}var thecopy=$.extend(true,dest,source);for(var key in tmpspace){source[key]=tmpspace[key];thecopy[key]=tmpspace[key];}return thecopy;}var deepcopyitem=function(source,dest){return deepcopy(source,dest,"self");};var safecopy=function(source,dest){if(dest===undefined){dest={};}if(source){for(var key in source){if(!dest[key]){dest[key]=source[key];}}}return dest;};var elementcopy_non_safe_attrs=["class","style","xmlns","__listeners__","__listening__"];var elementcopy=function(source,dest){if(dest===undefined){dest={};}if(source){for(var key in source){if(elementcopy_non_safe_attrs.indexOf(key)===-1){dest[key]=source[key];}}}return dest;};var valuesAreEqual=function(a,b){for(p in a){if(typeof(b[p])=="undefined"){return false;}}for(p in a){if(a[p]){switch(typeof(a[p])){case"object":if(!a[p].equals(b[p])){return false;}break;case"function":if(typeof(b[p])=="undefined"||(p!="equals"&&a[p].toString()!=b[p].toString())){return false;}break;default:if(a[p]!=b[p]){return false;}}}else{if(b[p]){return false;}}}for(p in b){if(typeof(a[p])=="undefined"){return false;}}return true;};function getTextFromFirstChild(el){var result;$(el).contents().each(function(){if(result=$.trim($(this).text())){return false;}});return result;}var debuggingId=function(buf){if(buf===undefined){return"UNDEFINED.";}buf=$(buf);if(buf.attr("id")){return"ID: "+buf.id;}if(buf.attr("name")){return"NAME: "+buf.name;}if(buf[0]&&buf[0].isHypertag){if(buf[0].template){return"USING TEMPLATE: "+buf[0].template;}}return"HTML: "+buf.html();};function encode_utf8(s){return unescape(encodeURIComponent(s));}function decode_utf8(s){return decodeURIComponent(escape(s));}function checkDictionaryForErrors(text_to_eval,allowSlashComments){text_to_eval="var the_dict_to_test = "+text_to_eval+";";if(!allowSlashComments&&text_to_eval.match(/\s+\/\//g)){throw"You cannot use // style comments in hypertag code blocks! You must use slash-star style comments, as a side effect of the HTML DOM parser. (DOMParser iteself does allow // but a rule was indicated.) \n\nIn the code block:\n\n"+text_to_eval;}var result=JSHINT(text_to_eval,{debug:true,sub:true,loopfunc:true,multistr:true,laxcomma:false,shadow:true,onevar:false,evil:true,expr:true,funcscope:false});if(!result){var error_message="";var error=JSHINT.errors[0];error_message+=error.reason+", line "+error.line+", char "+error.character+"\n";if(error.character>80){error_message+="\n\nThe error occurred around: \n\n"+text_to_eval.slice(Math.max(0,error.character-40),Math.min(text_to_eval.length,error.character+40));}return error_message;}return false;}var post=function(options){var url=options.url;var data=options.data;var membership=options.membership;var success=options.success;var error=options.error;var async=options.async||false;var preprocess_success=options.preprocess_success;success=success!==undefined?success:function(){};if(!(data instanceof Array)){data=[data];}var json_payload={objs:[]};for(var i=0;i<data.length;i++){var entry={};for(var key in data[i]){entry[key]=JSON.stringify(data[i][key]);}json_payload.objs.push(entry);}var successwrapper=function(data,status){if(data.error||!data){alert(data.error);if(error){error(data);}return true;}if(preprocess_success){data=preprocess_success(data,status);if(!data){return false;}}if(success){success(data.objs||data,status);}if(data.msg){alert(data.msg);}return true;};var completewrapper=function(xhr){if(xhr.status!=200&&!xhr.responseText){if(error){error(url,data);}return false;}return true;};if(url.slice(0,2)=="//"){membership=getServerFromURL(url);url=url.slice(1);}else{if(!membership&&url.slice(0,1)=="/"){membership=Hypertag.Trust.default_membership;}}if(GLOBAL.fat&&membership){var membership_data=false;if(fat.exists("/Network/memberships/"+membership+".membership")){membership_data=fat.read("/Network/memberships/"+membership+".membership");}else{if(fat.exists("/Network/memberships/"+membership+".server")){membership_data=fat.read("/Network/memberships/"+membership+".server");}else{if(fat.exists("/Network/mounts/"+membership+".mount")){mount_data=fat.read("/Network/mounts/"+membership+".mount");membership_data=fat.read("/Network/memberships/"+mount_data.membership+".membership");}}}if(membership_data){url="http://"+membership_data.servers[0]+url;}}try{return $.ajax({url:encodeURI(url),type:"POST",cache:false,data:json_payload,dataType:"json",async:async,success:successwrapper,error:function(){if(error){error(url);}}});}catch(err){console.error("post() failed to load "+url+". Error was "+String(err));if(error){error(url);}return false;}};var returnCSSWidthOfElementAsInt=function(element){var amount_text=$(element).css("width");return parseInt(amount_text.substr(0,amount_text.length-2));};var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(input){var output="";var chr1,chr2,chr3,enc1,enc2,enc3,enc4;var i=0;input=Base64._utf8_encode(input);while(i<input.length){chr1=input.charCodeAt(i++);chr2=input.charCodeAt(i++);chr3=input.charCodeAt(i++);enc1=chr1>>2;enc2=((chr1&3)<<4)|(chr2>>4);enc3=((chr2&15)<<2)|(chr3>>6);enc4=chr3&63;if(isNaN(chr2)){enc3=enc4=64;}else{if(isNaN(chr3)){enc4=64;}}output=output+Base64._keyStr.charAt(enc1)+Base64._keyStr.charAt(enc2)+Base64._keyStr.charAt(enc3)+Base64._keyStr.charAt(enc4);}return output;},decode:function(input){var output="";var chr1,chr2,chr3;var enc1,enc2,enc3,enc4;var i=0;input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(i<input.length){enc1=Base64._keyStr.indexOf(input.charAt(i++));enc2=Base64._keyStr.indexOf(input.charAt(i++));enc3=Base64._keyStr.indexOf(input.charAt(i++));enc4=Base64._keyStr.indexOf(input.charAt(i++));chr1=(enc1<<2)|(enc2>>4);chr2=((enc2&15)<<4)|(enc3>>2);chr3=((enc3&3)<<6)|enc4;output=output+String.fromCharCode(chr1);if(enc3!=64){output=output+String.fromCharCode(chr2);}if(enc4!=64){output=output+String.fromCharCode(chr3);}}output=Base64._utf8_decode(output);return output;},_utf8_encode:function(string){string=string.replace(/\r\n/g,"\n");var utftext="";for(var n=0;n<string.length;n++){var c=string.charCodeAt(n);if(c<128){utftext+=String.fromCharCode(c);}else{if((c>127)&&(c<2048)){utftext+=String.fromCharCode((c>>6)|192);utftext+=String.fromCharCode((c&63)|128);}else{utftext+=String.fromCharCode((c>>12)|224);utftext+=String.fromCharCode(((c>>6)&63)|128);utftext+=String.fromCharCode((c&63)|128);}}}return utftext;},_utf8_decode:function(utftext){var string="";var i=0;var c=0,c1=0,c2=0;while(i<utftext.length){c=utftext.charCodeAt(i);if(c<128){string+=String.fromCharCode(c);i++;}else{if((c>191)&&(c<224)){c1=utftext.charCodeAt(i+1);string+=String.fromCharCode(((c&31)<<6)|(c1&63));i+=2;}else{c1=utftext.charCodeAt(i+1);c2=utftext.charCodeAt(i+2);string+=String.fromCharCode(((c&15)<<12)|((c1&63)<<6)|(c2&63));i+=3;}}}return string;}};var MD5=function(string){function RotateLeft(lValue,iShiftBits){return(lValue<<iShiftBits)|(lValue>>>(32-iShiftBits));}function AddUnsigned(lX,lY){var lX4,lY4,lX8,lY8,lResult;lX8=(lX&2147483648);lY8=(lY&2147483648);lX4=(lX&1073741824);lY4=(lY&1073741824);lResult=(lX&1073741823)+(lY&1073741823);if(lX4&lY4){return(lResult^2147483648^lX8^lY8);}if(lX4|lY4){if(lResult&1073741824){return(lResult^3221225472^lX8^lY8);}else{return(lResult^1073741824^lX8^lY8);}}else{return(lResult^lX8^lY8);}}function F(x,y,z){return(x&y)|((~x)&z);}function G(x,y,z){return(x&z)|(y&(~z));}function H(x,y,z){return(x^y^z);}function I(x,y,z){return(y^(x|(~z)));}function FF(a,b,c,d,x,s,ac){a=AddUnsigned(a,AddUnsigned(AddUnsigned(F(b,c,d),x),ac));return AddUnsigned(RotateLeft(a,s),b);}function GG(a,b,c,d,x,s,ac){a=AddUnsigned(a,AddUnsigned(AddUnsigned(G(b,c,d),x),ac));return AddUnsigned(RotateLeft(a,s),b);}function HH(a,b,c,d,x,s,ac){a=AddUnsigned(a,AddUnsigned(AddUnsigned(H(b,c,d),x),ac));return AddUnsigned(RotateLeft(a,s),b);}function II(a,b,c,d,x,s,ac){a=AddUnsigned(a,AddUnsigned(AddUnsigned(I(b,c,d),x),ac));return AddUnsigned(RotateLeft(a,s),b);}function ConvertToWordArray(string){var lWordCount;var lMessageLength=string.length;var lNumberOfWords_temp1=lMessageLength+8;var lNumberOfWords_temp2=(lNumberOfWords_temp1-(lNumberOfWords_temp1%64))/64;var lNumberOfWords=(lNumberOfWords_temp2+1)*16;var lWordArray=Array(lNumberOfWords-1);var lBytePosition=0;var lByteCount=0;while(lByteCount<lMessageLength){lWordCount=(lByteCount-(lByteCount%4))/4;lBytePosition=(lByteCount%4)*8;lWordArray[lWordCount]=(lWordArray[lWordCount]|(string.charCodeAt(lByteCount)<<lBytePosition));lByteCount++;}lWordCount=(lByteCount-(lByteCount%4))/4;lBytePosition=(lByteCount%4)*8;lWordArray[lWordCount]=lWordArray[lWordCount]|(128<<lBytePosition);lWordArray[lNumberOfWords-2]=lMessageLength<<3;lWordArray[lNumberOfWords-1]=lMessageLength>>>29;return lWordArray;}function WordToHex(lValue){var WordToHexValue="",WordToHexValue_temp="",lByte,lCount;for(lCount=0;lCount<=3;lCount++){lByte=(lValue>>>(lCount*8))&255;WordToHexValue_temp="0"+lByte.toString(16);WordToHexValue=WordToHexValue+WordToHexValue_temp.substr(WordToHexValue_temp.length-2,2);}return WordToHexValue;}function Utf8Encode(string){string=string.replace(/\r\n/g,"\n");var utftext="";for(var n=0;n<string.length;n++){var c=string.charCodeAt(n);if(c<128){utftext+=String.fromCharCode(c);}else{if((c>127)&&(c<2048)){utftext+=String.fromCharCode((c>>6)|192);utftext+=String.fromCharCode((c&63)|128);}else{utftext+=String.fromCharCode((c>>12)|224);utftext+=String.fromCharCode(((c>>6)&63)|128);utftext+=String.fromCharCode((c&63)|128);}}}return utftext;}var x=Array();var k,AA,BB,CC,DD,a,b,c,d;var S11=7,S12=12,S13=17,S14=22;var S21=5,S22=9,S23=14,S24=20;var S31=4,S32=11,S33=16,S34=23;var S41=6,S42=10,S43=15,S44=21;string=Utf8Encode(string);x=ConvertToWordArray(string);a=1732584193;b=4023233417;c=2562383102;d=271733878;for(k=0;k<x.length;k+=16){AA=a;BB=b;CC=c;DD=d;a=FF(a,b,c,d,x[k+0],S11,3614090360);d=FF(d,a,b,c,x[k+1],S12,3905402710);c=FF(c,d,a,b,x[k+2],S13,606105819);b=FF(b,c,d,a,x[k+3],S14,3250441966);a=FF(a,b,c,d,x[k+4],S11,4118548399);d=FF(d,a,b,c,x[k+5],S12,1200080426);c=FF(c,d,a,b,x[k+6],S13,2821735955);b=FF(b,c,d,a,x[k+7],S14,4249261313);a=FF(a,b,c,d,x[k+8],S11,1770035416);d=FF(d,a,b,c,x[k+9],S12,2336552879);c=FF(c,d,a,b,x[k+10],S13,4294925233);b=FF(b,c,d,a,x[k+11],S14,2304563134);a=FF(a,b,c,d,x[k+12],S11,1804603682);d=FF(d,a,b,c,x[k+13],S12,4254626195);c=FF(c,d,a,b,x[k+14],S13,2792965006);b=FF(b,c,d,a,x[k+15],S14,1236535329);a=GG(a,b,c,d,x[k+1],S21,4129170786);d=GG(d,a,b,c,x[k+6],S22,3225465664);c=GG(c,d,a,b,x[k+11],S23,643717713);b=GG(b,c,d,a,x[k+0],S24,3921069994);a=GG(a,b,c,d,x[k+5],S21,3593408605);d=GG(d,a,b,c,x[k+10],S22,38016083);c=GG(c,d,a,b,x[k+15],S23,3634488961);b=GG(b,c,d,a,x[k+4],S24,3889429448);a=GG(a,b,c,d,x[k+9],S21,568446438);d=GG(d,a,b,c,x[k+14],S22,3275163606);c=GG(c,d,a,b,x[k+3],S23,4107603335);b=GG(b,c,d,a,x[k+8],S24,1163531501);a=GG(a,b,c,d,x[k+13],S21,2850285829);d=GG(d,a,b,c,x[k+2],S22,4243563512);c=GG(c,d,a,b,x[k+7],S23,1735328473);b=GG(b,c,d,a,x[k+12],S24,2368359562);a=HH(a,b,c,d,x[k+5],S31,4294588738);d=HH(d,a,b,c,x[k+8],S32,2272392833);c=HH(c,d,a,b,x[k+11],S33,1839030562);b=HH(b,c,d,a,x[k+14],S34,4259657740);a=HH(a,b,c,d,x[k+1],S31,2763975236);d=HH(d,a,b,c,x[k+4],S32,1272893353);c=HH(c,d,a,b,x[k+7],S33,4139469664);b=HH(b,c,d,a,x[k+10],S34,3200236656);a=HH(a,b,c,d,x[k+13],S31,681279174);d=HH(d,a,b,c,x[k+0],S32,3936430074);c=HH(c,d,a,b,x[k+3],S33,3572445317);b=HH(b,c,d,a,x[k+6],S34,76029189);a=HH(a,b,c,d,x[k+9],S31,3654602809);d=HH(d,a,b,c,x[k+12],S32,3873151461);c=HH(c,d,a,b,x[k+15],S33,530742520);b=HH(b,c,d,a,x[k+2],S34,3299628645);a=II(a,b,c,d,x[k+0],S41,4096336452);d=II(d,a,b,c,x[k+7],S42,1126891415);c=II(c,d,a,b,x[k+14],S43,2878612391);b=II(b,c,d,a,x[k+5],S44,4237533241);a=II(a,b,c,d,x[k+12],S41,1700485571);d=II(d,a,b,c,x[k+3],S42,2399980690);c=II(c,d,a,b,x[k+10],S43,4293915773);b=II(b,c,d,a,x[k+1],S44,2240044497);a=II(a,b,c,d,x[k+8],S41,1873313359);d=II(d,a,b,c,x[k+15],S42,4264355552);c=II(c,d,a,b,x[k+6],S43,2734768916);b=II(b,c,d,a,x[k+13],S44,1309151649);a=II(a,b,c,d,x[k+4],S41,4149444226);d=II(d,a,b,c,x[k+11],S42,3174756917);c=II(c,d,a,b,x[k+2],S43,718787259);b=II(b,c,d,a,x[k+9],S44,3951481745);a=AddUnsigned(a,AA);b=AddUnsigned(b,BB);c=AddUnsigned(c,CC);d=AddUnsigned(d,DD);}var temp=WordToHex(a)+WordToHex(b)+WordToHex(c)+WordToHex(d);return temp.toLowerCase();};var getWindowSize=function(){if(document.body&&document.body.offsetWidth){winW=document.body.offsetWidth;winH=document.body.offsetHeight;}else{if(document.compatMode=="CSS1Compat"&&document.documentElement&&document.documentElement.offsetWidth){winW=document.documentElement.offsetWidth;winH=document.documentElement.offsetHeight;}else{if(window.innerWidth&&window.innerHeight){winW=window.innerWidth;winH=window.innerHeight;}}}return[winW,winH];};var range=function(start,stop,yield){if(stop==undefined){stop=start;start=0;}if(yield){for(var buf=[],i=start;i<stop;i++){buf.push(yield(i));}}else{for(var buf=[],i=start;i<stop;i++){buf.push(i);}}return buf;};var numericalSort=function(a,b){a=parseInt(a);b=parseInt(b);if(a<b){return -1;}else{if(a==b){return 0;}else{if(a>b){return 1;}}}};Array.prototype.sortByKey=function(key,extract,sortfunc){var key_value_and_object_pairs=[];for(var i=0;i!=this.length;i++){key_value_and_object_pairs.push([this[i][key],this[i]]);}key_value_and_object_pairs=key_value_and_object_pairs.sort(sortfunc);var output=[];if(extract===undefined){for(var i=0;i!=key_value_and_object_pairs.length;i++){output.push(key_value_and_object_pairs[i][1]);}}else{for(var i=0;i!=key_value_and_object_pairs.length;i++){output.push(key_value_and_object_pairs[i][1][extract]);}}return output;};if(!Array.prototype.extend){Array.prototype.extend=function(withwhat){for(var i=0;i<withwhat.length;i++){this.push(withwhat[i]);}return this;};}else{alert("Array.extend already defined!");}if(!Array.prototype.omit){Array.prototype.omit=function(removefromlist){if(!(removefromlist instanceof Array)){removefromlist=[removefromlist];}for(var i=this.length-1;i!=-1;i--){if(removefromlist.indexOf(this[i])!==-1){this.remove(i);}}return this;};}else{alert("Array.omit already defined!");}if(!Array.prototype.endswith){Array.prototype.endswith=function(what){if(!what){return this;}var filtered=[];for(var i=0;i<this.length;i++){if(typed(this[i],String)&&this[i].endswith(what)){filtered.push(this[i]);}}return filtered;};}else{alert("Array.endswith already defined!");}if(!Array.prototype.startswith){Array.prototype.startswith=function(what){var filtered=[];for(var i=0;i<this.length;i++){if(typed(this[i],String)&&this[i].startswith(what)){filtered.push(this[i]);}}return filtered;};}else{alert("Array.startswith already defined!");}Array.prototype.thread=function(operation,progress,complete,interval){var items=this;var interval=interval||10;var operation_method=function(idx){var result=operation(items[idx],idx);items[idx]=result===undefined?items[idx]:result;++idx;if(idx==items.length){return complete(items,idx);}if(progress&&progress(items,idx)===false){return;}setTimeout(operation_method,interval,idx);};setTimeout(operation_method,interval,0);return this;};if(!String.prototype.removeEnding){String.prototype.removeEnding=function(what){if(this.endswith(what)){return this.slice(0,-what.length);}return this;};}else{alert("Array.endswith already defined!");}if(!String.prototype.count){String.prototype.count=function(substr){var num,pos;num=pos=0;if(!this.length){return 0;}while(pos=1+this.indexOf(substr,pos)){num++;}return num;};}else{alert("String.count already defined!");}if(!Array.prototype.sorted){Array.prototype.sorted=function(withFunction){this.sort(withFunction);return this;};}else{alert("Array.startswith already defined!");}var elemToDict=function(obj){var output={};for(var key in obj){output[key]=obj[key];}return output;};function wait(msecs){var start=new Date().getTime();var cur=start;while(cur-start<msecs){cur=new Date().getTime();}}function getViewOffset(node,singleFrame){function addOffset(node,coords,view){var p=node.offsetParent;coords.x+=node.offsetLeft-(p?p.scrollLeft:0);coords.y+=node.offsetTop-(p?p.scrollTop:0);if(p){if(p.nodeType==1){var parentStyle=view.getComputedStyle(p,"");if(parentStyle.position!="static"){coords.x+=parseInt(parentStyle.borderLeftWidth);coords.y+=parseInt(parentStyle.borderTopWidth);if(p.localName=="TABLE"){coords.x+=parseInt(parentStyle.paddingLeft);coords.y+=parseInt(parentStyle.paddingTop);}else{if(p.localName=="BODY"){var style=view.getComputedStyle(node,"");coords.x+=parseInt(style.marginLeft);coords.y+=parseInt(style.marginTop);}}}else{if(p.localName=="BODY"){coords.x+=parseInt(parentStyle.borderLeftWidth);coords.y+=parseInt(parentStyle.borderTopWidth);}}var parent=node.parentNode;while(p!=parent){coords.x-=parent.scrollLeft;coords.y-=parent.scrollTop;parent=parent.parentNode;}addOffset(p,coords,view);}}else{if(node.localName=="BODY"){var style=view.getComputedStyle(node,"");coords.x+=parseInt(style.borderLeftWidth);coords.y+=parseInt(style.borderTopWidth);var htmlStyle=view.getComputedStyle(node.parentNode,"");coords.x-=parseInt(htmlStyle.paddingLeft);coords.y-=parseInt(htmlStyle.paddingTop);}if(node.scrollLeft){coords.x+=node.scrollLeft;}if(node.scrollTop){coords.y+=node.scrollTop;}var win=node.ownerDocument.defaultView;if(win&&(!singleFrame&&win.frameElement)){addOffset(win.frameElement,coords,win);}}}var coords={x:0,y:0};if(node){addOffset(node,coords,node.ownerDocument.defaultView);}return coords;}function mod(a,b){return a%b;}function checksum(s){var i;var chk=305419896;for(i=0;i<s.length;i++){chk+=(s.charCodeAt(i)*i);}return chk;}function dictToList(d){var output=[];for(var key in d){output.push([key,{key:key,value:d[key]}]);}output.sort();var final_output=[];for(var i=0;i<output.length;i++){final_output.push(output[i][1]);}return final_output;}var stopEvent=function(e){stopPropagation(e);preventDefault(e);return false;};var stopPropagation=function(e){if(e.stopPropagation){e.stopPropagation();}else{e.cancelBubble=true;}};var preventDefault=function(e){if(e.preventDefault){e.preventDefault();}else{e.returnValue=false;}};var onscroll=function(element,fun){$(element).scroll(fun);if(element.addEventListener){element.addEventListener("DOMMouseScroll",fun,false);element.addEventListener("mousewheel",fun,false);}else{element.onmousewheel=fun;}};var addEventHandler=function(obj,evt,handler,order){if(obj.addEventListener){obj.addEventListener(evt,handler,order||false);}else{if(obj.attachEvent){obj.attachEvent("on"+evt,handler);}else{obj["on"+evt]=handler;}}};var round_up=function(num,factor){return(num+factor-1-(num-1)%factor)-factor;};var openAnimation=function(item,after,duration){if(!duration){duration=300;}$(item).animate({scale:1.5,opacity:0.3,rotate:"8deg"},(duration/3)*2);$(item).animate({scale:1,opacity:1,rotate:"0deg"},duration/3-10);setTimeout(function(){after();},duration+10);};function parseQueryString(query_string_text){var urlParams={};var add_char_rgx=/\+/g;var param_split_rgx=/([^&=]+)=?([^&]*)/g;var decodeParam=function(buf){return decodeURIComponent(buf.replace(add_char_rgx," "));};var results;while(results=param_split_rgx.exec(query_string_text)){urlParams[decodeParam(results[1])]=decodeParam(results[2]);}return urlParams;}var getServerFromURL=function(url){return url.match(/:\/\/(.[^/]+)/)[1];};function makepath(folder,file,extension){return extension?folder+"/"+file:folder+"/"+file+"."+extension;}var lt=String.fromCharCode(60),gt=String.fromCharCode(62);function haskeys(obj){for(var i in obj){return true;}return false;}function urlEncode(url){return encodeURIComponent(url).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A");}function getXmlHttpObject(){var xmlHttp=null;try{xmlHttp=new XMLHttpRequest();}catch(e){try{xmlHttp=new ActiveXObject("Msxml2.XMLHTTP");}catch(e){xmlHttp=new ActiveXObject("Microsoft.XMLHTTP");}}return xmlHttp;}var SHMLClass=function(indent_amt){var self=this;self.indent_amt=indent_amt!==undefined?indent_amt:4;self.html_comment_open_symbol="<!--";self.html_comment_close_symbol="-->";self.js_comment_open_symbol="/*";self.js_comment_close_symbol="*/";self.js_comment_line_symbol="//";return self;};SHMLClass.prototype.processTemplateText=function(templatetext){if(templatetext.trim().indexOf("<!--")===0){var end_of_directive_idx=templatetext.indexOf("-->");var comment_content=templatetext.slice(templatetext.indexOf("<!--")+4,end_of_directive_idx-1).trim().toLowerCase();if(comment_content=="markup shml"||comment_content=="dialect shml"){return this.process(templatetext).replace("&amp;","&");}else{return templatetext;}}else{return templatetext;}};SHMLClass.prototype.process=function(buf,autodetect_indent_amt){var self=this;if(autodetect_indent_amt===undefined){autodetect_indent_amt=true;}self.lines=buf.split("\n");if(autodetect_indent_amt){self.indent_amt=self.detectIndent(self.lines);}self.html_comments_open=0;self.js_comments_open=0;var output=[];while(self.lines.length!==0){output.push("\n");output.extend(self.recursiveProcessor());}return output.join("\n");};SHMLClass.prototype.detectIndent=function(lines){var self=this;var first_indent=false;for(var i=0;i<lines.length;i++){var line=String(lines[i]);if(line.trim().length===0){continue;}indent=line.length-line.ltrim().length;if(first_indent===false){first_indent=indent;continue;}else{if(indent>first_indent){return indent-first_indent;}}}return 4;};SHMLClass.prototype.makeIndent=function(amt){buf=[];while(buf.length<amt){buf.push(" ");}return buf.join("");};SHMLClass.prototype._selfClosingTags={area:true,base:true,basefont:true,br:true,col:true,frame:true,hr:true,img:true,input:true,isindex:true,link:true,meta:true,param:true};SHMLClass.prototype.recursiveProcessor=function(base_indent,base_actual_indent){var self=this;if(base_indent===undefined){base_indent=0;}if(base_actual_indent===undefined){base_actual_indent=-1;}var output=[];var still_searching_for_base_indent=true;var tagname,attr,text;var current_indent=base_indent;while(1){if(self.lines.length===0){if(!still_searching_for_base_indent&&!self._selfClosingTags[tagname]){output.push(self.makeIndent(current_indent*self.indent_amt)+"</"+tagname+">");}break;}var line=self.lines[0];var strippedline=String(line.trim());if(strippedline.length===0||self.skipLineIfInCommentBlock(strippedline)){self.lines.shift();continue;}var is_new_elem=strippedline.startswith("<")&&(strippedline[1]!="!")&&(strippedline[1]!="%");current_actual_indent=line.length-line.ltrim().length;if(is_new_elem&&strippedline.startswith("</")){throw"There is no need for close tags in a SHML file! (offending lines are:)\n"+self.lines.slice(0,10).join("\n")+"\n";}if(still_searching_for_base_indent&&is_new_elem){if(line.indexOf(">")===-1){line=line.rtrim();self.lines.shift();while(self.lines[0].indexOf(">")===-1){line+=" "+self.lines[0].trim();self.lines.shift();}line+=" "+self.lines[0].trim();strippedline=line.trim();}try{var tagname=strippedline.split("<").slice(1)[0].split(">").slice(0)[0].split(" ")[0];var attrs=strippedline.slice(strippedline.indexOf(tagname)+tagname.length).split(">")[0];var text=strippedline.split(">").slice(1).join(">");}catch(err){throw"It is probable your SHML has an error. it was detected when parsing this line: '"+line+"' Error is "+err;}base_actual_indent=current_actual_indent;still_searching_for_base_indent=false;if(self._selfClosingTags[tagname]){output.push(self.makeIndent(current_indent*self.indent_amt)+"<"+tagname+attrs+"/>");if(text){console.error("SHML found text in a self closing tag ("+tagname+") which is: "+text+". The context was around:\n\n",output.slice(-2,-1).join("\n")+"\n"+self.lines[0]);}}else{output.push(self.makeIndent(current_indent*self.indent_amt)+"<"+tagname+attrs+">");text&&output.push(self.makeIndent((current_indent+1)*self.indent_amt)+text);}}else{if(current_actual_indent<=base_actual_indent){still_searching_for_base_indent=true;if(!self._selfClosingTags[tagname]){output.push(self.makeIndent(current_indent*self.indent_amt)+"</"+tagname+">");}current_indent-=1;return output;}else{if(is_new_elem){output.extend(self.recursiveProcessor(current_indent+1,current_actual_indent));continue;}else{output.push(line);}}}if(self.lines.length){self.lines.shift();}}return output;};SHMLClass.prototype.skipLineIfInCommentBlock=function(strippedline){var self=this;strippedline=String(strippedline);if(!self.js_comments_open){if(self.html_comments_open){self.html_comments_open+=strippedline.count(self.html_comment_open_symbol);}else{if(strippedline.startswith(self.html_comment_open_symbol)){self.html_comments_open+=strippedline.count(self.html_comment_open_symbol);}}if(self.html_comments_open){self.html_comments_open-=strippedline.count(self.html_comment_close_symbol);return true;}}if(!self.html_comments_open){if(self.js_comments_open){self.js_comments_open+=strippedline.count(self.js_comment_open_symbol);}else{if(strippedline.startswith(self.js_comment_open_symbol)){self.js_comments_open+=strippedline.count(self.js_comment_open_symbol);}}if(self.js_comments_open){self.js_comments_open-=strippedline.count(self.js_comment_close_symbol);return true;}}if(strippedline.startswith(self.js_comment_line_symbol)){return true;}return self.html_comments_open||self.js_comments_open;};(function($){$.QueryString=(function(a){if(a==""){return{};}var b={};for(var i=0;i<a.length;++i){var p=a[i].split("=");if(p.length!=2){continue;}b[p[0]]=decodeURIComponent(p[1].replace(/\+/g," "));}return b;})(window.location.search.substr(1).split("&"));})(jQuery);var _clickableMethod=function(){var self=this;self.self=self;Hypertag.Runtime.makeElementNavigable(self);var load=self.getAttribute("__load__");if(load&&typed(load,String)){eval("self.__load__ = function(){"+load+";}");}var mousedown=self.getAttribute("__mousedown__")||self.getAttribute("__click__");if(mousedown&&typed(mousedown,String)){eval("self.__mousedown__ = function(){"+mousedown+";}");}if(self.__mousedown__){$(self).mousedown(self.__mousedown__);}var hoverselectable_flag=self.getAttribute("hoverselectable");if(!hoverselectable_flag||hoverselectable_flag!="false"){makeHoverSelectable(this);}if(self.__load__){fire(self,"__load__");}};var _changeableMethod=function(){var self=this;self.self=self;Hypertag.Runtime.makeElementNavigable(self);var load=self.getAttribute("__load__");if(load&&typed(load,String)){eval("self.__load__ = function(){"+load+";}");}var change=self.getAttribute("__change__");if(change&&typed(change,String)){eval("self.__change__ = function(event){"+change+";}");}var keydown=self.getAttribute("__keydown__");if(keydown&&typed(keydown,String)){eval("self.__keydown__ = function(event){"+keydown+";}");}var mousedown=self.getAttribute("__mousedown__")||self.getAttribute("__click__");if(mousedown&&typed(mousedown,String)){eval("self.__mousedown__ = function(){"+mousedown+";}");}var blur=self.getAttribute("__blur__")||self.getAttribute("__blur__");if(blur&&typed(blur,String)){eval("self.__blur__ = function(){"+blur+";}");}var focus=self.getAttribute("__focus__")||self.getAttribute("__focus__");if(focus&&typed(focus,String)){eval("self.__focus__ = function(){"+focus+";}");}if(self.__mousedown__){$(self).mousedown(self.__mousedown__);}if(self.__change__){$(self).change(self.__change__);}if(self.__keydown__){$(self).keydown(self.__keydown__);}if(self.__blur__){$(self).blur(self.__blur__);}if(self.__focus__){$(self).focus(self.__focus__);}if(self.__load__){fire(self,"__load__");}};var _makeElementNavigiable=function(){var self=this;Hypertag.Runtime.makeElementNavigable(self);for(var i=0;i!=self.attributes.length;i++){var attrname=self.attributes[i].nodeName;if(attrname.startswith("on")||attrname.startsendswith("__")){var load=self.getAttribute(attrname);if(load&&typed(load,String)){eval("self."+attrname+" = function(){"+load+";}");}}}if(self.__load__){fire(self,"__load__");}};Hypertag.Runtime.addCSSTrait(".clickable",_clickableMethod);Hypertag.Runtime.addCSSTrait(".button",_clickableMethod);Hypertag.Runtime.addCSSTrait(".changeable",_changeableMethod);Hypertag.Runtime.addCSSTrait(".self",_makeElementNavigiable);var animate=function(elem,attrs,options){if(!(options instanceof Object)){options={duration:options};}options.queue=options.queue||false;return $(elem).animate(attrs,options);};var settled=setTimeout;var CompilerClass=function(){var self=this;self.debug=true;self.uuid_to_name_debug_lookup={};return self;};CompilerClass.prototype.DumpHypertagTemplatesToConsole=function(){$("script").each(function(){if(this.type=="text/hypertag"){var scr_name=(this.getAttribute("server")||"*")+"/"+this.getAttribute("id");Hypertag.Runtime.TemplateCache(scr_name);}});var output="/* Compiled templates by/for the Hypertag Framework, created on "+new Date()+".\n   See http://hypertagworks.com for more info.\n*/\n\n";output+='Hypertag.Runtime.SavedTemplateTagType.push("'+Base64.encode(JSON.stringify(Hypertag.Runtime.TemplateTagType))+'");';output+='Hypertag.Runtime.SavedTemplateLowercaseLookup.push("'+Base64.encode(JSON.stringify(Hypertag.Runtime.TemplateLowercaseLookup))+'");';output+='Hypertag.Runtime.SavedExtendsTemplateLookup.push("'+Base64.encode(JSON.stringify(Hypertag.Runtime.ExtendsTemplateLookup))+'");';var cache=Hypertag.Runtime.CompiledTemplateCache;var optionscache=Hypertag.Runtime.CompiledTemplateOptionsTextCache;for(var key in cache){output+='Hypertag.Runtime.SavedCompiledTemplateCache["'+key+'"]="'+Base64.encode(String(cache[key]).replace(" anonymous",""))+'";';output+='Hypertag.Runtime.SavedCompiledTemplateOptionsCache["'+key+'"]="'+Base64.encode(String(optionscache[key]))+'";';}console.log(output);return output;};CompilerClass.prototype.guid=function(){return"X"+TrustOS.uuid(22).replace(/\//g,"_").replace(/\+/g,"-");};CompilerClass.prototype.ImportIntoTemplateCache=function(template_name){var self=this;if(template_name.indexOf("/")==-1){template_name="*/"+template_name;}if(Hypertag.Runtime.TemplateNodesByServer[template_name]){var templatenode=Hypertag.Runtime.TemplateNodesByServer[template_name];}else{if(template_name.indexOf("*/")==0){var templatenode=$("#"+template_name.slice(2))[0];}}if(!templatenode){var msg="A template by the name of "+template_name+" was invoked, but no local or imported template by that name exists.";throw msg;}templatenode=self._parseAttributesIntoCodeBlock(templatenode);var css_name=template_name.slice(template_name.indexOf("/")+1);var templatenode_text=PrintXML(templatenode).replace(/\&lt\;/g,"<").replace(/\&gt\;/g,">").replace(/\[\=/g,"{{= ").replace(/\=\]/g,"}}").replace(/\\\/\\\//g,"//").replace(/\&quot\;/g,'"').replace(/\&(?!\w|\#)/g,"&amp;");var template_dom=ParseXML("<div xmlns='http://www.w3.org/1999/xhtml'></div>");var template_nodes=ParseXML(templatenode_text);for(var i=0;i<template_nodes.childNodes.length;i++){template_dom.appendChild(template_nodes.childNodes[i].cloneNode(true));}var codeblock="";var nodesToRemove=[];for(var i=0,node;(node=template_dom.childNodes[i]);i++){if(node.nodeType==3){codeblock+=node.nodeValue;nodesToRemove.push(node);}else{if(node.nodeType==8){nodesToRemove.push(node);}}}var node;while((node=nodesToRemove.shift())){template_dom.removeChild(node);}if(codeblock){codeblock=codeblock.replace(/\%lt\;/g,"<").replace(/\%gt\;/g,">").replace(/\{\-/g,"<").replace(/\-\}/g,">").replace(/\&quot\;/g,'"').replace(/\&amp\;/g,"&");codeblock=codeblock.trim();if(codeblock.slice(-1)==","){codeblock=codeblock.slice(0,codeblock.length-1);}codeblock="{"+codeblock+"}";if(Hypertag.Runtime.debug){var result=checkDictionaryForErrors(codeblock);if(result){throw"SYNTAX ERROR: "+String(result)+"\n\nCode is:\n\n"+Hypertag.Runtime.addLineNumbers(codeblock);}}Hypertag.Runtime.CompiledTemplateOptionsTextCache[template_name]=codeblock;try{eval("var codeblock_method = function(self){return "+codeblock+";};");}catch(e){var msg="HypertagOS Compiler\n    An error occurred compiling "+self.uuid_to_name_debug_lookup[template_name.slice(2)]||template_name+":\n\n    "+String(e);throw msg;}Hypertag.Runtime.CompiledTemplateOptionsCache[template_name]=codeblock_method;}else{codeblock="false";Hypertag.Runtime.CompiledTemplateOptionsTextCache[template_name]=codeblock;try{eval("var codeblock_method = function(self){return "+codeblock+";};");}catch(e){throw"HypertagOS Compiler\n    An error occurred compiling "+self.uuid_to_name_debug_lookup[template_name.slice(2)]||template_name+":\n\n    "+String(e);}Hypertag.Runtime.CompiledTemplateOptionsCache[template_name]=codeblock_method;}self._ConvertHypertagsToInstances(template_dom);self._RecursivelySubstituteRealTemplatesForAnonymousOnes(template_name,template_dom);templatenode_text=self._decodeURIsInNodeAttributes(["src","href"],PrintInnerXML(template_dom));try{templatenode_text=templatenode_text.replace(/\%amp\;/g,"&amp;").replace(/\%lt\;/g,"&lt;").replace(/\%gt\;/g,"&gt;").replace(/\{\-/g,"&lt;").replace(/\-\}/g,"&gt;").replace(/\&quot\;/g,'"');var template=$.template(templatenode_text);Hypertag.Runtime.CompiledTemplateCache[template_name]=template;}catch(err){throw"problem compiling the template "+template_name+", "+err+".\n\n"+templatenode_text;}templatenode=null;templatenode_text=null;template_dom=null;};CompilerClass.prototype._RecursivelySubstituteRealTemplatesForAnonymousOnes=function(template_name,template_dom){var server=template_dom.getAttribute("server")||"*";if(Hypertag.Runtime.AnonymousTemplatesForTemplate[template_name]===undefined){Hypertag.Runtime.AnonymousTemplatesForTemplate[template_name]={};}var all_items=$.makeArray(template_dom.childNodes);var item;while(item=all_items.shift()){if(item.nodeType!=1){continue;}else{if(hasClass(item,"hypertag")){var inner_template_nodes=[];var children=$.makeArray(item.childNodes);for(var i=0;i<children.length;i++){if(children[i].nodeType==1){inner_template_nodes.push(children[i].cloneNode(true));item.removeChild(children[i]);}}if(inner_template_nodes.length){var inner_template=EmptyTemplate.cloneNode(true);for(var i=0;i<inner_template_nodes.length;i++){inner_template.appendChild(inner_template_nodes[i]);}var uuid=MD5(PrintXML(inner_template));var server_and_template_name=server+"/"+uuid;Hypertag.Runtime.TemplateNodesByServer[server_and_template_name]=inner_template;Hypertag.Runtime.TemplateLowercaseLookup[server_and_template_name.toLowerCase()]=server_and_template_name;Hypertag.Runtime.AnonymousTemplatesForTemplate[template_name][server_and_template_name]=true;$(item).attr("inner_template",uuid);}}else{var children=$.makeArray(item.childNodes);if(children.length){for(var i=0;i<children.length;i++){if(children[i].nodeType==1){all_items.push(children[i]);}}}}}}return template_dom;};CompilerClass.prototype.ImportTemplatesFromText=function(templatetagstext,overwrite){var self=this;var templates_loaded=[];templatetagstext=templatetagstext.replace(/\&(?!(\#|amp\;))/g,"&amp;");var dom=ParseXML("<div xmlns='http://www.w3.org/1999/xhtml'>"+templatetagstext+"</div>");for(var i in dom.childNodes){var node=dom.childNodes[i];if(node.nodeType==1&&node.tagName=="script"&&(node.attributes.getNamedItem("type").nodeValue=="text/hypertag")){var template_id=node.attributes.getNamedItem("id").nodeValue;var server_to_use="*";server_to_use=server_to_use?server_to_use:"*";var server_and_template_name=server_to_use+"/"+template_id;templates_loaded.push(server_and_template_name);Hypertag.Runtime.TemplateNodesByServer[server_and_template_name]=node;Hypertag.Runtime.TemplateLowercaseLookup[server_and_template_name.toLowerCase()]=server_and_template_name;var tagtype=node.getAttribute("tagtype");if(tagtype){Hypertag.Runtime.TemplateTagType["*/"+template_id.toLowerCase()]=tagtype;}self._PerformSetupForExtendAttribute(server_and_template_name,node.attributes.getNamedItem("extend"));if(overwrite){if(delete Hypertag.Runtime.CompiledTemplateCache[server_and_template_name]){delete Hypertag.Runtime.CompiledTemplateCache[server_and_template_name];}if(Hypertag.Runtime.CompiledTemplateOptionsCache[server_and_template_name]){delete Hypertag.Runtime.CompiledTemplateOptionsCache[server_and_template_name];}}}}return templates_loaded;};CompilerClass.prototype._LoadedLibraries={};CompilerClass.prototype._LoadLibrariesFromScripts=function(after){var self=this;var libraries=$("script[type='library/hypertag']");if(!libraries.length){return after();}for(var i=0;i!=libraries.length;i++){var $library=$(libraries[i]);var url=$library.attr("url");var hash=$library.attr("hash")||false;$library.remove();if(!self._LoadedLibraries[url]){$.ajax({url:url,async:false,dataType:"String",complete:function(response){if(response.responseText){var text_hash=MD5(response.responseText);console.log("Loading library at "+url+"...");if(hash&&hash!==text_hash){alert("Loading "+url+" had a bad hash. ("+text_hash+" should have been "+hash);}else{Hypertag.$Body.append(response.responseText);}}}});}self._LoadedLibraries[url]=true;}setTimeout(function(){self._LoadLibrariesFromScripts(after);});};CompilerClass.prototype._ConvertHypertagsToInstances=function(template_dom){var allitems=$.makeArray($(template_dom).children());var itemsready=[];while(allitems.length){var item=allitems.pop();if(item.tagName.toLowerCase()!="svg"||item.getAttribute("tagtype").toLowerCase()!="svg"){itemsready.push(item);var children=$.makeArray($(item).children());for(var k=0;k<children.length;k++){if(children[k].nodeType==1){allitems.push(children[k]);}}}}itemsready.reverse();for(var i=0,item;(item=itemsready[i]);i++){var tagname=item.tagName.toLowerCase();if(!Hypertag.Runtime.html_tag_names[tagname]){var server=item.getAttribute("server");server=server?server:"*";var tag=item.getAttribute("tagtype")||Hypertag.Runtime.TemplateTagType[server+"/"+tagname]||"div";var new_div=ParseXML("<"+tag+" xmlns='http://www.w3.org/1999/xhtml'>"+PrintInnerXML(item)+"</"+tag+">");var template_name=Hypertag.Runtime.TemplateLowercaseLookup[server+"/"+tagname];if(Hypertag.Runtime.CompiledTemplateAttributeNames[template_name]){for(var key in Hypertag.Runtime.CompiledTemplateAttributeNames[template_name]){new_div.setAttribute(key,Hypertag.Runtime.CompiledTemplateAttributeNames[template_name][key]);}}for(var j=0;j<item.attributes.length;j++){new_div.setAttribute(item.attributes[j].nodeName,item.attributes[j].nodeValue);}var classes=new_div.getAttribute("class");var new_class_value=!classes?"hypertag":"hypertag "+classes;new_div.setAttribute("class",new_class_value);if(tagname!="view"){if(tagname.toLowerCase()=="parsererror"){var p=template_dom;while(1){if(!p.parentNode){break;}else{p=p.parentNode;}}var msg="XML PARSER PROBLEM (in tagname "+tagname+") when converting hypertag to html instance: \n\n"+PrintXML(p)+"\n\n----\n\n"+PrintXML(template_dom);throw msg;}else{if(!template_name){var msg="You're trying to instantiate a '"+tagname+"' hypertag, but a template tag/id for that template has not been defined, or it is not of type 'text/hypertag'! (please note the name is case insenstive)";throw msg;}}var just_template_name=template_name.slice(template_name.indexOf("/")+1);$(new_div).attr("template",just_template_name);}item.parentNode.replaceChild(new_div,item);}}return template_dom;};CompilerClass.prototype._decodeURIsInNodeAttributes=function(attrs,text){text=String(text);var replaces={};if(!(attrs instanceof Array)){attrs=[attrs];}for(var i=0;i<attrs.length;i++){var attr=attrs[i];var attr_open=" "+attr+'="';var attr_close='"';var intermediate_str=String(text);var startidx;while((startidx=intermediate_str.indexOf(attr_open))!=-1){var intermediate_str=intermediate_str.slice(startidx+attr.length+3);var repl_str=intermediate_str.slice(0,intermediate_str.indexOf(attr_close));if(repl_str.indexOf("%7B%7B=%20")==-1){continue;}replaces[attr_open+repl_str+attr_close]=attr_open+decodeURI(repl_str)+attr_close;}}for(var repl_str in replaces){text=text.replace(repl_str,replaces[repl_str],"g");}return text;};CompilerClass.prototype._parseAttributesIntoCodeBlock=function(node,template){var node=node.cloneNode(true);var output="";for(var i=0,attr;(attr=node.attributes[i]);i++){if(attr.nodeName!="id"&&attr.nodeName!="type"){var name=attr.nodeName;var value=attr.nodeValue;output+=name+':"'+value+'",\n';}}if(output){$(node).prepend("\n"+output);}return node;};CompilerClass.prototype._BuildTemplateLookups=function(){var self=this;$("script").each(function(){if(this.type=="text/hypertag"){var template_id=this.attributes.getNamedItem("id").nodeValue;var tag=this.attributes.getNamedItem("tagtype");tag=tag?tag.nodeValue:"div";var template_name="*/"+template_id;var lower_case_name="*/"+template_id.toLowerCase();Hypertag.Runtime.TemplateLowercaseLookup[lower_case_name]="*/"+template_id;Hypertag.Runtime.TemplateTagType[lower_case_name]=tag;self._PerformSetupForExtendAttribute(template_name,this.attributes.getNamedItem("extend"));}});};CompilerClass.prototype._ProcessSHMLTemplateTags=function(){var self=this;$("script").each(function(){if(this.type=="text/hypertag"){var templatetext=PrintInnerXML(this).replace(/\&lt\;/g,"<").replace(/\&gt\;/g,">").replace(/\&quot\;/g,'"').replace(/\&(?!\w|\#)/g,"&amp;");if(templatetext.indexOf("<!--")===0){var end_of_directive_idx=templatetext.indexOf("->");if(end_of_directive_idx!==-1&&["dialect shml","markup shml"].indexOf(templatetext.slice(4,end_of_directive_idx-1).trim().toLowerCase())!==-1){$(this).html(Hypertag.SHML.process(templatetext).replace(/\&(?!\w|\#)/g,"&amp;"));}}}});};CompilerClass.prototype.stripComments=function(file_contents){var lines=file_contents.split("\n");for(var i=0;i<lines.length;i++){var slashidx=lines[i].indexOf("//");if(slashidx!==-1){lines[i]=lines[i].slice(0,slashidx);}}return lines.join("\n");};CompilerClass.prototype._PerformSetupForExtendAttribute=function(template_name,extend){if(extend){extend=extend.nodeValue.trim();if(extend.indexOf("/")==-1){extend="*/"+extend;}var lookup=Hypertag.Runtime.ExtendsTemplateLookup;if(!lookup[extend]){lookup[extend]=[];}lookup[extend].push(template_name);}};CompilerClass.prototype._executeJSInApp=RuntimeClass.prototype._executeJSInApp;CompilerClass.prototype._addCSSByKey=RuntimeClass.prototype._addCSSByKey;CompilerClass.prototype._removeCSSByKey=RuntimeClass.prototype._removeCSSByKey;if(!Hypertag){Hypertag={};}GLOBAL.isAltPressed=false;GLOBAL.isCrtlPressed=false;GLOBAL.isMetaPressed=false;GLOBAL.isShiftPressed=false;GLOBAL.isCommandPressed=false;Hypertag.GUI=function(){var self={};self.disableKeyEvents=false;self._SizedToWindowInitialEventsRequired=[];self.mousemove=false;self.duration=300;self.cancelDragIfOccuring=function(){var state=Hypertag.Dragging.state;var dragmethods=HypertagDraggingClass.prototype;if(state=="waiting"){Hypertag.Dragging.state="idle";return false;}else{if(state=="dragging"){dragmethods.dragDropping(false,false);return false;}}return true;};self.focus={setLayer:function(layer){if(this.layer==layer){return;}if(!layer.window){layer.window={};}if(!layer._windowStack){layer._windowStack=[];}if(this.layer&&this.layer.window){send(this.layer.window,"__unfocused__");if(this.layer.window.focused&&this.layer.window.focused.focusring!==false){$(this.layer.window.focused).removeClass("focused");}}set(this,"layer",layer);if(this.layer.window){send(this.layer.window,"__focused__");}var focused=this.layer.window.focused;if(focused){if(focused.tagName.toLowerCase()=="input"){$(focused).focus();}if(focused.focusring!==false){$(focused).addClass("focused");}}},setWindow:function(element){if(this.layer.window.focused){if(this.layer.window.focused.focusring!==false){$(this.layer.window.focused).removeClass("focused").blur();}}if(this.layer.window){send(this.layer.window,"__unfocused__");}set(this.layer,"window",element);if(element){send(this.layer.window,"__focused__");}var focused=this.layer.window.focused;if(focused){if(focused.tagName.toLowerCase()=="input"){$(focused).focus();}if(focused.focusring!==false){$(focused).addClass("focused");}}},setFocused:function(element){if(!this.layer||!this.layer.window||(this.layer.window.focused&&this.layer.window.focused===element)){return;}var focused=this.layer.window.focused;if(focused&&focused!=element){var jtarget=$(focused);if(focused.focusring!==false){jtarget.removeClass("focused");}}set(this.layer.window,"focused",element);if(element&&element.focusring!==false){$(element).addClass("focused");}},pushFocused:function(element){var layer=Hypertag.GUI.focus.layer;var lastFocus=false;if(layer&&layer.window&&layer.window.focused){lastFocus=layer.window.focused;}if(Hypertag.GUI.focus.layer&&Hypertag.GUI.focus.layer.window!=element){Hypertag.GUI.focus.setFocused(element);Hypertag.GUI.focus._lastFocus=lastFocus;}},popFocused:function(){var layer=Hypertag.GUI.focus.layer;if(Hypertag.GUI.focus._lastFocus){Hypertag.GUI.focus.setFocused(Hypertag.GUI.focus._lastFocus);}else{if(layer&&layer.window){layer.window.focused=false;}}Hypertag.GUI.focus._lastFocus=false;},blurInputMethod:function(e){Hypertag.GUI.focus.setFocused(false);},focusInputMethod:function(e){Hypertag.GUI.focus.setFocused(this);}};return self;}();listen(Hypertag,"__ready__",function(){$(window).mousemove(function(e){Hypertag.GUI.mousemove=e;return true;});$(window).mouseup(function(e){Hypertag.GUI.mousedown=false;Hypertag.GUI.cancelDragIfOccuring();return true;});$(window).keyup(function(e){GLOBAL.isAltPressed=e.altKey;GLOBAL.isCrtlPressed=e.crtlKey;GLOBAL.isMetaPressed=e.metaKey;GLOBAL.isShiftPressed=e.shiftKey!==undefined?e.shiftKey:GLOBAL.isShiftPressed;GLOBAL.isCommandPressed=GLOBAL.isAltPressed;return true;});$(window).focus(function(e){GLOBAL.isAltPressed=GLOBAL.isCommandPressed=false;return true;});$(window).blur(function(e){GLOBAL.isAltPressed=GLOBAL.isCommandPressed=false;return true;});$(window).keydown(function(e){try{var retval;GLOBAL.isAltPressed=GLOBAL.isCommandPressed=e.altKey;GLOBAL.isCrtlPressed=e.crtlKey;GLOBAL.isMetaPressed=e.metaKey;GLOBAL.isShiftPressed=e.shiftKey!==undefined?e.shiftKey:GLOBAL.isShiftPressed;if(e.metaKey){return true;}var self=Hypertag.GUI.focus.layer?Hypertag.GUI.focus.layer.window:false;if(e.keyCode==8&&self.focused&&["input","textarea"].intersect(self.focused.tagName.toLowerCase())){return true;}if(Hypertag.GUI.showKeyCode){Hypertag.Debugger.comment("e.keyCode",e.keyCode);}if(!self){return true;}if(e.keyCode==13){retval=conditionalFocusFireForApp(self,e,"__enter__");}else{if(e.keyCode==32){if(self.tagName=="input"&&self.getAttribute("type")=="button"){$(self).trigger("click");retval=false;}else{retval=conditionalFocusFireForApp(self,e,"__space__");}}else{if(e.keyCode==8){retval=conditionalFocusFireForApp(self,e,"__backspace__");if(self.focused&&self.focused.__backspace__){return false;}}else{if(e.keyCode==38){retval=conditionalFocusFireForApp(self,e,"__uparrow__");}else{if(e.keyCode==40){retval=conditionalFocusFireForApp(self,e,"__downarrow__");}else{if(e.keyCode==37){retval=conditionalFocusFireForApp(self,e,"__leftarrow__");}else{if(e.keyCode==39){retval=conditionalFocusFireForApp(self,e,"__rightarrow__");}else{if(e.keyCode==27){retval=conditionalFocusFireForApp(self,e,"__escape__");}else{if(e.keyCode==9){retval=conditionalFocusFireForApp(self,e,"__tab__");}}}}}}}}}if(retval!==false&&GLOBAL.isCommandPressed){retval=conditionalSend(self,"shortcutKey",function(method,context){return method.call(context?context:self,e.keyCode,String.fromCharCode(e.keyCode),e);});}if(retval!==false){conditionalSend(self,"__keypress__",function(method,context){var val=method.call(context,e);if(retval!==false){retval=val;}return true;});if(self.focused&&self.focused.__keypress__){retval=self.focused.__keypress__(e)||false;self.focused.send("__keypress__",e);}}if(GLOBAL.isAltPressed&&(e.keyCode==38||e.keyCode==40||e.keyCode==82)){return false;}if(e.keyCode==8&&self.focused){return false;}return retval===undefined?true:retval;}catch(e){var msg="Error handling a keydown event. Key was "+e.keyCode+", Target is: "+String(e.target)+"\n\nError is: "+e;Hypertag.Debugger.error(msg);return false;}});});function conditionalFocusFireForApp(self,e,eventname){var retval;conditionalSend(self,eventname,function(method,context){var val=method.call(context,e);if(retval!==false&&retval!==undefined){retval=val;}return true;});if(retval!==false&&self.api&&self.api[eventname]){retval=self.api[eventname](e)||false;conditionalSend(self.api,eventname,function(method,context){var val=method.call(context,e);if(retval!==false){retval=val;}return true;});}if(retval!==false&&self.focused&&self.focused[eventname]){retval=self.focused[eventname](e)||false;conditionalSend(self.focused,eventname,function(method,context){var val=method.call(context,e);if(retval!==false){retval=val;}return true;});}return retval;}function SendToBack(element,onlyIfHasClassFlag){return BringToFront(element,onlyIfHasClassFlag,true);}function BringToFront(element,onlyIfHasClassFlag,reverseFlag){onlyIfHasClassFlag=onlyIfHasClassFlag?"."+onlyIfHasClassFlag:undefined;var children=$.makeArray($(element).parent().children(onlyIfHasClassFlag));var zmap=[];for(var i=0;i<children.length;i++){zmap[children[i]._zindex]=children[i];}var offset=0;var reordered_zmap=[];for(var k=0;k<zmap.length;k++){if(zmap[k]&&zmap[k]!=element){reordered_zmap.push(zmap[k]);}}for(var i=reverseFlag?1:0;i<reordered_zmap.length;i++){reordered_zmap[i]._zindex=i;$(reordered_zmap[i]).css("z-index",i);}element._zindex=reverseFlag?0:reordered_zmap.length;$(element).css("z-index",element._zindex);}